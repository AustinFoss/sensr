/*! For license information please see sw.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.sw=t():e.sw=t()}(this,()=>(()=>{var e,t,r,n,s={38:(e,t,r)=>{"use strict";r.d(t,{f:()=>ke});var n=r(6552),s=r(7191),i=r(6800),o=r(5291),a=r(298),c=r(9820),l=r(515);function u(){const e=(0,l.A)();let t=!1;return{sink:async r=>{if(t)throw new Error("already piped");t=!0,e.resolve(r)},source:async function*(){const t=await e.promise;yield*t}()}}var h=r(9986),d=r(6345);const f=65535,p=Boolean(globalThis.process?.env?.DUMP_SESSION_KEYS);function g(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function m(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}function y(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function w(e,...t){if(!g(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function b(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function v(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function E(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const x=(()=>68===new Uint8Array(new Uint32Array([287454020]).buffer)[0])();function S(e){if("string"==typeof e)e=function(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}(e);else{if(!g(e))throw new Error("Uint8Array expected, got "+typeof e);e=k(e)}return e}const A=(e,t)=>{function r(r,...n){if(w(r),!x)throw new Error("Non little-endian hardware is not yet supported");if(void 0!==e.nonceLength){const t=n[0];if(!t)throw new Error("nonce / iv required");e.varSizeNonce?w(t):w(t,e.nonceLength)}const s=e.tagLength;s&&void 0!==n[1]&&w(n[1]);const i=t(r,...n),o=(e,t)=>{if(void 0!==t){if(2!==e)throw new Error("cipher output not supported");w(t)}};let a=!1;return{encrypt(e,t){if(a)throw new Error("cannot encrypt() twice with same key + nonce");return a=!0,w(e),o(i.encrypt.length,t),i.encrypt(e,t)},decrypt(e,t){if(w(e),s&&e.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return o(i.decrypt.length,t),i.decrypt(e,t)}}}return Object.assign(r,e),r};function I(e,t,r=!0){if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw new Error("invalid output length, expected "+e+", got: "+t.length);if(r&&t.byteOffset%4!=0)throw new Error("invalid output, must be aligned");return t}function C(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,l=n?0:4;e.setUint32(t+c,o,n),e.setUint32(t+l,a,n)}function k(e){return Uint8Array.from(e)}const P=e=>Uint8Array.from(e.split("").map(e=>e.charCodeAt(0))),T=P("expand 16-byte k"),_=P("expand 32-byte k"),D=v(T),L=v(_);function R(e,t){return e<<t|e>>>32-t}function U(e){return e.byteOffset%4==0}const M=2**32-1,B=new Uint32Array;function N(e,t){const{allowShortKeys:r,extendNonceFn:n,counterLength:s,counterRight:i,rounds:o}=function(e,t){if(null==t||"object"!=typeof t)throw new Error("options must be defined");return Object.assign({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t)}(0,t);if("function"!=typeof e)throw new Error("core must be a function");return y(s),y(o),m(i),m(r),(t,a,c,l,u=0)=>{w(t),w(a),w(c);const h=c.length;if(void 0===l&&(l=new Uint8Array(h)),w(l),y(u),u<0||u>=M)throw new Error("arx: counter overflow");if(l.length<h)throw new Error(`arx: output (${l.length}) is shorter than data (${h})`);const d=[];let f,p,g=t.length;if(32===g)d.push(f=k(t)),p=L;else{if(16!==g||!r)throw new Error(`arx: invalid 32-byte key, got length=${g}`);f=new Uint8Array(32),f.set(t),f.set(t,16),p=D,d.push(f)}U(a)||d.push(a=k(a));const m=v(f);if(n){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");n(p,m,v(a.subarray(0,16)),m),a=a.subarray(16)}const b=16-s;if(b!==a.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(12!==b){const e=new Uint8Array(12);e.set(a,i?0:12-a.length),a=e,d.push(a)}const x=v(a);return function(e,t,r,n,s,i,o,a){const c=s.length,l=new Uint8Array(64),u=v(l),h=U(s)&&U(i),d=h?v(s):B,f=h?v(i):B;for(let p=0;p<c;o++){if(e(t,r,n,u,o,a),o>=M)throw new Error("arx: counter overflow");const g=Math.min(64,c-p);if(h&&64===g){const e=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let t,r=0;r<16;r++)t=e+r,f[t]=d[t]^u[r];p+=64;continue}for(let e,t=0;t<g;t++)e=p+t,i[e]=s[e]^l[t];p+=g}}(e,p,m,x,c,l,u,o),E(...d),l}}const O=(e,t)=>255&e[t++]|(255&e[t++])<<8;class F{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,w(e=S(e),32);const t=O(e,0),r=O(e,2),n=O(e,4),s=O(e,6),i=O(e,8),o=O(e,10),a=O(e,12),c=O(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|r<<3),this.r[2]=7939&(r>>>10|n<<6),this.r[3]=8191&(n>>>7|s<<9),this.r[4]=255&(s>>>4|i<<12),this.r[5]=i>>>1&8190,this.r[6]=8191&(i>>>14|o<<2),this.r[7]=8065&(o>>>11|a<<5),this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127;for(let t=0;t<8;t++)this.pad[t]=O(e,16+2*t)}process(e,t,r=!1){const n=r?0:2048,{h:s,r:i}=this,o=i[0],a=i[1],c=i[2],l=i[3],u=i[4],h=i[5],d=i[6],f=i[7],p=i[8],g=i[9],m=O(e,t+0),y=O(e,t+2),w=O(e,t+4),b=O(e,t+6),v=O(e,t+8),E=O(e,t+10),x=O(e,t+12),S=O(e,t+14);let A=s[0]+(8191&m),I=s[1]+(8191&(m>>>13|y<<3)),C=s[2]+(8191&(y>>>10|w<<6)),k=s[3]+(8191&(w>>>7|b<<9)),P=s[4]+(8191&(b>>>4|v<<12)),T=s[5]+(v>>>1&8191),_=s[6]+(8191&(v>>>14|E<<2)),D=s[7]+(8191&(E>>>11|x<<5)),L=s[8]+(8191&(x>>>8|S<<8)),R=s[9]+(S>>>5|n),U=0,M=U+A*o+I*(5*g)+C*(5*p)+k*(5*f)+P*(5*d);U=M>>>13,M&=8191,M+=T*(5*h)+_*(5*u)+D*(5*l)+L*(5*c)+R*(5*a),U+=M>>>13,M&=8191;let B=U+A*a+I*o+C*(5*g)+k*(5*p)+P*(5*f);U=B>>>13,B&=8191,B+=T*(5*d)+_*(5*h)+D*(5*u)+L*(5*l)+R*(5*c),U+=B>>>13,B&=8191;let N=U+A*c+I*a+C*o+k*(5*g)+P*(5*p);U=N>>>13,N&=8191,N+=T*(5*f)+_*(5*d)+D*(5*h)+L*(5*u)+R*(5*l),U+=N>>>13,N&=8191;let F=U+A*l+I*c+C*a+k*o+P*(5*g);U=F>>>13,F&=8191,F+=T*(5*p)+_*(5*f)+D*(5*d)+L*(5*h)+R*(5*u),U+=F>>>13,F&=8191;let q=U+A*u+I*l+C*c+k*a+P*o;U=q>>>13,q&=8191,q+=T*(5*g)+_*(5*p)+D*(5*f)+L*(5*d)+R*(5*h),U+=q>>>13,q&=8191;let z=U+A*h+I*u+C*l+k*c+P*a;U=z>>>13,z&=8191,z+=T*o+_*(5*g)+D*(5*p)+L*(5*f)+R*(5*d),U+=z>>>13,z&=8191;let K=U+A*d+I*h+C*u+k*l+P*c;U=K>>>13,K&=8191,K+=T*a+_*o+D*(5*g)+L*(5*p)+R*(5*f),U+=K>>>13,K&=8191;let $=U+A*f+I*d+C*h+k*u+P*l;U=$>>>13,$&=8191,$+=T*c+_*a+D*o+L*(5*g)+R*(5*p),U+=$>>>13,$&=8191;let j=U+A*p+I*f+C*d+k*h+P*u;U=j>>>13,j&=8191,j+=T*l+_*c+D*a+L*o+R*(5*g),U+=j>>>13,j&=8191;let V=U+A*g+I*p+C*f+k*d+P*h;U=V>>>13,V&=8191,V+=T*u+_*l+D*c+L*a+R*o,U+=V>>>13,V&=8191,U=(U<<2)+U|0,U=U+M|0,M=8191&U,U>>>=13,B+=U,s[0]=M,s[1]=B,s[2]=N,s[3]=F,s[4]=q,s[5]=z,s[6]=K,s[7]=$,s[8]=j,s[9]=V}finalize(){const{h:e,pad:t}=this,r=new Uint16Array(10);let n=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=n,n=e[t]>>>13,e[t]&=8191;e[0]+=5*n,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,r[0]=e[0]+5,n=r[0]>>>13,r[0]&=8191;for(let t=1;t<10;t++)r[t]=e[t]+n,n=r[t]>>>13,r[t]&=8191;r[9]-=8192;let s=(1^n)-1;for(let e=0;e<10;e++)r[e]&=s;s=~s;for(let t=0;t<10;t++)e[t]=e[t]&s|r[t];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let i=e[0]+t[0];e[0]=65535&i;for(let r=1;r<8;r++)i=(e[r]+t[r]|0)+(i>>>16)|0,e[r]=65535&i;E(r)}update(e){b(this),w(e=S(e));const{buffer:t,blockLen:r}=this,n=e.length;for(let s=0;s<n;){const i=Math.min(r-this.pos,n-s);if(i!==r)t.set(e.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===r&&(this.process(t,0,!1),this.pos=0);else for(;r<=n-s;s+=r)this.process(e,s)}return this}destroy(){E(this.h,this.r,this.buffer,this.pad)}digestInto(e){b(this),function(e,t){w(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}(e,this),this.finished=!0;const{buffer:t,h:r}=this;let{pos:n}=this;if(n){for(t[n++]=1;n<16;n++)t[n]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let t=0;t<8;t++)e[s++]=r[t]>>>0,e[s++]=r[t]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}}const q=function(e){const t=(t,r)=>e(r).update(S(t)).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}(e=>new F(e));function z(e,t,r,n,s,i=20){let o=e[0],a=e[1],c=e[2],l=e[3],u=t[0],h=t[1],d=t[2],f=t[3],p=t[4],g=t[5],m=t[6],y=t[7],w=s,b=r[0],v=r[1],E=r[2],x=o,S=a,A=c,I=l,C=u,k=h,P=d,T=f,_=p,D=g,L=m,U=y,M=w,B=b,N=v,O=E;for(let e=0;e<i;e+=2)x=x+C|0,M=R(M^x,16),_=_+M|0,C=R(C^_,12),x=x+C|0,M=R(M^x,8),_=_+M|0,C=R(C^_,7),S=S+k|0,B=R(B^S,16),D=D+B|0,k=R(k^D,12),S=S+k|0,B=R(B^S,8),D=D+B|0,k=R(k^D,7),A=A+P|0,N=R(N^A,16),L=L+N|0,P=R(P^L,12),A=A+P|0,N=R(N^A,8),L=L+N|0,P=R(P^L,7),I=I+T|0,O=R(O^I,16),U=U+O|0,T=R(T^U,12),I=I+T|0,O=R(O^I,8),U=U+O|0,T=R(T^U,7),x=x+k|0,O=R(O^x,16),L=L+O|0,k=R(k^L,12),x=x+k|0,O=R(O^x,8),L=L+O|0,k=R(k^L,7),S=S+P|0,M=R(M^S,16),U=U+M|0,P=R(P^U,12),S=S+P|0,M=R(M^S,8),U=U+M|0,P=R(P^U,7),A=A+T|0,B=R(B^A,16),_=_+B|0,T=R(T^_,12),A=A+T|0,B=R(B^A,8),_=_+B|0,T=R(T^_,7),I=I+C|0,N=R(N^I,16),D=D+N|0,C=R(C^D,12),I=I+C|0,N=R(N^I,8),D=D+N|0,C=R(C^D,7);let F=0;n[F++]=o+x|0,n[F++]=a+S|0,n[F++]=c+A|0,n[F++]=l+I|0,n[F++]=u+C|0,n[F++]=h+k|0,n[F++]=d+P|0,n[F++]=f+T|0,n[F++]=p+_|0,n[F++]=g+D|0,n[F++]=m+L|0,n[F++]=y+U|0,n[F++]=w+M|0,n[F++]=b+B|0,n[F++]=v+N|0,n[F++]=E+O|0}const K=N(z,{counterRight:!1,counterLength:4,allowShortKeys:!1}),$=N(z,{counterRight:!1,counterLength:8,extendNonceFn:function(e,t,r,n){let s=e[0],i=e[1],o=e[2],a=e[3],c=t[0],l=t[1],u=t[2],h=t[3],d=t[4],f=t[5],p=t[6],g=t[7],m=r[0],y=r[1],w=r[2],b=r[3];for(let e=0;e<20;e+=2)s=s+c|0,m=R(m^s,16),d=d+m|0,c=R(c^d,12),s=s+c|0,m=R(m^s,8),d=d+m|0,c=R(c^d,7),i=i+l|0,y=R(y^i,16),f=f+y|0,l=R(l^f,12),i=i+l|0,y=R(y^i,8),f=f+y|0,l=R(l^f,7),o=o+u|0,w=R(w^o,16),p=p+w|0,u=R(u^p,12),o=o+u|0,w=R(w^o,8),p=p+w|0,u=R(u^p,7),a=a+h|0,b=R(b^a,16),g=g+b|0,h=R(h^g,12),a=a+h|0,b=R(b^a,8),g=g+b|0,h=R(h^g,7),s=s+l|0,b=R(b^s,16),p=p+b|0,l=R(l^p,12),s=s+l|0,b=R(b^s,8),p=p+b|0,l=R(l^p,7),i=i+u|0,m=R(m^i,16),g=g+m|0,u=R(u^g,12),i=i+u|0,m=R(m^i,8),g=g+m|0,u=R(u^g,7),o=o+h|0,y=R(y^o,16),d=d+y|0,h=R(h^d,12),o=o+h|0,y=R(y^o,8),d=d+y|0,h=R(h^d,7),a=a+c|0,w=R(w^a,16),f=f+w|0,c=R(c^f,12),a=a+c|0,w=R(w^a,8),f=f+w|0,c=R(c^f,7);let v=0;n[v++]=s,n[v++]=i,n[v++]=o,n[v++]=a,n[v++]=m,n[v++]=y,n[v++]=w,n[v++]=b},allowShortKeys:!1}),j=new Uint8Array(16),V=(e,t)=>{e.update(t);const r=t.length%16;r&&e.update(j.subarray(r))},H=new Uint8Array(32);function G(e,t,r,n,s){const i=e(t,r,H),o=q.create(i);s&&V(o,s),V(o,n);const a=function(e,t,r){m(r);const n=new Uint8Array(16),s=(i=n,new DataView(i.buffer,i.byteOffset,i.byteLength));var i;return C(s,0,BigInt(t),r),C(s,8,BigInt(e),r),n}(n.length,s?s.length:0,!0);o.update(a);const c=o.digest();return E(i,a),c}const W=e=>(t,r,n)=>({encrypt(s,i){const o=s.length;(i=I(o+16,i,!1)).set(s);const a=i.subarray(0,-16);e(t,r,a,a,1);const c=G(e,t,r,a,n);return i.set(c,o),E(c),i},decrypt(s,i){i=I(s.length-16,i,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=G(e,t,r,o,n);if(!function(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}(a,c))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),e(t,r,i,i,1),E(c),i}}),Z=A({blockSize:64,nonceLength:12,tagLength:16},W(K));W($);var Y=r(775),Q=r(7884),X=r(4597);const J=Uint8Array.from([0]),ee=Uint8Array.of();var te=r(2384);const re={hashSHA256:e=>(0,te.sc)(e.subarray()),getHKDF(e,t){const r=function(e,t,r){return(0,X.sd)(e),void 0===r&&(r=new Uint8Array(e.outputLen)),(0,Q.w)(e,(0,X.ZJ)(r),(0,X.ZJ)(t))}(te.sc,t,e),n=function(e,t,r,n=32){(0,X.sd)(e),(0,X.Fe)(n);const s=e.outputLen;if(n>255*s)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/s);void 0===r&&(r=ee);const o=new Uint8Array(i*s),a=Q.w.create(e,t),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let e=0;e<i;e++)J[0]=e+1,c.update(0===e?ee:l).update(r).update(J).digestInto(l),o.set(l,s*e),a._cloneInto(c);return a.destroy(),c.destroy(),(0,X.uH)(l,J),o.slice(0,n)}(te.sc,r,void 0,96);return[n.subarray(0,32),n.subarray(32,64),n.subarray(64,96)]},generateX25519KeyPair(){const e=Y.TU.utils.randomPrivateKey();return{publicKey:Y.TU.getPublicKey(e),privateKey:e}},generateX25519KeyPairFromSeed:e=>({publicKey:Y.TU.getPublicKey(e),privateKey:e}),generateX25519SharedKey:(e,t)=>Y.TU.getSharedSecret(e.subarray(),t.subarray()),chaCha20Poly1305Encrypt:(e,t,r,n)=>Z(n,t,r).encrypt(e.subarray()),chaCha20Poly1305Decrypt:(e,t,r,n,s)=>Z(n,t,r).decrypt(e.subarray(),s)};var ne=r(86);const se=e=>{const t=(0,d.K)(2);return t[0]=e>>8,t[1]=e,t};se.bytes=2;const ie=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");if(e instanceof Uint8Array){let t=0;return t+=e[0]<<8,t+=e[1],t}return e.getUint16(0)};ie.bytes=2;var oe=r(5129);function ae(e,t){t.enabled&&p&&(e?(t(`LOCAL_STATIC_PUBLIC_KEY ${(0,oe.d)(e.publicKey,"hex")}`),t(`LOCAL_STATIC_PRIVATE_KEY ${(0,oe.d)(e.privateKey,"hex")}`)):t("Missing local static keys."))}function ce(e,t){t.enabled&&p&&(e?(t(`LOCAL_PUBLIC_EPHEMERAL_KEY ${(0,oe.d)(e.publicKey,"hex")}`),t(`LOCAL_PRIVATE_EPHEMERAL_KEY ${(0,oe.d)(e.privateKey,"hex")}`)):t("Missing local ephemeral keys."))}function le(e,t){t.enabled&&p&&t(e?`REMOTE_EPHEMERAL_PUBLIC_KEY ${(0,oe.d)(e.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function ue(e,t,r){r.enabled&&p&&(r(`CIPHER_STATE_1 ${e.n.getUint64()} ${e.k&&(0,oe.d)(e.k,"hex")}`),r(`CIPHER_STATE_2 ${t.n.getUint64()} ${t.k&&(0,oe.d)(t.k,"hex")}`))}var he=r(7442);class de extends Error{code;constructor(e="Invalid crypto exchange"){super(e),this.code=de.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"}class fe{n;bytes;view;constructor(e=0){this.n=e,this.bytes=(0,d.c)(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error("Cipherstate has reached maximum n, a new handshake must be performed")}}const pe=(0,d.c)(0);class ge{k;n;crypto;constructor(e,t=void 0,r=0){this.crypto=e,this.k=t,this.n=new fe(r)}hasKey(){return Boolean(this.k)}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();const r=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),r}decryptWithAd(e,t,r){if(!this.hasKey())return t;this.n.assertValue();const n=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,r);return this.n.increment(),n}}class me{cs;ck;h;crypto;constructor(e,t){this.crypto=e;const r=(0,he.s)(t,"utf-8");this.h=function(e,t){if(t.length<=32){const e=(0,d.c)(32);return e.set(t),e}return e.hash(t)}(e,r),this.ck=this.h,this.cs=new ge(e)}mixKey(e){const[t,r]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new ge(this.crypto,r)}mixHash(e){this.h=this.crypto.hash(new ne.I(this.h,e))}encryptAndHash(e){const t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){const t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){const[e,t]=this.crypto.hkdf(this.ck,pe);return[new ge(this.crypto,e),new ge(this.crypto,t)]}}class ye{ss;s;e;rs;re;initiator;crypto;constructor(e){const{crypto:t,protocolName:r,prologue:n,initiator:s,s:i,e:o,rs:a,re:c}=e;this.crypto=t,this.ss=new me(t,r),this.ss.mixHash(n),this.initiator=s,this.s=i,this.e=o,this.rs=a,this.re=c}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");const r=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+r)throw new Error("message is not long enough");const n=e.sublist(t,t+r);return this.rs=this.ss.decryptAndHash(n),r}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class we extends ye{writeMessageA(e){return new ne.I(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){const t=this.writeE();this.writeEE();const r=this.writeS();return this.writeES(),new ne.I(t,r,this.ss.encryptAndHash(e))}writeMessageC(e){const t=this.writeS();return this.writeSE(),new ne.I(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(e){throw new de(`handshake stage 0 validation fail: ${e.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();const t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(e){throw new de(`handshake stage 1 validation fail: ${e.message}`)}}readMessageC(e){try{const t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(e){throw new de(`handshake stage 2 validation fail: ${e.message}`)}}}var be,ve,Ee=r(6119),xe=r(4113);async function Se(e,t,r){const s=await e.sign(Ie(t));return ve.encode({identityKey:(0,n.Ve)(e.publicKey),identitySig:s,extensions:r})}async function Ae(e,t,r){try{const s=ve.decode(e),i=(0,n.EZ)(s.identityKey);if(!1===r?.equals(i))throw new Error(`Payload identity key ${i} does not match expected remote identity key ${r}`);if(!t)throw new Error("Remote static does not exist");const o=Ie(t);if(!await i.verify(o,s.identitySig))throw new Error("Invalid payload signature");return s}catch(e){throw new i.aS(e.message)}}function Ie(e){const t=(0,he.s)("noise-libp2p-static-key:");return e instanceof Uint8Array?(0,Ee.x)([t,e],t.length+e.length):(e.prepend(t),e)}!function(e){let t;e.codec=()=>(null==t&&(t=(0,xe.iU)((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.webtransportCerthashes)for(const r of e.webtransportCerthashes)t.uint32(10),t.bytes(r);if(null!=e.streamMuxers)for(const r of e.streamMuxers)t.uint32(18),t.string(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={webtransportCerthashes:[],streamMuxers:[]},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:if(null!=r.limits?.webtransportCerthashes&&n.webtransportCerthashes.length===r.limits.webtransportCerthashes)throw new xe.zH('Decode error - map field "webtransportCerthashes" had too many elements');n.webtransportCerthashes.push(e.bytes());break;case 2:if(null!=r.limits?.streamMuxers&&n.streamMuxers.length===r.limits.streamMuxers)throw new xe.zH('Decode error - map field "streamMuxers" had too many elements');n.streamMuxers.push(e.string());break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,xe.mH)(t,e.codec()),e.decode=(t,r)=>(0,xe.Y8)(t,e.codec(),r)}(be||(be={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,xe.iU)((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.identityKey&&e.identityKey.byteLength>0&&(t.uint32(10),t.bytes(e.identityKey)),null!=e.identitySig&&e.identitySig.byteLength>0&&(t.uint32(18),t.bytes(e.identitySig)),null!=e.extensions&&(t.uint32(34),be.codec().encode(e.extensions,t)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={identityKey:(0,d.c)(0),identitySig:(0,d.c)(0)},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.identityKey=e.bytes();break;case 2:n.identitySig=e.bytes();break;case 4:n.extensions=be.codec().decode(e,e.uint32(),{limits:r.limits?.extensions});break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,xe.mH)(t,e.codec()),e.decode=(t,r)=>(0,xe.Y8)(t,e.codec(),r)}(ve||(ve={}));class Ce{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(e,t={}){const{staticNoiseKey:r,extensions:n,crypto:s,prologueBytes:i}=t,{metrics:o}=e;this.components=e;const a=s??re;this.crypto=function(e){return{generateKeypair:e.generateX25519KeyPair,dh:(t,r)=>e.generateX25519SharedKey(t.privateKey,r).subarray(0,32),encrypt:e.chaCha20Poly1305Encrypt,decrypt:e.chaCha20Poly1305Decrypt,hash:e.hashSHA256,hkdf:e.getHKDF}}(a),this.extensions={webtransportCerthashes:[],...n},this.metrics=o?function(e){return{xxHandshakeSuccesses:e.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:e.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:e.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:e.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:e.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}(o):void 0,this.staticKey=r?a.generateX25519KeyPairFromSeed(r):a.generateX25519KeyPair(),this.prologue=i??(0,d.c)(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[s.Ch]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(e,t){const r=(0,c.V)(e,{lengthEncoder:se,lengthDecoder:ie,maxDataLength:f}),s=await this.performHandshakeInitiator(r,this.components.privateKey,t?.remotePeer?.publicKey,t),i=await this.createSecureConnection(r,s);e.source=i.source,e.sink=i.sink;const a=(0,n.EZ)(s.payload.identityKey);return{conn:e,remoteExtensions:s.payload.extensions,remotePeer:(0,o.sR)(a),streamMuxer:!0===t?.skipStreamMuxerNegotiation?void 0:this.getStreamMuxer(s.payload.extensions?.streamMuxers)}}getStreamMuxer(e){if(null==e||0===e.length)return;const t=this.components.upgrader.getStreamMuxers();if(null!=t)for(const r of e){const e=t.get(r);if(null!=e)return e}if(e.length)throw new i.c6("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){const r=(0,c.V)(e,{lengthEncoder:se,lengthDecoder:ie,maxDataLength:f}),s=await this.performHandshakeResponder(r,this.components.privateKey,t?.remotePeer?.publicKey,t),i=await this.createSecureConnection(r,s);e.source=i.source,e.sink=i.sink;const a=(0,n.EZ)(s.payload.identityKey);return{conn:e,remoteExtensions:s.payload.extensions,remotePeer:(0,o.sR)(a),streamMuxer:!0===t?.skipStreamMuxerNegotiation?void 0:this.getStreamMuxer(s.payload.extensions?.streamMuxers)}}async performHandshakeInitiator(e,t,r,n){let s;const i=!0===n?.skipStreamMuxerNegotiation?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{s=await async function(e,t){const{log:r,connection:n,crypto:s,privateKey:i,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=e,u=await Se(i,a.publicKey,l),h=new we({crypto:s,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:o,s:a});ae(h.s,r),r.trace("Stage 0 - Initiator starting to send first message."),await n.write(h.writeMessageA(pe),t),r.trace("Stage 0 - Initiator finished sending first message."),ce(h.e,r),r.trace("Stage 1 - Initiator waiting to receive first message from responder...");const d=h.readMessageB(await n.read(t));var f,g;r.trace("Stage 1 - Initiator received the message."),le(h.re,r),f=h.rs,(g=r).enabled&&p&&g(f?`REMOTE_STATIC_PUBLIC_KEY ${(0,oe.d)(f.subarray(),"hex")}`:"Missing remote static public key."),r.trace("Initiator going to check remote's signature...");const m=await Ae(d,h.rs,c);r.trace("All good with the signature!"),r.trace("Stage 2 - Initiator sending third handshake message."),await n.write(h.writeMessageC(u),t),r.trace("Stage 2 - Initiator sent message with signed payload.");const[y,w]=h.ss.split();return ue(y,w,r),{payload:m,encrypt:e=>y.encryptWithAd(pe,e),decrypt:(e,t)=>w.decryptWithAd(pe,e,t)}}({connection:e,privateKey:t,remoteIdentityKey:r,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:i,webtransportCerthashes:[],...this.extensions}},n),this.metrics?.xxHandshakeSuccesses.increment()}catch(e){throw this.metrics?.xxHandshakeErrors.increment(),e}return s}async performHandshakeResponder(e,t,r,n){let s;const i=!0===n?.skipStreamMuxerNegotiation?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{s=await async function(e,t){const{log:r,connection:n,crypto:s,privateKey:i,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=e,u=await Se(i,a.publicKey,l),h=new we({crypto:s,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:o,s:a});ae(h.s,r),r.trace("Stage 0 - Responder waiting to receive first message."),h.readMessageA(await n.read(t)),r.trace("Stage 0 - Responder received first message."),le(h.re,r),r.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(h.writeMessageB(u),t),r.trace("Stage 1 - Responder sent the second handshake message with signed payload."),ce(h.e,r),r.trace("Stage 2 - Responder waiting for third handshake message...");const d=h.readMessageC(await n.read(t));r.trace("Stage 2 - Responder received the message, finished handshake.");const f=await Ae(d,h.rs,c),[p,g]=h.ss.split();return ue(p,g,r),{payload:f,encrypt:e=>g.encryptWithAd(pe,e),decrypt:(e,t)=>p.decryptWithAd(pe,e,t)}}({connection:e,privateKey:t,remoteIdentityKey:r,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:i,webtransportCerthashes:[],...this.extensions}},n),this.metrics?.xxHandshakeSuccesses.increment()}catch(e){throw this.metrics?.xxHandshakeErrors.increment(),e}return s}async createSecureConnection(e,t){const[r,n]=function(){const e=u(),t=u();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]}(),s=e.unwrap();return await(0,h.F)(r,function(e,t){return async function*(r){for await(const n of r)for(let r=0;r<n.length;r+=65519){let s,i=r+65519;i>n.length&&(i=n.length),s=n instanceof Uint8Array?e.encrypt(n.subarray(r,i)):e.encrypt(n.sublist(r,i)),t?.encryptedPackets.increment(),yield new ne.I(se(s.byteLength),s)}}}(t,this.metrics),s,e=>(0,a.D)(e,{lengthDecoder:ie}),function(e,t){return async function*(r){for await(const n of r)for(let r=0;r<n.length;r+=f){let s=r+f;if(s>n.length&&(s=n.length),s-16<r)throw new Error("Invalid chunk");const i=n.sublist(r,s),o=n.subarray(r,s-16);try{const r=e.decrypt(i,o);t?.decryptedPackets.increment(),yield r}catch(e){throw t?.decryptErrors.increment(),e}}}}(t,this.metrics),r),n}}function ke(e={}){return t=>new Ce(t,e)}},86:(e,t,r)=>{"use strict";r.d(t,{I:()=>l});var n=r(6345),s=r(6119),i=r(5131);const o=Symbol.for("@achingbrain/uint8arraylist");function a(e,t){if(null==t||t<0)throw new RangeError("index is out of bounds");let r=0;for(const n of e){const e=r+n.byteLength;if(t<e)return{buf:n,index:t-r};r=e}throw new RangeError("index is out of bounds")}function c(e){return Boolean(e?.[o])}class l{bufs;length;[o]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const r of e)if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.push(r);else{if(!c(r))throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");t+=r.byteLength,this.bufs.push(...r.bufs)}this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const r of e.reverse())if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.unshift(r);else{if(!c(r))throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");t+=r.byteLength,this.bufs.unshift(...r.bufs)}this.length+=t}get(e){const t=a(this.bufs,e);return t.buf[t.index]}set(e,t){const r=a(this.bufs,e);r.buf[r.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let r=0;r<e.length;r++)this.set(t+r,e[r]);else{if(!c(e))throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList");for(let r=0;r<e.length;r++)this.set(t+r,e.get(r))}}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength)return this.bufs=[],void(this.length=0);for(;this.bufs.length>0;){if(!(e>=this.bufs[0].byteLength)){this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift()}}}slice(e,t){const{bufs:r,length:n}=this._subList(e,t);return(0,s.x)(r,n)}subarray(e,t){const{bufs:r,length:n}=this._subList(e,t);return 1===r.length?r[0]:(0,s.x)(r,n)}sublist(e,t){const{bufs:r,length:n}=this._subList(e,t),s=new l;return s.length=n,s.bufs=[...r],s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(0===e&&t===this.length)return{bufs:this.bufs,length:this.length};const r=[];let n=0;for(let s=0;s<this.bufs.length;s++){const i=this.bufs[s],o=n,a=o+i.byteLength;if(n=a,e>=a)continue;const c=e>=o&&e<a,l=t>o&&t<=a;if(c&&l){if(e===o&&t===a){r.push(i);break}const n=e-o;r.push(i.subarray(n,n+(t-e)));break}if(c){if(0===e){r.push(i);continue}r.push(i.subarray(e-o))}else{if(l){if(t===a){r.push(i);break}r.push(i.subarray(0,t-o));break}r.push(i)}}return{bufs:r,length:t-e}}indexOf(e,t=0){if(!(c(e)||e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const r=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;const n=r.byteLength;if(0===n)throw new TypeError("search must be at least 1 byte long");const s=new Int32Array(256);for(let e=0;e<256;e++)s[e]=-1;for(let e=0;e<n;e++)s[r[e]]=e;const i=s,o=this.byteLength-r.byteLength,a=r.byteLength-1;let l;for(let e=t;e<=o;e+=l){l=0;for(let t=a;t>=0;t--){const n=this.get(e+t);if(r[t]!==n){l=Math.max(1,t-i[n]);break}}if(0===l)return e}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const r=(0,n.K)(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt8(0,t),this.write(r,e)}getInt16(e,t){const r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt16(0,t)}setInt16(e,t,r){const s=(0,n.c)(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt16(0,t,r),this.write(s,e)}getInt32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt32(0,t)}setInt32(e,t,r){const s=(0,n.c)(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt32(0,t,r),this.write(s,e)}getBigInt64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigInt64(0,t)}setBigInt64(e,t,r){const s=(0,n.c)(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigInt64(0,t,r),this.write(s,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const r=(0,n.K)(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint8(0,t),this.write(r,e)}getUint16(e,t){const r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,t)}setUint16(e,t,r){const s=(0,n.c)(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint16(0,t,r),this.write(s,e)}getUint32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint32(0,t)}setUint32(e,t,r){const s=(0,n.c)(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint32(0,t,r),this.write(s,e)}getBigUint64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigUint64(0,t)}setBigUint64(e,t,r){const s=(0,n.c)(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigUint64(0,t,r),this.write(s,e)}getFloat32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat32(0,t)}setFloat32(e,t,r){const s=(0,n.c)(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat32(0,t,r),this.write(s,e)}getFloat64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat64(0,t)}setFloat64(e,t,r){const s=(0,n.c)(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat64(0,t,r),this.write(s,e)}equals(e){if(null==e)return!1;if(!(e instanceof l))return!1;if(e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!(0,i.a)(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const r=new l;return r.bufs=e,null==t&&(t=e.reduce((e,t)=>e+t.byteLength,0)),r.length=t,r}}},135:(e,t,r)=>{"use strict";r.r(t),r.d(t,{base32:()=>s,base32hex:()=>c,base32hexpad:()=>u,base32hexpadupper:()=>h,base32hexupper:()=>l,base32pad:()=>o,base32padupper:()=>a,base32upper:()=>i,base32z:()=>d});var n=r(5970);const s=(0,n.yE)({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),i=(0,n.yE)({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),o=(0,n.yE)({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),a=(0,n.yE)({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),c=(0,n.yE)({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),l=(0,n.yE)({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),u=(0,n.yE)({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),h=(0,n.yE)({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),d=(0,n.yE)({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})},142:(e,t,r)=>{"use strict";r.r(t),r.d(t,{sha256:()=>i,sha512:()=>o});var n=r(2416);function s(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}const i=(0,n.H)({name:"sha2-256",code:18,encode:s("SHA-256")}),o=(0,n.H)({name:"sha2-512",code:19,encode:s("SHA-512")})},250:(e,t,r)=>{"use strict";r.d(t,{o:()=>p});var n=r(6800),s=r(6513),i=r(2860),o=r(6194),a=r(7418),c=r(7090),l=r(8337),u=r(1205),h=r(515);class d{deferred;signal;constructor(e){this.signal=e,this.deferred=(0,h.A)(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new n.lc)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}}class f{id;fn;options;recipients;status;timeline;controller;constructor(e,t){this.id=`${parseInt(String(1e9*Math.random()),10).toString()}${Date.now()}`,this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,(0,l.k)(1/0,this.controller.signal),this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((e,t)=>e&&!0===t.signal?.aborted,!0)&&(this.controller.abort(new n.lc),this.cleanup())}async join(e={}){const t=new d(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await(0,u.W)(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}}class p extends i.X{concurrency;maxSize;queue;pending;sort;constructor(e={}){super(),this.concurrency=e.concurrency??Number.POSITIVE_INFINITY,this.maxSize=e.maxSize??Number.POSITIVE_INFINITY,this.pending=0,null!=e.metricName&&e.metrics?.registerMetricGroup(e.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=e.sort,this.queue=[],this.emitEmpty=(0,a.s)(this.emitEmpty.bind(this),1),this.emitIdle=(0,a.s)(this.emitIdle.bind(this),1)}emitEmpty(){0===this.size&&this.safeDispatchEvent("empty")}emitIdle(){0===this.running&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(0===this.size)return this.emitEmpty(),0===this.running&&this.emitIdle(),!1;if(this.pending<this.concurrency){let e;for(const t of this.queue)if("queued"===t.status){e=t;break}return null!=e&&(this.safeDispatchEvent("active"),this.pending++,e.run().finally(()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(e){this.queue.push(e),null!=this.sort&&this.queue.sort(this.sort)}async add(e,t){if(t?.signal?.throwIfAborted(),this.size===this.maxSize)throw new c.Z;const r=new f(e,t);return this.enqueue(r),this.safeDispatchEvent("add"),this.tryToStartAnother(),r.join(t).then(e=>(this.safeDispatchEvent("completed",{detail:e}),this.safeDispatchEvent("success",{detail:{job:r,result:e}}),e)).catch(e=>{if("queued"===r.status)for(let e=0;e<this.queue.length;e++)if(this.queue[e]===r){this.queue.splice(e,1);break}throw this.safeDispatchEvent("error",{detail:e}),this.safeDispatchEvent("failure",{detail:{job:r,error:e}}),e})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(e=>{e.abort(new n.lc)}),this.clear()}async onEmpty(e){0!==this.size&&await(0,o.y)(this,"empty",e?.signal)}async onSizeLessThan(e,t){this.size<e||await(0,o.y)(this,"next",t?.signal,{filter:()=>this.size<e})}async onIdle(e){0===this.pending&&0===this.size||await(0,o.y)(this,"idle",e?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(e){e?.signal?.throwIfAborted();const t=(0,s.Ny)({objectMode:!0}),r=e=>{null!=e?this.abort():this.clear(),t.end(e)},i=e=>{null!=e.detail&&t.push(e.detail)},o=e=>{r(e.detail)},a=()=>{r()},c=()=>{r(new n.lc("Queue aborted"))};this.addEventListener("completed",i),this.addEventListener("error",o),this.addEventListener("idle",a),e?.signal?.addEventListener("abort",c);try{yield*t}finally{this.removeEventListener("completed",i),this.removeEventListener("error",o),this.removeEventListener("idle",a),e?.signal?.removeEventListener("abort",c),r()}}}},265:(e,t,r)=>{"use strict";r.d(t,{A6:()=>d,B1:()=>C,C:()=>g,C9:()=>S,Cm:()=>h,DW:()=>y,F9:()=>T,GY:()=>n,Hu:()=>R,Ik:()=>a,Io:()=>l,Jj:()=>f,K8:()=>F,LH:()=>D,Qj:()=>U,Rc:()=>I,SQ:()=>m,U2:()=>L,X5:()=>z,XK:()=>A,ZC:()=>E,Zj:()=>p,_J:()=>P,bi:()=>v,eI:()=>u,eN:()=>B,g8:()=>b,gF:()=>q,lI:()=>O,le:()=>_,mC:()=>N,o$:()=>i,qT:()=>K,qc:()=>c,rx:()=>w,u:()=>s,v$:()=>k,xr:()=>o,yZ:()=>M,yt:()=>x});const n=4,s=6,i=273,o=33,a=41,c=42,l=43,u=53,h=54,d=55,f=56,p=132,g=301,m=302,y=400,w=421,b=444,v=445,E=446,x=447,S=448,A=449,I=454,C=460,k=461,P=465,T=466,_=480,D=481,L=443,R=477,U=478,M=479,B=277,N=275,O=276,F=280,q=281,z=290,K=777},298:(e,t,r)=>{"use strict";r.d(t,{D:()=>w,l:()=>g});var n=r(5082),s=r(86),i=r(6345);const o=8,a=4194304;class c extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class l extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class u extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class h extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function d(e){return null!=e[Symbol.asyncIterator]}function f(e,t){if(e.byteLength>t)throw new l("Message length too long")}const p=e=>{const t=n.OY(e),r=(0,i.K)(t);return n.lF(e,r),p.bytes=t,r};function g(e,t){const r=(t=t??{}).lengthEncoder??p,n=t?.maxDataLength??a;function*s(e){f(e,n);const t=r(e.byteLength);t instanceof Uint8Array?yield t:yield*t,e instanceof Uint8Array?yield e:yield*e}return d(e)?async function*(){for await(const t of e)yield*s(t)}():function*(){for(const t of e)yield*s(t)}()}var m;p.bytes=0,g.single=(e,t)=>{const r=(t=t??{}).lengthEncoder??p;return f(e,t?.maxDataLength??a),new s.I(r(e.byteLength),e)},function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(m||(m={}));const y=e=>{const t=n.D4(e);return y.bytes=n.OY(t),t};function w(e,t){const r=new s.I;let n=m.LENGTH,i=-1;const f=t?.lengthDecoder??y,p=t?.maxLengthLength??o,g=t?.maxDataLength??a;function*w(){for(;r.byteLength>0;){if(n===m.LENGTH)try{if(i=f(r),i<0)throw new c("Invalid message length");if(i>g)throw new l("Message length too long");const e=f.bytes;r.consume(e),null!=t?.onLength&&t.onLength(i),n=m.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>p)throw new u("Message length length too long");break}throw e}if(n===m.DATA){if(r.byteLength<i)break;const e=r.sublist(0,i);r.consume(i),null!=t?.onData&&t.onData(e),yield e,n=m.LENGTH}}}return d(e)?async function*(){for await(const t of e)r.append(t),yield*w();if(r.byteLength>0)throw new h("Unexpected end of input")}():function*(){for(const t of e)r.append(t),yield*w();if(r.byteLength>0)throw new h("Unexpected end of input")}()}y.bytes=0,w.fromReader=(e,t)=>{let r=1;return w(async function*(){for(;;)try{const{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}(),{...t??{},onLength:e=>{r=e}})}},334:(e,t,r)=>{"use strict";r.d(t,{R:()=>n}),r(7944);const n=e=>new URL(String(e),location.href).href.replace(new RegExp(`^${location.origin}`),"")},386:(e,t,r)=>{"use strict";r.d(t,{By:()=>k,DD:()=>g,RJ:()=>o,VO:()=>M,WV:()=>A,YJ:()=>T,aM:()=>F,qi:()=>v,r9:()=>D,u9:()=>R,uM:()=>m,ur:()=>y,uu:()=>N});var n=r(5763),s=r(6115);const i=(0,s.cl)(),o=(0,s.Sc)(i),a=(0,s.Uo)((0,s.eu)("dns4"),(0,s.Yj)()),c=(0,s.Uo)((0,s.eu)("dns6"),(0,s.Yj)()),l=(0,s.Uo)((0,s.eu)("dnsaddr"),(0,s.Yj)()),u=(0,s.Uo)((0,s.eu)("dns"),(0,s.Yj)()),h=((0,s.Sc)(a,(0,s.lq)((0,s.cl)())),(0,s.Sc)(c,(0,s.lq)((0,s.cl)())),(0,s.Sc)(l,(0,s.lq)((0,s.cl)())),(0,s.Sc)((0,s.or)(u,l,a,c),(0,s.lq)((0,s.cl)())),(0,s.Uo)((0,s.eu)("ip4"),(0,s.Pc)(n.wM))),d=(0,s.Uo)((0,s.eu)("ip6"),(0,s.Pc)(n.w7)),f=(0,s.or)(h,d),p=(0,s.or)(f,u,a,c,l),g=(0,s.Sc)((0,s.or)(f,(0,s.Uo)((0,s.or)(u,l,a,c),(0,s.lq)((0,s.cl)())))),m=(0,s.Sc)(h),y=(0,s.Sc)(d),w=((0,s.Sc)(f),(0,s.Uo)(p,(0,s.eu)("tcp"),(0,s.ai)())),b=(0,s.Uo)(p,(0,s.eu)("udp"),(0,s.ai)()),v=(0,s.Sc)((0,s.Uo)(w,(0,s.lq)((0,s.cl)()))),E=((0,s.Sc)(b),(0,s.Uo)(b,(0,s.eu)("quic"),(0,s.lq)((0,s.cl)()))),x=(0,s.Uo)(b,(0,s.eu)("quic-v1"),(0,s.lq)((0,s.cl)())),S=(0,s.or)(E,x),A=((0,s.Sc)(E),(0,s.Sc)(x)),I=(0,s.or)(p,w,b,E,x),C=(0,s.or)((0,s.Uo)(I,(0,s.eu)("ws"),(0,s.lq)((0,s.cl)()))),k=(0,s.Sc)(C),P=(0,s.or)((0,s.Uo)(I,(0,s.eu)("wss"),(0,s.lq)((0,s.cl)())),(0,s.Uo)(I,(0,s.eu)("tls"),(0,s.lq)((0,s.Uo)((0,s.eu)("sni"),(0,s.Yj)())),(0,s.eu)("ws"),(0,s.lq)((0,s.cl)()))),T=(0,s.Sc)(P),_=(0,s.Uo)(b,(0,s.eu)("webrtc-direct"),(0,s.lq)((0,s.lT)()),(0,s.lq)((0,s.lT)()),(0,s.lq)((0,s.cl)())),D=(0,s.Sc)(_),L=(0,s.Uo)(x,(0,s.eu)("webtransport"),(0,s.lq)((0,s.lT)()),(0,s.lq)((0,s.lT)()),(0,s.lq)((0,s.cl)())),R=(0,s.Sc)(L),U=(0,s.or)(C,P,(0,s.Uo)(w,(0,s.lq)((0,s.cl)())),(0,s.Uo)(S,(0,s.lq)((0,s.cl)())),(0,s.Uo)(p,(0,s.lq)((0,s.cl)())),_,L,(0,s.cl)()),M=(0,s.Sc)(U),B=(0,s.Uo)(U,(0,s.eu)("p2p-circuit"),(0,s.cl)()),N=(0,s.Sc)(B),O=(0,s.or)((0,s.Uo)(U,(0,s.eu)("p2p-circuit"),(0,s.eu)("webrtc"),(0,s.lq)((0,s.cl)())),(0,s.Uo)(U,(0,s.eu)("webrtc"),(0,s.lq)((0,s.cl)())),(0,s.Uo)((0,s.eu)("webrtc"),(0,s.lq)((0,s.cl)()))),F=(0,s.Sc)(O),q=(0,s.or)((0,s.Uo)(p,(0,s.eu)("tcp"),(0,s.ai)(),(0,s.eu)("http"),(0,s.lq)((0,s.cl)())),(0,s.Uo)(p,(0,s.eu)("http"),(0,s.lq)((0,s.cl)()))),z=((0,s.Sc)(q),(0,s.or)((0,s.Uo)(p,(0,s.eu)("tcp"),(0,s.or)((0,s.Uo)((0,s.eu)("443"),(0,s.eu)("http")),(0,s.Uo)((0,s.ai)(),(0,s.eu)("https")),(0,s.Uo)((0,s.ai)(),(0,s.eu)("tls"),(0,s.eu)("http"))),(0,s.lq)((0,s.cl)())),(0,s.Uo)(p,(0,s.eu)("tls"),(0,s.eu)("http"),(0,s.lq)((0,s.cl)())),(0,s.Uo)(p,(0,s.eu)("https"),(0,s.lq)((0,s.cl)())))),K=((0,s.Sc)(z),(0,s.or)((0,s.Uo)((0,s.eu)("memory"),(0,s.Yj)(),(0,s.lq)((0,s.cl)()))));(0,s.Sc)(K)},458:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var s=this._errors[n],i=s.message,o=(e[i]||0)+1;e[i]=o,o>=r&&(t=s,r=o)}return t}},515:(e,t,r)=>{"use strict";function n(){const e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}r.d(t,{A:()=>n})},704:(e,t,r)=>{"use strict";function n(e){const t=new globalThis.AbortController;function r(){t.abort();for(const t of e)null!=t?.removeEventListener&&t.removeEventListener("abort",r)}for(const t of e){if(!0===t?.aborted){r();break}null!=t?.addEventListener&&t.addEventListener("abort",r)}const n=t.signal;return n.clear=function(){for(const t of e)null!=t?.removeEventListener&&t.removeEventListener("abort",r)},n}r.d(t,{J:()=>n})},775:(e,t,r)=>{"use strict";r.d(t,{ev:()=>T,TU:()=>_});var n=r(3550),s=r(8289),i=r(4597),o=r(9460),a=r(3801);const c=BigInt(0),l=BigInt(1),u=BigInt(2),h=BigInt(8),d={zip215:!0};function f(e){const{CURVE:t,curveOpts:r,eddsaOpts:n}=function(e){const t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy};return{CURVE:t,curveOpts:{Fp:e.Fp,Fn:(0,a.D0)(t.n,e.nBitLength,!0),uvRatio:e.uvRatio},eddsaOpts:{hash:e.hash,randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve}}}(e),f=function(e,t={}){const{Fp:r,Fn:n}=(0,o.UT)("edwards",e,t),{h:a,n:d}=e;(0,s.DS)(t,{},{uvRatio:"function"});const f=u<<BigInt(8*n.BYTES)-l,p=e=>r.create(e),g=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:r.sqrt(r.div(e,t))}}catch(e){return{isValid:!1,value:c}}});if(!function(e,t,r,n){const s=e.sqr(r),i=e.sqr(n),o=e.add(e.mul(t.a,s),i),a=e.add(e.ONE,e.mul(t.d,e.mul(s,i)));return e.eql(o,a)}(r,e,e.Gx,e.Gy))throw new Error("bad curve params: generator point");function m(e,t,r=!1){const n=r?l:c;return(0,s.aK)("coordinate "+e,t,n,f),t}function y(e){if(!(e instanceof v))throw new Error("ExtendedPoint expected")}const w=(0,s.x)((e,t)=>{const{ex:n,ey:s,ez:i}=e,o=e.is0();null==t&&(t=o?h:r.inv(i));const a=p(n*t),u=p(s*t),d=p(i*t);if(o)return{x:c,y:l};if(d!==l)throw new Error("invZ was invalid");return{x:a,y:u}}),b=(0,s.x)(t=>{const{a:r,d:n}=e;if(t.is0())throw new Error("bad point: ZERO");const{ex:s,ey:i,ez:o,et:a}=t,c=p(s*s),l=p(i*i),u=p(o*o),h=p(u*u),d=p(c*r);if(p(u*p(d+l))!==p(h+p(n*p(c*l))))throw new Error("bad point: equation left != right (1)");if(p(s*i)!==p(o*a))throw new Error("bad point: equation left != right (2)");return!0});class v{constructor(e,t,r,n){this.ex=m("x",e),this.ey=m("y",t),this.ez=m("z",r,!0),this.et=m("t",n),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof v)throw new Error("extended point not allowed");const{x:t,y:r}=e||{};return m("x",t),m("y",r),new v(t,r,l,p(t*r))}static normalizeZ(e){return(0,o.Ak)(v,"ez",e)}static msm(e,t){return(0,o.Xf)(v,n,e,t)}_setWindowSize(e){this.precompute(e)}precompute(e=8,t=!0){return E.setWindowSize(this,e),t||this.multiply(u),this}assertValidity(){b(this)}equals(e){y(e);const{ex:t,ey:r,ez:n}=this,{ex:s,ey:i,ez:o}=e,a=p(t*o),c=p(s*n),l=p(r*o),u=p(i*n);return a===c&&l===u}is0(){return this.equals(v.ZERO)}negate(){return new v(p(-this.ex),this.ey,this.ez,p(-this.et))}double(){const{a:t}=e,{ex:r,ey:n,ez:s}=this,i=p(r*r),o=p(n*n),a=p(u*p(s*s)),c=p(t*i),l=r+n,h=p(p(l*l)-i-o),d=c+o,f=d-a,g=c-o,m=p(h*f),y=p(d*g),w=p(h*g),b=p(f*d);return new v(m,y,b,w)}add(t){y(t);const{a:r,d:n}=e,{ex:s,ey:i,ez:o,et:a}=this,{ex:c,ey:l,ez:u,et:h}=t,d=p(s*c),f=p(i*l),g=p(a*n*h),m=p(o*u),w=p((s+i)*(c+l)-d-f),b=m-g,E=m+g,x=p(f-r*d),S=p(w*b),A=p(E*x),I=p(w*x),C=p(b*E);return new v(S,A,C,I)}subtract(e){return this.add(e.negate())}multiply(e){const t=e;(0,s.aK)("scalar",t,l,d);const{p:r,f:n}=E.wNAFCached(this,t,v.normalizeZ);return v.normalizeZ([r,n])[0]}multiplyUnsafe(e,t=v.ZERO){const r=e;return(0,s.aK)("scalar",r,c,d),r===c?v.ZERO:this.is0()||r===l?this:E.wNAFCachedUnsafe(this,r,v.normalizeZ,t)}isSmallOrder(){return this.multiplyUnsafe(a).is0()}isTorsionFree(){return E.wNAFCachedUnsafe(this,d).is0()}toAffine(e){return w(this,e)}clearCofactor(){return a===l?this:this.multiplyUnsafe(a)}static fromBytes(e,t=!1){return(0,i.DO)(e),this.fromHex(e,t)}static fromHex(t,n=!1){const{d:i,a:o}=e,a=r.BYTES;t=(0,s.qj)("pointHex",t,a),(0,s.e8)("zip215",n);const u=t.slice(),h=t[a-1];u[a-1]=-129&h;const d=(0,s.lX)(u),m=n?f:r.ORDER;(0,s.aK)("pointHex.y",d,c,m);const y=p(d*d),w=p(y-l),b=p(i*y-o);let{isValid:E,value:x}=g(w,b);if(!E)throw new Error("Point.fromHex: invalid y coordinate");const S=(x&l)===l,A=!!(128&h);if(!n&&x===c&&A)throw new Error("Point.fromHex: x=0 and x_0=1");return A!==S&&(x=p(-x)),v.fromAffine({x,y:d})}static fromPrivateScalar(e){return v.BASE.multiply(e)}toBytes(){const{x:e,y:t}=this.toAffine(),n=(0,s.z)(t,r.BYTES);return n[n.length-1]|=e&l?128:0,n}toRawBytes(){return this.toBytes()}toHex(){return(0,i.My)(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}v.BASE=new v(e.Gx,e.Gy,l,p(e.Gx*e.Gy)),v.ZERO=new v(c,l,l,c),v.Fp=r,v.Fn=n;const E=(0,o.hT)(v,8*n.BYTES);return v}(t,r);return function(e,t){return Object.assign({},t,{ExtendedPoint:t.Point,CURVE:e})}(e,function(e,t){(0,s.DS)(t,{hash:"function"},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:r,hash:n}=t,{BASE:o,Fp:a,Fn:l}=e,u=l.ORDER,h=t.randomBytes||i.po,f=t.adjustScalarBytes||(e=>e),p=t.domain||((e,t,r)=>{if((0,s.e8)("phflag",r),t.length||r)throw new Error("Contexts/pre-hash are not supported");return e});function g(e){return l.create(e)}function m(e){return g((0,s.lX)(e))}function y(e){const{head:t,prefix:r,scalar:i}=function(e){const t=a.BYTES;e=(0,s.qj)("private key",e,t);const r=(0,s.qj)("hashed private key",n(e),2*t),i=f(r.slice(0,t));return{head:i,prefix:r.slice(t,2*t),scalar:m(i)}}(e),c=o.multiply(i),l=c.toBytes();return{head:t,prefix:r,scalar:i,point:c,pointBytes:l}}function w(e=Uint8Array.of(),...t){const o=(0,i.Id)(...t);return m(n(p(o,(0,s.qj)("context",e),!!r)))}const b=d;return o.precompute(8),{getPublicKey:function(e){return y(e).pointBytes},sign:function(e,t,n={}){e=(0,s.qj)("message",e),r&&(e=r(e));const{prefix:l,scalar:h,pointBytes:d}=y(t),f=w(n.context,l,e),p=o.multiply(f).toBytes(),m=g(f+w(n.context,p,d,e)*h);(0,s.aK)("signature.s",m,c,u);const b=a.BYTES,v=(0,i.Id)(p,(0,s.z)(m,b));return(0,s.qj)("result",v,2*b)},verify:function(t,n,i,c=b){const{context:l,zip215:u}=c,h=a.BYTES;t=(0,s.qj)("signature",t,2*h),n=(0,s.qj)("message",n),i=(0,s.qj)("publicKey",i,h),void 0!==u&&(0,s.e8)("zip215",u),r&&(n=r(n));const d=(0,s.lX)(t.slice(h,2*h));let f,p,g;try{f=e.fromHex(i,u),p=e.fromHex(t.slice(0,h),u),g=o.multiplyUnsafe(d)}catch(e){return!1}if(!u&&f.isSmallOrder())return!1;const m=w(l,p.toBytes(),f.toBytes(),n);return p.add(f.multiplyUnsafe(m)).subtract(g).clearCofactor().is0()},utils:{getExtendedPublicKey:y,randomPrivateKey:()=>h(a.BYTES),precompute:(t=8,r=e.BASE)=>r.precompute(t,!1)},Point:e}}(f,n))}const p=BigInt(0),g=BigInt(1),m=BigInt(2);BigInt(0);const y=BigInt(1),w=BigInt(2),b=BigInt(3),v=BigInt(5),E=BigInt(8),x={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:E,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function S(e){const t=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=x.p,o=e*e%i*e%i,c=(0,a.zH)(o,w,i)*o%i,l=(0,a.zH)(c,y,i)*e%i,u=(0,a.zH)(l,v,i)*l%i,h=(0,a.zH)(u,t,i)*u%i,d=(0,a.zH)(h,r,i)*h%i,f=(0,a.zH)(d,n,i)*d%i,p=(0,a.zH)(f,s,i)*f%i,g=(0,a.zH)(p,s,i)*f%i,m=(0,a.zH)(g,t,i)*u%i;return{pow_p_5_8:(0,a.zH)(m,w,i)*e%i,b2:o}}function A(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}const I=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function C(e,t){const r=x.p,n=(0,a.zi)(t*t*t,r),s=S(e*(0,a.zi)(n*n*t,r)).pow_p_5_8;let i=(0,a.zi)(e*n*s,r);const o=(0,a.zi)(t*i*i,r),c=i,l=(0,a.zi)(i*I,r),u=o===e,h=o===(0,a.zi)(-e,r),d=o===(0,a.zi)(-e*I,r);return u&&(i=c),(h||d)&&(i=l),(0,a.dQ)(i,r)&&(i=(0,a.zi)(-i,r)),{isValid:u||h,value:i}}const k=(()=>(0,a.D0)(x.p,void 0,!0))(),P=(()=>({...x,Fp:k,hash:n.Zf,adjustScalarBytes:A,uvRatio:C}))(),T=(()=>f(P))(),_=(()=>{const e=x.p;return function(e){const t=function(e){return(0,s.DS)(e,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...e})}(e),{P:r,type:n,adjustScalarBytes:o,powPminus2:c,randomBytes:l}=t,u="x25519"===n;if(!u&&"x448"!==n)throw new Error("invalid type");const h=l||i.po,d=u?255:448,f=u?32:56,y=u?BigInt(9):BigInt(5),w=u?BigInt(121665):BigInt(39081),b=u?m**BigInt(254):m**BigInt(447),v=u?BigInt(8)*m**BigInt(251)-g:BigInt(4)*m**BigInt(445)-g,E=b+v+g,x=e=>(0,a.zi)(e,r),S=A(y);function A(e){return(0,s.z)(x(e),f)}function I(e,t){const n=function(e,t){(0,s.aK)("u",e,p,r),(0,s.aK)("scalar",t,b,E);const n=t,i=e;let o=g,a=p,l=e,u=g,h=p;for(let e=BigInt(d-1);e>=p;e--){const t=n>>e&g;h^=t,({x_2:o,x_3:l}=k(h,o,l)),({x_2:a,x_3:u}=k(h,a,u)),h=t;const r=o+a,s=x(r*r),c=o-a,d=x(c*c),f=s-d,p=l+u,m=x((l-u)*r),y=x(p*c),b=m+y,v=m-y;l=x(b*b),u=x(i*x(v*v)),o=x(s*d),a=x(f*(s+x(w*f)))}({x_2:o,x_3:l}=k(h,o,l)),({x_2:a,x_3:u}=k(h,a,u));const f=c(a);return x(o*f)}(function(e){const t=(0,s.qj)("u coordinate",e,f);return u&&(t[31]&=127),x((0,s.lX)(t))}(t),function(e){return(0,s.lX)(o((0,s.qj)("scalar",e,f)))}(e));if(n===p)throw new Error("invalid private or public key received");return A(n)}function C(e){return I(e,S)}function k(e,t,r){const n=x(e*(t-r));return{x_2:t=x(t-n),x_3:r=x(r+n)}}return{scalarMult:I,scalarMultBase:C,getSharedSecret:(e,t)=>I(e,t),getPublicKey:e=>C(e),utils:{randomPrivateKey:()=>h(f)},GuBytes:S.slice()}}({P:e,type:"x25519",powPminus2:t=>{const{pow_p_5_8:r,b2:n}=S(t);return(0,a.zi)((0,a.zH)(r,b,e)*n,e)},adjustScalarBytes:A})})()},853:(e,t,r)=>{"use strict";r.d(t,{q:()=>A});var n=r(38),s=r(2090),i=r(7191),o=r(6800),a=r(386),c=r(4214),l=r(1205),u=r(1698),h=r(86);class d extends u.l{writer;reader;constructor(e){super(e),this.writer=e.bidiStream.writable.getWriter(),this.reader=e.bidiStream.readable.getReader(),Promise.resolve().then(async()=>{for(;;){const t=await this.reader.read();if(t.done)return void e.log("remote closed write");null!=t.value&&this.sourcePush(new h.I(t.value))}}).catch(t=>{e.log.error("error reading from stream",t),this.abort(t)}).finally(()=>{this.remoteCloseWrite()}),this.writer.closed.then(()=>{e.log("writer closed")}).catch(t=>{e.log("writer close promise rejected",t)}).finally(()=>{this.remoteCloseRead()})}sendNewStream(e){}async sendData(e,t){for(const r of e)this.log("sendData waiting for writer to be ready"),await(0,l.W)(this.writer.ready,t?.signal),this.writer.write(r).catch(e=>{this.log.error("error sending stream data",e)})}async sendReset(e){this.log("sendReset aborting writer"),await(0,l.W)(this.writer.abort(),e?.signal),this.log("sendReset aborted writer")}async sendCloseWrite(e){this.log("sendCloseWrite closing writer"),await(0,l.W)(this.writer.close(),e?.signal),this.log("sendCloseWrite closed writer")}async sendCloseRead(e){this.log("sendCloseRead cancelling reader"),await(0,l.W)(this.reader.cancel(),e?.signal),this.log("sendCloseRead cancelled reader")}}async function f(e,t,r,n,s,i){const o=i.forComponent(`libp2p:webtransport:stream:${r}:${t}`),a=new d({bidiStream:e,id:t,direction:r,log:o,onEnd:()=>{const e=n.findIndex(e=>e===a);-1!==e&&n.splice(e,1),s?.(a)}});return a}function p(){return{source:{[Symbol.asyncIterator]:()=>({next:async()=>new Promise(()=>{})})},sink:async e=>new Promise(()=>{})}}function g(e,t,r,n){let s=0;const i=r.forComponent("libp2p:webtransport:muxer");return{protocol:"webtransport",createStreamMuxer:o=>{"function"==typeof o&&(o={onIncomingStream:o});const a=[];Promise.resolve().then(async()=>{for(;;){const{done:e,value:c}=await t.read();if(e)break;if(a.length>=n.maxInboundStreams)i(`too many inbound streams open - ${a.length}/${n.maxInboundStreams}, closing new incoming stream`),c.writable.close().catch(e=>{i.error(`failed to close inbound stream that crossed our maxInboundStream limit: ${e.message}`)}),c.readable.cancel().catch(e=>{i.error(`failed to close inbound stream that crossed our maxInboundStream limit: ${e.message}`)});else{const e=await f(c,String(s++),"inbound",a,o?.onStreamEnd,r);a.push(e),o?.onIncomingStream?.(e)}}}).catch(e=>{i.error("could not create a new stream",e)});const c={protocol:"webtransport",streams:a,newStream:async t=>{i("new outgoing stream",t);const n=await e.createBidirectionalStream(),c=await f(n,String(s++),o?.direction??"outbound",a,o?.onStreamEnd,r);return a.push(c),c},close:async()=>{i("closing webtransport muxer gracefully");try{e.close()}catch(e){c.abort(e)}},abort:t=>{i("closing webtransport muxer with err:",t);try{e.close()}catch(t){i.error("webtransport session threw error during close",t)}},...p()};return c}}}var m=r(5131),y=r(5291),w=r(4135),b=r(3578);const v=Object.values(b.Fo).map(e=>e.decoder).reduce((e,t)=>e.or(t));function E(e){if(!a.u9.matches(e))throw new o.Ci("Invalid multiaddr, was not a WebTransport address");const t=e.stringTuples(),r=t.filter(([e,t])=>e===(0,w.WH)("certhash").code).map(([e,t])=>{return r=t??"",b.br.decode(v.decode(r));var r}),n=t.filter(([e,t])=>e===(0,w.WH)("p2p").code).map(([e,t])=>(0,y.XL)(t??""))[0],s=e.toOptions();let i=s.host;return 6===s.family&&i?.includes(":")&&(i=`[${i}]`),{url:`https://${i}:${s.port}`,certhashes:r,remotePeer:n}}const x=globalThis.WebTransport;class S{log;components;config;metrics;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:webtransport"),this.components=e,this.config={...t,maxInboundStreams:t.maxInboundStreams??1e3,certificates:t.certificates??[]},null!=e.metrics&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webtransport_dialer_events_total",{label:"event",help:"Total count of WebTransport dialer events by type"})})}[Symbol.toStringTag]="@libp2p/webtransport";[s._J]=!0;[i.Ch]=["@libp2p/transport"];async dial(e,t){t.signal.throwIfAborted(),this.log("dialing %s",e),t=t??{};const{url:r,certhashes:n,remotePeer:s}=E(e);let i,a,u=()=>{},h=!1,d=!1,f=!1;try{this.metrics?.dialerEvents.increment({pending:!0});const m=new x(`${r}/.well-known/libp2p-webtransport?type=noise`,{serverCertificateHashes:n.map(e=>({algorithm:"sha-256",value:e.digest}))});if(u=e=>{if(!h)try{this.metrics?.dialerEvents.increment({[e]:!0}),m.close()}catch(e){this.log.error("error closing wt session",e)}finally{null!=a&&(a.timeline.close=Date.now()),h=!0}},i=()=>{u(d?"noise_timeout":"ready_timeout")},t.signal.addEventListener("abort",i,{once:!0}),this.log("wait for session to be ready"),t.onProgress?.(new c.j("webtransport:wait-for-session")),await Promise.race([m.closed,m.ready]),this.log("session became ready"),d=!0,this.metrics?.dialerEvents.increment({ready:!0}),m.closed.catch(e=>{this.log.error("error on remote wt session close",e)}).finally(()=>{u("remote_close")}),f=await(0,l.W)(this.authenticateWebTransport({wt:m,remotePeer:s,certhashes:n,...t}),t.signal),!f)throw new o.c6("Failed to authenticate webtransport");return this.metrics?.dialerEvents.increment({open:!0}),a={close:async()=>{this.log("closing webtransport"),u("close")},abort:e=>{this.log("aborting webtransport due to passed err",e),u("abort")},remoteAddr:e,timeline:{open:Date.now()},log:this.components.logger.forComponent("libp2p:webtransport:maconn"),...p()},await t.upgrader.upgradeOutbound(a,{...t,skipEncryption:!0,muxerFactory:g(m,m.incomingBidirectionalStreams.getReader(),this.components.logger,this.config),skipProtection:!0})}catch(e){throw this.log.error("caught wt session err",e),u(f?"upgrade_error":d?"noise_error":"ready_error"),e}finally{null!=i&&t.signal?.removeEventListener("abort",i)}}async authenticateWebTransport({wt:e,remotePeer:t,certhashes:r,onProgress:s,signal:i}){i?.throwIfAborted(),s?.(new c.j("webtransport:open-authentication-stream"));const a=await e.createBidirectionalStream(),u=a.writable.getWriter(),h=a.readable.getReader(),d={source:async function*(){for(;;){const e=await h.read();if(null!=e.value&&(yield e.value),e.done)break}}(),sink:async e=>{for await(const t of e){await(0,l.W)(u.ready,i);const e=t instanceof Uint8Array?t:t.subarray();u.write(e).catch(e=>{this.log.error("could not write chunk during authentication of WebTransport stream",e)})}}},f=(0,n.f)()(this.components);s?.(new c.j("webtransport:secure-outbound-connection"));const{remoteExtensions:p}=await f.secureOutbound(d,{signal:i,remotePeer:t,skipStreamMuxerNegotiation:!0});if(s?.(new c.j("webtransport:close-authentication-stream")),u.close().catch(e=>{this.log.error(`Failed to close authentication stream writer: ${e.message}`)}),h.cancel().catch(e=>{this.log.error(`Failed to close authentication stream reader: ${e.message}`)}),g=p?.webtransportCerthashes??[],(y=r.map(e=>e.bytes)).filter(e=>Boolean(g.find(t=>(0,m.a)(e,t)))).length!==y.length)throw new o.gG("Our certhashes are not a subset of the remote's reported certhashes");var g,y;return!0}createListener(e){return function(){throw new Error("Not implemented")}(this.components,(this.config.certificates,this.config.maxInboundStreams))}listenFilter(){return[]}dialFilter(e){return null==globalThis.WebTransport?[]:e.filter(e=>{if(!a.u9.exactMatch(e))return!1;const{url:t,certhashes:r}=E(e);return null!=t&&r.length>0})}}function A(e={}){return t=>new S(t,e)}},1151:(e,t,r)=>{"use strict";function n(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}r.d(t,{h:()=>n})},1204:(e,t,r)=>{"use strict";r.d(t,{b:()=>s});var n=r(4135);function s(e){try{for(const{code:t}of e.getComponents())if(t!==n.qc)return t===n.GY||t===n.Ik}catch{}return!1}},1205:(e,t,r)=>{"use strict";r.d(t,{W:()=>s});class n extends Error{type;code;constructor(e,t,r){super(e??"The operation was aborted"),this.type="aborted",this.name=r??"AbortError",this.code=t??"ABORT_ERR"}}async function s(e,t,r){if(null==t)return e;if(t.aborted)return e.catch(()=>{}),Promise.reject(new n(r?.errorMessage,r?.errorCode,r?.errorName));let s;const i=new n(r?.errorMessage,r?.errorCode,r?.errorName);try{return await Promise.race([e,new Promise((e,r)=>{s=()=>{r(i)},t.addEventListener("abort",s)})])}finally{null!=s&&t.removeEventListener("abort",s)}}},1252:(e,t,r)=>{"use strict";r.d(t,{p:()=>a});var n=r(1266),s=r(1205),i=r(86);class o extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function a(e,t){const r=(0,n.L)();e.sink(r).catch(async e=>{await r.end(e)}),e.sink=async e=>{for await(const t of e)await r.push(t);await r.end()};let a=e.source;null!=e.source[Symbol.iterator]?a=e.source[Symbol.iterator]():null!=e.source[Symbol.asyncIterator]&&(a=e.source[Symbol.asyncIterator]());const c=new i.I;return{read:async e=>{if(e?.signal?.throwIfAborted(),null==e?.bytes){const{done:t,value:r}=await(0,s.W)(a.next(),e?.signal);return!0===t?null:r}for(;c.byteLength<e.bytes;){const{value:t,done:r}=await(0,s.W)(a.next(),e?.signal);if(!0===r)throw new o("unexpected end of input");c.append(t)}const t=c.sublist(0,e.bytes);return c.consume(e.bytes),t},write:async(e,t)=>{t?.signal?.throwIfAborted(),e instanceof Uint8Array?await r.push(e,t):await r.push(e.subarray(),t)},unwrap:()=>{if(c.byteLength>0){const r=e.source;e.source=async function*(){!1===t?.yieldBytes?yield c:yield*c,yield*r}()}return e}}}},1266:(e,t,r)=>{"use strict";r.d(t,{L:()=>o});var n=r(515),s=r(1205);class i{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=(0,n.A)(),this.haveNext=(0,n.A)()}[Symbol.asyncIterator](){return this}async next(){if(null==this.nextResult&&await this.haveNext.promise,null==this.nextResult)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=(0,n.A)(),e}async throw(e){return this.ended=!0,this.error=e,null!=e&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){null!=e?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(null!=e&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;null!=this.nextResult;)await this.readNext.promise;null!=e?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=(0,n.A)(),await(0,s.W)(this.readNext.promise,t?.signal,t)}}function o(){return new i}},1343:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function i(e,t,n,i,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,i||e,o),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function o(e,t){0===--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,s=[];if(0===this._eventsCount)return s;for(n in e=this._events)t.call(e,n)&&s.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,i=n.length,o=new Array(i);s<i;s++)o[s]=n[s].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,s,i,o){var a=r?r+e:e;if(!this._events[a])return!1;var c,l,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,s),!0;case 5:return u.fn.call(u.context,t,n,s,i),!0;case 6:return u.fn.call(u.context,t,n,s,i,o),!0}for(l=1,c=new Array(h-1);l<h;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var d,f=u.length;for(l=0;l<f;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),h){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,n);break;case 4:u[l].fn.call(u[l].context,t,n,s);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];u[l].fn.apply(u[l].context,c)}}return!0},a.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,s){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return o(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||s&&!a.once||n&&a.context!==n||o(this,i);else{for(var c=0,l=[],u=a.length;c<u;c++)(a[c].fn!==t||s&&!a[c].once||n&&a[c].context!==n)&&l.push(a[c]);l.length?this._events[i]=1===l.length?l[0]:l:o(this,i)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a},1671:(e,t,r)=>{"use strict";r.r(t),r.d(t,{base58btc:()=>s,base58flickr:()=>i});var n=r(5970);const s=(0,n._Q)({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),i=(0,n._Q)({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})},1698:(e,t,r)=>{"use strict";r.d(t,{l:()=>u});var n=r(6800),s=r(6513),i=r(515),o=r(1205),a=r(86),c=r(1151);function l(e){return null!=e&&"function"==typeof e.then&&"function"==typeof e.catch&&"function"==typeof e.finally}class u{id;direction;timeline;protocol;metadata;source;status;readStatus;writeStatus;log;sinkController;sinkEnd;closed;endErr;streamSource;onEnd;onCloseRead;onCloseWrite;onReset;onAbort;sendCloseWriteTimeout;sendingData;constructor(e){this.sinkController=new AbortController,this.sinkEnd=(0,i.A)(),this.closed=(0,i.A)(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??5e3,this.onEnd=e.onEnd,this.onCloseRead=e.onCloseRead,this.onCloseWrite=e.onCloseWrite,this.onReset=e.onReset,this.onAbort=e.onAbort,this.source=this.streamSource=(0,s.Ny)({onEnd:e=>{null!=e?this.log.trace("source ended with error",e):this.log.trace("source ended"),this.onSourceEnd(e)}}),this.sink=this.sink.bind(this)}async sink(e){if("ready"!==this.writeStatus)throw new n.mw(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if("outbound"===this.direction){const e=this.sendNewStream(t);l(e)&&await e}const r=()=>{!function(e,t){const r=(0,c.h)(e).return?.();var n;null!=(n=r)&&"function"==typeof n.then&&"function"==typeof n.catch&&"function"==typeof n.finally&&r.catch(e=>{t.error("could not cause iterator to return",e)})}(e,this.log)};try{this.sinkController.signal.addEventListener("abort",r),this.log.trace("sink reading from source");for await(let r of e){r=r instanceof Uint8Array?new a.I(r):r;const e=this.sendData(r,t);l(e)&&(this.sendingData=(0,i.A)(),await e,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",r)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),"writing"===this.writeStatus&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(e){throw this.log.trace("sink ended with error, calling abort with error",e),this.abort(e),e}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){null==this.timeline.closeRead&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",null!=e&&null==this.endErr&&(this.endErr=e),this.onCloseRead?.(),null!=this.timeline.closeWrite?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),"aborted"!==this.status&&"reset"!==this.status&&(this.status="closed"),null!=this.onEnd&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){null==this.timeline.closeWrite&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",null!=e&&null==this.endErr&&(this.endErr=e),this.onCloseWrite?.(),null!=this.timeline.closeRead?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),"aborted"!==this.status&&"reset"!==this.status&&(this.status="closed"),null!=this.onEnd&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){"open"===this.status&&(this.log.trace("closing gracefully"),this.status="closing",await(0,o.W)(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e?.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(e={}){if("closing"===this.readStatus||"closed"===this.readStatus)return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing","reset"!==this.status&&"aborted"!==this.status&&null==this.timeline.closeRead&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),"ready"===t&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){"closing"!==this.writeStatus&&"closed"!==this.writeStatus&&(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),"ready"===this.writeStatus&&(this.log.trace("sink was never sunk, sink an empty array"),await(0,o.W)(this.sink([]),e.signal)),"writing"===this.writeStatus&&(null!=this.sendingData&&await(0,o.W)(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await(0,o.W)(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;this.log("abort with error",e),this.log("try to send reset to remote");const t=this.sendReset();l(t)&&t.catch(e=>{this.log.error("error sending reset message",e)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),this.onAbort?.(e)}reset(){if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;const e=new n.yp("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),this.onReset?.()}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){"writing"===this.writeStatus&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){"closing"!==this.readStatus&&"closed"!==this.readStatus&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){"closing"!==this.readStatus&&"closed"!==this.readStatus?(this.log.trace("remote close write"),this._closeSource()):this.log("received remote close write but local source is already closed")}remoteCloseRead(){"closing"!==this.writeStatus&&"closed"!==this.writeStatus?(this.log.trace("remote close read"),this._closeSink()):this.log("received remote close read but local sink is already closed")}destroy(){"closed"!==this.status&&"aborted"!==this.status&&"reset"!==this.status?(this.log.trace("stream destroyed"),this._closeSinkAndSource()):this.log("received destroy but we are already closed")}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}},1704:(e,t,r)=>{"use strict";r.d(t,{V:()=>x,u:()=>S});var n=r(5763),s=r(2906),i=r(7484),o=r(265),a=r(9621),c=r(135),l=r(3578),u=r(6119),h=r(7442),d=r(5129);function f(e){return t=>(0,d.d)(t,e)}function p(e){return t=>(0,h.s)(t,e)}function g(e){return new DataView(e.buffer).getUint16(e.byteOffset).toString()}function m(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,"string"==typeof e?parseInt(e):e),new Uint8Array(t)}function y(e){const t=e.subarray(0,e.length-2),r=e.subarray(e.length-2);return`${(0,d.d)(t,"base32")}:${g(r)}`}const w=function(e){e=e.toString().trim();const t=new Uint8Array(4);return e.split(/\./g).forEach((e,r)=>{const n=parseInt(e,10);if(isNaN(n)||n<0||n>255)throw new a.Ci("Invalid byte value in IP address");t[r]=n}),t},b=Object.values(l.Fo).map(e=>e.decoder),v=function(){let e=b[0].or(b[1]);return b.slice(2).forEach(t=>e=e.or(t)),e}(),E=function(...e){return t=>{for(const r of e)r(t)}}(function(e){if(parseInt(e).toString()!==e)throw new a.yI("Value must be an integer")},function(e){if(e<0)throw new a.yI("Value must be a positive integer, or zero")},e=>{if(e>65535)throw new a.yI("Value must be smaller than or equal to 65535")});const x=-1,S=new class{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(e){let t;if(t="string"==typeof e?this.protocolsByName.get(e):this.protocolsByCode.get(e),null==t)throw new a.Xn(`Protocol ${e} was unknown`);return t}addProtocol(e){this.protocolsByCode.set(e.code,e),this.protocolsByName.set(e.name,e),e.aliases?.forEach(t=>{this.protocolsByName.set(t,e)})}removeProtocol(e){const t=this.protocolsByCode.get(e);null!=t&&(this.protocolsByCode.delete(t.code),this.protocolsByName.delete(t.name),t.aliases?.forEach(e=>{this.protocolsByName.delete(e)}))}};var A;[{code:o.GY,name:"ip4",size:32,valueToBytes:w,bytesToValue:function(e){if(4!==e.byteLength)throw new a.Ci("IPv4 address was incorrect length");const t=[];for(let r=0;r<e.byteLength;r++)t.push(e[r]);return t.join(".")},validate:e=>{if(!(0,n.wM)(e))throw new a.yI(`Invalid IPv4 address "${e}"`)}},{code:o.u,name:"tcp",size:16,valueToBytes:m,bytesToValue:g,validate:E},{code:o.o$,name:"udp",size:16,valueToBytes:m,bytesToValue:g,validate:E},{code:o.xr,name:"dccp",size:16,valueToBytes:m,bytesToValue:g,validate:E},{code:o.Ik,name:"ip6",size:128,valueToBytes:function(e){let t=0;const r=(e=e.toString().trim()).split(":",8);let s;for(s=0;s<r.length;s++){let e;(0,n.wM)(r[s])&&(e=w(r[s]),r[s]=(0,d.d)(e.subarray(0,2),"base16")),null!=e&&++s<8&&r.splice(s,0,(0,d.d)(e.subarray(2,4),"base16"))}if(""===r[0])for(;r.length<8;)r.unshift("0");else if(""===r[r.length-1])for(;r.length<8;)r.push("0");else if(r.length<8){for(s=0;s<r.length&&""!==r[s];s++);const e=[s,1];for(s=9-r.length;s>0;s--)e.push("0");r.splice.apply(r,e)}const i=new Uint8Array(t+16);for(s=0;s<r.length;s++){""===r[s]&&(r[s]="0");const e=parseInt(r[s],16);if(isNaN(e)||e<0||e>65535)throw new a.Ci("Invalid byte value in IP address");i[t++]=e>>8&255,i[t++]=255&e}return i},bytesToValue:function(e){if(16!==e.byteLength)throw new a.Ci("IPv6 address was incorrect length");const t=[];for(let r=0;r<e.byteLength;r+=2){const n=e[r],s=e[r+1],i=`${n.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`;t.push(i)}const r=t.join(":");try{const e=new URL(`http://[${r}]`);return e.hostname.substring(1,e.hostname.length-1)}catch{throw new a.Ci(`Invalid IPv6 address "${r}"`)}},stringToValue:function(e){try{const t=new URL(`http://[${e}]`);return t.hostname.substring(1,t.hostname.length-1)}catch{throw new a.Ci(`Invalid IPv6 address "${e}"`)}},validate:e=>{if(!(0,n.w7)(e))throw new a.yI(`Invalid IPv6 address "${e}"`)}},{code:o.qc,name:"ip6zone",size:x},{code:o.Io,name:"ipcidr",size:8,bytesToValue:f("base10"),valueToBytes:p("base10")},{code:o.eI,name:"dns",size:x,resolvable:!0},{code:o.Cm,name:"dns4",size:x,resolvable:!0},{code:o.A6,name:"dns6",size:x,resolvable:!0},{code:o.Jj,name:"dnsaddr",size:x,resolvable:!0},{code:o.Zj,name:"sctp",size:16,valueToBytes:m,bytesToValue:g,validate:E},{code:o.C,name:"udt"},{code:o.SQ,name:"utp"},{code:o.DW,name:"unix",size:x,path:!0,stringToValue:e=>decodeURIComponent(e),valueToString:e=>encodeURIComponent(e)},{code:o.rx,name:"p2p",aliases:["ipfs"],size:x,bytesToValue:f("base58btc"),valueToBytes:e=>e.startsWith("Q")||e.startsWith("1")?p("base58btc")(e):s.TO.parse(e).multihash.bytes},{code:o.g8,name:"onion",size:96,bytesToValue:y,valueToBytes:function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);const r=(0,h.s)(t[0],"base32"),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=m(n);return(0,u.x)([r,s],r.length+s.length)}},{code:o.bi,name:"onion3",size:296,bytesToValue:y,valueToBytes:function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);const r=c.base32.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=m(n);return(0,u.x)([r,s],r.length+s.length)}},{code:o.ZC,name:"garlic64",size:x},{code:o.yt,name:"garlic32",size:x},{code:o.C9,name:"tls"},{code:o.XK,name:"sni",size:x},{code:o.Rc,name:"noise"},{code:o.B1,name:"quic"},{code:o.v$,name:"quic-v1"},{code:o._J,name:"webtransport"},{code:o.F9,name:"certhash",size:x,bytesToValue:(A=i.base64url,e=>A.encoder.encode(e)),valueToBytes:function(e){return v.decode(e)}},{code:o.le,name:"http"},{code:o.LH,name:"http-path",size:x,stringToValue:e=>`/${decodeURIComponent(e)}`,valueToString:e=>encodeURIComponent(e.substring(1))},{code:o.U2,name:"https"},{code:o.Hu,name:"ws"},{code:o.Qj,name:"wss"},{code:o.yZ,name:"p2p-websocket-star"},{code:o.eN,name:"p2p-stardust"},{code:o.mC,name:"p2p-webrtc-star"},{code:o.lI,name:"p2p-webrtc-direct"},{code:o.K8,name:"webrtc-direct"},{code:o.gF,name:"webrtc"},{code:o.X5,name:"p2p-circuit"},{code:o.qT,name:"memory",size:x}].forEach(e=>{S.addProtocol(e)})},1794:(e,t,r)=>{"use strict";r.d(t,{b:()=>a});var n=r(5763),s=r(9944);const i=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"].map(e=>new s.Netmask(e));function o(e){for(const t of i)if(t.contains(e))return!0;return!1}function a(e){return(0,n.wM)(e)?o(e):/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(e)?function(e){const t=e.split(":");if(t.length<2)return!1;const r=t[t.length-1].padStart(4,"0"),n=t[t.length-2].padStart(4,"0");return o(`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(r.substring(0,2),16)}.${parseInt(r.substring(2),16)}`)}(e):/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)?function(e){const t=e.split(":");return o(t[t.length-1])}(e):(0,n.w7)(e)?function(e){return/^::$/.test(e)||/^::1$/.test(e)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(e)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(e)||/^ff([0-9a-fA-F]{2,2}):/i.test(e)}(e):void 0}},1935:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});const n=function(e){const[t,r]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>t.next(),push:e=>{n.push(e)},next:()=>n.length>0?{done:!1,value:n.shift()}:t.next(),[r](){return this}}}},2090:(e,t,r)=>{"use strict";r.d(t,{_J:()=>n,aF:()=>s});const n=Symbol.for("@libp2p/transport");var s;!function(e){e[e.FATAL_ALL=0]="FATAL_ALL",e[e.NO_FATAL=1]="NO_FATAL"}(s||(s={}))},2095:(e,t,r)=>{"use strict";r.d(t,{R:()=>a}),r(9566);var n=r(9538),s=r(7136),i=r(6419),o=r(8192);function a(e,t,r){let a;if("string"==typeof e){const n=new URL(e,location.href),i=({url:e})=>e.href===n.href;a=new s.q(i,t,r)}else if(e instanceof RegExp)a=new i.b(e,t,r);else if("function"==typeof e)a=new s.q(e,t,r);else{if(!(e instanceof s.q))throw new n.R("unsupported-route-type",{moduleName:"workbox-routing",funcName:"registerRoute",paramName:"capture"});a=e}return(0,o.G)().registerRoute(a),a}r(5706)},2158:(e,t,r)=>{"use strict";r.d(t,{q:()=>de});const n=["string","number","bigint","symbol"],s=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];class i{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}i.uint=new i(0,"uint",!0),i.negint=new i(1,"negint",!0),i.bytes=new i(2,"bytes",!0),i.string=new i(3,"string",!0),i.array=new i(4,"array",!1),i.map=new i(5,"map",!1),i.tag=new i(6,"tag",!1),i.float=new i(7,"float",!0),i.false=new i(7,"false",!0),i.true=new i(7,"true",!0),i.null=new i(7,"null",!0),i.undefined=new i(7,"undefined",!0),i.break=new i(7,"break",!0);class o{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const a=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,c=new TextDecoder,l=new TextEncoder;function u(e){return a&&globalThis.Buffer.isBuffer(e)}const h=a?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):y(e,t,r):(e,t,r)=>r-t>64?c.decode(e.subarray(t,r)):y(e,t,r),d=a?e=>e.length>64?globalThis.Buffer.from(e):m(e):e=>e.length>64?l.encode(e):m(e),f=a?(e,t,r)=>u(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),p=a?(e,t)=>{return e=e.map(e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e)),(r=globalThis.Buffer.concat(e,t))instanceof Uint8Array?u(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r);var r}:(e,t)=>{const r=new Uint8Array(t);let n=0;for(let t of e)n+t.length>r.length&&(t=t.subarray(0,r.length-n)),r.set(t,n),n+=t.length;return r},g=a?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function m(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=63&s|128):55296==(64512&s)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++n)),t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=63&s|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=63&s|128)}return t}function y(e,t,r){const n=[];for(;t<r;){const s=e[t];let i=null,o=s>239?4:s>223?3:s>191?2:1;if(t+o<=r){let r,n,a,c;switch(o){case 1:s<128&&(i=s);break;case 2:r=e[t+1],128==(192&r)&&(c=(31&s)<<6|63&r,c>127&&(i=c));break;case 3:r=e[t+1],n=e[t+2],128==(192&r)&&128==(192&n)&&(c=(15&s)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:r=e[t+1],n=e[t+2],a=e[t+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&s)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),t+=o}return function(e){const t=e.length;if(t<=w)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=w));return r}(n)}const w=4096,b="CBOR decode error:",v="CBOR encode error:",E=[];function x(e,t,r){if(e.length-t<r)throw new Error(`${b} not enough data for type`)}E[23]=1,E[24]=2,E[25]=3,E[26]=5,E[27]=9;const S=[24,256,65536,4294967296,BigInt("18446744073709551616")];function A(e,t,r){x(e,t,1);const n=e[t];if(!0===r.strict&&n<S[0])throw new Error(`${b} integer encoded in more bytes than necessary (strict decode)`);return n}function I(e,t,r){x(e,t,2);const n=e[t]<<8|e[t+1];if(!0===r.strict&&n<S[1])throw new Error(`${b} integer encoded in more bytes than necessary (strict decode)`);return n}function C(e,t,r){x(e,t,4);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===r.strict&&n<S[2])throw new Error(`${b} integer encoded in more bytes than necessary (strict decode)`);return n}function k(e,t,r){x(e,t,8);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],s=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],i=(BigInt(n)<<BigInt(32))+BigInt(s);if(!0===r.strict&&i<S[3])throw new Error(`${b} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(!0===r.allowBigInt)return i;throw new Error(`${b} integers outside of the safe integer range are not supported`)}function P(e,t){return T(e,0,t.value)}function T(e,t,r){if(r<S[0]){const n=Number(r);e.push([t|n])}else if(r<S[1]){const n=Number(r);e.push([24|t,n])}else if(r<S[2]){const n=Number(r);e.push([25|t,n>>>8,255&n])}else if(r<S[3]){const n=Number(r);e.push([26|t,n>>>24&255,n>>>16&255,n>>>8&255,255&n])}else{const n=BigInt(r);if(!(n<S[4]))throw new Error(`${b} encountered BigInt larger than allowable range`);{const r=[27|t,0,0,0,0,0,0,0];let s=Number(n&BigInt(4294967295)),i=Number(n>>BigInt(32)&BigInt(4294967295));r[8]=255&s,s>>=8,r[7]=255&s,s>>=8,r[6]=255&s,s>>=8,r[5]=255&s,r[4]=255&i,i>>=8,r[3]=255&i,i>>=8,r[2]=255&i,i>>=8,r[1]=255&i,e.push(r)}}}P.encodedSize=function(e){return T.encodedSize(e.value)},T.encodedSize=function(e){return e<S[0]?1:e<S[1]?2:e<S[2]?3:e<S[3]?5:9},P.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};const _=BigInt(-1),D=BigInt(1);function L(e,t){const r=t.value,n="bigint"==typeof r?r*_-D:-1*r-1;T(e,t.type.majorEncoded,n)}function R(e,t,r,n){x(e,t,r+n);const s=f(e,t+r,t+r+n);return new o(i.bytes,s,r+n)}function U(e,t,r,n){return R(e,t,1,r)}function M(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===i.string?d(e.value):e.value),e.encodedBytes}function B(e,t){const r=M(t);T(e,t.type.majorEncoded,r.length),e.push(r)}function N(e,t,r,n,s){const a=r+n;x(e,t,a);const c=new o(i.string,h(e,t+r,t+a),a);return!0===s.retainStringBytes&&(c.byteValue=f(e,t+r,t+a)),c}function O(e,t,r,n){return N(e,t,1,r,n)}L.encodedSize=function(e){const t=e.value,r="bigint"==typeof t?t*_-D:-1*t-1;return r<S[0]?1:r<S[1]?2:r<S[2]?3:r<S[3]?5:9},L.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},B.encodedSize=function(e){const t=M(e);return T.encodedSize(t.length)+t.length},B.compareTokens=function(e,t){return r=M(e),n=M(t),r.length<n.length?-1:r.length>n.length?1:function(e,t){if(u(e)&&u(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}(r,n);var r,n};const F=B;function q(e,t,r,n){return new o(i.array,n,r)}function z(e,t,r,n){return q(0,0,1,r)}function K(e,t){T(e,i.array.majorEncoded,t.value)}function $(e,t,r,n){return new o(i.map,n,r)}function j(e,t,r,n){return $(0,0,1,r)}function V(e,t){T(e,i.map.majorEncoded,t.value)}function H(e,t,r,n){return new o(i.tag,r,1)}function G(e,t){T(e,i.tag.majorEncoded,t.value)}function W(e,t,r){if(r){if(!1===r.allowNaN&&Number.isNaN(e))throw new Error(`${b} NaN values are not supported`);if(!1===r.allowInfinity&&(e===1/0||e===-1/0))throw new Error(`${b} Infinity values are not supported`)}return new o(i.float,e,t)}function Z(e,t,r){const n=t.value;if(!1===n)e.push([20|i.float.majorEncoded]);else if(!0===n)e.push([21|i.float.majorEncoded]);else if(null===n)e.push([22|i.float.majorEncoded]);else if(void 0===n)e.push([23|i.float.majorEncoded]);else{let t,i=!1;r&&!0===r.float64||(J(n),t=ee(X,1),n===t||Number.isNaN(n)?(X[0]=249,e.push(X.slice(0,3)),i=!0):(te(n),t=re(X,1),n===t&&(X[0]=250,e.push(X.slice(0,5)),i=!0))),i||(s=n,Q.setFloat64(0,s,!1),t=ne(X,1),X[0]=251,e.push(X.slice(0,9)))}var s}K.compareTokens=P.compareTokens,K.encodedSize=function(e){return T.encodedSize(e.value)},V.compareTokens=P.compareTokens,V.encodedSize=function(e){return T.encodedSize(e.value)},G.compareTokens=P.compareTokens,G.encodedSize=function(e){return T.encodedSize(e.value)},Z.encodedSize=function(e,t){const r=e.value;if(!1===r||!0===r||null==r)return 1;if(!t||!0!==t.float64){J(r);let e=ee(X,1);if(r===e||Number.isNaN(r))return 3;if(te(r),e=re(X,1),r===e)return 5}return 9};const Y=new ArrayBuffer(9),Q=new DataView(Y,1),X=new Uint8Array(Y,0);function J(e){if(e===1/0)Q.setUint16(0,31744,!1);else if(e===-1/0)Q.setUint16(0,64512,!1);else if(Number.isNaN(e))Q.setUint16(0,32256,!1);else{Q.setFloat32(0,e);const t=Q.getUint32(0),r=(2139095040&t)>>23,n=8388607&t;if(255===r)Q.setUint16(0,31744,!1);else if(0===r)Q.setUint16(0,(2147483648&e)>>16|n>>13,!1);else{const e=r-127;e<-24?Q.setUint16(0,0):e<-14?Q.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):Q.setUint16(0,(2147483648&t)>>16|e+15<<10|n>>13,!1)}}}function ee(e,t){if(e.length-t<2)throw new Error(`${b} not enough data for float16`);const r=(e[t]<<8)+e[t+1];if(31744===r)return 1/0;if(64512===r)return-1/0;if(32256===r)return NaN;const n=r>>10&31,s=1023&r;let i;return i=0===n?s*2**-24:31!==n?(s+1024)*2**(n-25):0===s?1/0:NaN,32768&r?-i:i}function te(e){Q.setFloat32(0,e,!1)}function re(e,t){if(e.length-t<4)throw new Error(`${b} not enough data for float32`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function ne(e,t){if(e.length-t<8)throw new Error(`${b} not enough data for float64`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}function se(e,t,r){throw new Error(`${b} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function ie(e){return()=>{throw new Error(`${b} ${e}`)}}Z.compareTokens=P.compareTokens;const oe=[];for(let e=0;e<=23;e++)oe[e]=se;oe[24]=function(e,t,r,n){return new o(i.uint,A(e,t+1,n),2)},oe[25]=function(e,t,r,n){return new o(i.uint,I(e,t+1,n),3)},oe[26]=function(e,t,r,n){return new o(i.uint,C(e,t+1,n),5)},oe[27]=function(e,t,r,n){return new o(i.uint,k(e,t+1,n),9)},oe[28]=se,oe[29]=se,oe[30]=se,oe[31]=se;for(let e=32;e<=55;e++)oe[e]=se;oe[56]=function(e,t,r,n){return new o(i.negint,-1-A(e,t+1,n),2)},oe[57]=function(e,t,r,n){return new o(i.negint,-1-I(e,t+1,n),3)},oe[58]=function(e,t,r,n){return new o(i.negint,-1-C(e,t+1,n),5)},oe[59]=function(e,t,r,n){const s=k(e,t+1,n);if("bigint"!=typeof s){const e=-1-s;if(e>=Number.MIN_SAFE_INTEGER)return new o(i.negint,e,9)}if(!0!==n.allowBigInt)throw new Error(`${b} integers outside of the safe integer range are not supported`);return new o(i.negint,_-BigInt(s),9)},oe[60]=se,oe[61]=se,oe[62]=se,oe[63]=se;for(let e=64;e<=87;e++)oe[e]=U;oe[88]=function(e,t,r,n){return R(e,t,2,A(e,t+1,n))},oe[89]=function(e,t,r,n){return R(e,t,3,I(e,t+1,n))},oe[90]=function(e,t,r,n){return R(e,t,5,C(e,t+1,n))},oe[91]=function(e,t,r,n){const s=k(e,t+1,n);if("bigint"==typeof s)throw new Error(`${b} 64-bit integer bytes lengths not supported`);return R(e,t,9,s)},oe[92]=se,oe[93]=se,oe[94]=se,oe[95]=ie("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)oe[e]=O;oe[120]=function(e,t,r,n){return N(e,t,2,A(e,t+1,n),n)},oe[121]=function(e,t,r,n){return N(e,t,3,I(e,t+1,n),n)},oe[122]=function(e,t,r,n){return N(e,t,5,C(e,t+1,n),n)},oe[123]=function(e,t,r,n){const s=k(e,t+1,n);if("bigint"==typeof s)throw new Error(`${b} 64-bit integer string lengths not supported`);return N(e,t,9,s,n)},oe[124]=se,oe[125]=se,oe[126]=se,oe[127]=ie("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)oe[e]=z;oe[152]=function(e,t,r,n){return q(0,0,2,A(e,t+1,n))},oe[153]=function(e,t,r,n){return q(0,0,3,I(e,t+1,n))},oe[154]=function(e,t,r,n){return q(0,0,5,C(e,t+1,n))},oe[155]=function(e,t,r,n){const s=k(e,t+1,n);if("bigint"==typeof s)throw new Error(`${b} 64-bit integer array lengths not supported`);return q(0,0,9,s)},oe[156]=se,oe[157]=se,oe[158]=se,oe[159]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${b} indefinite length items not allowed`);return q(0,0,1,1/0)};for(let e=160;e<=183;e++)oe[e]=j;oe[184]=function(e,t,r,n){return $(0,0,2,A(e,t+1,n))},oe[185]=function(e,t,r,n){return $(0,0,3,I(e,t+1,n))},oe[186]=function(e,t,r,n){return $(0,0,5,C(e,t+1,n))},oe[187]=function(e,t,r,n){const s=k(e,t+1,n);if("bigint"==typeof s)throw new Error(`${b} 64-bit integer map lengths not supported`);return $(0,0,9,s)},oe[188]=se,oe[189]=se,oe[190]=se,oe[191]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${b} indefinite length items not allowed`);return $(0,0,1,1/0)};for(let e=192;e<=215;e++)oe[e]=H;oe[216]=function(e,t,r,n){return new o(i.tag,A(e,t+1,n),2)},oe[217]=function(e,t,r,n){return new o(i.tag,I(e,t+1,n),3)},oe[218]=function(e,t,r,n){return new o(i.tag,C(e,t+1,n),5)},oe[219]=function(e,t,r,n){return new o(i.tag,k(e,t+1,n),9)},oe[220]=se,oe[221]=se,oe[222]=se,oe[223]=se;for(let e=224;e<=243;e++)oe[e]=ie("simple values are not supported");oe[244]=se,oe[245]=se,oe[246]=se,oe[247]=function(e,t,r,n){if(!1===n.allowUndefined)throw new Error(`${b} undefined values are not supported`);return!0===n.coerceUndefinedToNull?new o(i.null,null,1):new o(i.undefined,void 0,1)},oe[248]=ie("simple values are not supported"),oe[249]=function(e,t,r,n){return W(ee(e,t+1),3,n)},oe[250]=function(e,t,r,n){return W(re(e,t+1),5,n)},oe[251]=function(e,t,r,n){return W(ne(e,t+1),9,n)},oe[252]=se,oe[253]=se,oe[254]=se,oe[255]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${b} indefinite length items not allowed`);return new o(i.break,void 0,1)};const ae=[];for(let e=0;e<24;e++)ae[e]=new o(i.uint,e,1);for(let e=-1;e>=-24;e--)ae[31-e]=new o(i.negint,e,1);ae[64]=new o(i.bytes,new Uint8Array(0),1),ae[96]=new o(i.string,"",1),ae[128]=new o(i.array,0,1),ae[160]=new o(i.map,0,1),ae[244]=new o(i.false,!1,1),ae[245]=new o(i.true,!0,1),ae[246]=new o(i.null,null,1),function(){const e=[];e[i.uint.major]=P,e[i.negint.major]=L,e[i.bytes.major]=B,e[i.string.major]=F,e[i.array.major]=K,e[i.map.major]=V,e[i.tag.major]=G,e[i.float.major]=Z}(),new class{constructor(e=256){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=g(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){const r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=f(r,0,this.cursor)}else t=p(this.chunks,this.cursor);return e&&this.reset(),t}};class ce{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${v} object contains circular references`);return new ce(t,e)}}const le={null:new o(i.null,null),undefined:new o(i.undefined,void 0),true:new o(i.true,!0),false:new o(i.false,!1),emptyArray:new o(i.array,0),emptyMap:new o(i.map,0)},ue={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new o(e>=0?i.uint:i.negint,e):new o(i.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new o(i.uint,e):new o(i.negint,e),Uint8Array:(e,t,r,n)=>new o(i.bytes,e),string:(e,t,r,n)=>new o(i.string,e),boolean:(e,t,r,n)=>e?le.true:le.false,null:(e,t,r,n)=>le.null,undefined:(e,t,r,n)=>le.undefined,ArrayBuffer:(e,t,r,n)=>new o(i.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new o(i.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[le.emptyArray,new o(i.break)]:le.emptyArray;n=ce.createCheck(n,e);const s=[];let a=0;for(const t of e)s[a++]=he(t,r,n);return r.addBreakTokens?[new o(i.array,e.length),s,new o(i.break)]:[new o(i.array,e.length),s]},Object(e,t,r,n){const s="Object"!==t,a=s?e.keys():Object.keys(e),c=s?e.size:a.length;if(!c)return!0===r.addBreakTokens?[le.emptyMap,new o(i.break)]:le.emptyMap;n=ce.createCheck(n,e);const l=[];let u=0;for(const t of a)l[u++]=[he(t,r,n),he(s?e.get(t):e[t],r,n)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(l,r),r.addBreakTokens?[new o(i.map,c),l,new o(i.break)]:[new o(i.map,c),l]}};ue.Map=ue.Object,ue.Buffer=ue.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))ue[`${e}Array`]=ue.DataView;function he(e,t={},r){const i=function(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(n.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(function(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}(e))return"Buffer";return function(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(s.includes(t))return t}(e)||"Object"}(e),o=t&&t.typeEncoders&&t.typeEncoders[i]||ue[i];if("function"==typeof o){const n=o(e,i,t,r);if(null!=n)return n}const a=ue[i];if(!a)throw new Error(`${v} unsupported type: ${i}`);return a(e,i,t,r)}async function de(e,t,r){try{const n=await e.dialProtocol(t,"/http/1.1"),s=(await e.peerStore.all(),(new TextEncoder).encode(r));await n.sink([s]);let i="";for await(const e of n.source)i+=(new TextDecoder).decode(e.subarray());return i}catch(e){console.log("Error dialing libp2phttp: ",e.message)}}Symbol.for("DONE"),Symbol.for("BREAK"),r(4135)},2384:(e,t,r)=>{"use strict";r.d(t,{sc:()=>n});const n=r(3550).sc},2416:(e,t,r)=>{"use strict";r.d(t,{H:()=>s});var n=r(6915);function s({name:e,code:t,encode:r}){return new i(e,t,r)}class i{name;code;encode;constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?n.create(this.code,t):t.then(e=>n.create(this.code,e))}throw Error("Unknown type, must be binary type")}}},2520:(e,t,r)=>{"use strict";r.d(t,{fO:()=>a,eX:()=>c});var n=r(8935);const s=(parseInt("0xFFFF",16),new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]));function i(e,t){16===t.length&&4===e.length&&function(e){let t=0;for(const r of e)if(!(t<0)){if(t>11)break;if(255!==r)return!1;t++}return!0}(t)&&(t=t.slice(12)),4===t.length&&16===e.length&&function(e,t){let r=0;for(const n of e)if(!(r<0)){if(r>11)break;if(n!==t[r])return!1;r++}return!0}(e,s)&&(e=e.slice(12));const r=e.length;if(r!=t.length)throw new Error("Failed to mask ip");const n=new Uint8Array(r);for(let s=0;s<r;s++)n[s]=e[s]&t[s];return n}function o(e,t){if(32!==t&&128!==t)throw new Error("Invalid CIDR mask");if(e<0||e>t)throw new Error("Invalid CIDR mask");const r=t/8,n=new Uint8Array(r);for(let t=0;t<r;t++)e>=8?(n[t]=255,e-=8):(n[t]=255-(255>>e),e=0);return n}class a{constructor(e,t){if(null==t)({network:this.network,mask:this.mask}=function(e){const[t,r]=e.split("/");if(!t||!r)throw new Error("Failed to parse given CIDR: "+e);let s=4,a=(0,n.vm)(t);if(null==a&&(s=16,a=(0,n.JI)(t),null==a))throw new Error("Failed to parse given CIDR: "+e);const c=parseInt(r,10);if(Number.isNaN(c)||String(c).length!==r.length||c<0||c>8*s)throw new Error("Failed to parse given CIDR: "+e);const l=o(c,8*s);return{network:i(a,l),mask:l}}(e));else{const r=(0,n.do)(e);if(null==r)throw new Error("Failed to parse network");t=String(t);const s=parseInt(t,10);if(Number.isNaN(s)||String(s).length!==t.length||s<0||s>8*r.length){const e=(0,n.do)(t);if(null==e)throw new Error("Failed to parse mask");this.mask=e}else this.mask=o(s,8*r.length);this.network=i(r,this.mask)}}contains(e){return function(e,t){if("string"==typeof t&&(t=(0,n.do)(t)),null==t)throw new Error("Invalid ip");if(t.length!==e.network.length)return!1;for(let r=0;r<t.length;r++)if((e.network[r]&e.mask[r])!==(t[r]&e.mask[r]))return!1;return!0}({network:this.network,mask:this.mask},e)}toString(){const e=function(e){let t=0;for(let[r,n]of e.entries()){if(255!==n){for(;128&n;)t++,n<<=1;if(128&n)return-1;for(let t=r+1;t<e.length;t++)if(0!=e[t])return-1;break}t+=8}return t}(this.mask),t=-1!==e?String(e):function(e){let t="0x";for(const r of e)t+=(r>>4).toString(16)+(15&r).toString(16);return t}(this.mask);return function(e){switch(e.length){case 4:return e.join(".");case 16:{const t=[];for(let r=0;r<e.length;r++)r%2==0&&t.push(e[r].toString(16).padStart(2,"0")+e[r+1].toString(16).padStart(2,"0"));return t.join(":")}default:throw new Error("Invalid ip length")}}(this.network)+"/"+t}}function c(e,t){return new a(e).contains(t)}},2723:(e,t,r)=>{"use strict";r.d(t,{c:()=>u});var n=r(5291),s=r(4135),i=r(6915);const o=Uint8Array.from([3,1]);var a,c=r(4113),l=r(6345);!function(e){let t,r;!function(e){let t;e.codec=()=>(null==t&&(t=(0,c.iU)((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.multiaddr&&e.multiaddr.byteLength>0&&(t.uint32(10),t.bytes(e.multiaddr)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={multiaddr:(0,l.c)(0)},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();t>>>3==1?n.multiaddr=e.bytes():e.skipType(7&t)}return n})),t),e.encode=t=>(0,c.mH)(t,e.codec()),e.decode=(t,r)=>(0,c.Y8)(t,e.codec(),r)}(t=e.AddressInfo||(e.AddressInfo={})),e.codec=()=>(null==r&&(r=(0,c.iU)((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.peerId&&t.peerId.byteLength>0&&(r.uint32(10),r.bytes(t.peerId)),null!=t.seq&&0n!==t.seq&&(r.uint32(16),r.uint64(t.seq)),null!=t.addresses)for(const n of t.addresses)r.uint32(26),e.AddressInfo.codec().encode(n,r);!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{const s={peerId:(0,l.c)(0),seq:0n,addresses:[]},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:s.peerId=t.bytes();break;case 2:s.seq=t.uint64();break;case 3:if(null!=n.limits?.addresses&&s.addresses.length===n.limits.addresses)throw new c.zH('Decode error - map field "addresses" had too many elements');s.addresses.push(e.AddressInfo.codec().decode(t,t.uint32(),{limits:n.limits?.addresses$}));break;default:t.skipType(7&r)}}return s})),r),e.encode=t=>(0,c.mH)(t,e.codec()),e.decode=(t,r)=>(0,c.Y8)(t,e.codec(),r)}(a||(a={}));class u{static createFromProtobuf=e=>{const t=a.decode(e),r=(0,n.jD)(i.decode(t.peerId)),o=(t.addresses??[]).map(e=>(0,s.HZ)(e.multiaddr)),c=t.seq;return new u({peerId:r,multiaddrs:o,seqNumber:c})};static DOMAIN="libp2p-peer-record";static CODEC=o;peerId;multiaddrs;seqNumber;domain=u.DOMAIN;codec=u.CODEC;marshaled;constructor(e){const{peerId:t,multiaddrs:r,seqNumber:n}=e;this.peerId=t,this.multiaddrs=r??[],this.seqNumber=n??BigInt(Date.now())}marshal(){return null==this.marshaled&&(this.marshaled=a.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return e instanceof u&&!!this.peerId.equals(e.peerId)&&this.seqNumber===e.seqNumber&&!!function(e,t){const r=(e,t)=>e.toString().localeCompare(t.toString());return e.length===t.length&&(t.sort(r),e.sort(r).every((e,r)=>t[r].equals(e)))}(this.multiaddrs,e.multiaddrs)}}},2860:(e,t,r)=>{"use strict";r.d(t,{X:()=>s});var n=r(8337);class s extends EventTarget{#e=new Map;constructor(){super(),(0,n.k)(1/0,this)}listenerCount(e){const t=this.#e.get(e);return null==t?0:t.length}addEventListener(e,t,r){super.addEventListener(e,t,r);let n=this.#e.get(e);null==n&&(n=[],this.#e.set(e,n)),n.push({callback:t,once:(!0!==r&&!1!==r&&r?.once)??!1})}removeEventListener(e,t,r){super.removeEventListener(e.toString(),t??null,r);let n=this.#e.get(e);null!=n&&(n=n.filter(({callback:e})=>e!==t),this.#e.set(e,n))}dispatchEvent(e){const t=super.dispatchEvent(e);let r=this.#e.get(e.type);return null==r||(r=r.filter(({once:e})=>!e),this.#e.set(e.type,r)),t}safeDispatchEvent(e,t={}){return this.dispatchEvent(new CustomEvent(e,t))}}},2906:(e,t,r)=>{"use strict";r.d(t,{TO:()=>n.TO,br:()=>s}),r(6129);var n=r(5494),s=r(6915);r(2416),r(5509)},2988:(e,t,r)=>{"use strict";r.d(t,{l:()=>B,d:()=>N});var n,s=r(7191),i=r(2723),o=r(5768),a=r(7418),c=r(4135),l=r(3810),u=r(7987),h=r(6209),d=r(8337),f=r(7442),p=r(5129),g=r(4113);!function(e){let t;e.codec=()=>(null==t&&(t=(0,g.iU)((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.protocolVersion&&(t.uint32(42),t.string(e.protocolVersion)),null!=e.agentVersion&&(t.uint32(50),t.string(e.agentVersion)),null!=e.publicKey&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.listenAddrs)for(const r of e.listenAddrs)t.uint32(18),t.bytes(r);if(null!=e.observedAddr&&(t.uint32(34),t.bytes(e.observedAddr)),null!=e.protocols)for(const r of e.protocols)t.uint32(26),t.string(r);null!=e.signedPeerRecord&&(t.uint32(66),t.bytes(e.signedPeerRecord)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={listenAddrs:[],protocols:[]},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 5:n.protocolVersion=e.string();break;case 6:n.agentVersion=e.string();break;case 1:n.publicKey=e.bytes();break;case 2:if(null!=r.limits?.listenAddrs&&n.listenAddrs.length===r.limits.listenAddrs)throw new g.zH('Decode error - map field "listenAddrs" had too many elements');n.listenAddrs.push(e.bytes());break;case 4:n.observedAddr=e.bytes();break;case 3:if(null!=r.limits?.protocols&&n.protocols.length===r.limits.protocols)throw new g.zH('Decode error - map field "protocols" had too many elements');n.protocols.push(e.string());break;case 8:n.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,g.mH)(t,e.codec()),e.decode=(t,r)=>(0,g.Y8)(t,e.codec(),r)}(n||(n={}));var m=r(6552),y=r(6800),w=r(5291);const b="ipfs",v=5e3,E=1,x=1,S=10,A=8192,I=!0,C=!0,k=!0,P=32;async function T(e,t,r,n,s){if(r("received identify from %p",n.remotePeer),null==s)throw new y.L("message was null or undefined");const a={};if(s.listenAddrs.length>0&&(a.addresses=s.listenAddrs.map(e=>({isCertified:!1,multiaddr:(0,c.HZ)(e)}))),s.protocols.length>0&&(a.protocols=s.protocols),null!=s.publicKey){const e=(0,m.EZ)(s.publicKey);if(!(0,w.sR)(e).equals(n.remotePeer))throw new y.L("public key did not match remote PeerId");a.publicKey=e}let l;if(null!=s.signedPeerRecord){r.trace("received signedPeerRecord from %p",n.remotePeer);let t=s.signedPeerRecord;const c=await o.e.openAndCertify(t,i.c.DOMAIN);let u=i.c.createFromProtobuf(c.payload);const h=(0,w.Az)(c.publicKey.toCID());if(!u.peerId.equals(h))throw new y.L("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(u.peerId))throw new y.L("signing key does not match remote PeerId");let d;try{d=await e.get(u.peerId)}catch(e){if("NotFoundError"!==e.name)throw e}if(null!=d&&(a.metadata=d.metadata,null!=d.peerRecordEnvelope)){const e=o.e.createFromProtobuf(d.peerRecordEnvelope),n=i.c.createFromProtobuf(e.payload);n.seqNumber>=u.seqNumber&&(r("sequence number was lower or equal to existing sequence number - stored: %d received: %d",n.seqNumber,u.seqNumber),u=n,t=d.peerRecordEnvelope)}a.peerRecordEnvelope=t,a.addresses=u.multiaddrs.map(e=>({isCertified:!0,multiaddr:e})),l={seq:u.seqNumber,addresses:u.multiaddrs}}else r("%p did not send a signed peer record",n.remotePeer);if(r.trace("patching %p with",n.remotePeer,a),await e.patch(n.remotePeer,a),null!=s.agentVersion||null!=s.protocolVersion){const t={};null!=s.agentVersion&&(t.AgentVersion=(0,f.s)(s.agentVersion)),null!=s.protocolVersion&&(t.ProtocolVersion=(0,f.s)(s.protocolVersion)),r.trace("merging %p metadata",n.remotePeer,t),await e.merge(n.remotePeer,{metadata:t})}const u={peerId:n.remotePeer,protocolVersion:s.protocolVersion,agentVersion:s.agentVersion,publicKey:s.publicKey,listenAddrs:s.listenAddrs.map(e=>(0,c.HZ)(e)),observedAddr:null==s.observedAddr?void 0:(0,c.HZ)(s.observedAddr),protocols:s.protocols,signedPeerRecord:l,connection:n};return t.safeDispatchEvent("peer:identify",{detail:u}),u}class _{host;protocol;started;timeout;peerId;privateKey;peerStore;registrar;addressManager;maxInboundStreams;maxOutboundStreams;maxMessageSize;maxObservedAddresses;events;runOnLimitedConnection;log;constructor(e,t){var r,n;this.protocol=t.protocol,this.started=!1,this.peerId=e.peerId,this.privateKey=e.privateKey,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.events=e.events,this.log=t.log,this.timeout=t.timeout??v,this.maxInboundStreams=t.maxInboundStreams??E,this.maxOutboundStreams=t.maxOutboundStreams??x,this.maxMessageSize=t.maxMessageSize??A,this.maxObservedAddresses=t.maxObservedAddresses??S,this.runOnLimitedConnection=t.runOnLimitedConnection??k,this.host={protocolVersion:`${t.protocolPrefix??b}/0.1.0`,agentVersion:(r=e.nodeInfo,n=t.agentVersion,null!=n?n:r.userAgent)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:(0,f.s)(this.host.agentVersion),ProtocolVersion:(0,f.s)(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,e=>{this.handleProtocol(e).catch(e=>{this.log.error(e)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}class D extends _{connectionManager;concurrency;_push;constructor(e,t={}){super(e,{...t,protocol:`/${t.protocolPrefix??b}/id/push/1.0.0`,log:e.logger.forComponent("libp2p:identify-push")}),this.connectionManager=e.connectionManager,this.concurrency=t.concurrency??P,this._push=(0,a.s)(this.sendPushMessage.bind(this),t.debounce??1e3),(t.runOnSelfUpdate??C)&&e.events.addEventListener("self:peer:update",e=>{this.push().catch(e=>{this.log.error("error pushing updates to peers - %e",e)})})}[s.Ch]=["@libp2p/identify-push"];async push(){this._push()}async sendPushMessage(){if(this.isStarted())try{const e=this.addressManager.getAddresses().map(e=>e.decapsulateCode((0,c.WH)("p2p").code)),t=new i.c({peerId:this.peerId,multiaddrs:e}),r=await o.e.seal(t,this.privateKey),s=this.registrar.getProtocols(),a=await this.peerStore.get(this.peerId),g=(0,p.d)(a.metadata.get("AgentVersion")??(0,f.s)(this.host.agentVersion)),m=(0,p.d)(a.metadata.get("ProtocolVersion")??(0,f.s)(this.host.protocolVersion)),y=this;async function*w(){for(const t of y.connectionManager.getConnections())(await y.peerStore.get(t.remotePeer)).protocols.includes(y.protocol)&&(yield async()=>{let i;const o=AbortSignal.timeout(y.timeout);(0,d.k)(1/0,o);try{i=await t.newStream(y.protocol,{signal:o,runOnLimitedConnection:y.runOnLimitedConnection});const a=(0,h.z)(i,{maxDataLength:y.maxMessageSize}).pb(n);await a.write({listenAddrs:e.map(e=>e.bytes),signedPeerRecord:r.marshal(),protocols:s,agentVersion:g,protocolVersion:m},{signal:o}),await i.close({signal:o})}catch(e){y.log.error("could not push identify update to peer",e),i?.abort(e)}})}await(0,l.A)((0,u.A)(w(),{concurrency:this.concurrency}))}catch(b){this.log.error("error pushing updates to peers - %e",b)}}async handleProtocol(e){const{connection:t,stream:r}=e;try{if(this.peerId.equals(t.remotePeer))throw new Error("received push from ourselves?");const e={signal:AbortSignal.timeout(this.timeout)},s=(0,h.z)(r,{maxDataLength:this.maxMessageSize}).pb(n),i=await s.read(e);await r.close(e),await T(this.peerStore,this.events,this.log,t,i)}catch(e){return this.log.error("received invalid message",e),void r.abort(e)}this.log.trace("handled push from %p",t.remotePeer)}}var L=r(2520),R=r(3008),U=r(386);class M extends _{constructor(e,t={}){super(e,{...t,protocol:`/${t.protocolPrefix??b}/id/1.0.0`,log:e.logger.forComponent("libp2p:identify")}),(t.runOnConnectionOpen??I)&&e.events.addEventListener("connection:open",e=>{const t=e.detail;this.identify(t).catch(e=>{e.name!==y.IM.name&&this.log.error("error during identify trigged by connection:open",e)})})}[s.Ch]=["@libp2p/identify"];async _identify(e,t={}){let r;if(null==t.signal){const e=AbortSignal.timeout(this.timeout);(0,d.k)(1/0,e),t={...t,signal:e}}try{r=await e.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection});const s=(0,h.z)(r,{maxDataLength:this.maxMessageSize}).pb(n),i=await s.read(t);return await r.close(t),i}catch(e){throw r?.abort(e),e}}async identify(e,t={}){const r=await this._identify(e,t),{publicKey:n,protocols:s,observedAddr:i}=r;if(null==n)throw new y.L("public key was missing from identify message");const o=(0,m.EZ)(n),a=(0,w.Az)(o.toCID());if(!e.remotePeer.equals(a))throw new y.L("identified peer does not match the expected peer");if(this.peerId.equals(a))throw new y.L("identified peer is our own peer id?");return this.maybeAddObservedAddress(i),this.log("identify completed for peer %p and protocols %o",a,s),T(this.peerStore,this.events,this.log,e,r)}maybeAddObservedAddress(e){const t=function(e){if(null!=e&&e.length>0)try{return(0,c.HZ)(e)}catch{}}(e);if(null==t)return;if(this.log.trace("our observed address was %a",t),(0,R.G)(t))return void this.log.trace("our observed address was private");const r=t.getComponents();r[0].code!==c.Ik&&(r[0].code!==c.qc||r[1].code!==c.Ik)||function(e){try{for(const{code:t,value:r}of e.getComponents())if(null!=r&&t===c.Ik)return(0,L.eX)("2000::/3",r)}catch{}return!1}(t)?U.qi.exactMatch(t)||(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(t)):this.log.trace("our observed address was IPv6 but not a global unicast address")}async handleProtocol(e){const{connection:t,stream:r}=e,s=AbortSignal.timeout(this.timeout);(0,d.k)(1/0,s);try{const e=await this.peerStore.get(this.peerId),a=this.addressManager.getAddresses().map(e=>e.decapsulateCode((0,c.WH)("p2p").code));let l=e.peerRecordEnvelope;if(a.length>0&&null==l){const e=new i.c({peerId:this.peerId,multiaddrs:a});l=(await o.e.seal(e,this.privateKey)).marshal().subarray()}let u=t.remoteAddr.bytes;U.DD.matches(t.remoteAddr)||(u=void 0);const d=(0,h.z)(r).pb(n);await d.write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:(0,m.Ve)(this.privateKey.publicKey),listenAddrs:a.map(e=>e.bytes),signedPeerRecord:l,observedAddr:u,protocols:e.protocols},{signal:s}),await r.close({signal:s})}catch(e){this.log.error("could not respond to identify request",e),r.abort(e)}}}function B(e={}){return t=>new M(t,e)}function N(e={}){return t=>new D(t,e)}},3008:(e,t,r)=>{"use strict";r.d(t,{G:()=>i});var n=r(1794),s=r(1204);function i(e){try{if(!(0,s.b)(e))return!1;const[[,t]]=e.stringTuples();return null!=t&&((0,n.b)(t)??!1)}catch{}return!0}},3051:(e,t,r)=>{"use strict";r.d(t,{Hu:()=>s});var n=r(2520);function s(e){let t,r;if(e.getComponents().forEach(e=>{"ip4"!==e.name&&"ip6"!==e.name||(r=e.value),"ipcidr"===e.name&&(t=e.value)}),null==t||null==r)throw new Error("Invalid multiaddr");return new n.fO(r,t)}r(7442),r(5129),r(1704)},3368:()=>{"use strict";try{self["workbox:precaching:7.2.0"]&&_()}catch(e){}},3550:(e,t,r)=>{"use strict";r.d(t,{sc:()=>U,Zf:()=>M});var n=r(4597);function s(e,t,r){return e&t^~e&r}function i(e,t,r){return e&t^e&r^t&r}class o extends n.Vw{constructor(e,t,r,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.buffer=new Uint8Array(e),this.view=(0,n.O8)(this.buffer)}update(e){(0,n.CC)(this),e=(0,n.ZJ)(e),(0,n.DO)(e);const{view:t,buffer:r,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const t=(0,n.O8)(e);for(;s<=i-o;o+=s)this.process(t,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,n.CC)(this),(0,n.Ht)(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:i}=this;let{pos:o}=this;t[o++]=128,(0,n.uH)(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(r,0),o=0);for(let e=o;e<s;e++)t[e]=0;!function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,l=n?0:4;e.setUint32(t+c,o,n),e.setUint32(t+l,a,n)}(r,s-8,BigInt(8*this.length),i),this.process(r,0);const a=(0,n.O8)(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<l;e++)a.setUint32(4*e,u[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:n,finished:s,destroyed:i,pos:o}=this;return e.destroyed=i,e.finished=s,e.length=n,e.pos=o,n%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const a=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),c=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),l=BigInt(2**32-1),u=BigInt(32);function h(e,t=!1){return t?{h:Number(e&l),l:Number(e>>u&l)}:{h:0|Number(e>>u&l),l:0|Number(e&l)}}const d=(e,t,r)=>e>>>r,f=(e,t,r)=>e<<32-r|t>>>r,p=(e,t,r)=>e>>>r|t<<32-r,g=(e,t,r)=>e<<32-r|t>>>r,m=(e,t,r)=>e<<64-r|t>>>r-32,y=(e,t,r)=>e>>>r-32|t<<64-r;function w(e,t,r,n){const s=(t>>>0)+(n>>>0);return{h:e+r+(s/2**32|0)|0,l:0|s}}const b=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),v=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,E=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),x=(e,t,r,n,s)=>t+r+n+s+(e/2**32|0)|0,S=(e,t,r,n,s)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(s>>>0),A=(e,t,r,n,s,i)=>t+r+n+s+i+(e/2**32|0)|0,I=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),C=new Uint32Array(64);class k extends o{constructor(e=32){super(64,e,8,!1),this.A=0|a[0],this.B=0|a[1],this.C=0|a[2],this.D=0|a[3],this.E=0|a[4],this.F=0|a[5],this.G=0|a[6],this.H=0|a[7]}get(){const{A:e,B:t,C:r,D:n,E:s,F:i,G:o,H:a}=this;return[e,t,r,n,s,i,o,a]}set(e,t,r,n,s,i,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|s,this.F=0|i,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)C[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=C[e-15],r=C[e-2],s=(0,n.Ow)(t,7)^(0,n.Ow)(t,18)^t>>>3,i=(0,n.Ow)(r,17)^(0,n.Ow)(r,19)^r>>>10;C[e]=i+C[e-7]+s+C[e-16]|0}let{A:r,B:o,C:a,D:c,E:l,F:u,G:h,H:d}=this;for(let e=0;e<64;e++){const t=d+((0,n.Ow)(l,6)^(0,n.Ow)(l,11)^(0,n.Ow)(l,25))+s(l,u,h)+I[e]+C[e]|0,f=((0,n.Ow)(r,2)^(0,n.Ow)(r,13)^(0,n.Ow)(r,22))+i(r,o,a)|0;d=h,h=u,u=l,l=c+t|0,c=a,a=o,o=r,r=t+f|0}r=r+this.A|0,o=o+this.B|0,a=a+this.C|0,c=c+this.D|0,l=l+this.E|0,u=u+this.F|0,h=h+this.G|0,d=d+this.H|0,this.set(r,o,a,c,l,u,h,d)}roundClean(){(0,n.uH)(C)}destroy(){this.set(0,0,0,0,0,0,0,0),(0,n.uH)(this.buffer)}}const P=(()=>function(e,t=!1){const r=e.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){const{h:r,l:o}=h(e[i],t);[n[i],s[i]]=[r,o]}return[n,s]}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))))(),T=(()=>P[0])(),_=(()=>P[1])(),D=new Uint32Array(80),L=new Uint32Array(80);class R extends o{constructor(e=64){super(128,e,16,!1),this.Ah=0|c[0],this.Al=0|c[1],this.Bh=0|c[2],this.Bl=0|c[3],this.Ch=0|c[4],this.Cl=0|c[5],this.Dh=0|c[6],this.Dl=0|c[7],this.Eh=0|c[8],this.El=0|c[9],this.Fh=0|c[10],this.Fl=0|c[11],this.Gh=0|c[12],this.Gl=0|c[13],this.Hh=0|c[14],this.Hl=0|c[15]}get(){const{Ah:e,Al:t,Bh:r,Bl:n,Ch:s,Cl:i,Dh:o,Dl:a,Eh:c,El:l,Fh:u,Fl:h,Gh:d,Gl:f,Hh:p,Hl:g}=this;return[e,t,r,n,s,i,o,a,c,l,u,h,d,f,p,g]}set(e,t,r,n,s,i,o,a,c,l,u,h,d,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|s,this.Cl=0|i,this.Dh=0|o,this.Dl=0|a,this.Eh=0|c,this.El=0|l,this.Fh=0|u,this.Fl=0|h,this.Gh=0|d,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let r=0;r<16;r++,t+=4)D[r]=e.getUint32(t),L[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){const t=0|D[e-15],r=0|L[e-15],n=p(t,r,1)^p(t,r,8)^d(t,0,7),s=g(t,r,1)^g(t,r,8)^f(t,r,7),i=0|D[e-2],o=0|L[e-2],a=p(i,o,19)^m(i,o,61)^d(i,0,6),c=g(i,o,19)^y(i,o,61)^f(i,o,6),l=E(s,c,L[e-7],L[e-16]),u=x(l,n,a,D[e-7],D[e-16]);D[e]=0|u,L[e]=0|l}let{Ah:r,Al:n,Bh:s,Bl:i,Ch:o,Cl:a,Dh:c,Dl:l,Eh:u,El:h,Fh:I,Fl:C,Gh:k,Gl:P,Hh:R,Hl:U}=this;for(let e=0;e<80;e++){const t=p(u,h,14)^p(u,h,18)^m(u,h,41),d=g(u,h,14)^g(u,h,18)^y(u,h,41),f=u&I^~u&k,E=S(U,d,h&C^~h&P,_[e],L[e]),x=A(E,R,t,f,T[e],D[e]),M=0|E,B=p(r,n,28)^m(r,n,34)^m(r,n,39),N=g(r,n,28)^y(r,n,34)^y(r,n,39),O=r&s^r&o^s&o,F=n&i^n&a^i&a;R=0|k,U=0|P,k=0|I,P=0|C,I=0|u,C=0|h,({h:u,l:h}=w(0|c,0|l,0|x,0|M)),c=0|o,l=0|a,o=0|s,a=0|i,s=0|r,i=0|n;const q=b(M,N,F);r=v(q,x,B,O),n=0|q}({h:r,l:n}=w(0|this.Ah,0|this.Al,0|r,0|n)),({h:s,l:i}=w(0|this.Bh,0|this.Bl,0|s,0|i)),({h:o,l:a}=w(0|this.Ch,0|this.Cl,0|o,0|a)),({h:c,l}=w(0|this.Dh,0|this.Dl,0|c,0|l)),({h:u,l:h}=w(0|this.Eh,0|this.El,0|u,0|h)),({h:I,l:C}=w(0|this.Fh,0|this.Fl,0|I,0|C)),({h:k,l:P}=w(0|this.Gh,0|this.Gl,0|k,0|P)),({h:R,l:U}=w(0|this.Hh,0|this.Hl,0|R,0|U)),this.set(r,n,s,i,o,a,c,l,u,h,I,C,k,P,R,U)}roundClean(){(0,n.uH)(D,L)}destroy(){(0,n.uH)(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const U=(0,n.qj)(()=>new k),M=(0,n.qj)(()=>new R)},3578:(e,t,r)=>{"use strict";r.d(t,{Fo:()=>O,br:()=>N.br});var n={};r.r(n),r.d(n,{base10:()=>d});var s={};r.r(s),r.d(s,{base16:()=>f,base16upper:()=>p});var i={};r.r(i),r.d(i,{base2:()=>g});var o={};r.r(o),r.d(o,{base256emoji:()=>b});var a={};r.r(a),r.d(a,{base8:()=>A});var c={};r.r(c),r.d(c,{identity:()=>C});var l={};r.r(l),r.d(l,{code:()=>_,decode:()=>L,encode:()=>D,name:()=>T});var u={};r.r(u),r.d(u,{code:()=>U,decode:()=>B,encode:()=>M,name:()=>R});var h=r(5970);const d=(0,h._Q)({prefix:"9",name:"base10",alphabet:"0123456789"}),f=(0,h.yE)({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),p=(0,h.yE)({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),g=(0,h.yE)({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),m=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),y=m.reduce((e,t,r)=>(e[r]=t,e),[]),w=m.reduce((e,t,r)=>{const n=t.codePointAt(0);if(null==n)throw new Error(`Invalid character: ${t}`);return e[n]=r,e},[]),b=(0,h.HT)({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce((e,t)=>e+y[t],"")},decode:function(e){const t=[];for(const r of e){const e=r.codePointAt(0);if(null==e)throw new Error(`Invalid character: ${r}`);const n=w[e];if(null==n)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}});var v=r(135),E=r(5427),x=r(1671),S=r(7484);const A=(0,h.yE)({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var I=r(6129);const C=(0,h.HT)({prefix:"\0",name:"identity",encode:e=>(0,I.dI)(e),decode:e=>(0,I.sH)(e)}),k=new TextEncoder,P=new TextDecoder,T="json",_=512;function D(e){return k.encode(JSON.stringify(e))}function L(e){return JSON.parse(P.decode(e))}const R="raw",U=85;function M(e){return(0,I.au)(e)}function B(e){return(0,I.au)(e)}r(9809),r(142);var N=r(2906);const O={...c,...i,...a,...n,...s,...v,...E,...x,...S,...o}},3734:(e,t,r)=>{"use strict";r.d(t,{q:()=>n}),r(9248),r(5706);const n=e=>e&&"object"==typeof e?e:{handle:e}},3801:(e,t,r)=>{"use strict";r.d(t,{D0:()=>x,Tp:()=>A,dQ:()=>y,jr:()=>b,pS:()=>v,qy:()=>I,zH:()=>f,zi:()=>d});var n=r(8289),s=r(4597);const i=BigInt(0),o=BigInt(1),a=BigInt(2),c=BigInt(3),l=BigInt(4),u=BigInt(5),h=BigInt(8);function d(e,t){const r=e%t;return r>=i?r:t+r}function f(e,t,r){let n=e;for(;t-- >i;)n*=n,n%=r;return n}function p(e,t){if(e===i)throw new Error("invert: expected non-zero number");if(t<=i)throw new Error("invert: expected positive modulus, got "+t);let r=d(e,t),n=t,s=i,a=o,c=o,l=i;for(;r!==i;){const e=n/r,t=n%r,i=s-c*e,o=a-l*e;n=r,r=t,s=c,a=l,c=i,l=o}if(n!==o)throw new Error("invert: does not exist");return d(s,t)}function g(e,t){const r=(e.ORDER+o)/l,n=e.pow(t,r);if(!e.eql(e.sqr(n),t))throw new Error("Cannot find square root");return n}function m(e,t){const r=(e.ORDER-u)/h,n=e.mul(t,a),s=e.pow(n,r),i=e.mul(t,s),o=e.mul(e.mul(i,a),s),c=e.mul(i,e.sub(o,e.ONE));if(!e.eql(e.sqr(c),t))throw new Error("Cannot find square root");return c}const y=(e,t)=>(d(e,t)&o)===o,w=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function b(e){const t=w.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"});return(0,n.DS)(e,t),e}function v(e,t,r=!1){const n=new Array(t.length).fill(r?e.ZERO:void 0),s=t.reduce((t,r,s)=>e.is0(r)?t:(n[s]=t,e.mul(t,r)),e.ONE),i=e.inv(s);return t.reduceRight((t,r,s)=>e.is0(r)?t:(n[s]=e.mul(t,n[s]),e.mul(t,r)),i),n}function E(e,t){const r=(e.ORDER-o)/a,n=e.pow(t,r),s=e.eql(n,e.ONE),i=e.eql(n,e.ZERO),c=e.eql(n,e.neg(e.ONE));if(!s&&!i&&!c)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function x(e,t,r=!1,f={}){if(e<=i)throw new Error("invalid field: expected ORDER > 0, got "+e);let y,w;if("object"==typeof t&&null!=t){if(f.sqrt||r)throw new Error("cannot specify opts in two arguments");const e=t;e.BITS&&(y=e.BITS),e.sqrt&&(w=e.sqrt),"boolean"==typeof e.isLE&&(r=e.isLE)}else"number"==typeof t&&(y=t),f.sqrt&&(w=f.sqrt);const{nBitLength:b,nByteLength:S}=function(e,t){void 0!==t&&(0,s.Fe)(t);const r=void 0!==t?t:e.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}(e,y);if(S>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let A;const I=Object.freeze({ORDER:e,isLE:r,BITS:b,BYTES:S,MASK:(0,n.OG)(b),ZERO:i,ONE:o,create:t=>d(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("invalid field element: expected bigint, got "+typeof t);return i<=t&&t<e},is0:e=>e===i,isValidNot0:e=>!I.is0(e)&&I.isValid(e),isOdd:e=>(e&o)===o,neg:t=>d(-t,e),eql:(e,t)=>e===t,sqr:t=>d(t*t,e),add:(t,r)=>d(t+r,e),sub:(t,r)=>d(t-r,e),mul:(t,r)=>d(t*r,e),pow:(e,t)=>function(e,t,r){if(r<i)throw new Error("invalid exponent, negatives unsupported");if(r===i)return e.ONE;if(r===o)return t;let n=e.ONE,s=t;for(;r>i;)r&o&&(n=e.mul(n,s)),s=e.sqr(s),r>>=o;return n}(I,e,t),div:(t,r)=>d(t*p(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>p(t,e),sqrt:w||(t=>{return A||(A=(r=e)%l===c?g:r%h===u?m:function(e){if(e<BigInt(3))throw new Error("sqrt is not defined for small field");let t=e-o,r=0;for(;t%a===i;)t/=a,r++;let n=a;const s=x(e);for(;1===E(s,n);)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(1===r)return g;let c=s.pow(n,t);const l=(t+o)/a;return function(e,n){if(e.is0(n))return n;if(1!==E(e,n))throw new Error("Cannot find square root");let s=r,i=e.mul(e.ONE,c),a=e.pow(n,t),u=e.pow(n,l);for(;!e.eql(a,e.ONE);){if(e.is0(a))return e.ZERO;let t=1,r=e.sqr(a);for(;!e.eql(r,e.ONE);)if(t++,r=e.sqr(r),t===s)throw new Error("Cannot find square root");const n=o<<BigInt(s-t-1),c=e.pow(i,n);s=t,i=e.sqr(c),a=e.mul(a,i),u=e.mul(u,c)}return u}}(r)),A(I,t);var r}),toBytes:e=>r?(0,n.z)(e,S):(0,n.lq)(e,S),fromBytes:e=>{if(e.length!==S)throw new Error("Field.fromBytes: expected "+S+" bytes, got "+e.length);return r?(0,n.lX)(e):(0,n.Ph)(e)},invertBatch:e=>v(I,e),cmov:(e,t,r)=>r?t:e});return Object.freeze(I)}function S(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function A(e){const t=S(e);return t+Math.ceil(t/2)}function I(e,t,r=!1){const s=e.length,i=S(t),a=A(t);if(s<16||s<a||s>1024)throw new Error("expected "+a+"-1024 bytes of input, got "+s);const c=d(r?(0,n.lX)(e):(0,n.Ph)(e),t-o)+o;return r?(0,n.z)(c,i):(0,n.lq)(c,i)}},3810:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});const n=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e);})();for(const t of e);}},3848:(e,t,r)=>{"use strict";r.d(t,{N:()=>R});var n=r(7191),s=r(8337),i=r(6800),o=r(1151),a=r(6513),c=r(86);class l extends Error{static name="InvalidFrameError";constructor(e="The frame was invalid"){super(e),this.name="InvalidFrameError"}}class u extends Error{static name="UnrequestedPingError";constructor(e="Unrequested ping error"){super(e),this.name="UnrequestedPingError"}}class h extends Error{static name="NotMatchingPingError";constructor(e="Unrequested ping error"){super(e),this.name="NotMatchingPingError"}}class d extends Error{static name="InvalidStateError";constructor(e="Invalid state"){super(e),this.name="InvalidStateError"}}class f extends Error{static name="StreamAlreadyExistsError";constructor(e="Strean already exists"){super(e),this.name="StreamAlreadyExistsError"}}class p extends Error{static name="DecodeInvalidVersionError";constructor(e="Decode invalid version"){super(e),this.name="DecodeInvalidVersionError"}}class g extends Error{static name="BothClientsError";constructor(e="Both clients"){super(e),this.name="BothClientsError"}}class m extends Error{static name="ReceiveWindowExceededError";constructor(e="Receive window exceeded"){super(e),this.name="ReceiveWindowExceededError"}}const y=new Set([l.name,u.name,h.name,f.name,p.name,g.name,m.name]),w=262144,b={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:w,maxStreamWindowSize:16777216,maxMessageSize:65536};var v,E,x;!function(e){e[e.Data=0]="Data",e[e.WindowUpdate=1]="WindowUpdate",e[e.Ping=2]="Ping",e[e.GoAway=3]="GoAway"}(v||(v={})),function(e){e[e.SYN=1]="SYN",e[e.ACK=2]="ACK",e[e.FIN=4]="FIN",e[e.RST=8]="RST"}(E||(E={})),Object.values(E).filter(e=>"string"!=typeof e),function(e){e[e.NormalTermination=0]="NormalTermination",e[e.ProtocolError=1]="ProtocolError",e[e.InternalError=2]="InternalError"}(x||(x={}));const S=2**24;class A{source;buffer;frameInProgress;constructor(e){this.source=function(e){if(void 0!==e[Symbol.iterator]){const t=e[Symbol.iterator]();return t.return=void 0,{[Symbol.iterator]:()=>t}}if(void 0!==e[Symbol.asyncIterator]){const t=e[Symbol.asyncIterator]();return t.return=void 0,{[Symbol.asyncIterator]:()=>t}}throw new Error("a source must be either an iterable or an async iterable")}(e),this.buffer=new c.I,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const e=this.readHeader();if(void 0===e)break;const{type:t,length:r}=e;t===v.Data?(this.frameInProgress=!0,yield{header:e,readData:this.readBytes.bind(this,r)}):yield{header:e}}}readHeader(){if(this.frameInProgress)throw new d("decoding frame already in progress");if(this.buffer.length<12)return;const e=function(e){if(0!==e[0])throw new l("Invalid frame version");return{type:e[1],flag:(e[2]<<8)+e[3],streamID:e[4]*S+(e[5]<<16)+(e[6]<<8)+e[7],length:e[8]*S+(e[9]<<16)+(e[10]<<8)+e[11]}}(this.buffer.subarray(0,12));return this.buffer.consume(12),e}async readBytes(e){if(this.buffer.length<e)for await(const t of this.source)if(this.buffer.append(t),this.buffer.length>=e)break;const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}}function I(e){const t=new Uint8Array(12);return t[1]=e.type,t[2]=e.flag>>>8,t[3]=e.flag,t[4]=e.streamID>>>24,t[5]=e.streamID>>>16,t[6]=e.streamID>>>8,t[7]=e.streamID,t[8]=e.length>>>24,t[9]=e.length>>>16,t[10]=e.length>>>8,t[11]=e.length,t}var C,k=r(1698),P=r(6267);!function(e){e[e.Init=0]="Init",e[e.SYNSent=1]="SYNSent",e[e.SYNReceived=2]="SYNReceived",e[e.Established=3]="Established",e[e.Finished=4]="Finished"}(C||(C={}));class T extends k.l{name;state;config;_id;sendWindowCapacity;sendWindowCapacityUpdate;recvWindow;recvWindowCapacity;epochStart;getRTT;sendFrame;constructor(e){super({...e,onEnd:t=>{this.state=C.Finished,e.onEnd?.(t)}}),this.config=e.config,this._id=parseInt(e.id,10),this.name=e.name,this.state=e.state,this.sendWindowCapacity=w,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=e.getRTT,this.sendFrame=e.sendFrame,this.source=(0,P.A)(this.source,()=>{this.sendWindowUpdate()})}async sendNewStream(){}async sendData(e,t={}){for(e=e.sublist();0!==e.byteLength;){if(0===this.sendWindowCapacity&&(this.log?.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(t),"closed"===this.status||"aborted"===this.status||"reset"===this.status))return void this.log?.trace("%s while waiting for send window capacity",this.status);const r=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-12,e.length),n=this.getSendFlags();this.sendFrame({type:v.Data,flag:n,streamID:this._id,length:r},e.sublist(0,r)),this.sendWindowCapacity-=r,e.consume(r)}}async sendReset(){this.sendFrame({type:v.WindowUpdate,flag:E.RST,streamID:this._id,length:0})}async sendCloseWrite(){const e=this.getSendFlags()|E.FIN;this.sendFrame({type:v.WindowUpdate,flag:e,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(e={}){if(this.sendWindowCapacity>0)return;let t,r;const n=()=>{"open"===this.status||"closing"===this.status?r(new i.lc("Stream aborted")):t()};e.signal?.addEventListener("abort",n);try{await new Promise((e,n)=>{this.sendWindowCapacityUpdate=()=>{e()},r=n,t=e})}finally{e.signal?.removeEventListener("abort",n)}}handleWindowUpdate(e){this.log?.trace("stream received window update id=%s",this._id),this.processFlags(e.flag);const t=this.sendWindowCapacity;this.sendWindowCapacity+=e.length,0===t&&e.length>0&&this.sendWindowCapacityUpdate?.()}async handleData(e,t){if(this.log?.trace("stream received data id=%s",this._id),this.processFlags(e.flag),this.recvWindowCapacity<e.length)throw new m("Receive window exceeded");const r=await t();this.recvWindowCapacity-=e.length,this.sourcePush(r)}processFlags(e){(e&E.ACK)===E.ACK&&this.state===C.SYNSent&&(this.state=C.Established),(e&E.FIN)===E.FIN&&this.remoteCloseWrite(),(e&E.RST)===E.RST&&this.reset()}getSendFlags(){switch(this.state){case C.Init:return this.state=C.SYNSent,E.SYN;case C.SYNReceived:return this.state=C.Established,E.ACK;default:return 0}}sendWindowUpdate(){const e=this.getSendFlags(),t=Date.now(),r=this.getRTT();if(0===e&&r>-1&&t-this.epochStart<4*r&&(this.recvWindow=Math.min(2*this.recvWindow,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&0===e)return;const n=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=t,this.sendFrame({type:v.WindowUpdate,flag:e,streamID:this._id,length:n})}}const _="/yamux/1.0.0";class D{protocol=_;_components;_init;constructor(e,t={}){this._components=e,this._init=t}[Symbol.toStringTag]="@chainsafe/libp2p-yamux";[n.Ch]=["@libp2p/stream-multiplexing"];createStreamMuxer(e){return new L(this._components,{...this._init,...e})}}class L{protocol=_;source;sink;config;log;logger;closeController;nextStreamID;_streams;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;onIncomingStream;onStreamEnd;constructor(e,t){this.client="outbound"===t.direction,this.config={...b,...t},this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),function(e){if(e.keepAliveInterval<=0)throw new i.gG("keep-alive interval must be positive");if(e.maxInboundStreams<0)throw new i.gG("max inbound streams must be larger or equal 0");if(e.maxOutboundStreams<0)throw new i.gG("max outbound streams must be larger or equal 0");if(e.initialStreamWindowSize<w)throw new i.gG("InitialStreamWindowSize must be larger or equal 256 kB");if(e.maxStreamWindowSize<e.initialStreamWindowSize)throw new i.gG("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(e.maxStreamWindowSize>2**32-1)throw new i.gG("MaxStreamWindowSize must be less than equal MAX_UINT32");if(e.maxMessageSize<1024)throw new i.gG("MaxMessageSize must be greater than a kilobyte")}(this.config),this.closeController=new AbortController,(0,s.k)(1/0,this.closeController.signal),this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=(0,a.Ny)({onEnd:()=>{this.log?.trace("muxer source ended"),this._streams.forEach(e=>{e.destroy()})}}),this.sink=async e=>{const t=()=>{const t=(0,o.h)(e);if(null!=t.return){const e=t.return();null!=(r=e)&&"function"==typeof r.then&&e.catch(e=>{this.log?.("could not cause sink source to return",e)})}var r};let r,n;try{const n=new A(e);try{this.closeController.signal.addEventListener("abort",t);for await(const e of n.emitFrames())await this.handleFrame(e.header,e.readData)}finally{this.closeController.signal.removeEventListener("abort",t)}r=x.NormalTermination}catch(e){y.has(e.name)?(this.log?.error("protocol error in sink",e),r=x.ProtocolError):(this.log?.error("internal error in sink",e),r=x.InternalError),n=e}this.log?.trace("muxer sink ended"),null!=n?this.abort(n,r):await this.close({reason:r})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,this.log?.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(e=>this.log?.error("keepalive error: %s",e)),this.ping().catch(e=>this.log?.error("ping error: %s",e))}get streams(){return Array.from(this._streams.values())}newStream(e){if(void 0!==this.remoteGoAway)throw new i.Qx("Muxer closed remotely");if(void 0!==this.localGoAway)throw new i.Qx("Muxer closed locally");const t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new i.NJ("max outbound streams exceeded");this.log?.trace("new outgoing stream id=%s",t);const r=this._newStream(t,e,C.Init,"outbound");return this._streams.set(t,r),this.numOutboundStreams++,r.sendWindowUpdate(),r}async ping(){if(void 0!==this.remoteGoAway)throw new i.Qx("Muxer closed remotely");if(void 0!==this.localGoAway)throw new i.Qx("Muxer closed locally");if(void 0===this.activePing){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((t,r)=>{const n=()=>{r(new i.Qx("Muxer closed locally"))};this.closeController.signal.addEventListener("abort",n,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",n),t()}}),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const r=Date.now();this.rtt=r-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(e={}){if(this.closeController.signal.aborted)return;const t=e?.reason??x.NormalTermination;if(this.log?.trace("muxer close reason=%s",t),null==e.signal){const t=AbortSignal.timeout(500);(0,s.k)(1/0,t),e={...e,signal:t}}try{await Promise.all([...this._streams.values()].map(async t=>t.close(e))),this.sendGoAway(t),this._closeMuxer()}catch(e){this.abort(e)}}abort(e,t){if(!this.closeController.signal.aborted){t=t??x.InternalError,this.log?.error("muxer abort reason=%s error=%s",t,e);for(const t of this._streams.values())t.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,r,n){if(null!=this._streams.get(e))throw new i.gG("Stream already exists with that id");const s=new T({id:e.toString(),name:t,state:r,direction:n,sendFrame:this.sendFrame.bind(this),onEnd:()=>{this.closeStream(e),this.onStreamEnd?.(s)},log:this.logger.forComponent(`libp2p:yamux:${n}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return s}closeStream(e){this.client===(e%2==0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){const e=new Promise((e,t)=>{this.closeController.signal.addEventListener("abort",t,{once:!0})});for(this.log?.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let t;try{await Promise.race([e,new Promise(e=>{t=setTimeout(e,this.config.keepAliveInterval)})]),this.ping().catch(e=>this.log?.error("ping error: %s",e))}catch(e){return void clearInterval(t)}}}async handleFrame(e,t){const{streamID:r,type:n,length:s}=e;if(this.log?.trace("received frame %o",e),0===r)switch(n){case v.Ping:return void this.handlePing(e);case v.GoAway:return void this.handleGoAway(s);default:throw new l("Invalid frame type")}else switch(e.type){case v.Data:case v.WindowUpdate:return void await this.handleStreamMessage(e,t);default:throw new l("Invalid frame type")}}handlePing(e){if(e.flag===E.SYN)this.log?.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,E.ACK);else{if(e.flag!==E.ACK)throw new l("Invalid frame flag");this.log?.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length)}}handlePingResponse(e){if(void 0===this.activePing)throw new u("ping not requested");if(this.activePing.id!==e)throw new h("ping doesn't match our id");this.activePing.resolve()}handleGoAway(e){this.log?.trace("received GoAway reason=%s",x[e]??"unknown"),this.remoteGoAway=e;for(const e of this._streams.values())e.reset();this._closeMuxer()}async handleStreamMessage(e,t){const{streamID:r,flag:n,type:s}=e;(n&E.SYN)===E.SYN&&this.incomingStream(r);const i=this._streams.get(r);if(void 0!==i)switch(s){case v.WindowUpdate:return void i.handleWindowUpdate(e);case v.Data:if(void 0===t)throw new Error("unreachable");return void await i.handleData(e,t);default:throw new Error("unreachable")}else if(s===v.Data){if(this.log?.("discarding data for stream id=%s",r),void 0===t)throw new Error("unreachable");await t()}else this.log?.trace("frame for missing stream id=%s",r)}incomingStream(e){if(this.client!==(e%2==0))throw new i.gG("Both endpoints are clients");if(this._streams.has(e))return;if(this.log?.trace("new incoming stream id=%s",e),void 0!==this.localGoAway)return void this.sendFrame({type:v.WindowUpdate,flag:E.RST,streamID:e,length:0});if(this.numInboundStreams>=this.config.maxInboundStreams)return this.log?.("maxIncomingStreams exceeded, forcing stream reset"),void this.sendFrame({type:v.WindowUpdate,flag:E.RST,streamID:e,length:0});const t=this._newStream(e,void 0,C.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),this.onIncomingStream?.(t)}sendFrame(e,t){if(this.log?.trace("sending frame %o",e),e.type===v.Data){if(void 0===t)throw new l("Invalid frame");this.source.push(new c.I(I(e),t))}else this.source.push(I(e))}sendPing(e,t=E.SYN){t===E.SYN?this.log?.trace("sending ping request pingId=%s",e):this.log?.trace("sending ping response pingId=%s",e),this.sendFrame({type:v.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=x.NormalTermination){this.log?.("sending GoAway reason=%s",x[e]),this.localGoAway=e,this.sendFrame({type:v.GoAway,flag:0,streamID:0,length:e})}}function R(e={}){return t=>new D(t,e)}},3951:(e,t,r)=>{"use strict";r.d(t,{Q:()=>n});const n="keep-alive"},4113:(e,t,r)=>{"use strict";r.d(t,{zH:()=>q,w2:()=>z,Y8:()=>b,mH:()=>M,eG:()=>O,iU:()=>F});var n=r(5082);const s=new Float32Array([-0]),i=new Uint8Array(s.buffer);function o(e,t,r){s[0]=e,t[r]=i[0],t[r+1]=i[1],t[r+2]=i[2],t[r+3]=i[3]}const a=new Float64Array([-0]),c=new Uint8Array(a.buffer);function l(e,t,r){a[0]=e,t[r]=c[0],t[r+1]=c[1],t[r+2]=c[2],t[r+3]=c[3],t[r+4]=c[4],t[r+5]=c[5],t[r+6]=c[6],t[r+7]=c[7]}const u=BigInt(Number.MAX_SAFE_INTEGER),h=BigInt(Number.MIN_SAFE_INTEGER);class d{lo;hi;constructor(e,t){this.lo=0|e,this.hi=0|t}toNumber(e=!1){if(!e&&this.hi>>>31>0){const e=1+~this.lo>>>0;let t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(e+4294967296*t)}return this.lo+4294967296*this.hi}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!=0){const e=1+~this.lo>>>0;let t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(BigInt(e)+(BigInt(t)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}static fromBigInt(e){if(0n===e)return f;if(e<u&&e>h)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let r=e>>32n,n=e-(r<<32n);return t&&(r=0n|~r,n=0n|~n,++n>p&&(n=0n,++r>p&&(r=0n))),new d(Number(n),Number(r))}static fromNumber(e){if(0===e)return f;const t=e<0;t&&(e=-e);let r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new d(r,n)}static from(e){return"number"==typeof e?d.fromNumber(e):"bigint"==typeof e?d.fromBigInt(e):"string"==typeof e?d.fromBigInt(BigInt(e)):null!=e.low||null!=e.high?new d(e.low>>>0,e.high>>>0):f}}const f=new d(0,0);f.toBigInt=function(){return 0n},f.zzEncode=f.zzDecode=function(){return this},f.length=function(){return 1};const p=4294967296n;function g(e,t,r){const n=r;let s,i;for(let n=0;n<e.length;++n)s=e.charCodeAt(n),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=63&s|128):55296==(64512&s)&&56320==(64512&(i=e.charCodeAt(n+1)))?(s=65536+((1023&s)<<10)+(1023&i),++n,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=63&s|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=63&s|128);return r-n}function m(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function y(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}class w{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,m(this,10);return e}int32(){return 0|this.uint32()}sint32(){const e=this.uint32();return e>>>1^-(1&e)}bool(){return 0!==this.uint32()}fixed32(){if(this.pos+4>this.len)throw m(this,4);return y(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw m(this,4);return 0|y(this.buf,this.pos+=4)}float(){if(this.pos+4>this.len)throw m(this,4);const e=(t=this.buf,r=this.pos,i[0]=t[r],i[1]=t[r+1],i[2]=t[r+2],i[3]=t[r+3],s[0]);var t,r;return this.pos+=4,e}double(){if(this.pos+8>this.len)throw m(this,4);const e=(t=this.buf,r=this.pos,c[0]=t[r],c[1]=t[r+1],c[2]=t[r+2],c[3]=t[r+3],c[4]=t[r+4],c[5]=t[r+5],c[6]=t[r+6],c[7]=t[r+7],a[0]);var t,r;return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw m(this,e);return this.pos+=e,t===r?new Uint8Array(0):this.buf.subarray(t,r)}string(){const e=this.bytes();return function(e,t,r){if(r-t<1)return"";let n;const s=[];let i,o=0;for(;t<r;)i=e[t++],i<128?s[o++]=i:i>191&&i<224?s[o++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(i>>10),s[o++]=56320+(1023&i)):s[o++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((n??(n=[])).push(String.fromCharCode.apply(String,s)),o=0);return null!=n?(o>0&&n.push(String.fromCharCode.apply(String,s.slice(0,o))),n.join("")):String.fromCharCode.apply(String,s.slice(0,o))}(e,0,e.length)}skip(e){if("number"==typeof e){if(this.pos+e>this.len)throw m(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw m(this)}while(128&this.buf[this.pos++]);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new d(0,0);let t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw m(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw m(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw m(this,8);const e=y(this.buf,this.pos+=4),t=y(this.buf,this.pos+=4);return new d(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=(0,n.Sb)(this.buf,this.pos);return this.pos+=(0,n.OY)(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function b(e,t,r){const n=function(e){return new w(e instanceof Uint8Array?e:e.subarray())}(e);return t.decode(n,void 0,r)}var v=r(6345),E=r(7442);class x{fn;len;next;val;constructor(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}}function S(){}class A{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const I=function(){const e=8192;let t,r=e;return function(n){if(n<1||n>4096)return(0,v.K)(n);r+n>e&&(t=(0,v.K)(e),r=0);const s=t.subarray(r,r+=n);return 7&r&&(r=1+(7|r)),s}}();class C{len;head;tail;states;constructor(){this.len=0,this.head=new x(S,0,0),this.tail=this.head,this.states=null}_push(e,t,r){return this.tail=this.tail.next=new x(e,t,r),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new T((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(_,10,d.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=d.fromBigInt(e);return this._push(_,t.length(),t)}uint64Number(e){return this._push(n.mD,(0,n.OY)(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=d.fromBigInt(e).zzEncode();return this._push(_,t.length(),t)}sint64Number(e){const t=d.fromNumber(e).zzEncode();return this._push(_,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(k,1,e?1:0)}fixed32(e){return this._push(D,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=d.fromBigInt(e);return this._push(D,4,t.lo)._push(D,4,t.hi)}fixed64Number(e){const t=d.fromNumber(e);return this._push(D,4,t.lo)._push(D,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(o,4,e)}double(e){return this._push(l,8,e)}bytes(e){const t=e.length>>>0;return 0===t?this._push(k,1,0):this.uint32(t)._push(L,t,e)}string(e){const t=function(e){let t=0,r=0;for(let n=0;n<e.length;++n)r=e.charCodeAt(n),r<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t}(e);return 0!==t?this.uint32(t)._push(g,t,e):this._push(k,1,0)}fork(){return this.states=new A(this),this.head=this.tail=new x(S,0,0),this.len=0,this}reset(){return null!=this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new x(S,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),0!==r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this}finish(){let e=this.head.next;const t=(r=this.len,null!=globalThis.Buffer?(0,v.K)(r):I(r));var r;let n=0;for(;null!=e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}}function k(e,t,r){t[r]=255&e}function P(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}class T extends x{next;constructor(e,t){super(P,e,t),this.next=void 0}}function _(e,t,r){for(;0!==e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function D(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function L(e,t,r){t.set(e,r)}function R(e,t,r){t.set(e,r)}function U(e,t,r){e.length<40?g(e,t,r):null!=t.utf8Write?t.utf8Write(e,r):t.set((0,E.s)(e),r)}function M(e,t){const r=new C;return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var B;function N(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function O(e){function t(t){if(null==e[t.toString()])throw new Error("Invalid enum value");return e[t]}return N("enum",B.VARINT,function(e,r){const n=t(e);r.int32(n)},function(e){return t(e.int32())})}function F(e,t){return N("message",B.LENGTH_DELIMITED,e,t)}null!=globalThis.Buffer&&(C.prototype.bytes=function(e){const t=e.length>>>0;return this.uint32(t),t>0&&this._push(R,t,e),this},C.prototype.string=function(e){const t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(U,t,e),this}),function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"}(B||(B={})),Error;class q extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"}class z extends Error{code="ERR_MAX_SIZE";name="MaxSizeError"}},4135:(e,t,r)=>{"use strict";r.d(t,{eI:()=>f.eI,Cm:()=>f.Cm,A6:()=>f.A6,Jj:()=>f.Jj,GY:()=>f.GY,Ik:()=>f.Ik,qc:()=>f.qc,R8:()=>v,HZ:()=>E,WH:()=>x,K6:()=>b});var n=r(5129),s=r(1671),i=r(5494),o=r(5131),a=r(7442),c=r(5082),l=r(6119),u=r(9621),h=r(1704);function d(e,t,r){return null==e.size||0===e.size?0:e.size>0?e.size/8:c.D4(t,r)}var f=r(265);const p=Symbol.for("nodejs.util.inspect.custom"),g=Symbol.for("@multiformats/multiaddr"),m=[f.eI,f.Cm,f.A6,f.Jj];class y extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}class w{[g]=!0;#t;#r;#n;constructor(e="/",t={}){this.#t=function(e){if(null==e&&(e="/"),v(e))return e.getComponents();if(e instanceof Uint8Array)return function(e){const t=[];let r=0;for(;r<e.length;){const s=c.D4(e,r),i=h.u.getProtocol(s),o=c.OY(s),a=d(i,e,r+o);let l=0;a>0&&i.size===h.V&&(l=c.OY(a));const u=o+l+a,f={code:s,name:i.name,bytes:e.subarray(r,r+u)};if(a>0){const t=r+o+l,s=e.subarray(t,t+a);f.value=i.bytesToValue?.(s)??(0,n.d)(s)}t.push(f),r+=u}return t}(e);if("string"==typeof e)return""===(e=e.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""))&&(e="/"),function(e){if("/"!==e.charAt(0))throw new u.Ci('String multiaddr must start with "/"');const t=[];let r="protocol",n="",s="";for(let i=1;i<e.length;i++){const o=e.charAt(i);"/"!==o&&("protocol"===r?s+=e.charAt(i):n+=e.charAt(i));const a=i===e.length-1;if("/"===o||a){const e=h.u.getProtocol(s);if("protocol"===r){if(null==e.size||0===e.size){t.push({code:e.code,name:e.name}),n="",s="",r="protocol";continue}if(a)throw new u.Ci(`Component ${s} was missing value`);r="value"}else if("value"===r){const i={code:e.code,name:e.name};if(null!=e.size&&0!==e.size){if(""===n)throw new u.Ci(`Component ${s} was missing value`);i.value=e.stringToValue?.(n)??n}t.push(i),n="",s="",r="protocol"}}}if(""!==s&&""!==n)throw new u.Ci("Incomplete multiaddr");return t}(e);if(Array.isArray(e))return e;throw new u.Ci("Must be a string, Uint8Array, Component[], or another Multiaddr")}(e),!1!==t.validate&&function(e){e.getComponents().forEach(e=>{const t=h.u.getProtocol(e.code);null!=e.value&&t.validate?.(e.value)})}(this)}get bytes(){return null==this.#n&&(this.#n=function(e){let t=0;const r=[];for(const n of e){if(null==n.bytes){const e=h.u.getProtocol(n.code),t=c.OY(n.code);let r,s=0,i=0;null!=n.value&&(r=e.valueToBytes?.(n.value)??(0,a.s)(n.value),s=r.byteLength,e.size===h.V&&(i=c.OY(s)));const o=new Uint8Array(t+i+s);let l=0;c.mD(n.code,o,l),l+=t,null!=r&&(e.size===h.V&&(c.mD(s,o,l),l+=i),o.set(r,l)),n.bytes=o}r.push(n.bytes),t+=n.bytes.byteLength}return(0,l.x)(r,t)}(this.#t)),this.#n}toString(){return null==this.#r&&(this.#r=`/${this.#t.flatMap(e=>{if(null==e.value)return e.name;const t=h.u.getProtocol(e.code);if(null==t)throw new u.Ci(`Unknown protocol code ${e.code}`);return[e.name,t.valueToString?.(e.value)??e.value]}).join("/")}`),this.#r}toJSON(){return this.toString()}toOptions(){let e,t,r,n,s="";for(const{code:i,name:o,value:a}of this.#t)i===f.qc&&(s=`%${a??""}`),m.includes(i)&&(t="tcp",n=443,r=`${a??""}${s}`,e=i===f.A6?6:4),i!==f.u&&i!==f.o$||(t="tcp"===o?"tcp":"udp",n=parseInt(a??"")),i!==f.GY&&i!==f.Ik||(t="tcp",r=`${a??""}${s}`,e=i===f.Ik?6:4);if(null==e||null==t||null==r||null==n)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:n}}getComponents(){return[...this.#t]}protos(){return this.#t.map(({code:e,value:t})=>{const r=h.u.getProtocol(e);return{code:e,size:r.size??0,name:r.name,resolvable:Boolean(r.resolvable),path:Boolean(r.path)}})}protoCodes(){return this.#t.map(({code:e})=>e)}protoNames(){return this.#t.map(({name:e})=>e)}tuples(){return this.#t.map(({code:e,value:t})=>{if(null==t)return[e];const r=h.u.getProtocol(e),n=[e];return null!=t&&n.push(r.valueToBytes?.(t)??(0,a.s)(t)),n})}stringTuples(){return this.#t.map(({code:e,value:t})=>null==t?[e]:[e,t])}encapsulate(e){const t=new w(e);return new w([...this.#t,...t.getComponents()],{validate:!1})}decapsulate(e){const t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw new u.gG(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new w(r.slice(0,n),{validate:!1})}decapsulateCode(e){let t;for(let r=this.#t.length-1;r>-1;r--)if(this.#t[r].code===e){t=r;break}return new w(this.#t.slice(0,t),{validate:!1})}getPeerId(){try{let e=[];this.#t.forEach(({code:t,value:r})=>{t===f.rx&&e.push([t,r]),t===f.X5&&(e=[])});const t=e.pop();if(null!=t?.[1]){const e=t[1];return"Q"===e[0]||"1"===e[0]?(0,n.d)(s.base58btc.decode(`z${e}`),"base58btc"):(0,n.d)(i.TO.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){for(const e of this.#t)if(h.u.getProtocol(e.code).path)return e.value??null;return null}equals(e){return(0,o.a)(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(e=>e.resolvable);if(null==t)return[this];const r=b.get(t.name);if(null==r)throw new y(`no available resolver for ${t.name}`);return(await r(this,e)).map(e=>E(e))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(){return!(2!==this.#t.length||this.#t[0].code!==f.GY&&this.#t[0].code!==f.Ik||this.#t[1].code!==f.u&&this.#t[1].code!==f.o$)}[p](){return`Multiaddr(${this.toString()})`}}r(3051);const b=new Map;function v(e){return Boolean(e?.[g])}function E(e){return new w(e)}function x(e){const t=h.u.getProtocol(e);return{code:t.code,size:t.size??0,name:t.name,resolvable:Boolean(t.resolvable),path:Boolean(t.path)}}},4214:(e,t,r)=>{"use strict";r.d(t,{j:()=>n});class n extends Event{type;detail;constructor(e,t){super(e),this.type=e,this.detail=t}}},4523:(e,t,r)=>{"use strict";r.d(t,{h:()=>u});var n=r(4641),s=r(7191),i=r(6800),o=r(1252),a=r(8337),c=r(5131);class l{protocol;components;started;timeout;maxInboundStreams;maxOutboundStreams;runOnLimitedConnection;log;constructor(e,t={}){this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${t.protocolPrefix??"ipfs"}/ping/1.0.0`,this.timeout=t.timeout??1e4,this.maxInboundStreams=t.maxInboundStreams??2,this.maxOutboundStreams=t.maxOutboundStreams??1,this.runOnLimitedConnection=t.runOnLimitedConnection??!0,this.handleMessage=this.handleMessage.bind(this)}[Symbol.toStringTag]="@libp2p/ping";[s.Ch]=["@libp2p/ping"];async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);const{stream:t}=e,r=Date.now(),n=(0,o.p)(t);let s=!1;Promise.resolve().then(async()=>{for(;;){const e=AbortSignal.timeout(this.timeout);(0,a.k)(1/0,e),e.addEventListener("abort",()=>{t?.abort(new i.MU("ping timeout"))});const r=await n.read({bytes:32,signal:e});await n.write(r,{signal:e}),s=!0}}).catch(r=>{s&&"UnexpectedEOFError"===r.name&&"ready"!==t.readStatus||(this.log.error("incoming ping from %p failed with error - %e",e.connection.remotePeer,r),t?.abort(r))}).finally(()=>{const n=Date.now()-r;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,n);const s=AbortSignal.timeout(this.timeout);(0,a.k)(1/0,s),t.close({signal:s}).catch(r=>{this.log.error("error closing ping stream from %p - %e",e.connection.remotePeer,r),t?.abort(r)})})}async ping(e,t={}){this.log("pinging %p",e);const r=Date.now(),s=(0,n.A)(32),a=await this.components.connectionManager.openConnection(e,t);let l;if(null==t.signal){const e=AbortSignal.timeout(this.timeout);t={...t,signal:e}}try{l=await a.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection});const e=(0,o.p)(l),[,n]=await Promise.all([e.write(s,t),e.read({...t,bytes:32})]),u=Date.now()-r;if(!(0,c.a)(s,n.subarray()))throw new i.bd(`Received wrong ping ack after ${u}ms`);return this.log("ping %p complete in %dms",a.remotePeer,u),u}catch(e){throw this.log.error("error while pinging %p",a.remotePeer,e),l?.abort(e),e}finally{null!=l&&await l.close(t)}}}function u(e={}){return t=>new l(t,e)}},4597:(e,t,r)=>{"use strict";r.d(t,{Vw:()=>E,DO:()=>o,CC:()=>c,sd:()=>a,Fe:()=>i,Ht:()=>l,My:()=>g,uH:()=>u,Id:()=>v,qj:()=>x,O8:()=>h,aT:()=>w,aY:()=>s,po:()=>S,Ow:()=>d,ZJ:()=>b});const n="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function s(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function i(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function o(e,...t){if(!s(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function a(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.createHasher");i(e.outputLen),i(e.blockLen)}function c(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function l(e,t){o(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function u(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function h(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function d(e,t){return e<<32-t|e>>>t}const f=(()=>"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex)(),p=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function g(e){if(o(e),f)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=p[e[r]];return t}const m={_0:48,_9:57,A:65,F:70,a:97,f:102};function y(e){return e>=m._0&&e<=m._9?e-m._0:e>=m.A&&e<=m.F?e-(m.A-10):e>=m.a&&e<=m.f?e-(m.a-10):void 0}function w(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);if(f)return Uint8Array.fromHex(e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let t=0,s=0;t<r;t++,s+=2){const r=y(e.charCodeAt(s)),i=y(e.charCodeAt(s+1));if(void 0===r||void 0===i){const t=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+s)}n[t]=16*r+i}return n}function b(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}(e)),o(e),e}function v(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];o(n),t+=n.length}const r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const s=e[t];r.set(s,n),n+=s.length}return r}class E{}function x(e){const t=t=>e().update(b(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function S(e=32){if(n&&"function"==typeof n.getRandomValues)return n.getRandomValues(new Uint8Array(e));if(n&&"function"==typeof n.randomBytes)return Uint8Array.from(n.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}},4641:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var n=r(6800),s=r(4597);function i(e){if(isNaN(e)||e<=0)throw new n.gG("random bytes length must be a Number bigger than 0");return(0,s.po)(e)}},4724:(e,t,r)=>{var n=r(458);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],s=0;s<t.retries;s++)n.push(this.createTimeout(s,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(s,t)),n.sort(function(e,t){return e-t}),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var s in n=[],e)"function"==typeof e[s]&&n.push(s);for(var i=0;i<n.length;i++){var o=n[i],a=e[o];e[o]=function(n){var s=t.operation(r),i=Array.prototype.slice.call(arguments,1),o=i.pop();i.push(function(e){s.retry(e)||(e&&(arguments[0]=s.mainError()),o.apply(this,arguments))}),s.attempt(function(){n.apply(e,i)})}.bind(e,a),e[o].options=r}}},5082:(e,t,r)=>{"use strict";r.d(t,{D4:()=>y,OY:()=>f,Sb:()=>g,lF:()=>m,mD:()=>p});var n=r(6345);const s=Math.pow(2,7),i=Math.pow(2,14),o=Math.pow(2,21),a=Math.pow(2,28),c=Math.pow(2,35),l=Math.pow(2,42),u=Math.pow(2,49),h=128,d=127;function f(e){if(e<s)return 1;if(e<i)return 2;if(e<o)return 3;if(e<a)return 4;if(e<c)return 5;if(e<l)return 6;if(e<u)return 7;if(null!=Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function p(e,t,r=0){switch(f(e)){case 8:t[r++]=255&e|h,e/=128;case 7:t[r++]=255&e|h,e/=128;case 6:t[r++]=255&e|h,e/=128;case 5:t[r++]=255&e|h,e/=128;case 4:t[r++]=255&e|h,e>>>=7;case 3:t[r++]=255&e|h,e>>>=7;case 2:t[r++]=255&e|h,e>>>=7;case 1:t[r++]=255&e,e>>>=7;break;default:throw new Error("unreachable")}return t}function g(e,t){let r=e[t],n=0;if(n+=r&d,r<h)return n;if(r=e[t+1],n+=(r&d)<<7,r<h)return n;if(r=e[t+2],n+=(r&d)<<14,r<h)return n;if(r=e[t+3],n+=(r&d)<<21,r<h)return n;if(r=e[t+4],n+=(r&d)*a,r<h)return n;if(r=e[t+5],n+=(r&d)*c,r<h)return n;if(r=e[t+6],n+=(r&d)*l,r<h)return n;if(r=e[t+7],n+=(r&d)*u,r<h)return n;throw new RangeError("Could not decode varint")}function m(e,t,r=0){return null==t&&(t=(0,n.K)(f(e))),t instanceof Uint8Array?p(e,t,r):function(e,t,r=0){switch(f(e)){case 8:t.set(r++,255&e|h),e/=128;case 7:t.set(r++,255&e|h),e/=128;case 6:t.set(r++,255&e|h),e/=128;case 5:t.set(r++,255&e|h),e/=128;case 4:t.set(r++,255&e|h),e>>>=7;case 3:t.set(r++,255&e|h),e>>>=7;case 2:t.set(r++,255&e|h),e>>>=7;case 1:t.set(r++,255&e),e>>>=7;break;default:throw new Error("unreachable")}return t}(e,t,r)}function y(e,t=0){return e instanceof Uint8Array?g(e,t):function(e,t){let r=e.get(t),n=0;if(n+=r&d,r<h)return n;if(r=e.get(t+1),n+=(r&d)<<7,r<h)return n;if(r=e.get(t+2),n+=(r&d)<<14,r<h)return n;if(r=e.get(t+3),n+=(r&d)<<21,r<h)return n;if(r=e.get(t+4),n+=(r&d)*a,r<h)return n;if(r=e.get(t+5),n+=(r&d)*c,r<h)return n;if(r=e.get(t+6),n+=(r&d)*l,r<h)return n;if(r=e.get(t+7),n+=(r&d)*u,r<h)return n;throw new RangeError("Could not decode varint")}(e,t)}},5086:(e,t,r)=>{"use strict";r.d(t,{j:()=>s});var n=r(7158);class s{map;constructor(e){if(this.map=new Map,null!=e)for(const[t,r]of e.entries())this.map.set(t.toString(),{key:t,value:r})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return(0,n.r)(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,r)=>{e(t.value,t.key,this)})}get(e){return this.map.get(e.toString())?.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return(0,n.r)(this.map.values(),e=>e.key)}values(){return(0,n.r)(this.map.values(),e=>e.value)}get size(){return this.map.size}}},5129:(e,t,r)=>{"use strict";r.d(t,{d:()=>s});var n=r(5739);function s(e,t="utf8"){const r=n.A[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}},5131:(e,t,r)=>{"use strict";function n(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}r.d(t,{a:()=>n})},5291:(e,t,r)=>{"use strict";r.d(t,{Az:()=>C,jD:()=>I,Ug:()=>A,sR:()=>S,XL:()=>x});var n=r(6552),s=r(6800),i=r(1671),o=r(5494),a=r(6915),c=r(9809),l=r(142),u=r(5129),h=r(8661),d=r(5131),f=r(7442);const p=Symbol.for("nodejs.util.inspect.custom");class g{type;multihash;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[h.e]=!0;toString(){return null==this.string&&(this.string=i.base58btc.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return o.TO.createV1(114,this.multihash)}toJSON(){return this.toString()}equals(e){if(null==e)return!1;if(e instanceof Uint8Array)return(0,d.a)(this.multihash.bytes,e);if("string"==typeof e)return this.toString()===e;if(null!=e?.toMultihash()?.bytes)return(0,d.a)(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[p](){return`PeerId(${this.toString()})`}}class m extends g{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class y extends g{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.publicKey}}class w extends g{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.publicKey}}class b{type="url";multihash;publicKey;url;constructor(e){this.url=e.toString(),this.multihash=c.identity.digest((0,f.s)(this.url))}[p](){return`PeerId(${this.url})`}[h.e]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return o.TO.createV1(2336,this.toMultihash())}toJSON(){return this.toString()}equals(e){return null!=e&&(e instanceof Uint8Array&&(e=(0,u.d)(e)),e.toString()===this.toString())}}const v=114,E=2336;function x(e,t){let r;if("1"===e.charAt(0)||"Q"===e.charAt(0))r=a.decode(i.base58btc.decode(`z${e}`));else{if(e.startsWith("k51qzi5uqu5")||e.startsWith("kzwfwjn5ji4")||e.startsWith("k2k4r8")||e.startsWith("bafz"))return C(o.TO.parse(e));if(null==t)throw new s.gG('Please pass a multibase decoder for strings that do not start with "1" or "Q"');r=a.decode(t.decode(e))}return I(r)}function S(e){if("Ed25519"===e.type)return new y({multihash:e.toCID().multihash,publicKey:e});if("secp256k1"===e.type)return new w({multihash:e.toCID().multihash,publicKey:e});if("RSA"===e.type)return new m({multihash:e.toCID().multihash,publicKey:e});throw new s.$q}function A(e){return S(e.publicKey)}function I(e){if(function(e){return e.code===l.sha256.code}(e))return new m({multihash:e});if(function(e){return e.code===c.identity.code}(e))try{const t=(0,n.Sq)(e);if("Ed25519"===t.type)return new y({multihash:e,publicKey:t});if("secp256k1"===t.type)return new w({multihash:e,publicKey:t})}catch(t){const r=(0,u.d)(e.digest);return new b(new URL(r))}throw new s.$V("Supplied PeerID Multihash is invalid")}function C(e){if(null==e?.multihash||null==e.version||1===e.version&&e.code!==v&&e.code!==E)throw new s.sY("Supplied PeerID CID is invalid");if(e.code===E){const t=(0,u.d)(e.multihash.digest);return new b(new URL(t))}return I(e.multihash)}},5314:(e,t,r)=>{e.exports=r(4724)},5427:(e,t,r)=>{"use strict";r.r(t),r.d(t,{base36:()=>s,base36upper:()=>i});var n=r(5970);const s=(0,n._Q)({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),i=(0,n._Q)({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})},5494:(e,t,r)=>{"use strict";r.d(t,{TO:()=>d});var n=r(135),s=r(5427),i=r(1671),o=r(6129),a=r(6915),c=r(5509);function l(e,t){const{bytes:r,version:s}=e;return 0===s?function(e,t,r){const{prefix:n}=r;if(n!==i.base58btc.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const s=t.get(n);if(null==s){const s=r.encode(e).slice(1);return t.set(n,s),s}return s}(r,h(e),t??i.base58btc.encoder):function(e,t,r){const{prefix:n}=r,s=t.get(n);if(null==s){const s=r.encode(e);return t.set(n,s),s}return s}(r,h(e),t??n.base32.encoder)}const u=new WeakMap;function h(e){const t=u.get(e);if(null==t){const t=new Map;return u.set(e,t),t}return t}class d{code;version;multihash;bytes;"/";constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==f)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==p)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return d.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=a.create(e,t);return d.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return d.equals(this,e)}static equals(e,t){const r=t;return null!=r&&e.code===r.code&&e.version===r.version&&a.equals(e.multihash,r.multihash)}toString(e){return l(this,e)}toJSON(){return{"/":l(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof d)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:s}=t;return new d(e,r,n,s??g(e,r,n.bytes))}if(!0===t[m]){const{version:e,multihash:r,code:n}=t,s=a.decode(r);return d.create(e,n,s)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==f)throw new Error(`Version 0 CID must use dag-pb (code: ${f}) block encoding`);return new d(e,t,r,r.bytes);case 1:{const n=g(e,t,r.bytes);return new d(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return d.create(0,f,e)}static createV1(e,t){return d.create(1,e,t)}static decode(e){const[t,r]=d.decodeFirst(e);if(0!==r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=d.inspectBytes(e),r=t.size-t.multihashSize,n=(0,o.au)(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=n.subarray(t.multihashSize-t.digestSize),i=new a.Digest(t.multihashCode,t.digestSize,s,n);return[0===t.version?d.createV0(i):d.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=c.D4(e.subarray(t));return t+=n,r};let n=r(),s=f;if(18===n?(n=0,t=0):s=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,o=r(),a=r(),l=t+a;return{version:n,codec:s,multihashCode:o,digestSize:a,multihashSize:l-i,size:l}}static parse(e,t){const[r,o]=function(e,t){switch(e[0]){case"Q":{const r=t??i.base58btc;return[i.base58btc.prefix,r.decode(`${i.base58btc.prefix}${e}`)]}case i.base58btc.prefix:{const r=t??i.base58btc;return[i.base58btc.prefix,r.decode(e)]}case n.base32.prefix:{const r=t??n.base32;return[n.base32.prefix,r.decode(e)]}case s.base36.prefix:{const r=t??s.base36;return[s.base36.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}(e,t),a=d.decode(o);if(0===a.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return h(a).set(r,e),a}}const f=112,p=18;function g(e,t,r){const n=c.OY(e),s=n+c.OY(t),i=new Uint8Array(s+r.byteLength);return c.s_(e,i,0),c.s_(t,i,n),i.set(r,s),i}const m=Symbol.for("@ipld/js-cid/CID")},5509:(e,t,r)=>{"use strict";r.d(t,{D4:()=>w,s_:()=>b,OY:()=>v});var n=128,s=-128,i=Math.pow(2,31),o=128,a=127,c=Math.pow(2,7),l=Math.pow(2,14),u=Math.pow(2,21),h=Math.pow(2,28),d=Math.pow(2,35),f=Math.pow(2,42),p=Math.pow(2,49),g=Math.pow(2,56),m=Math.pow(2,63);const y={encode:function e(t,r,o){r=r||[];for(var a=o=o||0;t>=i;)r[o++]=255&t|n,t/=128;for(;t&s;)r[o++]=255&t|n,t>>>=7;return r[o]=0|t,e.bytes=o-a+1,r},decode:function e(t,r){var n,s=0,i=0,c=r=r||0,l=t.length;do{if(c>=l)throw e.bytes=0,new RangeError("Could not decode varint");n=t[c++],s+=i<28?(n&a)<<i:(n&a)*Math.pow(2,i),i+=7}while(n>=o);return e.bytes=c-r,s},encodingLength:function(e){return e<c?1:e<l?2:e<u?3:e<h?4:e<d?5:e<f?6:e<p?7:e<g?8:e<m?9:10}};function w(e,t=0){return[y.decode(e,t),y.decode.bytes]}function b(e,t,r=0){return y.encode(e,t,r),t}function v(e){return y.encodingLength(e)}},5510:(e,t,r)=>{"use strict";r.d(t,{l:()=>n}),r(5706);const n="GET"},5706:()=>{"use strict";try{self["workbox:routing:7.2.0"]&&_()}catch(e){}},5739:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(3578),s=r(6345);function i(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const o=i("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>(new TextEncoder).encode(e.substring(1))),a=i("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);const t=(0,s.K)(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),c={utf8:o,"utf-8":o,hex:n.Fo.base16,latin1:a,ascii:a,binary:a,...n.Fo}},5763:(e,t,r)=>{"use strict";r.d(t,{w7:()=>i,wM:()=>s});var n=r(8935);function s(e){return Boolean((0,n.vm)(e))}function i(e){return Boolean((0,n.JI)(e))}},5768:(e,t,r)=>{"use strict";r.d(t,{e:()=>d});var n,s=r(6552),i=r(5082),o=r(86),a=r(5131),c=r(7442),l=r(4113),u=r(6345);!function(e){let t;e.codec=()=>(null==t&&(t=(0,l.iU)((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.publicKey&&e.publicKey.byteLength>0&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.payloadType&&e.payloadType.byteLength>0&&(t.uint32(18),t.bytes(e.payloadType)),null!=e.payload&&e.payload.byteLength>0&&(t.uint32(26),t.bytes(e.payload)),null!=e.signature&&e.signature.byteLength>0&&(t.uint32(42),t.bytes(e.signature)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={publicKey:(0,u.c)(0),payloadType:(0,u.c)(0),payload:(0,u.c)(0),signature:(0,u.c)(0)},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.publicKey=e.bytes();break;case 2:n.payloadType=e.bytes();break;case 3:n.payload=e.bytes();break;case 5:n.signature=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,l.mH)(t,e.codec()),e.decode=(t,r)=>(0,l.Y8)(t,e.codec(),r)}(n||(n={}));class h extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}class d{static createFromProtobuf=e=>{const t=n.decode(e),r=(0,s.EZ)(t.publicKey);return new d({publicKey:r,payloadType:t.payloadType,payload:t.payload,signature:t.signature})};static seal=async(e,t,r)=>{if(null==t)throw new Error("Missing private key");const n=e.domain,s=e.codec,i=e.marshal(),o=f(n,s,i),a=await t.sign(o.subarray(),r);return new d({publicKey:t.publicKey,payloadType:s,payload:i,signature:a})};static openAndCertify=async(e,t,r)=>{const n=d.createFromProtobuf(e);if(!await n.validate(t,r))throw new h("Envelope signature is not valid for the given domain");return n};publicKey;payloadType;payload;signature;marshaled;constructor(e){const{publicKey:t,payloadType:r,payload:n,signature:s}=e;this.publicKey=t,this.payloadType=r,this.payload=n,this.signature=s}marshal(){return null==this.marshaled&&(this.marshaled=n.encode({publicKey:(0,s.Ve)(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return null!=e&&(0,a.a)(this.marshal(),e.marshal())}async validate(e,t){const r=f(e,this.payloadType,this.payload);return this.publicKey.verify(r.subarray(),this.signature,t)}}const f=(e,t,r)=>{const n=(0,c.s)(e),s=i.lF(n.byteLength),a=i.lF(t.length),l=i.lF(r.length);return new o.I(s,n,a,t,l,r)}},5970:(e,t,r)=>{"use strict";r.d(t,{_Q:()=>h,HT:()=>u,yE:()=>d});var n=r(6129);const s=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(255!==r[o])throw new TypeError(i+" is ambiguous");r[o]=s}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,s=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*l+1>>>0,o=new Uint8Array(i);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=i-1;(0!==u||h<s)&&-1!==d;d--,h++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");s=h,t++}if(" "!==e[t]){for(var f=i-s;f!==i&&0===o[f];)f++;for(var p=new Uint8Array(n+(i-f)),g=n;f!==i;)p[g++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,s=0,i=t.length;s!==i&&0===t[s];)s++,r++;for(var o=(i-s)*u+1>>>0,l=new Uint8Array(o);s!==i;){for(var h=t[s],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,s++}for(var p=o-n;p!==o&&0===l[p];)p++;for(var g=c.repeat(r);p<o;++p)g+=e.charAt(l[p]);return g},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}};class i{name;prefix;baseEncode;constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class o{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,r){this.name=e,this.prefix=t;const n=t.codePointAt(0);if(void 0===n)throw new Error("Invalid prefix character");this.prefixCodePoint=n,this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return c(this,e)}}class a{decoders;constructor(e){this.decoders=e}or(e){return c(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(null!=r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function c(e,t){return new a({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}class l{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new i(e,t,r),this.decoder=new o(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function u({name:e,prefix:t,encode:r,decode:n}){return new l(e,t,r,n)}function h({name:e,prefix:t,alphabet:r}){const{encode:i,decode:o}=s(r,e);return u({prefix:t,name:e,encode:i,decode:e=>(0,n.au)(o(e))})}function d({name:e,prefix:t,bitsPerChar:r,alphabet:n}){const s=function(e){const t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}(n);return u({prefix:t,name:e,encode:e=>function(e,t,r){const n="="===t[t.length-1],s=(1<<r)-1;let i="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,i+=t[s&a>>o];if(0!==o&&(i+=t[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i}(e,n,r),decode:t=>function(e,t,r,n){let s=e.length;for(;"="===e[s-1];)--s;const i=new Uint8Array(s*r/8|0);let o=0,a=0,c=0;for(let l=0;l<s;++l){const s=t[e[l]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);a=a<<r|s,o+=r,o>=8&&(o-=8,i[c++]=255&a>>o)}if(o>=r||255&a<<8-o)throw new SyntaxError("Unexpected end of data");return i}(t,s,r,e)})}},6115:(e,t,r)=>{"use strict";r.d(t,{Pc:()=>o,Sc:()=>g,Uo:()=>p,Yj:()=>c,ai:()=>l,cl:()=>u,eu:()=>a,lT:()=>h,lq:()=>d,or:()=>f});var n=r(1671),s=r(7484);const i=e=>e.toString().split("/").slice(1),o=e=>({match:t=>!(t.length<1)&&!!e(t[0])&&t.slice(1),pattern:"fn"}),a=e=>({match:t=>o(t=>t===e).match(t),pattern:e}),c=()=>({match:e=>o(e=>"string"==typeof e).match(e),pattern:"{string}"}),l=()=>({match:e=>o(e=>!isNaN(parseInt(e))).match(e),pattern:"{number}"}),u=()=>({match:e=>{if(e.length<2)return!1;if("p2p"!==e[0]&&"ipfs"!==e[0])return!1;if(!e[1].startsWith("Q")&&!e[1].startsWith("1"))return!1;try{n.base58btc.decode(`z${e[1]}`)}catch(e){return!1}return e.slice(2)},pattern:"/p2p/{peerid}"}),h=()=>({match:e=>{if(e.length<2)return!1;if("certhash"!==e[0])return!1;try{s.base64url.decode(e[1])}catch{return!1}return e.slice(2)},pattern:"/certhash/{certhash}"}),d=e=>({match:t=>{const r=e.match(t);return!1===r?t:r},pattern:`optional(${e.pattern})`}),f=(...e)=>({match:t=>{let r;for(const n of e){const e=n.match(t);!1!==e&&(null==r||e.length<r.length)&&(r=e)}return null!=r&&r},pattern:`or(${e.map(e=>e.pattern).join(", ")})`}),p=(...e)=>({match:t=>{for(const r of e){const e=r.match(t);if(!1===e)return!1;t=e}return t},pattern:`and(${e.map(e=>e.pattern).join(", ")})`});function g(...e){function t(t){let r=i(t);for(const t of e){const e=t.match(r);if(!1===e)return!1;r=e}return r}return{matchers:e,matches:function(e){return!1!==t(e)},exactMatch:function(e){const r=t(e);return!1!==r&&0===r.length}}}},6119:(e,t,r)=>{"use strict";r.d(t,{x:()=>s});var n=r(6345);function s(e,t){null==t&&(t=e.reduce((e,t)=>e+t.length,0));const r=(0,n.K)(t);let s=0;for(const t of e)r.set(t,s),s+=t.length;return r}},6129:(e,t,r)=>{"use strict";function n(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function s(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function i(e){return(new TextEncoder).encode(e)}function o(e){return(new TextDecoder).decode(e)}r.d(t,{aI:()=>n,au:()=>s,dI:()=>o,sH:()=>i}),new Uint8Array(0)},6162:e=>{e.exports=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,r=Object.create(null),n=Object.create(null);function s(s,i){r[s]=i,++t>=e&&(t=0,n=r,r=Object.create(null))}return{has:function(e){return void 0!==r[e]||void 0!==n[e]},remove:function(e){void 0!==r[e]&&(r[e]=void 0),void 0!==n[e]&&(n[e]=void 0)},get:function(e){var t=r[e];return void 0!==t?t:void 0!==(t=n[e])?(s(e,t),t):void 0},set:function(e,t){void 0!==r[e]?r[e]=t:s(e,t)},clear:function(){r=Object.create(null),n=Object.create(null)}}}},6194:(e,t,r)=>{"use strict";r.d(t,{y:()=>s});class n extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=t??"ABORT_ERR"}}async function s(e,t,r,s){const i=new n(s?.errorMessage,s?.errorCode);return!0===r?.aborted?Promise.reject(i):new Promise((n,o)=>{function a(){r?.removeEventListener("abort",u),e.removeEventListener(t,c),null!=s?.errorEvent&&e.removeEventListener(s.errorEvent,l)}const c=e=>{try{if(!1===s?.filter?.(e))return}catch(e){return a(),void o(e)}a(),n(e)},l=e=>{a(),o(e.detail)},u=()=>{a(),o(i)};r?.addEventListener("abort",u),e.addEventListener(t,c),null!=s?.errorEvent&&e.addEventListener(s.errorEvent,l)})}},6209:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});var n=r(9820);function s(e,t){const r=(0,n.V)(e,t),s={read:async(e,t)=>{const n=await r.read(t);return e.decode(n)},write:async(e,t,n)=>{await r.write(t.encode(e),n)},writeV:async(e,t,n)=>{await r.writeV(e.map(e=>t.encode(e)),n)},pb:e=>({read:async t=>s.read(e,t),write:async(t,r)=>s.write(t,e,r),writeV:async(t,r)=>s.writeV(t,e,r),unwrap:()=>s}),unwrap:()=>r.unwrap()};return s}},6267:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var n=r(1935);function s(e){return null!=e?.then}const i=function(e,t){let r=0;if(null!=e[Symbol.asyncIterator])return async function*(){for await(const n of e){const e=t(n,r++);s(e)&&await e,yield n}}();const i=(0,n.A)(e),{value:o,done:a}=i.next();if(!0===a)return function*(){}();const c=t(o,r++);if("function"==typeof c?.then)return async function*(){yield o;for(const e of i){const n=t(e,r++);s(n)&&await n,yield e}}();const l=t;return function*(){yield o;for(const e of i)l(e,r++),yield e}()}},6345:(e,t,r)=>{"use strict";function n(e=0){return new Uint8Array(e)}function s(e=0){return new Uint8Array(e)}r.d(t,{K:()=>s,c:()=>n})},6419:(e,t,r)=>{"use strict";r.d(t,{b:()=>s}),r(9248),r(9566);var n=r(7136);r(5706);class s extends n.q{constructor(e,t,r){super(({url:t})=>{const r=e.exec(t.href);if(r&&(t.origin===location.origin||0===r.index))return r.slice(1)},t,r)}}},6513:(e,t,r)=>{"use strict";r.d(t,{Ny:()=>a});var n=r(515);class s{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class i{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new s(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new s(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}class o extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function a(e={}){return function(e,t){let r,s,a,c=(t=t??{}).onEnd,l=new i,u=(0,n.A)();const h=e=>null!=s?s(e):(l.push(e),r),d=e=>{if(a)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return h({done:!1,value:e})},f=e=>a?r:(a=!0,null!=e?(e=>(l=new i,null!=s?s({error:e}):(l.push({error:e}),r)))(e):h({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return l.isEmpty()?a?{done:!0}:await new Promise((t,n)=>{s=i=>{s=null,l.push(i);try{t(e(l))}catch(e){n(e)}return r}}):e(l)}finally{l.isEmpty()&&queueMicrotask(()=>{u.resolve(),u=(0,n.A)()})}},return:()=>(l=new i,f(),{done:!0}),throw:e=>(f(e),{done:!0}),push:d,end:f,get readableLength(){return l.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),l.isEmpty())return;let r,n;null!=t&&(r=new Promise((e,r)=>{n=()=>{r(new o)},t.addEventListener("abort",n)}));try{await Promise.race([u.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==c)return r;const p=r;return r={[Symbol.asyncIterator](){return this},next:()=>p.next(),throw:e=>(p.throw(e),null!=c&&(c(e),c=void 0),{done:!0}),return:()=>(p.return(),null!=c&&(c(),c=void 0),{done:!0}),push:d,end:e=>(p.end(e),null!=c&&(c(e),c=void 0),r),get readableLength(){return p.readableLength},onEmpty:e=>p.onEmpty(e)},r}(e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}},e)}},6552:(e,t,r)=>{"use strict";r.d(t,{TZ:()=>qe,Sq:()=>Ke,EZ:()=>ze,Ve:()=>$e});var n=r(6800),s=r(86),i=r(7442),o=r(5129);const a=parseInt("11111",2),c=parseInt("10000000",2),l=parseInt("01111111",2),u={0:f,1:f,2:function(e,t){const r=d(e,t),n=t.offset,s=t.offset+r,i=[];for(let t=n;t<s;t++)t===n&&0===e[t]||i.push(e[t]);return t.offset+=r,Uint8Array.from(i)},3:function(e,t){const r=d(e,t),n=e[t.offset];t.offset++;const s=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,0!==n)throw new Error("Unused bits in bit string is unimplemented");return s},4:function(e,t){const r=d(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n},5:function(e,t){return t.offset++,null},6:function(e,t){const r=d(e,t),n=t.offset+r,s=e[t.offset];t.offset++;let i=0,o=0;s<40?(i=0,o=s):s<80?(i=1,o=s-40):(i=2,o=s-80);let a=`${i}.${o}`,c=[];for(;t.offset<n;){const r=e[t.offset];if(t.offset++,c.push(127&r),r<128){c.reverse();let e=0;for(let t=0;t<c.length;t++)e+=c[t]<<7*t;a+=`.${e}`,c=[]}}return a},16:f,22:f,48:f};function h(e,t={offset:0}){const r=e[t.offset]&a;if(t.offset++,null!=u[r])return u[r](e,t);throw new Error("No decoder for tag "+r)}function d(e,t){let r=0;if((e[t.offset]&c)===c){const n=e[t.offset]&l;let s="0x";t.offset++;for(let r=0;r<n;r++,t.offset++)s+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(s,16)}else r=e[t.offset],t.offset++;return r}function f(e,t){d(e,t);const r=[];for(;!(t.offset>=e.byteLength);){const n=h(e,t);if(null===n)break;r.push(n)}return r}function p(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);const t=function(e){let t=e.toString(16);t.length%2==1&&(t="0"+t);const r=new s.I;for(let e=0;e<t.length;e+=2)r.append(Uint8Array.from([parseInt(`${t[e]}${t[e+1]}`,16)]));return r}(e.byteLength);return new s.I(Uint8Array.from([t.byteLength|c]),t)}function g(e){const t=new s.I;return!(128&~e.subarray()[0])&&t.append(Uint8Array.from([0])),t.append(e),new s.I(Uint8Array.from([2]),p(t),t)}function m(e){const t=Uint8Array.from([0]),r=new s.I(t,e);return new s.I(Uint8Array.from([3]),p(r),r)}function y(e,t=48){const r=new s.I;for(const t of e)r.append(t);return new s.I(Uint8Array.from([t]),p(r),r)}var w=r(1671),b=r(5494),v=r(9809),E=r(5131);class x{type="ECDSA";jwk;_raw;constructor(e){this.jwk=e}get raw(){var e;return null==this._raw&&(this._raw=(e=this.jwk,y([g(Uint8Array.from([1])),y([U(e.crv)],160),y([m(new s.I(Uint8Array.from([4]),(0,i.s)(e.x??"","base64url"),(0,i.s)(e.y??"","base64url")))],161)]).subarray())),this._raw}toMultihash(){return v.identity.digest($e(this))}toCID(){return b.TO.createV1(114,this.toMultihash())}toString(){return w.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&(0,E.a)(this.raw,e.raw)}async verify(e,t,r){return async function(e,t,r,n){const s=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();const i=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},s,t,r.subarray());return n?.signal?.throwIfAborted(),i}(this.jwk,t,e,r)}}class S{type="ECDSA";jwk;publicKey;_raw;constructor(e){this.jwk=e,this.publicKey=new x({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){var e,t;return null==this._raw&&(this._raw=(e=this.jwk,y([g(Uint8Array.from([1])),(t=(0,i.s)(e.d??"","base64url"),new s.I(Uint8Array.from([4]),p(t),t)),y([U(e.crv)],160),y([m(new s.I(Uint8Array.from([4]),(0,i.s)(e.x??"","base64url"),(0,i.s)(e.y??"","base64url")))],161)]).subarray())),this._raw}equals(e){return null!=e&&e.raw instanceof Uint8Array&&(0,E.a)(this.raw,e.raw)}async sign(e,t){return async function(e,t,r){const n=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["sign"]);r?.signal?.throwIfAborted();const s=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(s,0,s.byteLength)}(this.jwk,e,t)}}const A=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),I=Uint8Array.from([6,5,43,129,4,0,34]),C=Uint8Array.from([6,5,43,129,4,0,35]),k={ext:!0,kty:"EC",crv:"P-256"},P={ext:!0,kty:"EC",crv:"P-384"},T={ext:!0,kty:"EC",crv:"P-521"},_=32,D=48,L=66;function R(e){return function(e){const t=e[1][1][0];let r,s;if(t.byteLength===2*_+1)return r=(0,o.d)(t.subarray(1,1+_),"base64url"),s=(0,o.d)(t.subarray(1+_),"base64url"),new x({...k,key_ops:["verify"],x:r,y:s});if(t.byteLength===2*D+1)return r=(0,o.d)(t.subarray(1,1+D),"base64url"),s=(0,o.d)(t.subarray(1+D),"base64url"),new x({...P,key_ops:["verify"],x:r,y:s});if(t.byteLength===2*L+1)return r=(0,o.d)(t.subarray(1,1+L),"base64url"),s=(0,o.d)(t.subarray(1+L),"base64url"),new x({...T,key_ops:["verify"],x:r,y:s});throw new n.gG(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}(h(e))}function U(e){if("P-256"===e)return A;if("P-384"===e)return I;if("P-521"===e)return C;throw new n.gG(`Invalid curve ${e}`)}function M(e){return null!=e&&"function"==typeof e.then&&"function"==typeof e.catch&&"function"==typeof e.finally}var B=r(775);class N extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}}class O extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class F extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const q={get(e=globalThis){const t=e.crypto;if(null==t?.subtle)throw new F("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}},z=32,K=64,$=32;let j;const V=(async()=>{try{return await q.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();function H(e,t){const r=new Uint8Array(K);for(let n=0;n<$;n++)r[n]=e[n],r[$+n]=t[n];return r}class G{type="Ed25519";raw;constructor(e){this.raw=Y(e,z)}toMultihash(){return v.identity.digest($e(this))}toCID(){return b.TO.createV1(114,this.toMultihash())}toString(){return w.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&(0,E.a)(this.raw,e.raw)}verify(e,t,r){r?.signal?.throwIfAborted();const n=async function(e,t,r){return null==j&&(j=await V),j?async function(e,t,r){if(e.buffer instanceof ArrayBuffer){const n=await q.get().subtle.importKey("raw",e.buffer,{name:"Ed25519"},!1,["verify"]);return await q.get().subtle.verify({name:"Ed25519"},n,t,r instanceof Uint8Array?r:r.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}(e,t,r):function(e,t,r){return B.ev.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}(e,t,r)}(this.raw,t,e);return M(n)?n.then(e=>(r?.signal?.throwIfAborted(),e)):n}}class W{type="Ed25519";raw;publicKey;constructor(e,t){this.raw=Y(e,K),this.publicKey=new G(t)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&(0,E.a)(this.raw,e.raw)}sign(e,t){t?.signal?.throwIfAborted();const r=async function(e,t){return null==j&&(j=await V),j?async function(e,t){let r;r=e.length===K?e.subarray(0,32):e;const n={crv:"Ed25519",kty:"OKP",x:(0,o.d)(e.subarray(32),"base64url"),d:(0,o.d)(r,"base64url"),ext:!0,key_ops:["sign"]},s=await q.get().subtle.importKey("jwk",n,{name:"Ed25519"},!0,["sign"]),i=await q.get().subtle.sign({name:"Ed25519"},s,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(i,0,i.byteLength)}(e,t):function(e,t){const r=e.subarray(0,$);return B.ev.sign(t instanceof Uint8Array?t:t.subarray(),r)}(e,t)}(this.raw,e);return M(r)?r.then(e=>(t?.signal?.throwIfAborted(),e)):(t?.signal?.throwIfAborted(),r)}}function Z(e){return e=Y(e,z),new G(e)}function Y(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new n.gG(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}var Q,X,J,ee,te=r(4113);!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"}(Q||(Q={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"}(X||(X={})),function(e){e.codec=()=>(0,te.eG)(X)}(Q||(Q={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,te.iU)((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),Q.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.Type=Q.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,te.mH)(t,e.codec()),e.decode=(t,r)=>(0,te.Y8)(t,e.codec(),r)}(J||(J={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,te.iU)((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),Q.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.Type=Q.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,te.mH)(t,e.codec()),e.decode=(t,r)=>(0,te.Y8)(t,e.codec(),r)}(ee||(ee={}));var re=r(2384),ne=r(6915);class se{type="RSA";jwk;_raw;_multihash;constructor(e,t){this.jwk=e,this._multihash=t}get raw(){return null==this._raw&&(this._raw=ue(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return b.TO.createV1(114,this._multihash)}toString(){return w.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&(0,E.a)(this.raw,e.raw)}verify(e,t,r){return async function(e,t,r,n){const s=await q.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();const i=await q.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},s,t,r instanceof Uint8Array?r:r.subarray());return n?.signal?.throwIfAborted(),i}(this.jwk,t,e,r)}}class ie{type="RSA";jwk;_raw;publicKey;constructor(e,t){this.jwk=e,this.publicKey=t}get raw(){return null==this._raw&&(this._raw=function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new n.gG("JWK was missing components");return y([g(Uint8Array.from([0])),g((0,i.s)(e.n,"base64url")),g((0,i.s)(e.e,"base64url")),g((0,i.s)(e.d,"base64url")),g((0,i.s)(e.p,"base64url")),g((0,i.s)(e.q,"base64url")),g((0,i.s)(e.dp,"base64url")),g((0,i.s)(e.dq,"base64url")),g((0,i.s)(e.qi,"base64url"))]).subarray()}(this.jwk)),this._raw}equals(e){return null!=e&&e.raw instanceof Uint8Array&&(0,E.a)(this.raw,e.raw)}sign(e,t){return async function(e,t,r){const n=await q.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);r?.signal?.throwIfAborted();const s=await q.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(s,0,s.byteLength)}(this.jwk,e,t)}}const oe=8192,ae=18,ce=1062,le=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function ue(e){if(null==e.n||null==e.e)throw new n.gG("JWK was missing components");return y([le,m(y([g((0,i.s)(e.n,"base64url")),g((0,i.s)(e.e,"base64url"))]))]).subarray()}function he(e,t){if(e.byteLength>=ce)throw new n.O7("Key size is too large");return function(e,t,r){const n=function(e){const t=h(e[1],{offset:0});return{kty:"RSA",n:(0,o.d)(t[0],"base64url"),e:(0,o.d)(t[1],"base64url")}}(e);if(null==r){const e=(0,re.sc)(J.encode({Type:Q.RSA,Data:t}));r=(0,ne.create)(ae,e)}return new se(n,r)}(h(e,{offset:0}),e,t)}var de=r(3550),fe=r(7884),pe=r(8289),ge=r(4597),me=r(9460),ye=r(3801);function we(e){void 0!==e.lowS&&(0,pe.e8)("lowS",e.lowS),void 0!==e.prehash&&(0,pe.e8)("prehash",e.prehash)}class be extends Error{constructor(e=""){super(e)}}const ve={Err:be,_tlv:{encode:(e,t)=>{const{Err:r}=ve;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(1&t.length)throw new r("tlv.encode: unpadded data");const n=t.length/2,s=(0,pe.zW)(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const i=n>127?(0,pe.zW)(s.length/2|128):"";return(0,pe.zW)(e)+i+s+t},decode(e,t){const{Err:r}=ve;let n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");const s=t[n++];let i=0;if(128&s){const e=127&s;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");const o=t.subarray(n,n+e);if(o.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===o[0])throw new r("tlv.decode(long): zero leftmost byte");for(const e of o)i=i<<8|e;if(n+=e,i<128)throw new r("tlv.decode(long): not minimal encoding")}else i=s;const o=t.subarray(n,n+i);if(o.length!==i)throw new r("tlv.decode: wrong value length");return{v:o,l:t.subarray(n+i)}}},_int:{encode(e){const{Err:t}=ve;if(e<Ee)throw new t("integer: negative integers are not allowed");let r=(0,pe.zW)(e);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){const{Err:t}=ve;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return(0,pe.Ph)(e)}},toSig(e){const{Err:t,_int:r,_tlv:n}=ve,s=(0,pe.qj)("signature",e),{v:i,l:o}=n.decode(48,s);if(o.length)throw new t("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:l,l:u}=n.decode(2,c);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(e){const{_tlv:t,_int:r}=ve,n=t.encode(2,r.encode(e.r))+t.encode(2,r.encode(e.s));return t.encode(48,n)}},Ee=BigInt(0),xe=BigInt(1),Se=BigInt(2),Ae=BigInt(3),Ie=BigInt(4);function Ce(e,t,r){const{BYTES:n}=e;return function(s){let i;if("bigint"==typeof s)i=s;else{let r=(0,pe.qj)("private key",s);if(t){if(!t.includes(2*r.length))throw new Error("invalid private key");const e=new Uint8Array(n);e.set(r,e.length-r.length),r=e}try{i=e.fromBytes(r)}catch(e){throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof s}`)}}if(r&&(i=e.create(i)),!e.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}}function ke(e){return Uint8Array.of(e?2:3)}function Pe(e,t,r={}){(0,pe.DS)(t,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=t.randomBytes||ge.po,s=t.hmac||((e,...r)=>(0,fe.w)(t.hash,e,(0,ge.Id)(...r))),{Fp:i,Fn:o}=e,{ORDER:a,BITS:c}=o;function l(e){return e>a>>xe}function u(e,t){if(!o.isValidNot0(t))throw new Error(`invalid signature ${e}: out of range 1..CURVE.n`)}class h{constructor(e,t,r){u("r",e),u("s",t),this.r=e,this.s=t,null!=r&&(this.recovery=r),Object.freeze(this)}static fromCompact(e){const t=o.BYTES,r=(0,pe.qj)("compactSignature",e,2*t);return new h(o.fromBytes(r.subarray(0,t)),o.fromBytes(r.subarray(t,2*t)))}static fromDER(e){const{r:t,s:r}=ve.toSig((0,pe.qj)("DER",e));return new h(t,r)}assertValidity(){}addRecoveryBit(e){return new h(this.r,this.s,e)}recoverPublicKey(t){const r=i.ORDER,{r:n,s,recovery:c}=this;if(null==c||![0,1,2,3].includes(c))throw new Error("recovery id invalid");if(a*Se<r&&c>1)throw new Error("recovery id is ambiguous for h>1 curve");const l=2===c||3===c?n+a:n;if(!i.isValid(l))throw new Error("recovery id 2 or 3 invalid");const u=i.toBytes(l),h=e.fromHex((0,ge.Id)(ke(!(1&c)),u)),d=o.inv(l),f=m((0,pe.qj)("msgHash",t)),p=o.create(-f*d),g=o.create(s*d),y=e.BASE.multiplyUnsafe(p).add(h.multiplyUnsafe(g));if(y.is0())throw new Error("point at infinify");return y.assertValidity(),y}hasHighS(){return l(this.s)}normalizeS(){return this.hasHighS()?new h(this.r,o.neg(this.s),this.recovery):this}toBytes(e){if("compact"===e)return(0,ge.Id)(o.toBytes(this.r),o.toBytes(this.s));if("der"===e)return(0,ge.aT)(ve.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return(0,ge.My)(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return(0,ge.My)(this.toBytes("compact"))}}const d=Ce(o,r.allowedPrivateKeyLengths,r.wrapPrivateKey),f={isValidPrivateKey(e){try{return d(e),!0}catch(e){return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{const e=a;return(0,ye.qy)(n((0,ye.Tp)(e)),e)},precompute:(t=8,r=e.BASE)=>r.precompute(t,!1)};function p(t){if("bigint"==typeof t)return!1;if(t instanceof e)return!0;const n=(0,pe.qj)("key",t).length,s=i.BYTES,a=s+1,c=2*s+1;return r.allowedPrivateKeyLengths||o.BYTES===a?void 0:n===a||n===c}const g=t.bits2int||function(e){if(e.length>8192)throw new Error("input is too large");const t=(0,pe.Ph)(e),r=8*e.length-c;return r>0?t>>BigInt(r):t},m=t.bits2int_modN||function(e){return o.create(g(e))},y=(0,pe.OG)(c);function w(e){return(0,pe.aK)("num < 2^"+c,e,Ee,y),o.toBytes(e)}const b={lowS:t.lowS,prehash:!1},v={lowS:t.lowS,prehash:!1};return e.BASE.precompute(8),Object.freeze({getPublicKey:function(t,r=!0){return e.fromPrivateKey(t).toBytes(r)},getSharedSecret:function(t,r,n=!0){if(!0===p(t))throw new Error("first arg must be private key");if(!1===p(r))throw new Error("second arg must be public key");return e.fromHex(r).multiply(d(t)).toBytes(n)},sign:function(r,a,c=b){const{seed:u,k2sig:f}=function(r,s,a=b){if(["recovered","canonical"].some(e=>e in a))throw new Error("sign() legacy options not supported");const{hash:c}=t;let{lowS:u,prehash:f,extraEntropy:p}=a;null==u&&(u=!0),r=(0,pe.qj)("msgHash",r),we(a),f&&(r=(0,pe.qj)("prehashed msgHash",c(r)));const y=m(r),v=d(s),E=[w(v),w(y)];if(null!=p&&!1!==p){const e=!0===p?n(i.BYTES):p;E.push((0,pe.qj)("extraEntropy",e))}const x=(0,ge.Id)(...E),S=y;return{seed:x,k2sig:function(t){const r=g(t);if(!o.isValidNot0(r))return;const n=o.inv(r),s=e.BASE.multiply(r).toAffine(),i=o.create(s.x);if(i===Ee)return;const a=o.create(n*o.create(S+i*v));if(a===Ee)return;let c=(s.x===i?0:2)|Number(s.y&xe),d=a;return u&&l(a)&&(d=function(e){return l(e)?o.neg(e):e}(a),c^=1),new h(i,d,c)}}}(r,a,c);return(0,pe.fg)(t.hash.outputLen,o.BYTES,s)(u,f)},verify:function(r,n,s,i=v){const a=r;n=(0,pe.qj)("msgHash",n),s=(0,pe.qj)("publicKey",s),we(i);const{lowS:c,prehash:l,format:u}=i;if("strict"in i)throw new Error("options.strict was renamed to lowS");if(void 0!==u&&!["compact","der","js"].includes(u))throw new Error('format must be "compact", "der" or "js"');const d="string"==typeof a||(0,ge.aY)(a),f=!d&&!u&&"object"==typeof a&&null!==a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!d&&!f)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let p,g;try{if(f){if(void 0!==u&&"js"!==u)throw new Error("invalid format");p=new h(a.r,a.s)}if(d){try{"compact"!==u&&(p=h.fromDER(a))}catch(e){if(!(e instanceof ve.Err))throw e}p||"der"===u||(p=h.fromCompact(a))}g=e.fromHex(s)}catch(e){return!1}if(!p)return!1;if(c&&p.hasHighS())return!1;l&&(n=t.hash(n));const{r:y,s:w}=p,b=m(n),E=o.inv(w),x=o.create(b*E),S=o.create(y*E),A=e.BASE.multiplyUnsafe(x).add(g.multiplyUnsafe(S));return!A.is0()&&o.create(A.x)===y},utils:f,Point:e,Signature:h})}function Te(e){const{CURVE:t,curveOpts:r,ecdsaOpts:n}=function(e){const{CURVE:t,curveOpts:r}=function(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy};return{CURVE:t,curveOpts:{Fp:e.Fp,Fn:(0,ye.D0)(t.n,e.nBitLength),allowedPrivateKeyLengths:e.allowedPrivateKeyLengths,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,wrapPrivateKey:e.wrapPrivateKey,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes}}}(e);return{CURVE:t,curveOpts:r,ecdsaOpts:{hash:e.hash,hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN}}}(e);return function(e,t){return Object.assign({},t,{ProjectivePoint:t.Point,CURVE:e})}(e,Pe(function(e,t={}){const{Fp:r,Fn:n}=(0,me.UT)("weierstrass",e,t),{h:s,n:i}=e;(0,pe.DS)(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:o}=t;if(o&&(!r.is0(e.a)||"bigint"!=typeof o.beta||"function"!=typeof o.splitScalar))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}const c=t.toBytes||function(e,t,n){const{x:s,y:i}=t.toAffine(),o=r.toBytes(s);if((0,pe.e8)("isCompressed",n),n){a();const e=!r.isOdd(i);return(0,ge.Id)(ke(e),o)}return(0,ge.Id)(Uint8Array.of(4),o,r.toBytes(i))},l=t.fromBytes||function(e){(0,ge.DO)(e);const t=r.BYTES,n=t+1,s=2*t+1,i=e.length,o=e[0],c=e.subarray(1);if(i!==n||2!==o&&3!==o){if(i===s&&4===o){const e=r.fromBytes(c.subarray(0*t,1*t)),n=r.fromBytes(c.subarray(1*t,2*t));if(!h(e,n))throw new Error("bad point: is not on curve");return{x:e,y:n}}throw new Error(`bad point: got length ${i}, expected compressed=${n} or uncompressed=${s}`)}{const e=r.fromBytes(c);if(!r.isValid(e))throw new Error("bad point: is not on curve, wrong x");const t=u(e);let n;try{n=r.sqrt(t)}catch(e){const t=e instanceof Error?": "+e.message:"";throw new Error("bad point: is not on curve, sqrt error"+t)}return a(),!(1&~o)!==r.isOdd(n)&&(n=r.neg(n)),{x:e,y:n}}},u=function(e,t,r){return function(n){const s=e.sqr(n),i=e.mul(s,n);return e.add(e.add(i,e.mul(n,t)),r)}}(r,e.a,e.b);function h(e,t){const n=r.sqr(t),s=u(e);return r.eql(n,s)}if(!h(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const d=r.mul(r.pow(e.a,Ae),Ie),f=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(d,f)))throw new Error("bad curve params: a or b");function p(e,t,n=!1){if(!r.isValid(t)||n&&r.is0(t))throw new Error(`bad point coordinate ${e}`);return t}function g(e){if(!(e instanceof b))throw new Error("ProjectivePoint expected")}const m=(0,pe.x)((e,t)=>{const{px:n,py:s,pz:i}=e;if(r.eql(i,r.ONE))return{x:n,y:s};const o=e.is0();null==t&&(t=o?r.ONE:r.inv(i));const a=r.mul(n,t),c=r.mul(s,t),l=r.mul(i,t);if(o)return{x:r.ZERO,y:r.ZERO};if(!r.eql(l,r.ONE))throw new Error("invZ was invalid");return{x:a,y:c}}),y=(0,pe.x)(e=>{if(e.is0()){if(t.allowInfinityPoint&&!r.is0(e.py))return;throw new Error("bad point: ZERO")}const{x:n,y:s}=e.toAffine();if(!r.isValid(n)||!r.isValid(s))throw new Error("bad point: x or y not field elements");if(!h(n,s))throw new Error("bad point: equation left != right");if(!e.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function w(e,t,n,s,i){return n=new b(r.mul(n.px,e),n.py,n.pz),t=(0,me.u0)(s,t),n=(0,me.u0)(i,n),t.add(n)}class b{constructor(e,t,r){this.px=p("x",e),this.py=p("y",t,!0),this.pz=p("z",r),Object.freeze(this)}static fromAffine(e){const{x:t,y:n}=e||{};if(!e||!r.isValid(t)||!r.isValid(n))throw new Error("invalid affine point");if(e instanceof b)throw new Error("projective point not allowed");return r.is0(t)&&r.is0(n)?b.ZERO:new b(t,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){return(0,me.Ak)(b,"pz",e)}static fromBytes(e){return(0,ge.DO)(e),b.fromHex(e)}static fromHex(e){const t=b.fromAffine(l((0,pe.qj)("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){const r=Ce(n,t.allowedPrivateKeyLengths,t.wrapPrivateKey);return b.BASE.multiply(r(e))}static msm(e,t){return(0,me.Xf)(b,n,e,t)}precompute(e=8,t=!0){return E.setWindowSize(this,e),t||this.multiply(Ae),this}_setWindowSize(e){this.precompute(e)}assertValidity(){y(this)}hasEvenY(){const{y:e}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(e)}equals(e){g(e);const{px:t,py:n,pz:s}=this,{px:i,py:o,pz:a}=e,c=r.eql(r.mul(t,a),r.mul(i,s)),l=r.eql(r.mul(n,a),r.mul(o,s));return c&&l}negate(){return new b(this.px,r.neg(this.py),this.pz)}double(){const{a:t,b:n}=e,s=r.mul(n,Ae),{px:i,py:o,pz:a}=this;let c=r.ZERO,l=r.ZERO,u=r.ZERO,h=r.mul(i,i),d=r.mul(o,o),f=r.mul(a,a),p=r.mul(i,o);return p=r.add(p,p),u=r.mul(i,a),u=r.add(u,u),c=r.mul(t,u),l=r.mul(s,f),l=r.add(c,l),c=r.sub(d,l),l=r.add(d,l),l=r.mul(c,l),c=r.mul(p,c),u=r.mul(s,u),f=r.mul(t,f),p=r.sub(h,f),p=r.mul(t,p),p=r.add(p,u),u=r.add(h,h),h=r.add(u,h),h=r.add(h,f),h=r.mul(h,p),l=r.add(l,h),f=r.mul(o,a),f=r.add(f,f),h=r.mul(f,p),c=r.sub(c,h),u=r.mul(f,d),u=r.add(u,u),u=r.add(u,u),new b(c,l,u)}add(t){g(t);const{px:n,py:s,pz:i}=this,{px:o,py:a,pz:c}=t;let l=r.ZERO,u=r.ZERO,h=r.ZERO;const d=e.a,f=r.mul(e.b,Ae);let p=r.mul(n,o),m=r.mul(s,a),y=r.mul(i,c),w=r.add(n,s),v=r.add(o,a);w=r.mul(w,v),v=r.add(p,m),w=r.sub(w,v),v=r.add(n,i);let E=r.add(o,c);return v=r.mul(v,E),E=r.add(p,y),v=r.sub(v,E),E=r.add(s,i),l=r.add(a,c),E=r.mul(E,l),l=r.add(m,y),E=r.sub(E,l),h=r.mul(d,v),l=r.mul(f,y),h=r.add(l,h),l=r.sub(m,h),h=r.add(m,h),u=r.mul(l,h),m=r.add(p,p),m=r.add(m,p),y=r.mul(d,y),v=r.mul(f,v),m=r.add(m,y),y=r.sub(p,y),y=r.mul(d,y),v=r.add(v,y),p=r.mul(m,v),u=r.add(u,p),p=r.mul(E,v),l=r.mul(w,l),l=r.sub(l,p),p=r.mul(w,m),h=r.mul(E,h),h=r.add(h,p),new b(l,u,h)}subtract(e){return this.add(e.negate())}is0(){return this.equals(b.ZERO)}multiply(e){const{endo:r}=t;if(!n.isValidNot0(e))throw new Error("invalid scalar: out of range");let s,i;const o=e=>E.wNAFCached(this,e,b.normalizeZ);if(r){const{k1neg:t,k1:n,k2neg:a,k2:c}=r.splitScalar(e),{p:l,f:u}=o(n),{p:h,f:d}=o(c);i=u.add(d),s=w(r.beta,l,h,t,a)}else{const{p:t,f:r}=o(e);s=t,i=r}return b.normalizeZ([s,i])[0]}multiplyUnsafe(e){const{endo:r}=t,s=this;if(!n.isValid(e))throw new Error("invalid scalar: out of range");if(e===Ee||s.is0())return b.ZERO;if(e===xe)return s;if(E.hasPrecomputes(this))return this.multiply(e);if(r){const{k1neg:t,k1:n,k2neg:i,k2:o}=r.splitScalar(e),{p1:a,p2:c}=(0,me.fH)(b,s,n,o);return w(r.beta,a,c,t,i)}return E.wNAFCachedUnsafe(s,e)}multiplyAndAddUnsafe(e,t,r){const n=this.multiplyUnsafe(t).add(e.multiplyUnsafe(r));return n.is0()?void 0:n}toAffine(e){return m(this,e)}isTorsionFree(){const{isTorsionFree:e}=t;return s===xe||(e?e(b,this):E.wNAFCachedUnsafe(this,i).is0())}clearCofactor(){const{clearCofactor:e}=t;return s===xe?this:e?e(b,this):this.multiplyUnsafe(s)}toBytes(e=!0){return(0,pe.e8)("isCompressed",e),this.assertValidity(),c(b,this,e)}toRawBytes(e=!0){return this.toBytes(e)}toHex(e=!0){return(0,ge.My)(this.toBytes(e))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}b.BASE=new b(e.Gx,e.Gy,r.ONE),b.ZERO=new b(r.ZERO,r.ONE,r.ZERO),b.Fp=r,b.Fn=n;const v=n.BITS,E=(0,me.hT)(b,t.endo?Math.ceil(v/2):v);return b}(t,r),n,r))}const _e={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},De=(BigInt(0),BigInt(1)),Le=BigInt(2),Re=(e,t)=>(e+t/Le)/t;const Ue=(0,ye.D0)(_e.p,void 0,void 0,{sqrt:function(e){const t=_e.p,r=BigInt(3),n=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=e*e*e%t,u=l*l*e%t,h=(0,ye.zH)(u,r,t)*u%t,d=(0,ye.zH)(h,r,t)*u%t,f=(0,ye.zH)(d,Le,t)*l%t,p=(0,ye.zH)(f,s,t)*f%t,g=(0,ye.zH)(p,i,t)*p%t,m=(0,ye.zH)(g,a,t)*g%t,y=(0,ye.zH)(m,c,t)*m%t,w=(0,ye.zH)(y,a,t)*g%t,b=(0,ye.zH)(w,r,t)*u%t,v=(0,ye.zH)(b,o,t)*p%t,E=(0,ye.zH)(v,n,t)*l%t,x=(0,ye.zH)(E,Le,t);if(!Ue.eql(Ue.sqr(x),e))throw new Error("Cannot find square root");return x}}),Me=function(e,t){const r=t=>Te({...e,hash:t});return{...r(t),create:r}}({..._e,Fp:Ue,lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=_e.n,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-De*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=r,o=BigInt("0x100000000000000000000000000000000"),a=Re(i*e,t),c=Re(-n*e,t);let l=(0,ye.zi)(e-a*r-c*s,t),u=(0,ye.zi)(-a*n-c*i,t);const h=l>o,d=u>o;if(h&&(l=t-l),d&&(u=t-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:l,k2neg:d,k2:u}}}},de.sc);var Be=r(142);class Ne{type="secp256k1";raw;_key;constructor(e){this._key=function(e){try{return Me.ProjectivePoint.fromHex(e),e}catch(e){throw new n.O7(String(e))}}(e),this.raw=function(e){return Me.ProjectivePoint.fromHex(e).toRawBytes(!0)}(this._key)}toMultihash(){return v.identity.digest($e(this))}toCID(){return b.TO.createV1(114,this.toMultihash())}toString(){return w.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&(0,E.a)(this.raw,e.raw)}verify(e,t,r){return function(e,t,r,n){const s=Be.sha256.digest(r instanceof Uint8Array?r:r.subarray());if(M(s))return s.then(({digest:r})=>(n?.signal?.throwIfAborted(),Me.verify(t,r,e))).catch(e=>{if("AbortError"===e.name)throw e;throw new O(String(e))});try{return n?.signal?.throwIfAborted(),Me.verify(t,s.digest,e)}catch(e){throw new O(String(e))}}(this._key,t,e,r)}}class Oe{type="secp256k1";raw;publicKey;constructor(e,t){this.raw=function(e){try{return Me.getPublicKey(e,!0),e}catch(e){throw new n.CG(String(e))}}(e),this.publicKey=new Ne(t??function(e){try{return Me.getPublicKey(e,!0)}catch(e){throw new n.CG(String(e))}}(e))}equals(e){return null!=e&&e.raw instanceof Uint8Array&&(0,E.a)(this.raw,e.raw)}sign(e,t){return function(e,t,r){const n=Be.sha256.digest(t instanceof Uint8Array?t:t.subarray());if(M(n))return n.then(({digest:t})=>(r?.signal?.throwIfAborted(),Me.sign(t,e).toDERRawBytes())).catch(e=>{if("AbortError"===e.name)throw e;throw new N(String(e))});try{return Me.sign(n.digest,e).toDERRawBytes()}catch(e){throw new N(String(e))}}(this.raw,e,t)}}function Fe(e){return new Ne(e)}async function qe(e,t){if("Ed25519"===e)return async function(){const{privateKey:e,publicKey:t}=function(){const e=B.ev.utils.randomPrivateKey(),t=B.ev.getPublicKey(e);return{privateKey:H(e,t),publicKey:t}}();return new W(e,t)}();if("secp256k1"===e)return async function(){const e=Me.utils.randomPrivateKey();return new Oe(e)}();if("RSA"===e)return async function(e){if(e>oe)throw new n.gG("Key size is too large");const t=await async function(e,t){const r=await q.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);t?.signal?.throwIfAborted();const s=await async function(e,t){if(null==e.privateKey||null==e.publicKey)throw new n.gG("Private and public key are required");const r=await Promise.all([q.get().subtle.exportKey("jwk",e.privateKey),q.get().subtle.exportKey("jwk",e.publicKey)]);return t?.signal?.throwIfAborted(),r}(r,t);return{privateKey:s[0],publicKey:s[1]}}(e),r=(0,re.sc)(J.encode({Type:Q.RSA,Data:ue(t.publicKey)})),s=(0,ne.create)(ae,r);return new ie(t.privateKey,new se(t.publicKey,s))}(function(e){return null==e?2048:parseInt(e,10)}(t));if("ECDSA"===e)return async function(e="P-256"){const t=await async function(e="P-256"){const t=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:e},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",t.publicKey),privateKey:await crypto.subtle.exportKey("jwk",t.privateKey)}}(e);return new S(t.privateKey)}(function(e){if("P-256"===e||null==e)return"P-256";if("P-384"===e)return"P-384";if("P-521"===e)return"P-521";throw new n.gG("Unsupported curve, should be P-256, P-384 or P-521")}(t));throw new n.$q}function ze(e,t){const{Type:r,Data:s}=J.decode(e),i=s??new Uint8Array;switch(r){case Q.RSA:return he(i,t);case Q.Ed25519:return Z(i);case Q.secp256k1:return Fe(i);case Q.ECDSA:return R(i);default:throw new n.$q}}function Ke(e){const{Type:t,Data:r}=J.decode(e.digest),s=r??new Uint8Array;switch(t){case Q.Ed25519:return Z(s);case Q.secp256k1:return Fe(s);case Q.ECDSA:return R(s);default:throw new n.$q}}function $e(e){return J.encode({Type:Q[e.type],Data:e.raw})}},6760:(e,t,r)=>{"use strict";r.d(t,{I:()=>o}),r(9248),r(334);var n=r(5510),s=(r(9566),r(3734)),i=r(9538);r(5706);class o{constructor(){this._routes=new Map,this._defaultHandlerMap=new Map}get routes(){return this._routes}addFetchListener(){self.addEventListener("fetch",e=>{const{request:t}=e,r=this.handleRequest({request:t,event:e});r&&e.respondWith(r)})}addCacheListener(){self.addEventListener("message",e=>{if(e.data&&"CACHE_URLS"===e.data.type){const{payload:t}=e.data,r=Promise.all(t.urlsToCache.map(t=>{"string"==typeof t&&(t=[t]);const r=new Request(...t);return this.handleRequest({request:r,event:e})}));e.waitUntil(r),e.ports&&e.ports[0]&&r.then(()=>e.ports[0].postMessage(!0))}})}handleRequest({request:e,event:t}){const r=new URL(e.url,location.href);if(!r.protocol.startsWith("http"))return;const n=r.origin===location.origin,{params:s,route:i}=this.findMatchingRoute({event:t,request:e,sameOrigin:n,url:r});let o=i&&i.handler;const a=e.method;if(!o&&this._defaultHandlerMap.has(a)&&(o=this._defaultHandlerMap.get(a)),!o)return;let c;try{c=o.handle({url:r,request:e,event:t,params:s})}catch(e){c=Promise.reject(e)}const l=i&&i.catchHandler;return c instanceof Promise&&(this._catchHandler||l)&&(c=c.catch(async n=>{if(l)try{return await l.handle({url:r,request:e,event:t,params:s})}catch(e){e instanceof Error&&(n=e)}if(this._catchHandler)return this._catchHandler.handle({url:r,request:e,event:t});throw n})),c}findMatchingRoute({url:e,sameOrigin:t,request:r,event:n}){const s=this._routes.get(r.method)||[];for(const i of s){let s;const o=i.match({url:e,sameOrigin:t,request:r,event:n});if(o)return s=o,(Array.isArray(s)&&0===s.length||o.constructor===Object&&0===Object.keys(o).length||"boolean"==typeof o)&&(s=void 0),{route:i,params:s}}return{}}setDefaultHandler(e,t=n.l){this._defaultHandlerMap.set(t,(0,s.q)(e))}setCatchHandler(e){this._catchHandler=(0,s.q)(e)}registerRoute(e){this._routes.has(e.method)||this._routes.set(e.method,[]),this._routes.get(e.method).push(e)}unregisterRoute(e){if(!this._routes.has(e.method))throw new i.R("unregister-route-but-not-found-with-method",{method:e.method});const t=this._routes.get(e.method).indexOf(e);if(!(t>-1))throw new i.R("unregister-route-route-not-registered");this._routes.get(e.method).splice(t,1)}}},6800:(e,t,r)=>{"use strict";r.d(t,{$V:()=>w,$q:()=>T,B6:()=>g,CG:()=>c,Ci:()=>m,IM:()=>b,L:()=>v,MU:()=>x,NJ:()=>P,O7:()=>a,Qx:()=>h,U7:()=>I,aS:()=>s,bd:()=>E,c6:()=>i,gG:()=>o,lY:()=>C,lc:()=>n,m_:()=>p,mw:()=>f,q7:()=>k,qB:()=>l,rb:()=>u,sY:()=>y,x$:()=>S,yp:()=>d,zm:()=>A});class n extends Error{static name="AbortError";constructor(e="The operation was aborted"){super(e),this.name="AbortError"}}class s extends Error{static name="UnexpectedPeerError";constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}}class i extends Error{static name="InvalidCryptoExchangeError";constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}}class o extends Error{static name="InvalidParametersError";constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}}class a extends Error{static name="InvalidPublicKeyError";constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}class c extends Error{static name="InvalidPrivateKeyError";constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}}Error;class l extends Error{static name="ConnectionClosingError";constructor(e="The connection is closing"){super(e),this.name="ConnectionClosingError"}}class u extends Error{static name="ConnectionClosedError";constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}Error;class h extends Error{static name="MuxerClosedError";constructor(e="The muxer is closed"){super(e),this.name="MuxerClosedError"}}class d extends Error{static name="StreamResetError";constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}}class f extends Error{static name="StreamStateError";constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}}class p extends Error{static name="NotFoundError";constructor(e="Not found"){super(e),this.name="NotFoundError"}}class g extends Error{static name="InvalidPeerIdError";constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}class m extends Error{static name="InvalidMultiaddrError";constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}}class y extends Error{static name="InvalidCIDError";constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}class w extends Error{static name="InvalidMultihashError";constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}class b extends Error{static name="UnsupportedProtocolError";constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}class v extends Error{static name="InvalidMessageError";constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}class E extends Error{static name="ProtocolError";constructor(e="Protocol error"){super(e),this.name="ProtocolError"}}class x extends Error{static name="TimeoutError";constructor(e="Timed out"){super(e),this.name="TimeoutError"}}class S extends Error{static name="NotStartedError";constructor(e="Not started"){super(e),this.name="NotStartedError"}}Error;class A extends Error{static name="DialError";constructor(e="Dial error"){super(e),this.name="DialError"}}class I extends Error{static name="ListenError";constructor(e="Listen error"){super(e),this.name="ListenError"}}class C extends Error{static name="LimitedConnectionError";constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}class k extends Error{static name="TooManyInboundProtocolStreamsError";constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}class P extends Error{static name="TooManyOutboundProtocolStreamsError";constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}class T extends Error{static name="UnsupportedKeyTypeError";constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}Error},6837:(e,t,r)=>{"use strict";r.d(t,{Up:()=>k,N6:()=>P,ok:()=>T}),r(9248),r(7944);const n={googleAnalytics:"googleAnalytics",precache:"precache-v2",prefix:"workbox",runtime:"runtime",suffix:"undefined"!=typeof registration?registration.scope:""},s=e=>[n.prefix,e,n.suffix].filter(e=>e&&e.length>0).join("-"),i={updateDetails:e=>{(e=>{for(const t of Object.keys(n))e(t)})(t=>{"string"==typeof e[t]&&(n[t]=e[t])})},getGoogleAnalyticsName:e=>e||s(n.googleAnalytics),getPrecacheName:e=>e||s(n.precache),getPrefix:()=>n.prefix,getRuntimeName:e=>e||s(n.runtime),getSuffix:()=>n.suffix};r(9566);var o=r(9538);function a(e,t){const r=t();return e.waitUntil(r),r}function c(e){if(!e)throw new o.R("add-to-cache-list-unexpected-type",{entry:e});if("string"==typeof e){const t=new URL(e,location.href);return{cacheKey:t.href,url:t.href}}const{revision:t,url:r}=e;if(!r)throw new o.R("add-to-cache-list-unexpected-type",{entry:e});if(!t){const e=new URL(r,location.href);return{cacheKey:e.href,url:e.href}}const n=new URL(r,location.href),s=new URL(r,location.href);return n.searchParams.set("__WB_REVISION__",t),{cacheKey:n.href,url:s.href}}r(3368);class l{constructor(){this.updatedURLs=[],this.notUpdatedURLs=[],this.handlerWillStart=async({request:e,state:t})=>{t&&(t.originalRequest=e)},this.cachedResponseWillBeUsed=async({event:e,state:t,cachedResponse:r})=>{if("install"===e.type&&t&&t.originalRequest&&t.originalRequest instanceof Request){const e=t.originalRequest.url;r?this.notUpdatedURLs.push(e):this.updatedURLs.push(e)}return r}}}class u{constructor({precacheController:e}){this.cacheKeyWillBeUsed=async({request:e,params:t})=>{const r=(null==t?void 0:t.cacheKey)||this._precacheController.getCacheKeyForURL(e.url);return r?new Request(r,{headers:e.headers}):e},this._precacheController=e}}let h;var d=r(334);function f(e,t){const r=new URL(e);for(const e of t)r.searchParams.delete(e);return r.href}class p{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}const g=new Set;function m(e){return"string"==typeof e?new Request(e):e}r(8980);class y{constructor(e,t){this._cacheKeys={},Object.assign(this,t),this.event=t.event,this._strategy=e,this._handlerDeferred=new p,this._extendLifetimePromises=[],this._plugins=[...e.plugins],this._pluginStateMap=new Map;for(const e of this._plugins)this._pluginStateMap.set(e,{});this.event.waitUntil(this._handlerDeferred.promise)}async fetch(e){const{event:t}=this;let r=m(e);if("navigate"===r.mode&&t instanceof FetchEvent&&t.preloadResponse){const e=await t.preloadResponse;if(e)return e}const n=this.hasCallback("fetchDidFail")?r.clone():null;try{for(const e of this.iterateCallbacks("requestWillFetch"))r=await e({request:r.clone(),event:t})}catch(e){if(e instanceof Error)throw new o.R("plugin-error-request-will-fetch",{thrownErrorMessage:e.message})}const s=r.clone();try{let e;e=await fetch(r,"navigate"===r.mode?void 0:this._strategy.fetchOptions);for(const r of this.iterateCallbacks("fetchDidSucceed"))e=await r({event:t,request:s,response:e});return e}catch(e){throw n&&await this.runCallbacks("fetchDidFail",{error:e,event:t,originalRequest:n.clone(),request:s.clone()}),e}}async fetchAndCachePut(e){const t=await this.fetch(e),r=t.clone();return this.waitUntil(this.cachePut(e,r)),t}async cacheMatch(e){const t=m(e);let r;const{cacheName:n,matchOptions:s}=this._strategy,i=await this.getCacheKey(t,"read"),o=Object.assign(Object.assign({},s),{cacheName:n});r=await caches.match(i,o);for(const e of this.iterateCallbacks("cachedResponseWillBeUsed"))r=await e({cacheName:n,matchOptions:s,cachedResponse:r,request:i,event:this.event})||void 0;return r}async cachePut(e,t){const r=m(e);await new Promise(e=>setTimeout(e,0));const n=await this.getCacheKey(r,"write");if(!t)throw new o.R("cache-put-with-no-response",{url:(0,d.R)(n.url)});const s=await this._ensureResponseSafeToCache(t);if(!s)return!1;const{cacheName:i,matchOptions:a}=this._strategy,c=await self.caches.open(i),l=this.hasCallback("cacheDidUpdate"),u=l?await async function(e,t,r,n){const s=f(t.url,r);if(t.url===s)return e.match(t,n);const i=Object.assign(Object.assign({},n),{ignoreSearch:!0}),o=await e.keys(t,i);for(const t of o)if(s===f(t.url,r))return e.match(t,n)}(c,n.clone(),["__WB_REVISION__"],a):null;try{await c.put(n,l?s.clone():s)}catch(e){if(e instanceof Error)throw"QuotaExceededError"===e.name&&await async function(){for(const e of g)await e()}(),e}for(const e of this.iterateCallbacks("cacheDidUpdate"))await e({cacheName:i,oldResponse:u,newResponse:s.clone(),request:n,event:this.event});return!0}async getCacheKey(e,t){const r=`${e.url} | ${t}`;if(!this._cacheKeys[r]){let n=e;for(const e of this.iterateCallbacks("cacheKeyWillBeUsed"))n=m(await e({mode:t,request:n,event:this.event,params:this.params}));this._cacheKeys[r]=n}return this._cacheKeys[r]}hasCallback(e){for(const t of this._strategy.plugins)if(e in t)return!0;return!1}async runCallbacks(e,t){for(const r of this.iterateCallbacks(e))await r(t)}*iterateCallbacks(e){for(const t of this._strategy.plugins)if("function"==typeof t[e]){const r=this._pluginStateMap.get(t),n=n=>{const s=Object.assign(Object.assign({},n),{state:r});return t[e](s)};yield n}}waitUntil(e){return this._extendLifetimePromises.push(e),e}async doneWaiting(){let e;for(;e=this._extendLifetimePromises.shift();)await e}destroy(){this._handlerDeferred.resolve(null)}async _ensureResponseSafeToCache(e){let t=e,r=!1;for(const e of this.iterateCallbacks("cacheWillUpdate"))if(t=await e({request:this.request,response:t,event:this.event})||void 0,r=!0,!t)break;return r||t&&200!==t.status&&(t=void 0),t}}class w{constructor(e={}){this.cacheName=i.getRuntimeName(e.cacheName),this.plugins=e.plugins||[],this.fetchOptions=e.fetchOptions,this.matchOptions=e.matchOptions}handle(e){const[t]=this.handleAll(e);return t}handleAll(e){e instanceof FetchEvent&&(e={event:e,request:e.request});const t=e.event,r="string"==typeof e.request?new Request(e.request):e.request,n="params"in e?e.params:void 0,s=new y(this,{event:t,request:r,params:n}),i=this._getResponse(s,r,t);return[i,this._awaitComplete(i,s,r,t)]}async _getResponse(e,t,r){let n;await e.runCallbacks("handlerWillStart",{event:r,request:t});try{if(n=await this._handle(t,e),!n||"error"===n.type)throw new o.R("no-response",{url:t.url})}catch(s){if(s instanceof Error)for(const i of e.iterateCallbacks("handlerDidError"))if(n=await i({error:s,event:r,request:t}),n)break;if(!n)throw s}for(const s of e.iterateCallbacks("handlerWillRespond"))n=await s({event:r,request:t,response:n});return n}async _awaitComplete(e,t,r,n){let s,i;try{s=await e}catch(i){}try{await t.runCallbacks("handlerDidRespond",{event:n,request:r,response:s}),await t.doneWaiting()}catch(e){e instanceof Error&&(i=e)}if(await t.runCallbacks("handlerDidComplete",{event:n,request:r,response:s,error:i}),t.destroy(),i)throw i}}class b extends w{constructor(e={}){e.cacheName=i.getPrecacheName(e.cacheName),super(e),this._fallbackToNetwork=!1!==e.fallbackToNetwork,this.plugins.push(b.copyRedirectedCacheableResponsesPlugin)}async _handle(e,t){return await t.cacheMatch(e)||(t.event&&"install"===t.event.type?await this._handleInstall(e,t):await this._handleFetch(e,t))}async _handleFetch(e,t){let r;const n=t.params||{};if(!this._fallbackToNetwork)throw new o.R("missing-precache-entry",{cacheName:this.cacheName,url:e.url});{const s=n.integrity,i=e.integrity,o=!i||i===s;r=await t.fetch(new Request(e,{integrity:"no-cors"!==e.mode?i||s:void 0})),s&&o&&"no-cors"!==e.mode&&(this._useDefaultCacheabilityPluginIfNeeded(),await t.cachePut(e,r.clone()))}return r}async _handleInstall(e,t){this._useDefaultCacheabilityPluginIfNeeded();const r=await t.fetch(e);if(!await t.cachePut(e,r.clone()))throw new o.R("bad-precaching-response",{url:e.url,status:r.status});return r}_useDefaultCacheabilityPluginIfNeeded(){let e=null,t=0;for(const[r,n]of this.plugins.entries())n!==b.copyRedirectedCacheableResponsesPlugin&&(n===b.defaultPrecacheCacheabilityPlugin&&(e=r),n.cacheWillUpdate&&t++);0===t?this.plugins.push(b.defaultPrecacheCacheabilityPlugin):t>1&&null!==e&&this.plugins.splice(e,1)}}b.defaultPrecacheCacheabilityPlugin={cacheWillUpdate:async({response:e})=>!e||e.status>=400?null:e},b.copyRedirectedCacheableResponsesPlugin={cacheWillUpdate:async({response:e})=>e.redirected?await async function(e,t){let r=null;if(e.url&&(r=new URL(e.url).origin),r!==self.location.origin)throw new o.R("cross-origin-copy-response",{origin:r});const n=e.clone(),s={headers:new Headers(n.headers),status:n.status,statusText:n.statusText},i=t?t(s):s,a=function(){if(void 0===h){const e=new Response("");if("body"in e)try{new Response(e.body),h=!0}catch(e){h=!1}h=!1}return h}()?n.body:await n.blob();return new Response(a,i)}(e):e};class v{constructor({cacheName:e,plugins:t=[],fallbackToNetwork:r=!0}={}){this._urlsToCacheKeys=new Map,this._urlsToCacheModes=new Map,this._cacheKeysToIntegrities=new Map,this._strategy=new b({cacheName:i.getPrecacheName(e),plugins:[...t,new u({precacheController:this})],fallbackToNetwork:r}),this.install=this.install.bind(this),this.activate=this.activate.bind(this)}get strategy(){return this._strategy}precache(e){this.addToCacheList(e),this._installAndActiveListenersAdded||(self.addEventListener("install",this.install),self.addEventListener("activate",this.activate),this._installAndActiveListenersAdded=!0)}addToCacheList(e){const t=[];for(const r of e){"string"==typeof r?t.push(r):r&&void 0===r.revision&&t.push(r.url);const{cacheKey:e,url:n}=c(r),s="string"!=typeof r&&r.revision?"reload":"default";if(this._urlsToCacheKeys.has(n)&&this._urlsToCacheKeys.get(n)!==e)throw new o.R("add-to-cache-list-conflicting-entries",{firstEntry:this._urlsToCacheKeys.get(n),secondEntry:e});if("string"!=typeof r&&r.integrity){if(this._cacheKeysToIntegrities.has(e)&&this._cacheKeysToIntegrities.get(e)!==r.integrity)throw new o.R("add-to-cache-list-conflicting-integrities",{url:n});this._cacheKeysToIntegrities.set(e,r.integrity)}if(this._urlsToCacheKeys.set(n,e),this._urlsToCacheModes.set(n,s),t.length>0){const e=`Workbox is precaching URLs without revision info: ${t.join(", ")}\nThis is generally NOT safe. Learn more at https://bit.ly/wb-precache`;console.warn(e)}}}install(e){return a(e,async()=>{const t=new l;this.strategy.plugins.push(t);for(const[t,r]of this._urlsToCacheKeys){const n=this._cacheKeysToIntegrities.get(r),s=this._urlsToCacheModes.get(t),i=new Request(t,{integrity:n,cache:s,credentials:"same-origin"});await Promise.all(this.strategy.handleAll({params:{cacheKey:r},request:i,event:e}))}const{updatedURLs:r,notUpdatedURLs:n}=t;return{updatedURLs:r,notUpdatedURLs:n}})}activate(e){return a(e,async()=>{const e=await self.caches.open(this.strategy.cacheName),t=await e.keys(),r=new Set(this._urlsToCacheKeys.values()),n=[];for(const s of t)r.has(s.url)||(await e.delete(s),n.push(s.url));return{deletedURLs:n}})}getURLsToCacheKeys(){return this._urlsToCacheKeys}getCachedURLs(){return[...this._urlsToCacheKeys.keys()]}getCacheKeyForURL(e){const t=new URL(e,location.href);return this._urlsToCacheKeys.get(t.href)}getIntegrityForCacheKey(e){return this._cacheKeysToIntegrities.get(e)}async matchPrecache(e){const t=e instanceof Request?e.url:e,r=this.getCacheKeyForURL(t);if(r)return(await self.caches.open(this.strategy.cacheName)).match(r)}createHandlerBoundToURL(e){const t=this.getCacheKeyForURL(e);if(!t)throw new o.R("non-precached-url",{url:e});return r=>(r.request=new Request(e),r.params=Object.assign({cacheKey:t},r.params),this.strategy.handle(r))}}let E;const x=()=>(E||(E=new v),E);var S=r(2095),A=r(7136);class I extends A.q{constructor(e,t){super(({request:r})=>{const n=e.getURLsToCacheKeys();for(const s of function*(e,{ignoreURLParametersMatching:t=[/^utm_/,/^fbclid$/],directoryIndex:r="index.html",cleanURLs:n=!0,urlManipulation:s}={}){const i=new URL(e,location.href);i.hash="",yield i.href;const o=function(e,t=[]){for(const r of[...e.searchParams.keys()])t.some(e=>e.test(r))&&e.searchParams.delete(r);return e}(i,t);if(yield o.href,r&&o.pathname.endsWith("/")){const e=new URL(o.href);e.pathname+=r,yield e.href}if(n){const e=new URL(o.href);e.pathname+=".html",yield e.href}if(s){const e=s({url:i});for(const t of e)yield t.href}}(r.url,t)){const t=n.get(s);if(t)return{cacheKey:t,integrity:e.getIntegrityForCacheKey(t)}}},e.strategy)}}const C=async(e,t="-precache-")=>{const r=(await self.caches.keys()).filter(r=>r.includes(t)&&r.includes(self.registration.scope)&&r!==e);return await Promise.all(r.map(e=>self.caches.delete(e))),r};function k(){self.addEventListener("activate",e=>{const t=i.getPrecacheName();e.waitUntil(C(t).then(e=>{}))})}function P(e){return x().createHandlerBoundToURL(e)}function T(e,t){!function(e){x().precache(e)}(e),function(e){const t=x(),r=new I(t,e);(0,S.R)(r)}(t)}},6915:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Digest:()=>c,create:()=>i,decode:()=>o,equals:()=>a,hasCode:()=>l});var n=r(6129),s=r(5509);function i(e,t){const r=t.byteLength,n=s.OY(e),i=n+s.OY(r),o=new Uint8Array(i+r);return s.s_(e,o,0),s.s_(r,o,n),o.set(t,i),new c(e,r,t,o)}function o(e){const t=(0,n.au)(e),[r,i]=s.D4(t),[o,a]=s.D4(t.subarray(i)),l=t.subarray(i+a);if(l.byteLength!==o)throw new Error("Incorrect length");return new c(r,o,l,t)}function a(e,t){if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&(0,n.aI)(e.bytes,r.bytes)}}class c{code;size;digest;bytes;constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}function l(e,t){return e.code===t}},7090:(e,t,r)=>{"use strict";r.d(t,{O:()=>n,Z:()=>s});class n extends Error{remainingPoints;msBeforeNext;consumedPoints;isFirstInDuration;constructor(e="Rate limit exceeded",t){super(e),this.name="RateLimitError",this.remainingPoints=t.remainingPoints,this.msBeforeNext=t.msBeforeNext,this.consumedPoints=t.consumedPoints,this.isFirstInDuration=t.isFirstInDuration}}class s extends Error{static name="QueueFullError";constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}},7136:(e,t,r)=>{"use strict";r.d(t,{q:()=>i}),r(9248);var n=r(5510),s=r(3734);r(5706);class i{constructor(e,t,r=n.l){this.handler=(0,s.q)(t),this.match=e,this.method=r}setCatchHandler(e){this.catchHandler=(0,s.q)(e)}}},7158:(e,t,r)=>{"use strict";r.d(t,{X:()=>a,r:()=>o});var n=r(5291),s=r(1671),i=r(6915);function o(e,t){const r={[Symbol.iterator]:()=>r,next:()=>{const r=e.next(),n=r.value;return!0===r.done||null==n?{done:!0,value:void 0}:{done:!1,value:t(n)}}};return r}function a(e){const t=i.decode(s.base58btc.decode(`z${e}`));return(0,n.jD)(t)}},7191:(e,t,r)=>{"use strict";r.d(t,{Ch:()=>n,VM:()=>s});const n=Symbol.for("@libp2p/service-capabilities"),s=Symbol.for("@libp2p/service-dependencies")},7418:(e,t,r)=>{"use strict";function n(e,t){let r;const n=function(){clearTimeout(r),r=setTimeout(function(){r=void 0,e()},t)};return n.start=()=>{},n.stop=()=>{clearTimeout(r)},n}r.d(t,{s:()=>n})},7442:(e,t,r)=>{"use strict";r.d(t,{s:()=>s});var n=r(5739);function s(e,t="utf8"){const r=n.A[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}},7484:(e,t,r)=>{"use strict";r.r(t),r.d(t,{base64:()=>s,base64pad:()=>i,base64url:()=>o,base64urlpad:()=>a});var n=r(5970);const s=(0,n.yE)({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),i=(0,n.yE)({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),o=(0,n.yE)({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),a=(0,n.yE)({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})},7638:(e,t,r)=>{"use strict";r.d(t,{E:()=>On});var n=r(6552),s=r(5291),i=r(2090),o=r(6800);function a(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)}const{hasOwnProperty:c}=Object.prototype,{propertyIsEnumerable:l}=Object,u=(e,t,r)=>{Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})},h=void 0,d={concatArrays:!1,ignoreUndefined:!1},f=e=>{const t=[];for(const r in e)c.call(e,r)&&t.push(r);if(Object.getOwnPropertySymbols){const r=Object.getOwnPropertySymbols(e);for(const n of r)l.call(e,n)&&t.push(n)}return t};function p(e){return Array.isArray(e)?function(e){const t=e.slice(0,0);return f(e).forEach(r=>{u(t,r,p(e[r]))}),t}(e):a(e)?function(e){const t=null===Object.getPrototypeOf(e)?Object.create(null):{};return f(e).forEach(r=>{u(t,r,p(e[r]))}),t}(e):e}const g=(e,t,r,n)=>(r.forEach(r=>{void 0===t[r]&&n.ignoreUndefined||(r in e&&e[r]!==Object.getPrototypeOf(e)?u(e,r,y(e[r],t[r],n)):u(e,r,p(t[r])))}),e),m=(e,t,r)=>{let n=e.slice(0,0),s=0;return[e,t].forEach(t=>{const i=[];for(let r=0;r<t.length;r++)c.call(t,r)&&(i.push(String(r)),u(n,s++,t===e?t[r]:p(t[r])));n=g(n,t,f(t).filter(e=>!i.includes(e)),r)}),n};function y(e,t,r){return r.concatArrays&&Array.isArray(e)&&Array.isArray(t)?m(e,t,r):a(t)&&a(e)?g(e,t,f(t),r):p(t)}function w(...e){const t=y(p(d),this!==h&&this||{},d);let r={_:{}};for(const n of e)if(void 0!==n){if(!a(n))throw new TypeError("`"+n+"` is not an Option Object");r=y(r,{_:n},t)}return r._}var b=r(4214),v=r(1343);class E extends Error{constructor(e){super(e),this.name="TimeoutError"}}class x extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const S=e=>void 0===globalThis.DOMException?new x(e):new DOMException(e),A=e=>{const t=void 0===e.reason?S("This operation was aborted."):e.reason;return t instanceof Error?t:S(t)};class I{#s=[];enqueue(e,t){const r={priority:(t={priority:0,...t}).priority,id:t.id,run:e};if(0===this.size||this.#s[this.size-1].priority>=t.priority)return void this.#s.push(r);const n=function(e,t,r){let n=0,s=e.length;for(;s>0;){const i=Math.trunc(s/2);let o=n+i;r(e[o],t)<=0?(n=++o,s-=i+1):s=i}return n}(this.#s,r,(e,t)=>t.priority-e.priority);this.#s.splice(n,0,r)}setPriority(e,t){const r=this.#s.findIndex(t=>t.id===e);if(-1===r)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[n]=this.#s.splice(r,1);this.enqueue(n.run,{priority:t,id:e})}dequeue(){const e=this.#s.shift();return e?.run}filter(e){return this.#s.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this.#s.length}}class C extends v{#i;#o;#a=0;#c;#l;#u=0;#h;#d;#s;#f;#p=0;#g;#m;#y;#w=1n;timeout;constructor(e){if(super(),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:I,...e}).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);this.#i=e.carryoverConcurrencyCount,this.#o=e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,this.#c=e.intervalCap,this.#l=e.interval,this.#s=new e.queueClass,this.#f=e.queueClass,this.concurrency=e.concurrency,this.timeout=e.timeout,this.#y=!0===e.throwOnTimeout,this.#m=!1===e.autoStart}get#b(){return this.#o||this.#a<this.#c}get#v(){return this.#p<this.#g}#E(){this.#p--,this.#x(),this.emit("next")}#S(){this.#A(),this.#I(),this.#d=void 0}get#C(){const e=Date.now();if(void 0===this.#h){const t=this.#u-e;if(!(t<0))return void 0===this.#d&&(this.#d=setTimeout(()=>{this.#S()},t)),!0;this.#a=this.#i?this.#p:0}return!1}#x(){if(0===this.#s.size)return this.#h&&clearInterval(this.#h),this.#h=void 0,this.emit("empty"),0===this.#p&&this.emit("idle"),!1;if(!this.#m){const e=!this.#C;if(this.#b&&this.#v){const t=this.#s.dequeue();return!!t&&(this.emit("active"),t(),e&&this.#I(),!0)}}return!1}#I(){this.#o||void 0!==this.#h||(this.#h=setInterval(()=>{this.#A()},this.#l),this.#u=Date.now()+this.#l)}#A(){0===this.#a&&0===this.#p&&this.#h&&(clearInterval(this.#h),this.#h=void 0),this.#a=this.#i?this.#p:0,this.#k()}#k(){for(;this.#x(););}get concurrency(){return this.#g}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#g=e,this.#k()}async#P(e){return new Promise((t,r)=>{e.addEventListener("abort",()=>{r(e.reason)},{once:!0})})}setPriority(e,t){this.#s.setPriority(e,t)}async add(e,t={}){return t.id??=(this.#w++).toString(),t={timeout:this.timeout,throwOnTimeout:this.#y,...t},new Promise((r,n)=>{this.#s.enqueue(async()=>{this.#p++,this.#a++;try{t.signal?.throwIfAborted();let n=e({signal:t.signal});t.timeout&&(n=function(e,t){const{milliseconds:r,fallback:n,message:s,customTimers:i={setTimeout,clearTimeout}}=t;let o,a;const c=new Promise((c,l)=>{if("number"!=typeof r||1!==Math.sign(r))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``);if(t.signal){const{signal:e}=t;e.aborted&&l(A(e)),a=()=>{l(A(e))},e.addEventListener("abort",a,{once:!0})}if(r===Number.POSITIVE_INFINITY)return void e.then(c,l);const u=new E;o=i.setTimeout.call(void 0,()=>{if(n)try{c(n())}catch(e){l(e)}else"function"==typeof e.cancel&&e.cancel(),!1===s?c():s instanceof Error?l(s):(u.message=s??`Promise timed out after ${r} milliseconds`,l(u))},r),(async()=>{try{c(await e)}catch(e){l(e)}})()}).finally(()=>{c.clear(),a&&t.signal&&t.signal.removeEventListener("abort",a)});return c.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},c}(Promise.resolve(n),{milliseconds:t.timeout})),t.signal&&(n=Promise.race([n,this.#P(t.signal)]));const s=await n;r(s),this.emit("completed",s)}catch(e){if(e instanceof E&&!t.throwOnTimeout)return void r();n(e),this.emit("error",e)}finally{this.#E()}},t),this.emit("add"),this.#x()})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this.#m?(this.#m=!1,this.#k(),this):this}pause(){this.#m=!0}clear(){this.#s=new this.#f}async onEmpty(){0!==this.#s.size&&await this.#T("empty")}async onSizeLessThan(e){this.#s.size<e||await this.#T("next",()=>this.#s.size<e)}async onIdle(){0===this.#p&&0===this.#s.size||await this.#T("idle")}async#T(e,t){return new Promise(r=>{const n=()=>{t&&!t()||(this.off(e,n),r())};this.on(e,n)})}get size(){return this.#s.size}sizeBy(e){return this.#s.filter(e).length}get pending(){return this.#p}get isPaused(){return this.#m}}function k(e){const t=[D.A];return null==e?t:Array.isArray(e)?0===e.length?t:e:[e]}var P=r(5129);function T(e){return{Status:e.Status??0,TC:e.TC??e.flag_tc??!1,RD:e.RD??e.flag_rd??!1,RA:e.RA??e.flag_ra??!1,AD:e.AD??e.flag_ad??!1,CD:e.CD??e.flag_cd??!1,Question:(e.Question??e.questions??[]).map(e=>({name:e.name,type:D[e.type]})),Answer:(e.Answer??e.answers??[]).map(e=>({name:e.name,type:D[e.type],TTL:e.TTL??e.ttl??60,data:e.data instanceof Uint8Array?(0,P.d)(e.data):e.data}))}}function _(e,t={}){const r=new C({concurrency:t.queryConcurrency??4});return async(t,n={})=>{const s=new URLSearchParams;s.set("name",t),k(n.types).forEach(e=>{s.append("type",D[e])}),n.onProgress?.(new b.j("dns:query",{detail:t}));const i=await r.add(async()=>{const t=await fetch(`${e}?${s}`,{headers:{accept:"application/dns-json"},signal:n?.signal});if(200!==t.status)throw new Error(`Unexpected HTTP status: ${t.status} - ${t.statusText}`);const r=T(await t.json());return n.onProgress?.(new b.j("dns:response",{detail:r})),r},{signal:n.signal});if(null==i)throw new Error("No DNS response received");return i}}var D,L=r(6162);class R{lru;constructor(e){this.lru=L(e)}get(e,t){let r=!0;const n=[];for(const s of t){const t=this.getAnswers(e,s);if(0===t.length){r=!1;break}n.push(...t)}if(r)return T({answers:n})}getAnswers(e,t){const r=`${e.toLowerCase()}-${t}`,n=this.lru.get(r);if(null!=n){const e=n.filter(e=>e.expires>Date.now()).map(({expires:e,value:t})=>({...t,TTL:Math.round((e-Date.now())/1e3),type:D[t.type]}));return 0===e.length&&this.lru.remove(r),e}return[]}add(e,t){const r=`${e.toLowerCase()}-${t.type}`,n=this.lru.get(r)??[];n.push({expires:Date.now()+1e3*(t.TTL??60),value:t}),this.lru.set(r,n)}remove(e,t){const r=`${e.toLowerCase()}-${t}`;this.lru.remove(r)}clear(){this.lru.clear()}}class U{resolvers;cache;constructor(e){var t;this.resolvers={},this.cache=(t=e.cacheSize??1e3,new R(t)),Object.entries(e.resolvers??{}).forEach(([e,t])=>{Array.isArray(t)||(t=[t]),e.endsWith(".")||(e=`${e}.`),this.resolvers[e]=t}),null==this.resolvers["."]&&(this.resolvers["."]=[_("https://cloudflare-dns.com/dns-query"),_("https://dns.google/resolve")])}async query(e,t={}){const r=k(t.types),n=!1!==t.cached?this.cache.get(e,r):void 0;if(null!=n)return t.onProgress?.(new b.j("dns:cache",{detail:n})),n;const s=`${e.split(".").pop()}.`,i=(this.resolvers[s]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),o=[];for(const n of i){if(!0===t.signal?.aborted)break;try{const s=await n(e,{...t,types:r});for(const t of s.Answer)this.cache.add(e,t);return s}catch(e){o.push(e),t.onProgress?.(new b.j("dns:error",{detail:e}))}}if(1===o.length)throw o[0];throw new AggregateError(o,`DNS lookup of ${e} ${r} failed`)}}!function(e){e[e.A=1]="A",e[e.CNAME=5]="CNAME",e[e.TXT=16]="TXT",e[e.AAAA=28]="AAAA"}(D||(D={}));var M=r(4135);const B=-1,N={},O={};[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,B,"ip6zone"],[43,8,"ipcidr"],[53,B,"dns",!0],[54,B,"dns4",!0],[55,B,"dns6",!0],[56,B,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,B,"unix",!1,!0],[421,B,"ipfs"],[421,B,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,B,"garlic64"],[448,0,"tls"],[449,B,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,B,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,B,"http-path"],[777,B,"memory"]].forEach(e=>{const t=function(e,t,r,n,s){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(s)}}(...e);O[t.code]=t,N[t.name]=t});const{code:F}=function(e){if(null!=N[e])return N[e];throw new Error(`no protocol with name: ${e}`)}("dnsaddr");class q extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}const z=async function(e,t={}){const r=t.maxRecursiveDepth??32;if(0===r)throw new q("Max recursive depth reached");const[,n]=e.stringTuples().find(([e])=>e===F)??[],s=t?.dns??function(e={}){return new U(e)}(),i=await s.query(`_dnsaddr.${n}`,{signal:t?.signal,types:[D.TXT]}),o=e.getPeerId(),a=[];for(const e of i.Answer){const n=e.data.replace(/["']/g,"").trim().split("=")[1];if(null==n)continue;if(null!=o&&!n.includes(o))continue;const s=(0,M.HZ)(n);if(n.startsWith("/dnsaddr")){const e=await s.resolve({...t,maxRecursiveDepth:r-1});a.push(...e.map(e=>e.toString()))}else a.push(s.toString())}return a},K={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:e=>e},connectionManager:{resolvers:{dnsaddr:z}},transportManager:{faultTolerance:i.aF.FATAL_ALL}};async function $(e){const t=w(K,e);if(null===t.connectionProtector&&null!=globalThis.process?.env?.LIBP2P_FORCE_PNET)throw new o.gG("Private network is enforced, but no protector was provided");return t}const j=Symbol.for("@libp2p/content-routing"),V=Symbol.for("@libp2p/peer-routing"),H=Symbol.for("@libp2p/peer-discovery");var G=r(135),W=r(1671),Z=r(7484);const Y=1e3,Q=60*Y,X=60*Q,J=24*X,ee=7*J,te=function(e,t){try{if("string"==typeof e&&e.length>0)return function(e){if((e=String(e)).length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return NaN;const r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return r*ee;case"days":case"day":case"d":return r*J;case"hours":case"hour":case"hrs":case"hr":case"h":return r*X;case"minutes":case"minute":case"mins":case"min":case"m":return r*Q;case"seconds":case"second":case"secs":case"sec":case"s":return r*Y;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:throw new Error(`The unit ${n} was matched, but no matching case exists.`)}}(e);if("number"==typeof e&&isFinite(e))return t?.long?function(e){const t=Math.abs(e);return t>=J?re(e,t,J,"day"):t>=X?re(e,t,X,"hour"):t>=Q?re(e,t,Q,"minute"):t>=Y?re(e,t,Y,"second"):`${e} ms`}(e):function(e){const t=Math.abs(e);return t>=J?`${Math.round(e/J)}d`:t>=X?`${Math.round(e/X)}h`:t>=Q?`${Math.round(e/Q)}m`:t>=Y?`${Math.round(e/Y)}s`:`${e}ms`}(e);throw new Error("Value is not a string or number.")}catch(t){const r=function(e){return"object"==typeof e&&null!==e&&"message"in e}(t)?`${t.message}. value=${JSON.stringify(e)}`:"An unknown error has occured.";throw new Error(r)}};function re(e,t,r,n){const s=t>=1.5*r;return`${Math.round(e/r)} ${n}${s?"s":""}`}const ne=function(){try{return localStorage}catch(e){}}(),se=console.debug??console.log??(()=>{}),ie=function(e){function t(e){let n,s,i,o=null;function a(...e){if(!a.enabled)return;const r=a,s=Number(new Date),i=s-(n||s);r.diff=i,r.prev=n,r.curr=s,n=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(n,s)=>{if("%%"===n)return"%";o++;const i=t.formatters[s];if("function"==typeof i){const t=e[o];n=i.call(r,t),e.splice(o,1),o--}return n}),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(s!==t.namespaces&&(s=t.namespaces,i=t.enabled(e)),i),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack??e.message:e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),s=n.length;for(r=0;r<s;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=te,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(r=>{t[r]=e[r]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.setupFormatters(t.formatters),t.enable(t.load()),t}({formatArgs:function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+te(this.diff),!this.useColors)return;const t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(n=r))}),e.splice(n,0,t)},save:function(e){try{e?ne?.setItem("debug",e):ne?.removeItem("debug")}catch(e){}},load:function(){let e;try{e=ne?.getItem("debug")}catch(e){}return!e&&void 0!==globalThis.process&&"env"in globalThis.process&&(e=globalThis.process.env.DEBUG),e},useColors:function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||null==navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement?.style?.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&null!=navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/))},setupFormatters:function(e){e.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},colors:["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],storage:ne,log:se});function oe(){return{forComponent:e=>function(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return ie.enabled(`${e}:trace`)&&null!=ie.names.map(e=>e.toString()).find(e=>e.includes(":trace"))&&(t=ie(`${e}:trace`)),Object.assign(ie(e),{error:ie(`${e}:error`),trace:t})}(e)}}function ae(e){if(null!=e&&0!==(e=e.trim()).length)return e}ie.formatters.b=e=>null==e?"undefined":W.base58btc.baseEncode(e),ie.formatters.t=e=>null==e?"undefined":G.base32.baseEncode(e),ie.formatters.m=e=>null==e?"undefined":Z.base64.baseEncode(e),ie.formatters.p=e=>null==e?"undefined":e.toString(),ie.formatters.c=e=>null==e?"undefined":e.toString(),ie.formatters.k=e=>null==e?"undefined":e.toString(),ie.formatters.a=e=>null==e?"undefined":e.toString(),ie.formatters.e=e=>null==e?"undefined":ae(e.stack)??ae(e.message)??e.toString();var ce=r(7158);class le{set;constructor(e){if(this.set=new Set,null!=e)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return(0,ce.r)(this.set.entries(),e=>{const t=(0,ce.X)(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const r=(0,ce.X)(t);e(r,r,this)})}has(e){return this.set.has(e.toString())}values(){return(0,ce.r)(this.set.values(),e=>(0,ce.X)(e))}intersection(e){const t=new le;for(const r of e)this.has(r)&&t.add(r);return t}difference(e){const t=new le;for(const r of this)e.has(r)||t.add(r);return t}union(e){const t=new le;for(const r of e)t.add(r);for(const e of this)t.add(e);return t}}var ue=r(8661),he=r(5768),de=r(2723);const fe=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{const t=[];for await(const r of e)t.push(r);return t})();const t=[];for(const r of e)t.push(r);return t};var pe=r(5086);class ge extends pe.j{metric;constructor(e){super();const{name:t,metrics:r}=e;this.metric=r.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){const t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}class me extends Error{static name="AbortError";name="AbortError";constructor(e="The operation was aborted",...t){super(e,...t)}}var ye=r(6513),we=r(2860),be=r(6194);class ve extends Error{static name="QueueFullError";constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}var Ee=r(8337),xe=r(1205);class Se{deferred;signal;constructor(e){this.signal=e,this.deferred=Promise.withResolvers(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new me)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}}class Ae{id;fn;options;recipients;status;timeline;controller;constructor(e,t){this.id=`${parseInt(String(1e9*Math.random()),10).toString()}${Date.now()}`,this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,(0,Ee.k)(1/0,this.controller.signal),this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((e,t)=>e&&!0===t.signal?.aborted,!0)&&(this.controller.abort(new me),this.cleanup())}async join(e={}){const t=new Se(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await(0,xe.W)(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}}function Ie(e,t){let r;const n=function(){clearTimeout(r),r=setTimeout(function(){r=void 0,e()},t)};return n.start=()=>{},n.stop=()=>{clearTimeout(r)},n}class Ce extends we.X{concurrency;maxSize;queue;pending;sort;autoStart;constructor(e={}){super(),this.concurrency=e.concurrency??Number.POSITIVE_INFINITY,this.maxSize=e.maxSize??Number.POSITIVE_INFINITY,this.pending=0,this.autoStart=e.autoStart??!0,this.sort=e.sort,this.queue=[],this.emitEmpty=Ie(this.emitEmpty.bind(this),1),this.emitIdle=Ie(this.emitIdle.bind(this),1)}[Symbol.asyncIterator](){return this.toGenerator()}emitEmpty(){0===this.size&&this.safeDispatchEvent("empty")}emitIdle(){0===this.running&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(0===this.size)return this.emitEmpty(),0===this.running&&this.emitIdle(),!1;if(this.pending<this.concurrency){let e;for(const t of this.queue)if("queued"===t.status){e=t;break}return null!=e&&(this.safeDispatchEvent("active"),this.pending++,e.run().finally(()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.safeDispatchEvent("next"),this.autoStart&&this.tryToStartAnother()}),!0)}return!1}enqueue(e){this.queue.push(e),null!=this.sort&&this.queue.sort(this.sort)}start(){!1===this.autoStart&&(this.autoStart=!0,this.tryToStartAnother())}pause(){this.autoStart=!1}async add(e,t){if(t?.signal?.throwIfAborted(),this.size===this.maxSize)throw new ve;const r=new Ae(e,t);return this.enqueue(r),this.safeDispatchEvent("add"),this.autoStart&&this.tryToStartAnother(),r.join(t).then(e=>(this.safeDispatchEvent("success",{detail:{job:r,result:e}}),e)).catch(e=>{if("queued"===r.status)for(let e=0;e<this.queue.length;e++)if(this.queue[e]===r){this.queue.splice(e,1);break}throw this.safeDispatchEvent("failure",{detail:{job:r,error:e}}),e})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(e=>{e.abort(new me)}),this.clear()}async onEmpty(e){0!==this.size&&await(0,be.y)(this,"empty",e?.signal)}async onSizeLessThan(e,t){this.size<e||await(0,be.y)(this,"next",t?.signal,{filter:()=>this.size<e})}async onIdle(e){0===this.pending&&0===this.size||await(0,be.y)(this,"idle",e?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(e){e?.signal?.throwIfAborted();const t=(0,ye.Ny)({objectMode:!0}),r=e=>{null!=e?this.abort():this.clear(),t.end(e)},n=e=>{null!=e.detail&&t.push(e.detail.result)},s=e=>{r(e.detail.error)},i=()=>{r()},o=()=>{r(new me("Queue aborted"))};this.addEventListener("success",n),this.addEventListener("failure",s),this.addEventListener("idle",i),e?.signal?.addEventListener("abort",o);try{yield*t}finally{this.removeEventListener("success",n),this.removeEventListener("failure",s),this.removeEventListener("idle",i),e?.signal?.removeEventListener("abort",o),r()}}}const ke="lock:worker:request-read",Pe="lock:worker:abort-read-request",Te="lock:worker:release-read",_e="lock:master:grant-read",De="lock:master:error-read",Le="lock:worker:request-write",Re="lock:worker:abort-write-request",Ue="lock:worker:release-write",Me="lock:master:grant-write",Be="lock:master:error-write",Ne="lock:worker:finalize",Oe="mortice",Fe={singleProcess:!1},qe=(e,t,r,n,s,i,o,a,c)=>l=>{if(null==l.data)return;const u={type:l.data.type,name:l.data.name,identifier:l.data.identifier};u.type===s&&e.safeDispatchEvent(r,{detail:{name:u.name,identifier:u.identifier,handler:async()=>{t.postMessage({type:c,name:u.name,identifier:u.identifier}),await new Promise(e=>{const r=n=>{if(null==n?.data)return;const s=n.data.type,i=(n.data.name,n.data.identifier);s===a&&i===u.identifier&&(t.removeEventListener("message",r),e())};t.addEventListener("message",r)})},onError:e=>{t.postMessage({type:o,name:u.name,identifier:u.identifier,error:{message:e.message,name:e.name,stack:e.stack}})}}}),u.type===i&&e.safeDispatchEvent(n,{detail:{name:u.name,identifier:u.identifier}}),u.type===Ne&&e.safeDispatchEvent("finalizeRequest",{detail:{name:u.name}})};class ze{name;channel;constructor(e){this.name=e,this.channel=new BroadcastChannel(Oe)}readLock(e){return this.sendRequest(ke,Pe,_e,De,Te,e)}writeLock(e){return this.sendRequest(Le,Re,Me,Be,Ue,e)}finalize(){this.channel.postMessage({type:Ne,name:this.name}),this.channel.close()}async sendRequest(e,t,r,n,s,i){i?.signal?.throwIfAborted();const o=((e=10)=>Math.random().toString().substring(2,e+2))();return this.channel.postMessage({type:e,identifier:o,name:this.name}),new Promise((e,a)=>{const c=()=>{this.channel.postMessage({type:t,identifier:o,name:this.name})};i?.signal?.addEventListener("abort",c,{once:!0});const l=t=>{if(t.data?.identifier===o&&(t.data?.type===r&&(this.channel.removeEventListener("message",l),i?.signal?.removeEventListener("abort",c),e(()=>{this.channel.postMessage({type:s,identifier:o,name:this.name})})),t.data.type===n)){this.channel.removeEventListener("message",l),i?.signal?.removeEventListener("abort",c);const e=new Error;null!=t.data.error&&(e.message=t.data.error.message,e.name=t.data.error.name,e.stack=t.data.error.stack),a(e)}};this.channel.addEventListener("message",l)})}}const Ke=new Map;let $e;function je(e){return"function"==typeof e?.readLock&&"function"==typeof e?.writeLock}function Ve(e){if(null==$e&&($e=(e=>{if(e=Object.assign({},Fe,e),Boolean(globalThis.document)||e.singleProcess){const e=new BroadcastChannel(Oe),t=new we.X;return e.addEventListener("message",qe(t,e,"requestReadLock","abortReadLockRequest",ke,Pe,De,Te,_e)),e.addEventListener("message",qe(t,e,"requestWriteLock","abortWriteLockRequest",Le,Re,Be,Ue,Me)),t}return new ze(e.name)})(e),!je($e))){const e=$e;e.addEventListener("requestReadLock",t=>{const r=t.detail.name,n=t.detail.identifier,s=Ke.get(r);if(null==s)return;const i=new AbortController,o=e=>{e.detail.name===r&&e.detail.identifier===n&&i.abort()};e.addEventListener("abortReadLockRequest",o),s.readLock({signal:i.signal}).then(async e=>{await t.detail.handler().finally(()=>{e()})}).catch(e=>{t.detail.onError(e)}).finally(()=>{e.removeEventListener("abortReadLockRequest",o)})}),e.addEventListener("requestWriteLock",t=>{const r=t.detail.name,n=t.detail.identifier,s=Ke.get(r);if(null==s)return;const i=new AbortController,o=e=>{e.detail.name===r&&e.detail.identifier===n&&i.abort()};e.addEventListener("abortWriteLockRequest",o),s.writeLock({signal:i.signal}).then(async e=>{await t.detail.handler().finally(()=>{e()})}).catch(e=>{t.detail.onError(e)}).finally(()=>{e.removeEventListener("abortWriteLockRequest",o)})}),e.addEventListener("finalizeRequest",e=>{const t=e.detail.name,r=Ke.get(t);null!=r&&r.finalize()})}return $e}async function He(e,t){let r,n;const s=new Promise((e,t)=>{r=e,n=t}),i=()=>{n(new me)};return t?.signal?.addEventListener("abort",i,{once:!0}),e.add(async()=>{await new Promise(e=>{r(()=>{t?.signal?.removeEventListener("abort",i),e()})})},{signal:t?.signal}).catch(e=>{n(e)}),s}const Ge={name:"lock",concurrency:1/0,singleProcess:!1,autoFinalize:!1};function We(e){const t=Object.assign({},Ge,e);return((e,t)=>{let r=Ke.get(e);if(null!=r)return r;const n=Ve(t);if(je(n))return r=n,Ke.set(e,r),r;const s=new Ce({concurrency:1});let i;return r={async readLock(e){if(null!=i)return He(i,e);i=new Ce({concurrency:t.concurrency,autoStart:!1});const r=i,n=He(i,e);return s.add(async()=>{r.start(),await r.onIdle().then(()=>{i===r&&(i=null)})}),n},writeLock:async e=>(i=null,He(s,e)),finalize:()=>{Ke.delete(e)},queue:s},Ke.set(e,r),!0===t.autoFinalize&&s.addEventListener("idle",()=>{r.finalize()},{once:!0}),r})(t.name,t)}var Ze,Ye,Qe,Xe=r(5494),Je=r(4113),et=r(6345);function tt(e,t){if(null!=e.publicKey||null==t.publicKey)return e;let r;"RSA"===e.type&&(r=e.toMultihash());const i=(0,n.EZ)(t.publicKey,r);return(0,s.sR)(i)}function rt(e,t,r){const n=new Map,s=BigInt(Date.now());for(const[e,r]of t.tags.entries())null!=r.expiry&&r.expiry<s||n.set(e,r);return{...t,id:tt(e,t),addresses:t.addresses.filter(({observed:e})=>null!=e&&e>Date.now()-r).map(({multiaddr:e,isCertified:t})=>({multiaddr:(0,M.HZ)(e),isCertified:t??!1})),metadata:t.metadata,peerRecordEnvelope:t.peerRecordEnvelope??void 0,tags:n}}!function(e){let t,r,n;!function(e){let t;e.codec=()=>(null==t&&(t=(0,Je.iU)((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&""!==e.key&&(t.uint32(10),t.string(e.key)),null!=e.value&&e.value.byteLength>0&&(t.uint32(18),t.bytes(e.value)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={key:"",value:(0,et.c)(0)},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.key=e.string();break;case 2:n.value=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,Je.mH)(t,e.codec()),e.decode=(t,r)=>(0,Je.Y8)(t,e.codec(),r)}(t=e.Peer$metadataEntry||(e.Peer$metadataEntry={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,Je.iU)((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&""!==e.key&&(t.uint32(10),t.string(e.key)),null!=e.value&&(t.uint32(18),Qe.codec().encode(e.value,t)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={key:""},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.key=e.string();break;case 2:n.value=Qe.codec().decode(e,e.uint32(),{limits:r.limits?.value});break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,Je.mH)(t,e.codec()),e.decode=(t,r)=>(0,Je.Y8)(t,e.codec(),r)}(r=e.Peer$tagsEntry||(e.Peer$tagsEntry={})),e.codec=()=>(null==n&&(n=(0,Je.iU)((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.addresses)for(const e of t.addresses)r.uint32(10),Ye.codec().encode(e,r);if(null!=t.protocols)for(const e of t.protocols)r.uint32(18),r.string(e);if(null!=t.publicKey&&(r.uint32(34),r.bytes(t.publicKey)),null!=t.peerRecordEnvelope&&(r.uint32(42),r.bytes(t.peerRecordEnvelope)),null!=t.metadata&&0!==t.metadata.size)for(const[n,s]of t.metadata.entries())r.uint32(50),e.Peer$metadataEntry.codec().encode({key:n,value:s},r);if(null!=t.tags&&0!==t.tags.size)for(const[n,s]of t.tags.entries())r.uint32(58),e.Peer$tagsEntry.codec().encode({key:n,value:s},r);null!=t.updated&&(r.uint32(64),r.uint64Number(t.updated)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{const s={addresses:[],protocols:[],metadata:new Map,tags:new Map},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:if(null!=n.limits?.addresses&&s.addresses.length===n.limits.addresses)throw new Je.zH('Decode error - map field "addresses" had too many elements');s.addresses.push(Ye.codec().decode(t,t.uint32(),{limits:n.limits?.addresses$}));break;case 2:if(null!=n.limits?.protocols&&s.protocols.length===n.limits.protocols)throw new Je.zH('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break;case 4:s.publicKey=t.bytes();break;case 5:s.peerRecordEnvelope=t.bytes();break;case 6:{if(null!=n.limits?.metadata&&s.metadata.size===n.limits.metadata)throw new Je.w2('Decode error - map field "metadata" had too many elements');const r=e.Peer$metadataEntry.codec().decode(t,t.uint32());s.metadata.set(r.key,r.value);break}case 7:{if(null!=n.limits?.tags&&s.tags.size===n.limits.tags)throw new Je.w2('Decode error - map field "tags" had too many elements');const r=e.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:n.limits?.tags$value}});s.tags.set(r.key,r.value);break}case 8:s.updated=t.uint64Number();break;default:t.skipType(7&r)}}return s})),n),e.encode=t=>(0,Je.mH)(t,e.codec()),e.decode=(t,r)=>(0,Je.Y8)(t,e.codec(),r)}(Ze||(Ze={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,Je.iU)((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.multiaddr&&e.multiaddr.byteLength>0&&(t.uint32(10),t.bytes(e.multiaddr)),null!=e.isCertified&&(t.uint32(16),t.bool(e.isCertified)),null!=e.observed&&(t.uint32(24),t.uint64Number(e.observed)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={multiaddr:(0,et.c)(0)},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.multiaddr=e.bytes();break;case 2:n.isCertified=e.bool();break;case 3:n.observed=e.uint64Number();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,Je.mH)(t,e.codec()),e.decode=(t,r)=>(0,Je.Y8)(t,e.codec(),r)}(Ye||(Ye={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,Je.iU)((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.value&&0!==e.value&&(t.uint32(8),t.uint32(e.value)),null!=e.expiry&&(t.uint32(16),t.uint64(e.expiry)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={value:0},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.value=e.uint32();break;case 2:n.expiry=e.uint64();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,Je.mH)(t,e.codec()),e.decode=(t,r)=>(0,Je.Y8)(t,e.codec(),r)}(Qe||(Qe={}));var nt=r(5131);function st(e,t){return null==e&&null==t||null!=e&&null!=t&&(0,nt.a)(e,t)}function it(e,t,r){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1;return!0}function ot(e,t,r){if(e.size!==t.size)return!1;for(const[n,s]of e.entries()){const e=t.get(n);if(null==e)return!1;if(!r(s,e))return!1}return!0}var at=r(7442);const ct="/",lt=(new TextEncoder).encode(ct),ut=lt[0];class ht{_buf;constructor(e,t){if("string"==typeof e)this._buf=(0,at.s)(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==ut)throw new Error("Invalid key")}toString(e="utf8"){return(0,P.d)(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new ht(e.join(ct))}static random(){return new ht(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new ht(e):"function"==typeof e.uint8Array?new ht(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=lt),this._buf[0]!==ut){const e=new Uint8Array(this._buf.byteLength+1);e.fill(ut,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===ut;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],s=r[e];if(n<s)return!0;if(n>s)return!1}return t.length<r.length}reverse(){return ht.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(ct).slice(1)}type(){return function(e){const t=e.split(":");return t.length<2?"":t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new ht(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(ct)||(e+=ct),e+=this.type(),new ht(e)}parent(){const e=this.list();return 1===e.length?new ht(ct):new ht(e.slice(0,-1).join(ct))}child(e){return this.toString()===ct?e:e.toString()===ct?this:new ht(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return ht.withNamespaces([...this.namespaces(),...(t=e.map(e=>e.namespaces()),[].concat(...t))]);var t}}const dt="/peers/";function ft(e){if(!(0,ue.Q)(e)||null==e.type)throw new o.gG("Invalid PeerId");const t=e.toCID().toString();return new ht(`${dt}${t}`)}async function pt(e,t,r,n,s){const i=new Map;for(const n of r){if(null==n)continue;if(n.multiaddr instanceof Uint8Array&&(n.multiaddr=(0,M.HZ)(n.multiaddr)),!(0,M.R8)(n.multiaddr))throw new o.gG("Multiaddr was invalid");if(!await t(e,n.multiaddr,s))continue;const r=n.isCertified??!1,a=n.multiaddr.toString(),c=i.get(a);null!=c?n.isCertified=c.isCertified||r:i.set(a,{multiaddr:n.multiaddr,isCertified:r})}return[...i.values()].sort((e,t)=>e.multiaddr.toString().localeCompare(t.multiaddr.toString())).map(({isCertified:t,multiaddr:r})=>{const n=r.getPeerId();return e.equals(n)&&(r=r.decapsulate((0,M.HZ)(`/p2p/${e}`))),{isCertified:t,multiaddr:r.bytes}})}async function gt(e,t,r,s){if(null==t)throw new o.gG("Invalid PeerData");if(null!=t.publicKey&&null!=e.publicKey&&!t.publicKey.equals(e.publicKey))throw new o.gG("publicKey bytes do not match peer id publicKey bytes");const i=s.existingPeer?.peer;if(null!=i&&!e.equals(i.id))throw new o.gG("peer id did not match existing peer id");let a,c=i?.addresses??[],l=new Set(i?.protocols??[]),u=i?.metadata??new Map,h=i?.tags??new Map,d=i?.peerRecordEnvelope;if("patch"===r&&(null==t.multiaddrs&&null==t.addresses||(c=[],null!=t.multiaddrs&&c.push(...t.multiaddrs.map(e=>({isCertified:!1,multiaddr:e}))),null!=t.addresses&&c.push(...t.addresses)),null!=t.protocols&&(l=new Set(t.protocols)),null!=t.metadata&&(u=mt(t.metadata instanceof Map?[...t.metadata.entries()]:Object.entries(t.metadata),{validate:yt})),null!=t.tags&&(h=mt(t.tags instanceof Map?[...t.tags.entries()]:Object.entries(t.tags),{validate:wt,map:bt})),null!=t.peerRecordEnvelope&&(d=t.peerRecordEnvelope)),"merge"===r){if(null!=t.multiaddrs&&c.push(...t.multiaddrs.map(e=>({isCertified:!1,multiaddr:e}))),null!=t.addresses&&c.push(...t.addresses),null!=t.protocols&&(l=new Set([...l,...t.protocols])),null!=t.metadata){const e=t.metadata instanceof Map?[...t.metadata.entries()]:Object.entries(t.metadata);for(const[t,r]of e)null==r?u.delete(t):u.set(t,r);u=mt([...u.entries()],{validate:yt})}if(null!=t.tags){const e=t.tags instanceof Map?[...t.tags.entries()]:Object.entries(t.tags),r=new Map(h);for(const[t,n]of e)null==n?r.delete(t):r.set(t,n);h=mt([...r.entries()],{validate:wt,map:bt})}null!=t.peerRecordEnvelope&&(d=t.peerRecordEnvelope)}null!=i?.id.publicKey?a=(0,n.Ve)(i.id.publicKey):null!=t.publicKey?a=(0,n.Ve)(t.publicKey):null!=e.publicKey&&(a=(0,n.Ve)(e.publicKey));const f={addresses:await pt(e,s.addressFilter??(async()=>!0),c,s.existingPeer?.peerPB.addresses,s),protocols:[...l.values()].sort((e,t)=>e.localeCompare(t)),metadata:u,tags:h,publicKey:a,peerRecordEnvelope:d};return f.addresses.forEach(e=>{e.observed=s.existingPeer?.peerPB.addresses?.find(e=>(0,nt.a)(e.multiaddr,e.multiaddr))?.observed??Date.now()}),"RSA"!==e.type&&delete f.publicKey,f}function mt(e,t){const r=new Map;for(const[r,n]of e)null!=n&&t.validate(r,n);for(const[n,s]of e.sort(([e],[t])=>e.localeCompare(t)))null!=s&&r.set(n,t.map?.(n,s)??s);return r}function yt(e,t){if("string"!=typeof e)throw new o.gG("Metadata key must be a string");if(!(t instanceof Uint8Array))throw new o.gG("Metadata value must be a Uint8Array")}function wt(e,t){if("string"!=typeof e)throw new o.gG("Tag name must be a string");if(null!=t.value){if(parseInt(`${t.value}`,10)!==t.value)throw new o.gG("Tag value must be an integer");if(t.value<0||t.value>100)throw new o.gG("Tag value must be between 0-100")}if(null!=t.ttl){if(parseInt(`${t.ttl}`,10)!==t.ttl)throw new o.gG("Tag ttl must be an integer");if(t.ttl<0)throw new o.gG("Tag ttl must be between greater than 0")}}function bt(e,t){let r;null!=t.expiry&&(r=t.expiry),null!=t.ttl&&(r=BigInt(Date.now()+Number(t.ttl)));const n={value:t.value??0};return null!=r&&(n.expiry=r),n}function vt(e){const t=e.toString().split("/")[2],r=Xe.TO.parse(t,G.base32);return(0,s.Az)(r)}function Et(e,t,r){return function(e,t,r){return rt(e,Ze.decode(t),r)}(vt(e),t,r)}class xt{peerId;datastore;locks;addressFilter;log;maxAddressAge;maxPeerAge;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.locks=function(e){const{name:t,metrics:r}=e;let n;return n=null!=r?new ge({name:t,metrics:r}):new pe.j,n}({name:"libp2p_peer_store_locks",metrics:e.metrics}),this.maxAddressAge=t.maxAddressAge??36e5,this.maxPeerAge=t.maxPeerAge??216e5}getLock(e){let t=this.locks.get(e);return null==t&&(t={refs:0,lock:We({name:e.toString(),singleProcess:!0})},this.locks.set(e,t)),t.refs++,t}maybeRemoveLock(e,t){t.refs--,0===t.refs&&(t.lock.finalize(),this.locks.delete(e))}async getReadLock(e,t){const r=this.getLock(e);try{const n=await r.lock.readLock(t);return()=>{n(),this.maybeRemoveLock(e,r)}}catch(t){throw this.maybeRemoveLock(e,r),t}}async getWriteLock(e,t){const r=this.getLock(e);try{const n=await r.lock.writeLock(t);return()=>{n(),this.maybeRemoveLock(e,r)}}catch(t){throw this.maybeRemoveLock(e,r),t}}async has(e,t){try{return await this.load(e,t),!0}catch(e){if("NotFoundError"!==e.name)throw e}return!1}async delete(e,t){this.peerId.equals(e)||await this.datastore.delete(ft(e),t)}async load(e,t){const r=ft(e),n=await this.datastore.get(r,t),s=Ze.decode(n);if(this.#_(e,s))throw await this.datastore.delete(r,t),new o.m_;return rt(e,s,this.peerId.equals(e)?1/0:this.maxAddressAge)}async save(e,t,r){const n=await this.#D(e,r),s=await gt(e,t,"patch",{...r,addressFilter:this.addressFilter});return this.#L(e,s,n)}async patch(e,t,r){const n=await this.#D(e,r),s=await gt(e,t,"patch",{...r,addressFilter:this.addressFilter,existingPeer:n});return this.#L(e,s,n)}async merge(e,t,r){const n=await this.#D(e,r),s=await gt(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:n});return this.#L(e,s,n)}async*all(e){for await(const{key:t,value:r}of this.datastore.query(function(e,t){return{prefix:dt,filters:(e.filters??[]).map(e=>({key:r,value:n})=>e(Et(r,n,t))),orders:(e.orders??[]).map(e=>(r,n)=>e(Et(r.key,r.value,t),Et(n.key,n.value,t)))}}(e??{},this.maxAddressAge),e)){const n=vt(t);if(n.equals(this.peerId))continue;const s=Ze.decode(r);this.#_(n,s)?await this.datastore.delete(t,e):yield rt(n,s,this.peerId.equals(n)?1/0:this.maxAddressAge)}}async#D(e,t){try{const r=ft(e),n=await this.datastore.get(r,t),s=Ze.decode(n);if(this.#_(e,s))throw await this.datastore.delete(r,t),new o.m_;return{peerPB:s,peer:rt(e,s,this.maxAddressAge)}}catch(e){"NotFoundError"!==e.name&&this.log.error("invalid peer data found in peer store - %e",e)}}async#L(e,t,r,n){t.updated=Date.now();const s=Ze.encode(t);return await this.datastore.put(ft(e),s,n),{peer:rt(e,t,this.maxAddressAge),previous:r?.peer,updated:null==r||(a=t,c=r.peerPB,!(it(a.addresses,c.addresses,(e,t)=>e.isCertified===t.isCertified&&!!(0,nt.a)(e.multiaddr,t.multiaddr))&&it(a.protocols,c.protocols,(e,t)=>e===t)&&st(a.publicKey,c.publicKey)&&st(a.peerRecordEnvelope,c.peerRecordEnvelope)&&ot(a.metadata,c.metadata,(e,t)=>(0,nt.a)(e,t))&&(i=a.tags,o=c.tags,ot(i,o,(e,t)=>e.value===t.value&&e.expiry===t.expiry))))};var i,o,a,c}#_(e,t){if(null==t.updated)return!0;if(this.peerId.equals(e))return!1;const r=t.updated<Date.now()-this.maxPeerAge,n=Date.now()-this.maxAddressAge,s=t.addresses.filter(e=>null!=e.observed&&e.observed>n);return r&&0===s.length}}class St{store;events;peerId;log;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new xt(e,t)}[Symbol.toStringTag]="@libp2p/peer-store";async forEach(e,t){for await(const r of this.store.all(t))e(r)}async all(e){return fe(this.store.all(e))}async delete(e,t){const r=await this.store.getReadLock(e,t);try{await this.store.delete(e,t)}finally{r()}}async has(e,t){const r=await this.store.getReadLock(e,t);try{return await this.store.has(e,t)}finally{this.log.trace("has release read lock"),r?.()}}async get(e,t){const r=await this.store.getReadLock(e,t);try{return await this.store.load(e,t)}finally{r?.()}}async getInfo(e,t){const r=await this.get(e,t);return{id:r.id,multiaddrs:r.addresses.map(({multiaddr:e})=>e)}}async save(e,t,r){const n=await this.store.getWriteLock(e,r);try{const n=await this.store.save(e,t,r);return this.#R(e,n),n.peer}finally{n?.()}}async patch(e,t,r){const n=await this.store.getWriteLock(e,r);try{const n=await this.store.patch(e,t,r);return this.#R(e,n),n.peer}finally{n?.()}}async merge(e,t,r){const n=await this.store.getWriteLock(e,r);try{const n=await this.store.merge(e,t,r);return this.#R(e,n),n.peer}finally{n?.()}}async consumePeerRecord(e,t,r){const n=(0,ue.Q)(t)?t:(0,ue.Q)(t?.expectedPeer)?t.expectedPeer:void 0,i=(0,ue.Q)(t)||void 0===t?r:t,o=await he.e.openAndCertify(e,de.c.DOMAIN,i),a=(0,s.Az)(o.publicKey.toCID());if(!1===n?.equals(a))return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",n,a),!1;const c=de.c.createFromProtobuf(o.payload);let l;try{l=await this.get(a,i)}catch(e){if("NotFoundError"!==e.name)throw e}if(null!=l?.peerRecordEnvelope){const e=he.e.createFromProtobuf(l.peerRecordEnvelope),t=de.c.createFromProtobuf(e.payload);if(t.seqNumber>=c.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",t.seqNumber,c.seqNumber),!1}return await this.patch(c.peerId,{peerRecordEnvelope:e,addresses:c.multiaddrs.map(e=>({isCertified:!0,multiaddr:e}))},i),!0}#R(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))}}Error,Error,Error,Error,Error,Error;class At extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=At.name;code=At.code;constructor(e="Not Found"){super(e)}}Error;var It=r(3810),Ct=r(1935);const kt=function(e,t){let r=0;if(null!=e[Symbol.asyncIterator])return async function*(){for await(const n of e)await t(n,r++)&&(yield n)}();const n=(0,Ct.A)(e),{value:s,done:i}=n.next();if(!0===i)return function*(){}();const o=t(s,r++);if("function"==typeof o.then)return async function*(){await o&&(yield s);for(const e of n)await t(e,r++)&&(yield e)}();const a=t;return function*(){!0===o&&(yield s);for(const e of n)a(e,r++)&&(yield e)}()},Pt=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){const r=await fe(e);yield*r.sort(t)}():function*(){const r=fe(e);yield*r.sort(t)}()},Tt=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){let r=0;if(!(t<1))for await(const n of e)if(yield n,r++,r===t)return}():function*(){let r=0;if(!(t<1))for(const n of e)if(yield n,r++,r===t)return}()};class _t{put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield r}async*getMany(e,t={}){for await(const r of e)yield{key:r,value:await this.get(r,t)}}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await(0,It.A)(this.putMany(e,r)),e=[],await(0,It.A)(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix){const t=e.prefix;r=kt(r,e=>e.key.toString().startsWith(t))}if(Array.isArray(e.filters)&&(r=e.filters.reduce((e,t)=>kt(e,t),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((e,t)=>Pt(e,t),r)),null!=e.offset){let t=0;const n=e.offset;r=kt(r,()=>t++>=n)}return null!=e.limit&&(r=Tt(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix){const t=e.prefix;r=kt(r,e=>e.toString().startsWith(t))}if(Array.isArray(e.filters)&&(r=e.filters.reduce((e,t)=>kt(e,t),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((e,t)=>Pt(e,t),r)),null!=e.offset){const t=e.offset;let n=0;r=kt(r,()=>n++>=t)}return null!=e.limit&&(r=Tt(r,e.limit)),r}}class Dt extends _t{data;constructor(){super(),this.data=new Map}put(e,t,r){return r?.signal?.throwIfAborted(),this.data.set(e.toString(),t),e}get(e,t){t?.signal?.throwIfAborted();const r=this.data.get(e.toString());if(null==r)throw new At;return r}has(e,t){return t?.signal?.throwIfAborted(),this.data.has(e.toString())}delete(e,t){t?.signal?.throwIfAborted(),this.data.delete(e.toString())}*_all(e,t){t?.signal?.throwIfAborted();for(const[e,r]of this.data.entries())yield{key:new ht(e),value:r},t?.signal?.throwIfAborted()}*_allKeys(e,t){t?.signal?.throwIfAborted();for(const e of this.data.keys())yield new ht(e),t?.signal?.throwIfAborted()}}var Lt=r(6119),Rt=r(5763),Ut=r(7418),Mt=r(8304),Bt=r(1794),Nt=r(386);class Ot extends Map{metric;constructor(e){super();const{name:t,metrics:r}=e;this.metric=r.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){const t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function Ft(e){const{name:t,metrics:r}=e;let n;return n=null!=r?new Ot({name:t,metrics:r}):new Map,n}const qt=864e13;class zt{log;mappings;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=Ft({name:"libp2p_address_manager_dns_mappings",metrics:e.metrics})}has(e){const t=this.findHost(e);for(const e of this.mappings.values())if(e.domain===t)return!0;return!1}add(e,t){t.forEach(t=>{this.log("add DNS mapping %s to %s",t,e);const r=!0===(0,Bt.b)(t);this.mappings.set(t,{domain:e,verified:r,expires:r?qt-Date.now():0,lastVerified:r?qt-Date.now():void 0})})}remove(e){const t=this.findHost(e);let r=!1;for(const[e,n]of this.mappings.entries())n.domain===t&&(this.log("removing %s to %s DNS mapping %e",e,n.domain,new Error("where")),this.mappings.delete(e),r=r||n.verified);return r}getAll(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r].multiaddr.stringTuples(),s=n[0][1];if(null!=s)for(const[i,o]of this.mappings.entries())s===i&&this.maybeAddSNITuple(n,o.domain)&&(e.splice(r,1),r--,t.push({multiaddr:(0,M.HZ)(`/${n.map(e=>[(0,M.WH)(e[0]).name,e[1]].join("/")).join("/")}`),verified:o.verified,type:"dns-mapping",expires:o.expires,lastVerified:o.lastVerified}))}return t}maybeAddSNITuple(e,t){for(let r=0;r<e.length;r++)if(448===e[r][0]&&449!==e[r+1]?.[0])return e.splice(r+1,0,[449,t]),!0;return!1}confirm(e,t){const r=this.findHost(e);let n=!1;for(const[e,s]of this.mappings.entries())s.domain===r&&(this.log("marking %s to %s DNS mapping as verified",e,s.domain),n=s.verified,s.verified=!0,s.expires=Date.now()+t,s.lastVerified=Date.now());return n}unconfirm(e,t){const r=this.findHost(e);let n=!1;for(const[e,s]of this.mappings.entries())s.domain===r&&(this.log("removing verification of %s to %s DNS mapping",e,s.domain),n=n||s.verified,s.verified=!1,s.expires=Date.now()+t);return n}findHost(e){for(const t of e.stringTuples()){if(449===t[0])return t[1];if(53===t[0]||54===t[0]||55===t[0]||56===t[0])return t[1]}}}class Kt{log;mappings;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=Ft({name:"libp2p_address_manager_ip_mappings",metrics:e.metrics})}has(e){const t=e.stringTuples();for(const e of this.mappings.values())for(const r of e)if(r.externalIp===t[0][1])return!0;return!1}add(e,t,r,n=t,s="tcp"){const i=`${e}-${t}-${s}`,o=this.mappings.get(i)??[],a={internalIp:e,internalPort:t,externalIp:r,externalPort:n,externalFamily:(0,Rt.wM)(r)?4:6,protocol:s,verified:!1,expires:0};o.push(a),this.mappings.set(i,o)}remove(e){const t=e.stringTuples(),r=t[0][1]??"",n=6===t[1][0]?"tcp":"udp",s=parseInt(t[1][1]??"0");let i=!1;for(const[e,t]of this.mappings.entries()){for(let e=0;e<t.length;e++){const o=t[e];o.externalIp===r&&o.externalPort===s&&o.protocol===n&&(this.log("removing %s:%s to %s:%s %s IP mapping",o.externalIp,o.externalPort,r,s,n),i=i||o.verified,t.splice(e,1),e--)}0===t.length&&this.mappings.delete(e)}return i}getAll(e){const t=[];for(const{multiaddr:r}of e){const e=r.stringTuples();let n;if(4!==e[0][0]&&41!==e[0][0]||6!==e[1][0]?4!==e[0][0]&&41!==e[0][0]||273!==e[1][0]||(n=`${e[0][1]}-${e[1][1]}-udp`):n=`${e[0][1]}-${e[1][1]}-tcp`,null==n)continue;const s=this.mappings.get(n);if(null!=s)for(const r of s)e[0][0]=4===r.externalFamily?4:41,e[0][1]=r.externalIp,e[1][1]=`${r.externalPort}`,t.push({multiaddr:(0,M.HZ)(`/${e.map(e=>[(0,M.WH)(e[0]).name,e[1]].join("/")).join("/")}`),verified:r.verified,type:"ip-mapping",expires:r.expires,lastVerified:r.lastVerified})}return t}confirm(e,t){const r=e.stringTuples()[0][1];let n=!1;for(const e of this.mappings.values())for(const s of e)s.externalIp===r&&(this.log("marking %s to %s IP mapping as verified",s.internalIp,s.externalIp),n=s.verified,s.verified=!0,s.expires=Date.now()+t,s.lastVerified=Date.now());return n}unconfirm(e,t){const r=e.stringTuples(),n=r[0][1]??"",s=6===r[1][0]?"tcp":"udp",i=parseInt(r[1][1]??"0");let o=!1;for(const e of this.mappings.values())for(let r=0;r<e.length;r++){const a=e[r];a.externalIp===n&&a.externalPort===i&&a.protocol===s&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",a.externalIp,a.externalPort,n,i,s),o=o||a.verified,a.verified=!1,a.expires=Date.now()+t)}return o}}var $t=r(3008);class jt{log;addresses;maxObservedAddresses;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=Ft({name:"libp2p_address_manager_observed_addresses",metrics:e.metrics}),this.maxObservedAddresses=t.maxObservedAddresses??10}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(const t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&((0,$t.G)(e)||function(e){try{for(const{code:t,value:r}of e.getComponents())if(t!==M.qc&&null!=r){if(t===M.GY)return r.startsWith("169.254.");if(t===M.Ik)return r.toLowerCase().startsWith("fe80")}}catch{}return!1}(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:(0,M.HZ)(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){const t=this.addresses.get(e.toString())?.verified??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){const r=e.toString(),n=this.addresses.get(r)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},s=n.verified;return n.verified=!0,n.expires=Date.now()+t,n.lastVerified=Date.now(),this.log("marking observed address %a as verified",r),this.addresses.set(r,n),s}}const Vt=[M.GY,M.Ik,M.eI,M.Cm,M.A6,M.Jj];function Ht(e){try{for(const{code:t}of e.getComponents())if(t!==M.qc)return Vt.includes(t)}catch{}return!1}class Gt{log;addresses;maxObservedAddresses;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=Ft({name:"libp2p_address_manager_transport_addresses",metrics:e.metrics}),this.maxObservedAddresses=t.maxObservedAddresses??10}get(e,t){if((0,$t.G)(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};const r=this.toKey(e);let n=this.addresses.get(r);return null==n&&(n={verified:!Ht(e),expires:0},this.addresses.set(r,n)),{multiaddr:e,verified:n.verified,type:"transport",expires:n.expires,lastVerified:n.lastVerified}}has(e){const t=this.toKey(e);return this.addresses.has(t)}remove(e){const t=this.toKey(e),r=this.addresses.get(t)?.verified??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),r}confirm(e,t){const r=this.toKey(e),n=this.addresses.get(r)??{verified:!1,expires:0,lastVerified:0},s=n.verified;return n.verified=!0,n.expires=Date.now()+t,n.lastVerified=Date.now(),this.addresses.set(r,n),s}unconfirm(e,t){const r=this.toKey(e),n=this.addresses.get(r)??{verified:!1,expires:0},s=n.verified;return n.verified=!1,n.expires=Date.now()+t,this.addresses.set(r,n),s}toKey(e){if(Ht(e)){const t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}}const Wt=6e5,Zt=3e5,Yt=e=>e;function Qt(e,t){const r=e.getPeerId();return null!=r&&(0,s.XL)(r).equals(t)&&(e=e.decapsulate((0,M.HZ)(`/p2p/${t.toString()}`))),e}class Xt{log;components;listen;announce;appendAnnounce;announceFilter;observed;dnsMappings;ipMappings;transportAddresses;observedAddressFilter;addressVerificationTTL;addressVerificationRetry;constructor(e,t={}){const{listen:r=[],announce:n=[],appendAnnounce:s=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=r.map(e=>e.toString()),this.announce=new Set(n.map(e=>e.toString())),this.appendAnnounce=new Set(s.map(e=>e.toString())),this.observed=new jt(e,t),this.dnsMappings=new zt(e,t),this.ipMappings=new Kt(e,t),this.transportAddresses=new Gt(e,t),this.announceFilter=t.announceFilter??Yt,this.observedAddressFilter=(0,Mt.O)(1024),this.addressVerificationTTL=t.addressVerificationTTL??Wt,this.addressVerificationRetry=t.addressVerificationRetry??Zt,this._updatePeerStoreAddresses=(0,Ut.s)(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}[Symbol.toStringTag]="@libp2p/address-manager";_updatePeerStoreAddresses(){const e=this.getAddresses().map(e=>e.getPeerId()===this.components.peerId.toString()?e.decapsulate(`/p2p/${this.components.peerId.toString()}`):e);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(e=>{this.log.error("error updating addresses",e)})}getListenAddrs(){return Array.from(this.listen).map(e=>(0,M.HZ)(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>(0,M.HZ)(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>(0,M.HZ)(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){const t=e.stringTuples(),r=`${t[0][1]}:${t[1][1]}`;this.observedAddressFilter.has(r)||(this.observedAddressFilter.add(r),e=Qt(e,this.components.peerId),this.ipMappings.has(e)||this.dnsMappings.has(e)||this.observed.add(e))}confirmObservedAddr(e,t){e=Qt(e,this.components.peerId);let r=!0;("transport"===t?.type||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,t?.ttl??this.addressVerificationTTL)&&r&&(r=!1),("dns-mapping"===t?.type||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,t?.ttl??this.addressVerificationTTL)&&r&&(r=!1),("ip-mapping"===t?.type||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,t?.ttl??this.addressVerificationTTL)&&r&&(r=!1),("observed"===t?.type||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,t?.ttl??this.addressVerificationTTL),r=!1):!this.observed.confirm(e,t?.ttl??this.addressVerificationTTL)&&r&&(r=!1)),r||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=Qt(e,this.components.peerId);let r=!1;this.observed.has(e)&&!this.observed.remove(e)&&r&&(r=!1),this.transportAddresses.has(e)&&!this.transportAddresses.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&r&&(r=!1),this.dnsMappings.has(e)&&!this.dnsMappings.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&r&&(r=!1),this.ipMappings.has(e)&&!this.ipMappings.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&r&&(r=!1),r&&this._updatePeerStoreAddresses()}getAddresses(){const e=new Set,t=this.getAddressesWithMetadata().filter(t=>{if(!t.verified)return!1;const r=t.multiaddr.toString();return!e.has(r)&&(e.add(r),!0)}).map(e=>e.multiaddr);return this.announceFilter(t.map(e=>{const t=(0,M.HZ)(e),r=t.getComponents().pop();return r?.value===this.components.peerId.toString()?t:t.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(t=>{t.updateAnnounceAddrs(e)}),e.map(e=>({multiaddr:e,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(e=>this.transportAddresses.get(e,this.addressVerificationTTL)));const r=this.getAppendAnnounceAddrs();return r.length>0&&(this.components.transportManager.getListeners().forEach(e=>{e.updateAnnounceAddrs(r)}),t=t.concat(r.map(e=>({multiaddr:e,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove((0,M.HZ)(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,r,n=t,s="tcp"){this.ipMappings.add(e,t,r,n,s),this.observed.removePrefixed(`/ip${(0,Rt.wM)(r)?4:6}/${r}/${s}/${n}`)}removePublicAddressMapping(e,t,r,n=t,s="tcp"){this.ipMappings.remove((0,M.HZ)(`/ip${(0,Rt.wM)(r)?4:6}/${r}/${s}/${n}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;const t=e.toOptions();if(6===t.family||"127.0.0.1"===t.host||!0===(0,Bt.b)(t.host))return!1;const r=this.components.transportManager.getListeners(),n=[e=>Nt.By.exactMatch(e)||Nt.YJ.exactMatch(e),e=>Nt.qi.exactMatch(e),e=>Nt.WV.exactMatch(e)];for(const s of n){if(!s(e))continue;const n=r.filter(e=>e.getAddrs().filter(e=>4===e.toOptions().family&&s(e)).length>0);if(1!==n.length)continue;const i=n[0].getAddrs().filter(e=>"127.0.0.1"!==e.toOptions().host).pop();if(null==i)continue;const o=i.toOptions();return this.observed.remove(e),this.ipMappings.add(o.host,o.port,t.host,t.port,t.transport),!0}return!1}}var Jt,er=r(9583),tr=r(7191);!function(e){e.NOT_STARTED_YET="The libp2p node is not started yet",e.NOT_FOUND="Not found"}(Jt||(Jt={}));class rr extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class nr extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class sr extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class ir extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class or extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class ar extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class cr extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class lr extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class ur extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}}class hr extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}}class dr extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class fr extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class pr extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class gr extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class mr extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class yr extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class wr{components={};_started=!1;constructor(e={}){this.components={};for(const[t,r]of Object.entries(e))this.components[t]=r;null==this.components.logger&&(this.components.logger=oe())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(e=>(0,er.nw)(e)).map(async t=>{await(t[e]?.())}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const br=["metrics","connectionProtector","dns"],vr=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function Er(e){return Array.isArray(e?.[tr.Ch])?e[tr.Ch]:[]}function xr(e){return Array.isArray(e?.[tr.VM])?e[tr.VM]:[]}function Sr(e){return e?.[Symbol.toStringTag]??e?.toString()??"unknown"}function Ar(e={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{if(Nt.By.matches(e))return!1;const t=e.stringTuples();return(4===t[0][0]||41===t[0][0])&&Boolean((0,Bt.b)(`${t[0][1]}`))},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...e}}const Ir=()=>{const e=new Error("Delay aborted");return e.name="AbortError",e},Cr=new WeakMap,kr=function({clearTimeout:e,setTimeout:t}={}){return(r,{value:n,signal:s}={})=>{if(s?.aborted)return Promise.reject(Ir());let i,o,a;const c=e??clearTimeout,l=()=>{c(i),a(Ir())},u=new Promise((e,c)=>{o=()=>{s&&s.removeEventListener("abort",l),e(n)},a=c,i=(t??setTimeout)(o,r)});return s&&s.addEventListener("abort",l,{once:!0}),Cr.set(u,()=>{c(i),i=null,o()}),u}}();var Pr=r(7090);class Tr{memoryStorage;points;duration;blockDuration;execEvenly;execEvenlyMinDelayMs;keyPrefix;constructor(e={}){this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??1e3*this.duration/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new _r}async consume(e,t=1,r={}){const n=this.getKey(e),s=this._getKeySecDuration(r);let i=this.memoryStorage.incrby(n,t,s);if(i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i.consumedPoints>this.points)throw this.blockDuration>0&&i.consumedPoints<=this.points+t&&(i=this.memoryStorage.set(n,i.consumedPoints,this.blockDuration)),new Pr.O("Rate limit exceeded",i);if(this.execEvenly&&i.msBeforeNext>0&&!i.isFirstInDuration){let e=Math.ceil(i.msBeforeNext/(i.remainingPoints+2));e<this.execEvenlyMinDelayMs&&(e=i.consumedPoints*this.execEvenlyMinDelayMs),await kr(e)}return i}penalty(e,t=1,r={}){const n=this.getKey(e),s=this._getKeySecDuration(r),i=this.memoryStorage.incrby(n,t,s);return i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i}reward(e,t=1,r={}){const n=this.getKey(e),s=this._getKeySecDuration(r),i=this.memoryStorage.incrby(n,-t,s);return i.remainingPoints=Math.max(this.points-i.consumedPoints,0),i}block(e,t){const r=1e3*t,n=this.points+1;return this.memoryStorage.set(this.getKey(e),n,t),{remainingPoints:0,msBeforeNext:0===r?-1:r,consumedPoints:n,isFirstInDuration:!1}}set(e,t,r=0){const n=1e3*(r>=0?r:this.duration);return this.memoryStorage.set(this.getKey(e),t,r),{remainingPoints:0,msBeforeNext:0===n?-1:n,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return null!=t&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return null!=e?.customDuration&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class _r{storage;constructor(){this.storage=new Map}incrby(e,t,r){const n=this.storage.get(e);if(null!=n){const s=null!=n.expiresAt?n.expiresAt.getTime()-(new Date).getTime():-1;return null==n.expiresAt||s>0?(n.value+=t,{remainingPoints:0,msBeforeNext:s,consumedPoints:n.value,isFirstInDuration:!1}):this.set(e,t,r)}return this.set(e,t,r)}set(e,t,r){const n=1e3*r,s=this.storage.get(e);null!=s&&clearTimeout(s.timeoutId);const i={value:t,expiresAt:n>0?new Date(Date.now()+n):void 0};return this.storage.set(e,i),n>0&&(i.timeoutId=setTimeout(()=>{this.storage.delete(e)},n),null!=i.timeoutId.unref&&i.timeoutId.unref()),{remainingPoints:0,msBeforeNext:0===n?-1:n,consumedPoints:i.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(null!=t)return{remainingPoints:0,msBeforeNext:null!=t.expiresAt?t.expiresAt.getTime()-(new Date).getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){const t=this.storage.get(e);return null!=t&&(null!=t.timeoutId&&clearTimeout(t.timeoutId),this.storage.delete(e),!0)}}function Dr(e){if((0,ue.Q)(e))return{peerId:e,multiaddrs:[]};let t,r=Array.isArray(e)?e:[e];if(r.length>0){const e=r[0].getPeerId();t=null==e?void 0:(0,s.XL)(e),r.forEach(e=>{if(!(0,M.R8)(e))throw new o.Ci("Invalid multiaddr");const r=e.getPeerId();if(null==r){if(null!=t)throw new o.gG("Multiaddrs must all have the same peer id or have no peer id")}else{const e=(0,s.XL)(r);if(!0!==t?.equals(e))throw new o.gG("Multiaddrs must all have the same peer id or have no peer id")}})}return r=r.filter(e=>!Nt.RJ.exactMatch(e)),{peerId:t,multiaddrs:r}}const Lr=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];var Rr=r(3051);function Ur(e){try{let t;if(t="string"==typeof e?(0,M.HZ)(e):e,!t.protoNames().includes("ipcidr")){const e=t.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";t=t.encapsulate(e)}return(0,Rr.Hu)(t)}catch(t){throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${e}`)}}class Mr{connectionManager;peerStore;allow;events;log;constructor(e,t={}){this.allow=(t.allow??[]).map(e=>Ur(e)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}async _maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length,r=this.connectionManager.getMaxConnections();if(this.log("checking max connections limit %d/%d",t,r),t<=r)return;const n=new pe.j;for(const t of e){const e=t.remotePeer;if(!n.has(e)){n.set(e,0);try{const t=await this.peerStore.get(e);n.set(e,[...t.tags.values()].reduce((e,t)=>e+t.value,0))}catch(e){"NotFoundError"!==e.name&&this.log.error("error loading peer tags",e)}}}const s=this.sortConnections(e,n),i=Math.max(t-r,0),o=[];for(const e of s)if(this.log("too many connections open - closing a connection to %p",e.remotePeer),this.allow.some(t=>t.contains(e.remoteAddr.nodeAddress().address))||o.push(e),o.length===i)break;await Promise.all(o.map(async e=>{await async function(e,t){const r=e?.streams?.map(e=>e.protocol)??[],n=t?.closableProtocols??Lr;if(!(r.filter(e=>null!=e&&!n.includes(e)).length>0))try{await(e?.close(t))}catch(t){e?.abort(t)}}(e,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:o})}sortConnections(e,t){return e.sort((e,t)=>{const r=e.timeline.open,n=t.timeline.open;return r<n?1:r>n?-1:0}).sort((e,t)=>"outbound"===e.direction&&"inbound"===t.direction?1:"inbound"===e.direction&&"outbound"===t.direction?-1:0).sort((e,t)=>e.streams.length>t.streams.length?1:e.streams.length<t.streams.length?-1:0).sort((e,r)=>{const n=t.get(e.remotePeer)??0,s=t.get(r.remotePeer)??0;return n>s?1:n<s?-1:0})}}const Br="last-dial-failure",Nr="last-dial-success";var Or=r(250);class Fr extends Or.o{constructor(e={}){super({...e,sort:(e,t)=>e.options.priority>t.options.priority?-1:e.options.priority<t.options.priority?1:0})}}var qr=r(704),zr=r(1204);function Kr(e){if(!(0,zr.b)(e))return!1;const{address:t}=e.nodeAddress();return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r=t)||/^::1$/.test(r);var r}function $r(e,t){const r=Nt.qi.exactMatch(e.multiaddr),n=Nt.qi.exactMatch(t.multiaddr);if(r&&!n)return-1;if(!r&&n)return 1;const s=Nt.YJ.exactMatch(e.multiaddr),i=Nt.YJ.exactMatch(t.multiaddr);if(s&&!i)return-1;if(!s&&i)return 1;const o=Nt.By.exactMatch(e.multiaddr),a=Nt.By.exactMatch(t.multiaddr);if(o&&!a)return-1;if(!o&&a)return 1;const c=Nt.aM.exactMatch(e.multiaddr),l=Nt.aM.exactMatch(t.multiaddr);if(c&&!l)return-1;if(!c&&l)return 1;const u=Nt.r9.exactMatch(e.multiaddr),h=Nt.r9.exactMatch(t.multiaddr);if(u&&!h)return-1;if(!u&&h)return 1;const d=Nt.u9.exactMatch(e.multiaddr),f=Nt.u9.exactMatch(t.multiaddr);return d&&!f?-1:!d&&f?1:0}function jr(e,t){const r=Kr(e.multiaddr),n=Kr(t.multiaddr);return r&&!n?1:!r&&n?-1:0}function Vr(e,t){const r=(0,$t.G)(e.multiaddr),n=(0,$t.G)(t.multiaddr);return r&&!n?1:!r&&n?-1:0}function Hr(e,t){return e.isCertified&&!t.isCertified?-1:!e.isCertified&&t.isCertified?1:0}function Gr(e,t){const r=Nt.uu.exactMatch(e.multiaddr),n=Nt.uu.exactMatch(t.multiaddr);return r&&!n?1:!r&&n?-1:0}class Wr{queue;components;addressSorter;maxPeerAddrsToDial;maxDialQueueLength;dialTimeout;shutDownController;connections;log;constructor(e,t={}){this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??25,this.maxDialQueueLength=t.maxDialQueueLength??500,this.dialTimeout=t.dialTimeout??1e4,this.connections=t.connections??new pe.j,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,(0,Ee.k)(1/0,this.shutDownController.signal);for(const[e,r]of Object.entries(t.resolvers??{}))M.K6.set(e,r);this.queue=new Fr({concurrency:t.maxParallelDials??50,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",e=>{e.detail?.name!==o.lc.name&&this.log.error("error in dial queue - %e",e.detail)})}start(){this.shutDownController=new AbortController,(0,Ee.k)(1/0,this.shutDownController.signal)}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){const{peerId:r,multiaddrs:n}=Dr(e),s=Array.from(this.connections.values()).flat().find(e=>!0!==t.force&&(!!e.remotePeer.equals(r)||n.find(t=>t.equals(e.remoteAddr))));if("open"===s?.status)return this.log("already connected to %a",s.remoteAddr),t.onProgress?.(new b.j("dial-queue:already-connected")),s;const i=this.queue.queue.find(e=>{if(!0===r?.equals(e.options.peerId))return!0;const t=e.options.multiaddrs;if(null==t)return!1;for(const e of n)if(t.has(e.toString()))return!0;return!1});if(null!=i){this.log("joining existing dial target for %p",r);for(const e of n)i.options.multiaddrs.add(e.toString());return t.onProgress?.(new b.j("dial-queue:already-in-dial-queue")),i.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new o.zm("Dial queue is full");return this.log("creating dial target for %p",r,n.map(e=>e.toString())),t.onProgress?.(new b.j("dial-queue:add-to-dial-queue")),this.queue.add(async e=>{e.onProgress?.(new b.j("dial-queue:start-dial"));const t=(0,qr.J)([this.shutDownController.signal,e.signal]);(0,Ee.k)(1/0,t);try{return await this.dialPeer(e,t)}finally{t.clear()}},{peerId:r,priority:t.priority??sn,multiaddrs:new Set(n.map(e=>e.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async dialPeer(e,t){const r=e.peerId,n=e.multiaddrs,s=new Set;let i=0===e.multiaddrs.size,a=0,c=0;const l=[];for(this.log("starting dial to %p",r);i||n.size>0;){c++,i=!1;const u=[],h=new Set(e.multiaddrs);n.clear(),this.log("calculating addrs to dial %p from %s",r,[...h]);const d=await this.calculateMultiaddrs(r,h,{...e,signal:t});for(const e of d)s.has(e.multiaddr.toString())?this.log.trace("skipping previously failed multiaddr %a while dialing %p",e.multiaddr,r):u.push(e);this.log("%s dial to %p with %s",1===c?"starting":"continuing",r,u.map(e=>e.multiaddr.toString())),e?.onProgress?.(new b.j("dial-queue:calculated-addresses",u));for(const n of u){if(a===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",a,e.peerId),new o.zm("Peer had more than maxPeerAddrsToDial");a++;try{const s=await this.components.transportManager.dial(n.multiaddr,{...e,signal:t});this.log("dial to %a succeeded",n.multiaddr);try{await this.components.peerStore.merge(s.remotePeer,{multiaddrs:[s.remoteAddr],metadata:{[Nr]:(0,at.s)(Date.now().toString())}})}catch(e){this.log.error("could not update last dial failure key for %p",r,e)}return s}catch(e){if(this.log.error("dial failed to %a",n.multiaddr,e),s.add(n.multiaddr.toString()),null!=r)try{await this.components.peerStore.merge(r,{metadata:{[Br]:(0,at.s)(Date.now().toString())}})}catch(e){this.log.error("could not update last dial failure key for %p",r,e)}if(t.aborted)throw new o.MU(e.message);l.push(e)}}}if(1===l.length)throw l[0];throw new AggregateError(l,"All multiaddr dials failed")}async calculateMultiaddrs(e,t=new Set,r={}){const n=[...t].map(e=>({multiaddr:(0,M.HZ)(e),isCertified:!1}));if(null!=e){if(this.components.peerId.equals(e))throw new o.zm("Tried to dial self");if(!0===await(this.components.connectionGater.denyDialPeer?.(e)))throw new lr("The dial request is blocked by gater.allowDialPeer");if(0===n.length){this.log("loading multiaddrs for %p",e);try{const t=await this.components.peerStore.get(e);n.push(...t.addresses),this.log("loaded multiaddrs for %p",e,n.map(({multiaddr:e})=>e.toString()))}catch(e){if("NotFoundError"!==e.name)throw e}}if(0===n.length){this.log("looking up multiaddrs for %p in the peer routing",e);try{const t=await this.components.peerRouting.findPeer(e,r);this.log("found multiaddrs for %p in the peer routing",e,n.map(({multiaddr:e})=>e.toString())),n.push(...t.multiaddrs.map(e=>({multiaddr:e,isCertified:!1})))}catch(t){"NoPeerRoutersError"===t.name?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,t)}}}let s=(await Promise.all(n.map(async e=>{const t=await async function(e,t){let r=!1;for(const t of M.K6.keys())if(r=e.protoNames().includes(t),r)break;if(!r)return[e];const n=await e.resolve(t);return t.log("resolved %s to",e,n.map(e=>e.toString())),n}(e.multiaddr,{dns:this.components.dns,...r,log:this.log});return 1===t.length&&t[0].equals(e.multiaddr)?e:t.map(e=>({multiaddr:e,isCertified:!1}))}))).flat();if(null!=e){const t=`/p2p/${e.toString()}`;s=s.map(e=>{const r=e.multiaddr.getComponents().pop();return"p2p"!==r?.name?{multiaddr:e.multiaddr.encapsulate(t),isCertified:e.isCertified}:e})}const i=s.filter(t=>{if(null==this.components.transportManager.dialTransportForMultiaddr(t.multiaddr))return!1;const r=t.multiaddr.getPeerId();return null==e||null==r||e.equals(r)}),a=new Map;for(const e of i){const t=e.multiaddr.toString(),r=a.get(t);null==r?a.set(t,e):r.isCertified=r.isCertified||e.isCertified||!1}const c=[...a.values()];if(0===c.length)throw new dr("The dial request has no valid addresses");const l=[];for(const e of c)null!=this.components.connectionGater.denyDialMultiaddr&&await this.components.connectionGater.denyDialMultiaddr(e.multiaddr)||l.push(e);const u=null==this.addressSorter?l.sort($r).sort(Hr).sort(Gr).sort(Vr).sort(jr):l.sort(this.addressSorter);if(0===u.length)throw new lr("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",s.map(({multiaddr:e})=>e.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",u.map(({multiaddr:e})=>e.toString())),u}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{const r=await this.calculateMultiaddrs(void 0,new Set(e.map(e=>e.toString())),t);return!1!==t.runOnLimitedConnection||null!=r.find(e=>!Nt.uu.matches(e.multiaddr))}catch(e){this.log.trace("error calculating if multiaddr(s) were dialable",e)}return!1}}var Zr=r(3951),Yr=r(9163),Qr=r(5314);const Xr=Object.prototype.toString,Jr=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);class en extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const tn=(e,t,r)=>{const n=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=n,e};class rn{log;queue;started;peerStore;retries;retryInterval;backoffFactor;connectionManager;events;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new Yr.w({concurrency:t.maxParallelReconnects??5,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",e=>{this.maybeReconnect(e.detail).catch(t=>{this.log.error("failed to maybe reconnect to %p - %e",e.detail,t)})})}async maybeReconnect(e){if(!this.started)return;const t=await this.peerStore.get(e);nn(t)&&(this.queue.has(e)||this.queue.add(async t=>{await async function(e,t){return new Promise((r,n)=>{t={...t},t.onFailedAttempt??=()=>{},t.shouldRetry??=()=>!0,t.retries??=10;const s=Qr.operation(t),i=()=>{s.stop(),n(t.signal?.reason)};t.signal&&!t.signal.aborted&&t.signal.addEventListener("abort",i,{once:!0});const o=()=>{t.signal?.removeEventListener("abort",i),s.stop()};s.attempt(async i=>{try{const t=await e(i);o(),r(t)}catch(e){try{if(!(e instanceof Error))throw new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`);if(e instanceof en)throw e.originalError;if(e instanceof TypeError&&!function(e){var t;return!(!e||(t=e,"[object Error]"!==Xr.call(t))||"TypeError"!==e.name||"string"!=typeof e.message)&&("Load failed"===e.message?void 0===e.stack:Jr.has(e.message))}(e))throw e;if(tn(e,i,t),await t.shouldRetry(e)||(s.stop(),n(e)),await t.onFailedAttempt(e),!s.retry(e))throw s.mainError()}catch(e){tn(e,i,t),o(),n(e)}}})})}(async r=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:t?.signal})}catch(t){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,r,this.retries,t),t}},{signal:t?.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async r=>{this.log.error("failed to reconnect to %p - %e",e,r);const n={};[...t.tags.keys()].forEach(e=>{e.startsWith(Zr.Q)&&(n[e]=void 0)}),await this.peerStore.merge(e,{tags:n}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async t=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,t)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[e=>nn(e)]});await Promise.all(e.map(async e=>{await this.connectionManager.openConnection(e.id).catch(e=>{this.log.error(e)})}))}).catch(e=>{this.log.error(e)})}stop(){this.started=!1,this.queue.abort()}}function nn(e){for(const t of e.tags.keys())if(t.startsWith(Zr.Q))return!0;return!1}const sn=50;class on{started;connections;allow;deny;maxIncomingPendingConnections;incomingPendingConnections;outboundPendingConnections;maxConnections;dialQueue;reconnectQueue;connectionPruner;inboundConnectionRateLimiter;peerStore;metrics;events;log;peerId;constructor(e,t={}){if(this.maxConnections=t.maxConnections??100,this.maxConnections<1)throw new o.gG("Connection Manager maxConnections must be greater than 0");this.connections=new pe.j,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(e=>Ur(e)),this.deny=(t.deny??[]).map(e=>Ur(e)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??10,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new Tr({points:t.inboundConnectionThreshold??5,duration:1}),this.connectionPruner=new Mr({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{allow:t.allow?.map(e=>(0,M.HZ)(e))}),this.dialQueue=new Wr(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??50,maxDialQueueLength:t.maxDialQueueLength??500,maxPeerAddrsToDial:t.maxPeerAddrsToDial??25,dialTimeout:t.dialTimeout??1e4,resolvers:t.resolvers??{dnsaddr:z},connections:this.connections}),this.reconnectQueue=new rn({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}[Symbol.toStringTag]="@libp2p/connection-manager";async start(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const e={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const t of this.connections.values())for(const r of t)e[r.direction]++;return e}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const e={};for(const t of this.connections.values())for(const r of t)for(const t of r.streams){const r=`${t.direction} ${t.protocol??"unnegotiated"}`;e[r]=(e[r]??0)+1}return e}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const e={};for(const t of this.connections.values())for(const r of t){const t={};for(const e of r.streams){const r=`${e.direction} ${e.protocol??"unnegotiated"}`;t[r]=(t[r]??0)+1}for(const[r,n]of Object.entries(t))e[r]=e[r]??[],e[r].push(n)}const t={};for(let[r,n]of Object.entries(e)){n=n.sort((e,t)=>e-t);const e=Math.floor(.9*n.length);t[r]=n[e]}return t}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await(0,er.ni)(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await(0,er.ds)(this.reconnectQueue,this.dialQueue,this.connectionPruner);const e=[];for(const t of this.connections.values())for(const r of t)e.push((async()=>{try{await r.close()}catch(e){this.log.error(e)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}setMaxConnections(e){if(this.maxConnections<1)throw new o.gG("Connection Manager maxConnections must be greater than 0");let t=!1;e<this.maxConnections&&(t=!0),this.maxConnections=e,t&&this.connectionPruner.maybePruneConnections()}onConnect(e){this._onConnect(e).catch(e=>{this.log.error(e)})}async _onConnect(e){const{detail:t}=e;if(!this.started)return void await t.close();if("open"!==t.status)return;const r=t.remotePeer,n=!this.connections.has(r),s=this.connections.get(r)??[];s.push(t),this.connections.set(r,s),null!=r.publicKey&&"RSA"===r.type&&await this.peerStore.patch(r,{publicKey:r.publicKey}),n&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e,r=t.remotePeer,n=(this.connections.get(r)??[]).filter(e=>e.id!==t.id);this.connections.set(r,n),0===n.length&&(this.log("onDisconnect remove all connections for peer %p",r),this.connections.delete(r),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(null!=e)return this.connections.get(e)??[];let t=[];for(const e of this.connections.values())t=t.concat(e);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){if(!this.started)throw new o.x$("Not started");this.outboundPendingConnections++;try{t.signal?.throwIfAborted();const{peerId:r}=Dr(e);if(this.peerId.equals(r))throw new o.B6("Can not dial self");if(null!=r&&!0!==t.force){this.log("dial %p",r);const e=this.getConnections(r).find(e=>null==e.limits);if(null!=e)return this.log("had an existing non-limited connection to %p",r),t.onProgress?.(new b.j("dial-queue:already-connected")),e}const n=await this.dialQueue.dial(e,{...t,priority:t.priority??sn});if("open"!==n.status)throw new o.rb("Remote closed connection during opening");let s=this.connections.get(n.remotePeer);null==s&&(s=[],this.connections.set(n.remotePeer,s));let i=!1;for(const e of s)if(e.id===n.id&&(i=!0),!0!==t.force&&e.id!==n.id&&e.remoteAddr.equals(n.remoteAddr))return n.abort(new o.Ci("Duplicate multiaddr connection")),e;return i||s.push(n),n}finally{this.outboundPendingConnections--}}async closeConnections(e,t={}){const r=this.connections.get(e)??[];await Promise.all(r.map(async e=>{try{await e.close(t)}catch(t){e.abort(t)}}))}async acceptIncomingConnection(e){if(this.deny.some(t=>t.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(t=>t.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const t=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(t,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,t),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(e=>(0,M.HZ)(e))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}var an=r(4641);class cn{movingAverage;variance;deviation;forecast;timeSpan;previousTime;constructor(e){this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(null!=this.previousTime){const r=this.alpha(t,this.previousTime),n=e-this.movingAverage,s=r*n;this.movingAverage=r*e+(1-r)*this.movingAverage,this.variance=(1-r)*(this.variance+n*s),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+r*n}else this.movingAverage=e;this.previousTime=t}}class ln{success;failure;next;metric;timeoutMultiplier;failureMultiplier;minTimeout;maxTimeout;constructor(e={}){const t=e.interval??5e3;this.success=new cn(t),this.failure=new cn(t),this.next=new cn(t),this.failureMultiplier=e.failureMultiplier??2,this.timeoutMultiplier=e.timeoutMultiplier??1.2,this.minTimeout=e.minTimeout??5e3,this.maxTimeout=e.maxTimeout??6e4,null!=e.metricName&&(this.metric=e.metrics?.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){let t=Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier));t<this.minTimeout&&(t=this.minTimeout),t>this.maxTimeout&&(t=this.maxTimeout);const r=AbortSignal.timeout(t),n=(0,qr.J)([e.signal,r]);return(0,Ee.k)(1/0,n,r),n.start=Date.now(),n.timeout=t,n}cleanUp(e){const t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),this.metric?.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),this.metric?.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}var un=r(1252);class hn{protocol;components;log;heartbeatInterval;pingIntervalMs;abortController;timeout;abortConnectionOnPingFailure;constructor(e,t={}){this.components=e,this.protocol=`/${t.protocolPrefix??"ipfs"}/ping/1.0.0`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??1e4,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??!0,this.timeout=new ln({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}[Symbol.toStringTag]="@libp2p/connection-monitor";[tr.Ch]=["@libp2p/connection-monitor"];start(){this.abortController=new AbortController,(0,Ee.k)(1/0,this.abortController.signal),this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{let t=Date.now();try{const r=this.timeout.getTimeoutSignal({signal:this.abortController?.signal}),n=await e.newStream(this.protocol,{signal:r,runOnLimitedConnection:!0}),s=(0,un.p)(n);t=Date.now(),await Promise.all([s.write((0,an.A)(32),{signal:r}),s.read({bytes:32,signal:r})]),e.rtt=Date.now()-t,await s.unwrap().close({signal:r})}catch(r){if("UnsupportedProtocolError"!==r.name)throw r;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){this.abortController?.abort(),null!=this.heartbeatInterval&&clearInterval(this.heartbeatInterval)}}var dn=r(9488);class fn{routers;started;components;constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=e.metrics?.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,cid:e.toString()}),getAttributesFromYieldedValue:(e,t)=>({...t,providers:[...Array.isArray(t.providers)?t.providers:[],e.id.toString()]})})??this.findProviders,this.provide=e.metrics?.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,cid:e.toString()})})??this.provide,this.cancelReprovide=e.metrics?.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,cid:e.toString()})})??this.cancelReprovide,this.put=e.metrics?.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([e])=>({key:(0,P.d)(e,"base36")})})??this.put,this.get=e.metrics?.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([e])=>({key:(0,P.d)(e,"base36")})})??this.get}[Symbol.toStringTag]="@libp2p/content-routing";isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(0===this.routers.length)throw new sr("No content routers available");const r=this,n=new le;for await(const s of(0,dn.A)(...r.routers.filter(e=>e.findProviders instanceof Function).map(r=>r.findProviders(e,t))))null!=s&&(s.multiaddrs.length>0&&await this.components.peerStore.merge(s.id,{multiaddrs:s.multiaddrs},t),n.has(s.id)||(n.add(s.id),yield s))}async provide(e,t={}){if(0===this.routers.length)throw new sr("No content routers available");await Promise.all(this.routers.filter(e=>e.provide instanceof Function).map(async r=>{await r.provide(e,t)}))}async cancelReprovide(e,t={}){if(0===this.routers.length)throw new sr("No content routers available");await Promise.all(this.routers.filter(e=>e.cancelReprovide instanceof Function).map(async r=>{await r.cancelReprovide(e,t)}))}async put(e,t,r){if(!this.isStarted())throw new o.x$;await Promise.all(this.routers.filter(e=>e.put instanceof Function).map(async n=>{await n.put(e,t,r)}))}async get(e,t){if(!this.isStarted())throw new o.x$;return Promise.any(this.routers.filter(e=>e.get instanceof Function).map(async r=>r.get(e,t)))}}var pn=r(7987);class gn{log;peerId;peerStore;routers;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=e.metrics?.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,peer:e.toString()})})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,key:(0,P.d)(e,"base36")}),getAttributesFromYieldedValue:(e,t)=>({...t,peers:[...Array.isArray(t.peers)?t.peers:[],e.id.toString()]})})??this.getClosestPeers}[Symbol.toStringTag]="@libp2p/peer-routing";async findPeer(e,t){if(0===this.routers.length)throw new ir("No peer routers available");if(e.toString()===this.peerId.toString())throw new or("Should not try to find self");const r=this,n=(0,dn.A)(...this.routers.filter(e=>e.findPeer instanceof Function).map(n=>async function*(){try{yield await n.findPeer(e,t)}catch(e){r.log.error(e)}}()));for await(const e of n)if(null!=e)return e.multiaddrs.length>0&&await this.peerStore.merge(e.id,{multiaddrs:e.multiaddrs},t),e;throw new o.m_}async*getClosestPeers(e,t={}){if(0===this.routers.length)throw new ir("No peer routers available");const r=this,n=(0,Mt.O)(1024);for await(const s of(0,pn.A)(async function*(){const n=(0,dn.A)(...r.routers.filter(e=>e.getClosestPeers instanceof Function).map(r=>r.getClosestPeers(e,t)));for await(let e of n)yield async()=>{if(0===e.multiaddrs.length)try{e=await r.findPeer(e.id,{...t,useCache:!1})}catch(e){return void r.log.error("could not find peer multiaddrs",e)}return e}}()))null!=s&&(s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs},t),n.has(s.id.toMultihash().bytes)||(n.add(s.id.toMultihash().bytes),yield s))}}var mn=r(515);class yn extends we.X{peerRouting;log;walking;walkers;shutdownController;walkController;needNext;constructor(e){super(),this.log=e.logger.forComponent("libp2p:random-walk"),this.peerRouting=e.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,(0,Ee.k)(1/0,this.shutdownController.signal)}[Symbol.toStringTag]="@libp2p/random-walk";start(){this.shutdownController=new AbortController,(0,Ee.k)(1/0,this.shutdownController.signal)}stop(){this.shutdownController.abort()}async*walk(e){this.walking||this.startWalk(),this.walkers++;const t=(0,qr.J)([this.shutdownController.signal,e?.signal]);(0,Ee.k)(1/0,t);try{for(;;){this.needNext?.resolve(),this.needNext=(0,mn.A)();const e=await(0,be.y)(this,"walk:peer",t,{errorEvent:"walk:error"});yield e.detail}}finally{t.clear(),this.walkers--,0===this.walkers&&(this.walkController?.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,(0,Ee.k)(1/0,this.walkController.signal);const e=(0,qr.J)([this.walkController.signal,this.shutdownController.signal]);(0,Ee.k)(1/0,e);const t=Date.now();let r=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const t=(0,an.A)(32);let n=Date.now();for await(const s of this.peerRouting.getClosestPeers(t,{signal:e}))e.aborted&&this.log("aborting walk"),e.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",s.id,Date.now()-n,this.walkers),r++,this.safeDispatchEvent("walk:peer",{detail:s}),1===this.walkers&&null!=this.needNext&&(this.log("wait for need next"),await(0,xe.W)(this.needNext.promise,e)),n=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",t,this.walkers,r)}catch(e){this.log.error("random walk errored",e),this.safeDispatchEvent("walk:error",{detail:e})}this.log("no walkers left, ended walk")}).catch(e=>{this.log.error("random walk errored",e)}).finally(()=>{this.log("finished walk, found %d peers after %dms",r,Date.now()-t),this.walking=!1})}}class wn{log;topologies;handlers;components;constructor(e){this.components=e,this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,e.metrics?.registerMetricGroup("libp2p_registrar_topologies",{calculate:()=>{const e={};for(const[t,r]of this.topologies)e[t]=r.size;return e}}),this.handlers=Ft({name:"libp2p_registrar_protocol_handlers",metrics:e.metrics}),this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}[Symbol.toStringTag]="@libp2p/registrar";getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(null==t)throw new ar(`No handler registered for protocol ${e}`);return t}getTopologies(e){const t=this.topologies.get(e);return null==t?[]:[...t.values()]}async handle(e,t,r){if(this.handlers.has(e)&&!0!==r?.force)throw new cr(`Handler already registered for protocol ${e}`);const n=w.bind({ignoreUndefined:!0})({maxInboundStreams:32,maxOutboundStreams:64},r);this.handlers.set(e,{handler:t,options:n}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]},r)}async unhandle(e,t){(Array.isArray(e)?e:[e]).forEach(e=>{this.handlers.delete(e)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()},t)}async register(e,t){if(null==t)throw new o.gG("invalid topology");const r=`${(1e9*Math.random()).toString(36)}${Date.now()}`;let n=this.topologies.get(e);return null==n&&(n=new Map,this.topologies.set(e,n)),n.set(r,t),r}unregister(e){for(const[t,r]of this.topologies.entries())r.has(e)&&(r.delete(e),0===r.size&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail,r={signal:AbortSignal.timeout(5e3)};this.components.peerStore.get(t,r).then(e=>{for(const r of e.protocols){const e=this.topologies.get(r);if(null!=e)for(const r of e.values())!1!==r.filter?.has(t)&&(r.filter?.remove(t),r.onDisconnect?.(t))}}).catch(e=>{"NotFoundError"!==e.name&&this.log.error("could not inform topologies of disconnecting peer %p",t,e)})}_onPeerUpdate(e){const{peer:t,previous:r}=e.detail,n=(r?.protocols??[]).filter(e=>!t.protocols.includes(e));for(const e of n){const r=this.topologies.get(e);if(null!=r)for(const e of r.values())!1!==e.filter?.has(t.id)&&(e.filter?.remove(t.id),e.onDisconnect?.(t.id))}}_onPeerIdentify(e){const t=e.detail.protocols,r=e.detail.connection,n=e.detail.peerId;for(const e of t){const t=this.topologies.get(e);if(null!=t)for(const e of t.values())null!=r.limits&&!0!==e.notifyOnLimitedConnection||!0!==e.filter?.has(n)&&(e.filter?.add(n),e.onConnect?.(n,r))}}}class bn{log;components;transports;listeners;faultTolerance;started;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=Ft({name:"libp2p_transport_manager_transports",metrics:this.components.metrics}),this.listeners=Ft({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??i.aF.FATAL_ALL}[Symbol.toStringTag]="@libp2p/transport-manager";add(e){const t=e[Symbol.toStringTag];if(null==t)throw new o.gG("Transport must have a valid tag");if(this.transports.has(t))throw new o.gG(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,r]of this.listeners)for(this.log("closing listeners for %s",t);r.length>0;){const t=r.pop();null!=t&&e.push(t.close())}await Promise.all(e),this.log("all listeners closed");for(const e of this.listeners.keys())this.listeners.set(e,[]);this.started=!1}async dial(e,t){const r=this.dialTransportForMultiaddr(e);if(null==r)throw new yr(`No transport available for address ${String(e)}`);return t?.onProgress?.(new b.j("transport-manager:selected-transport",r[Symbol.toStringTag])),r.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(const t of this.listeners.values())for(const r of t)e=[...e,...r.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(const t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(const t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new o.x$("Not started");if(null==e||0===e.length)return void this.log("no addresses were provided for listening, this node is dial only");const t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(e=>{t.errors.set(e.toString(),new ur)});const r=[];for(const[n,s]of this.transports.entries()){const i=s.listenFilter(e);for(const e of i){this.log("creating listener for %s on %a",n,e);const i=s.createListener({upgrader:this.components.upgrader});let o=this.listeners.get(n)??[];null==o&&(o=[],this.listeners.set(n,o)),o.push(i),i.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:i})}),i.addEventListener("close",()=>{const e=o.findIndex(e=>e===i);o.splice(e,1),this.components.events.safeDispatchEvent("transport:close",{detail:i})}),Nt.uM.matches(e)?t.ipv4.attempts++:Nt.ur.matches(e)&&t.ipv6.attempts++,r.push(i.listen(e).then(()=>{t.errors.delete(e.toString()),Nt.uM.matches(e)&&t.ipv4.success++,Nt.ur.matches(e)&&t.ipv6.success++},r=>{throw this.log.error("transport %s could not listen on address %a - %e",n,e,r),t.errors.set(e.toString(),r),r}))}}const n=await Promise.allSettled(r);if(!(n.length>0&&n.every(e=>"fulfilled"===e.status)))if(this.ipv6Unsupported(t))this.log("all IPv4 addresses succeed but all IPv6 failed");else{if(this.faultTolerance!==i.aF.NO_FATAL)throw new hr(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:\n${[...t.errors.entries()].map(([e,t])=>`\n  ${e}: ${`${t.stack??t}`.split("\n").join("\n  ")}\n`).join("")}`);this.log("failed to listen on any address but fault tolerance allows this")}}ipv6Unsupported(e){if(0===e.ipv4.attempts||0===e.ipv6.attempts)return!1;const t=e.ipv4.attempts===e.ipv4.success,r=0===e.ipv6.success;return t&&r}async remove(e){const t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);const r=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){const e=t.pop();null!=e&&r.push(e.close())}await Promise.all(r),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}var vn=r(298),En=r(9820),xn=r(86);const Sn="/multistream/1.0.0",An=1024,In=(0,at.s)("\n");async function Cn(e,t,r){await e.write(t,r)}async function kn(e,t){const r=await async function(e,t){const r=await e.read(t);if(0===r.byteLength||r.get(r.byteLength-1)!==In[0])throw t.log.error("Invalid mss message - missing newline",r),new o.L("Missing newline");return r.sublist(0,-1)}(e,t);return(0,P.d)(r.subarray())}async function Pn(e,t,r){t=Array.isArray(t)?t:[t],r.log.trace("handle: available protocols %s",t);const n=(0,En.V)(e,{...r,maxDataLength:An,maxLengthLength:2});for(;;){r.log.trace("handle: reading incoming string");const e=await kn(n,r);if(r.log.trace('handle: read "%s"',e),e!==Sn){if(t.includes(e))return r.log.trace('handle: respond with "%s" for "%s"',e,e),await Cn(n,(0,at.s)(`${e}\n`),r),r.log.trace('handle: responded with "%s" for "%s"',e,e),{stream:n.unwrap(),protocol:e};if("ls"===e){const s=new xn.I(...t.map(e=>vn.l.single((0,at.s)(`${e}\n`))),(0,at.s)("\n"));r.log.trace('handle: respond with "%s" for %s',t,e),await Cn(n,s,r),r.log.trace('handle: responded with "%s" for %s',t,e);continue}r.log.trace('handle: respond with "na" for "%s"',e),await Cn(n,(0,at.s)("na\n"),r),r.log('handle: responded with "na" for "%s"',e)}else r.log.trace('handle: respond with "%s" for "%s"',Sn,e),await Cn(n,(0,at.s)(`${Sn}\n`),r),r.log.trace('handle: responded with "%s" for "%s"',Sn,e)}}var Tn=r(5082);async function _n(e,t,r){if(1===(t=Array.isArray(t)?[...t]:[t]).length&&!1===r.negotiateFully)return function(e,t,r){const n=e.sink.bind(e),s=e.source;let i=!1,a=!1;const c=(0,mn.A)();let l=!1,u=!1;const h=(0,mn.A)();let d=!1,f=!1;const p=(0,mn.A)(),g=(0,En.V)({sink:n,source:s},{...r,maxDataLength:An});async function m(){if(a)return r.log.trace("optimistic: already negotiating %s stream",t),void await c.promise;a=!0;try{l||(r.log.trace("optimistic: doing send protocol for %s stream",t),await async function(){if(u)await h.promise;else{u=!0;try{r.log.trace('optimistic: write ["%s", "%s", data] in source',Sn,t),await g.writeV([(0,at.s)(`${Sn}\n`),(0,at.s)(`${t}\n`)]),r.log.trace('optimistic: wrote ["%s", "%s", data] in source',Sn,t)}finally{l=!0,u=!1,h.resolve()}}}()),d||(r.log.trace("optimistic: doing read protocol for %s stream",t),await async function(){if(f)await p.promise;else{f=!0;try{r.log.trace("optimistic: reading multistream select header");let e=await kn(g,r);if(r.log.trace('optimistic: read multistream select header "%s"',e),e===Sn&&(e=await kn(g,r)),r.log.trace('optimistic: read protocol "%s", expecting "%s"',e,t),e!==t)throw new o.IM("protocol selection failed")}finally{d=!0,f=!1,p.resolve()}}}())}finally{a=!1,i=!0,c.resolve()}}if(e.sink=async e=>{const{sink:n}=g.unwrap();await n(async function*(){let n=!1;for await(const s of e){if(u&&await h.promise,l)yield s;else{u=!0,r.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',Sn,t,s.byteLength);const e=`${t}\n`;yield new xn.I(Uint8Array.from([19]),(0,at.s)(`${Sn}\n`),Tn.lF(e.length),(0,at.s)(e),s).subarray(),r.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',Sn,t,s.byteLength),l=!0,u=!1,h.resolve(),m().catch(e=>{r.log.error("could not finish optimistic protocol negotiation of %s",t,e)})}n=!0}n||await m()}())},e.source=async function*(){await m(),r.log.trace('optimistic: reading data from "%s" stream',t),yield*g.unwrap().source}(),null!=e.closeRead){const t=e.closeRead.bind(e);e.closeRead=async e=>{i||await m().catch(e=>{r.log.error("could not negotiate protocol before close read",e)}),await t(e)}}if(null!=e.closeWrite){const t=e.closeWrite.bind(e);e.closeWrite=async e=>{i||await m().catch(e=>{r.log.error("could not negotiate protocol before close write",e)}),await t(e)}}if(null!=e.close){const t=e.close.bind(e);e.close=async e=>{const r=[];u&&r.push(h.promise),f&&r.push(p.promise),r.length>0?await(0,xe.W)(Promise.all(r),e?.signal):(i=!0,a=!1,c.resolve()),await t(e)}}return{stream:e,protocol:t}}(e,t[0],r);const n=(0,En.V)(e,{...r,maxDataLength:An}),s=t.shift();if(null==s)throw new Error("At least one protocol must be specified");r.log.trace('select: write ["%s", "%s"]',Sn,s);const i=(0,at.s)(`${Sn}\n`),a=(0,at.s)(`${s}\n`);await async function(e,t,r){await e.writeV(t,r)}(n,[i,a],r),r.log.trace("select: reading multistream-select header");let c=await kn(n,r);if(r.log.trace('select: read "%s"',c),c===Sn&&(r.log.trace("select: reading protocol response"),c=await kn(n,r),r.log.trace('select: read "%s"',c)),c===s)return{stream:n.unwrap(),protocol:s};for(const e of t){r.log.trace('select: write "%s"',e),await Cn(n,(0,at.s)(`${e}\n`),r),r.log.trace("select: reading protocol response");const t=await kn(n,r);if(r.log.trace('select: read "%s" for "%s"',t,e),t===e)return{stream:n.unwrap(),protocol:e}}throw new o.IM("protocol selection failed")}const Dn=Symbol.for("@libp2p/connection");class Ln{id;remoteAddr;remotePeer;direction;timeline;multiplexer;encryption;status;limits;log;tags;_newStream;_close;_abort;_getStreams;constructor(e){const{remoteAddr:t,remotePeer:r,newStream:n,close:s,abort:i,getStreams:o}=e;this.id=`${parseInt(String(1e9*Math.random())).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=r,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),null==this.remoteAddr.getPeerId()&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=n,this._close=s,this._abort=i,this._getStreams=o,this.tags=[]}[Symbol.toStringTag]="Connection";[Dn]=!0;get streams(){return this._getStreams()}async newStream(e,t){if("closing"===this.status)throw new o.qB("the connection is being closed");if("closed"===this.status)throw new o.rb("the connection is closed");if(Array.isArray(e)||(e=[e]),null!=this.limits&&!0!==t?.runOnLimitedConnection)throw new o.lY("Cannot open protocol stream on limited connection");const r=await this._newStream(e,t);return r.direction="outbound",r}async close(e={}){if("closed"!==this.status&&"closing"!==this.status){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",null==e.signal){const t=AbortSignal.timeout(500);(0,Ee.k)(1/0,t),e={...e,signal:t}}try{this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(e){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,e),this.abort(e)}}}abort(e){"closed"!==this.status&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}}function Rn(e,t,r){let n=0;return r.streams.forEach(r=>{r.direction===t&&r.protocol===e&&n++}),n}class Un{components;connectionEncrypters;streamMuxers;inboundUpgradeTimeout;inboundStreamProtocolNegotiationTimeout;outboundStreamProtocolNegotiationTimeout;events;metrics;constructor(e,t){this.components=e,this.connectionEncrypters=Ft({name:"libp2p_upgrader_connection_encrypters",metrics:this.components.metrics}),t.connectionEncrypters.forEach(e=>{this.connectionEncrypters.set(e.protocol,e)}),this.streamMuxers=Ft({name:"libp2p_upgrader_stream_multiplexers",metrics:this.components.metrics}),t.streamMuxers.forEach(e=>{this.streamMuxers.set(e.protocol,e)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??1e4,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??1e4,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??1e4,this.events=e.events,this.metrics={dials:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dial_errors_total"),inboundErrors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_inbound_errors_total"),outboundErrors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_outbound_errors_total")}}[Symbol.toStringTag]="@libp2p/upgrader";async shouldBlockConnection(e,...t){const r=this.components.connectionGater[e];if(null!=r&&!0===await r.apply(this.components.connectionGater,t))throw new fr(`The multiaddr connection is blocked by gater.${e}`)}createInboundAbortSignal(e){const t=(0,qr.J)([AbortSignal.timeout(this.inboundUpgradeTimeout),e]);return(0,Ee.k)(1/0,t),t}async upgradeInbound(e,t){let r=!1;const n=this.createInboundAbortSignal(t.signal);try{if(this.metrics.dials?.increment({inbound:!0}),r=await(0,xe.W)(this.components.connectionManager.acceptIncomingConnection(e),n),!r)throw new pr("Connection denied");await(0,xe.W)(this.shouldBlockConnection("denyInboundConnection",e),n),await this._performUpgrade(e,"inbound",{...t,signal:n})}catch(e){throw this.metrics.errors?.increment({inbound:!0}),this.metrics.inboundErrors?.increment({[e.name??"Error"]:!0}),e}finally{n.clear(),r&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){try{this.metrics.dials?.increment({outbound:!0});const r=e.remoteAddr.getPeerId();let n;null!=r&&(n=(0,s.XL)(r),await(0,xe.W)(this.shouldBlockConnection("denyOutboundConnection",n,e),t.signal));let i="outbound";return!1===t.initiator&&(i="inbound"),await this._performUpgrade(e,i,t)}catch(e){throw this.metrics.errors?.increment({outbound:!0}),this.metrics.outboundErrors?.increment({[e.name??"Error"]:!0}),e}}async _performUpgrade(e,t,r){let n,i,a,c,l;this.components.metrics?.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let u=e;if(!0!==r?.skipProtection){const n=this.components.connectionProtector;null!=n&&(e.log("protecting the %s connection",t),u=await n.protect(e,r))}try{if(n=u,!0!==r?.skipEncryption){r?.onProgress?.(new b.j(`upgrader:encrypt-${t}-connection`)),({conn:n,remotePeer:i,protocol:l,streamMuxer:c}=await("inbound"===t?this._encryptInbound(u,r):this._encryptOutbound(u,r)));const e={...u,...n};await this.shouldBlockConnection("inbound"===t?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",i,e)}else{const r=e.remoteAddr.getPeerId();if(null==r)throw new o.Ci(`${t} connection that skipped encryption must have a peer id`);const n=(0,s.XL)(r);l="native",i=n}if(i.equals(this.components.peerId)){const t=new o.B6("Can not dial self");throw e.abort(t),t}if(a=n,null!=r?.muxerFactory)c=r.muxerFactory;else if(null==c&&this.streamMuxers.size>0){r?.onProgress?.(new b.j(`upgrader:multiplex-${t}-connection`));const e=await("inbound"===t?this._multiplexInbound({...u,...n},this.streamMuxers,r):this._multiplexOutbound({...u,...n},this.streamMuxers,r));c=e.muxerFactory,a=e.stream}}catch(r){throw e.log.error("failed to upgrade inbound connection %s %a - %e","inbound"===t?"from":"to",e.remoteAddr,r),r}return await this.shouldBlockConnection("inbound"===t?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",i,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:l,direction:t,maConn:e,upgradedConn:a,muxerFactory:c,remotePeer:i,limits:r?.limits})}_createConnection(e){const{cryptoProtocol:t,direction:r,maConn:n,upgradedConn:s,remotePeer:i,muxerFactory:a,limits:c}=e;let l,u,h;null!=a&&(l=a.createStreamMuxer({direction:r,onIncomingStream:e=>{if(null==h)return;const t=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout);(0,Ee.k)(1/0,t),Promise.resolve().then(async()=>{const r=this.components.registrar.getProtocols(),{stream:n,protocol:s}=await Pn(e,r,{signal:t,log:e.log,yieldBytes:!1});if(null==h)return;h.log("incoming stream opened on %s",s);const a=function(e,t){try{const{options:r}=t.getHandler(e);return r.maxInboundStreams}catch(e){if("UnhandledProtocolError"!==e.name)throw e}return 32}(s,this.components.registrar);if(Rn(s,"inbound",h)===a){const t=new o.q7(`Too many inbound protocol streams for protocol "${s}" - limit ${a}`);throw e.abort(t),t}e.source=n.source,e.sink=n.sink,e.protocol=s,null!=n.closeWrite&&(e.closeWrite=n.closeWrite),null!=n.closeRead&&(e.closeRead=n.closeRead),null!=n.close&&(e.close=n.close),await this.components.peerStore.merge(i,{protocols:[s]},{signal:t}),this.components.metrics?.trackProtocolStream(e,h),this._onStream({connection:h,stream:e,protocol:s})}).catch(async r=>{h.log.error("error handling incoming stream id %s - %e",e.id,r),null==e.timeline.close&&await e.close({signal:t}).catch(t=>e.abort(t))})}}),u=async(t,n={})=>{if(null==l)throw new gr("Connection is not multiplexed");h.log.trace("starting new stream for protocols %s",t);const s=await l.newStream();h.log.trace("started new stream %s for protocols %s",s.id,t);try{if(null==n.signal){s.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",t);const e=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);(0,Ee.k)(1/0,e),n={...n,signal:e}}s.log.trace("selecting protocol from protocols %s",t);const{stream:e,protocol:r}=await _n(s,t,{...n,log:s.log,yieldBytes:!0});s.log.trace("selected protocol %s",r);const a=function(e,t,r={}){try{const{options:r}=t.getHandler(e);if(null!=r.maxOutboundStreams)return r.maxOutboundStreams}catch(e){if("UnhandledProtocolError"!==e.name)throw e}return r.maxOutboundStreams??64}(r,this.components.registrar,n),c=Rn(r,"outbound",h);if(c>=a){const e=new o.NJ(`Too many outbound protocol streams for protocol "${r}" - ${c}/${a}`);throw s.abort(e),e}return await this.components.peerStore.merge(i,{protocols:[r]}),s.source=e.source,s.sink=e.sink,s.protocol=r,null!=e.closeWrite&&(s.closeWrite=e.closeWrite),null!=e.closeRead&&(s.closeRead=e.closeRead),null!=e.close&&(s.close=e.close),this.components.metrics?.trackProtocolStream(s,h),s}catch(n){throw h.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e","inbound"===r?"from":"to",e.maConn.remoteAddr,t,n),null==s.timeline.close&&s.abort(n),n}},Promise.all([l.sink(s.source),s.sink(l.source)]).catch(e=>{h.log.error("error piping data through muxer - %e",e)}));const d=n.timeline;var f;return n.timeline=new Proxy(d,{set:(...e)=>("close"===e[1]&&null!=e[2]&&null==d.close&&(async()=>{try{"open"===h.status&&await h.close()}catch(e){h.log.error("error closing connection after timeline close %e",e)}finally{this.events.safeDispatchEvent("connection:close",{detail:h})}})().catch(e=>{h.log.error("error thrown while dispatching connection:close event %e",e)}),Reflect.set(...e))}),n.timeline.upgraded=Date.now(),f={remoteAddr:n.remoteAddr,remotePeer:i,status:"open",direction:r,timeline:n.timeline,multiplexer:l?.protocol,encryption:t,limits:c,logger:this.components.logger,newStream:u??(()=>{throw new gr("Connection is not multiplexed")}),getStreams:()=>l?.streams??[],close:async e=>{await(l?.close(e)),await n.close(e)},abort:e=>{n.abort(e),l?.abort(e)}},h=new Ln(f),this.events.safeDispatchEvent("connection:open",{detail:h}),h.__maConnTimeline=d,h}_onStream(e){const{connection:t,stream:r,protocol:n}=e,{handler:s,options:i}=this.components.registrar.getHandler(n);if(null!=t.limits&&!0!==i.runOnLimitedConnection)throw new o.lY("Cannot open protocol stream on limited connection");s({connection:t,stream:r})}async _encryptInbound(e,t){const r=Array.from(this.connectionEncrypters.keys());try{const{stream:n,protocol:s}=await Pn(e,r,{...t,log:e.log}),i=this.connectionEncrypters.get(s);if(null==i)throw new mr(`no crypto module found for ${s}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,s),{...await i.secureInbound(n,t),protocol:s}}catch(t){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,t),new mr(t.message)}}async _encryptOutbound(e,t){const r=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",r);const{stream:n,protocol:s}=await _n(e,r,{...t,log:e.log,yieldBytes:!0}),i=this.connectionEncrypters.get(s);if(null==i)throw new mr(`no crypto module found for ${s}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,s),{...await i.secureOutbound(n,t),protocol:s}}catch(t){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,t),new mr(t.message)}}async _multiplexOutbound(e,t,r){const n=Array.from(t.keys());e.log("outbound selecting muxer %s",n);try{e.log.trace("selecting stream muxer from %s",n);const{stream:s,protocol:i}=await _n(e,n,{...r,log:e.log,yieldBytes:!0});return e.log("selected %s as muxer protocol",i),{stream:s,muxerFactory:t.get(i)}}catch(t){throw e.log.error("error multiplexing outbound connection",t),new gr(String(t))}}async _multiplexInbound(e,t,r){const n=Array.from(t.keys());e.log("inbound handling muxers %s",n);try{const{stream:s,protocol:i}=await Pn(e,n,{...r,log:e.log});return{stream:s,muxerFactory:t.get(i)}}catch(t){throw e.log.error("error multiplexing inbound connection",t),new gr(String(t))}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}const Mn="2.8.11",Bn="js-libp2p";class Nn extends we.X{peerId;peerStore;contentRouting;peerRouting;metrics;services;logger;status;components;log;constructor(e){super(),this.status="stopped";const t=new we.X,r=t.dispatchEvent.bind(t);t.dispatchEvent=e=>{const t=r(e),n=this.dispatchEvent(new CustomEvent(e.type,{detail:e.detail}));return t||n},(0,Ee.k)(1/0,t),this.peerId=e.peerId,this.logger=e.logger??oe(),this.log=this.logger.forComponent("libp2p"),this.services={};const n=e.nodeInfo?.name??Bn,s=e.nodeInfo?.version??Mn,i=this.components=function(e={}){const t=new wr(e);return new Proxy(t,{get(e,r,n){if("string"==typeof r&&!vr.includes(r)){const e=t.components[r];if(null==e&&!br.includes(r))throw new rr(`${r} not set`);return e}return Reflect.get(e,r,n)},set:(e,r,n)=>("string"==typeof r?t.components[r]=n:Reflect.set(e,r,n),!0)})}({peerId:e.peerId,privateKey:e.privateKey,nodeInfo:{name:n,version:s,userAgent:e.nodeInfo?.userAgent??(o=n,a=s,`${o??Bn}/${a??Mn} browser/${globalThis.navigator.userAgent}`)},logger:this.logger,events:t,datastore:e.datastore??new Dt,connectionGater:Ar(e.connectionGater),dns:e.dns});var o,a;null!=e.metrics&&(this.metrics=this.configureComponent("metrics",e.metrics(this.components))),this.peerStore=this.configureComponent("peerStore",function(e,t={}){return new St(e,t)}(i,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore})),i.events.addEventListener("peer:update",e=>{if(null==e.detail.previous){const t={id:e.detail.peer.id,multiaddrs:e.detail.peer.addresses.map(e=>e.multiaddr)};i.events.safeDispatchEvent("peer:discovery",{detail:t})}}),null!=e.connectionProtector&&this.configureComponent("connectionProtector",e.connectionProtector(i)),this.components.upgrader=new Un(this.components,{connectionEncrypters:(e.connectionEncrypters??[]).map((e,t)=>this.configureComponent(`connection-encryption-${t}`,e(this.components))),streamMuxers:(e.streamMuxers??[]).map((e,t)=>this.configureComponent(`stream-muxers-${t}`,e(this.components))),inboundUpgradeTimeout:e.connectionManager?.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:e.connectionManager?.inboundStreamProtocolNegotiationTimeout??e.connectionManager?.protocolNegotiationTimeout,outboundStreamProtocolNegotiationTimeout:e.connectionManager?.outboundStreamProtocolNegotiationTimeout??e.connectionManager?.protocolNegotiationTimeout}),this.configureComponent("transportManager",new bn(this.components,e.transportManager)),this.configureComponent("connectionManager",new on(this.components,e.connectionManager)),!1!==e.connectionMonitor?.enabled&&this.configureComponent("connectionMonitor",new hn(this.components,e.connectionMonitor)),this.configureComponent("registrar",new wn(this.components)),this.configureComponent("addressManager",new Xt(this.components,e.addresses));const c=(e.peerRouters??[]).map((e,t)=>this.configureComponent(`peer-router-${t}`,e(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new gn(this.components,{routers:c}));const l=(e.contentRouters??[]).map((e,t)=>this.configureComponent(`content-router-${t}`,e(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new fn(this.components,{routers:l})),this.configureComponent("randomWalk",new yn(this.components)),(e.peerDiscovery??[]).forEach((e,t)=>{this.configureComponent(`peer-discovery-${t}`,e(this.components)).addEventListener("peer",e=>{this.#U(e)})}),e.transports?.forEach((e,t)=>{this.components.transportManager.add(this.configureComponent(`transport-${t}`,e(this.components)))}),null!=e.services)for(const t of Object.keys(e.services)){const r=(0,e.services[t])(this.components);null!=r?(this.services[t]=r,this.configureComponent(t,r),null!=r[j]&&(this.log("registering service %s for content routing",t),l.push(r[j])),null!=r[V]&&(this.log("registering service %s for peer routing",t),c.push(r[V])),null!=r[H]&&(this.log("registering service %s for peer discovery",t),r[H].addEventListener?.("peer",e=>{this.#U(e)}))):this.log.error("service factory %s returned null or undefined instance",t)}!function(e){const t={};for(const r of Object.values(e.components))for(const e of Er(r))t[e]=!0;for(const r of Object.values(e.components))for(const e of xr(r))if(!0!==t[e])throw new nr(`Service "${Sr(r)}" required capability "${e}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}(i)}configureComponent(e,t){return null==t&&this.log.error("component %s was null or undefined",e),this.components[e]=t,t}async start(){if("stopped"===this.status){this.status="starting",this.log("libp2p is starting");try{await(this.components.beforeStart?.()),await this.components.start(),await(this.components.afterStart?.()),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(e){throw this.log.error("An error occurred starting libp2p",e),this.status="started",await this.stop(),e}}}async stop(){"started"===this.status&&(this.log("libp2p is stopping"),this.status="stopping",await(this.components.beforeStop?.()),await this.components.stop(),await(this.components.afterStop?.()),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(e){return this.components.connectionManager.getConnections(e)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const e=new le;for(const t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e,t={}){return this.components.connectionManager.openConnection(e,{priority:75,...t})}async dialProtocol(e,t,r={}){if(null==t)throw new o.gG("no protocols were provided to open a stream");if(0===(t=Array.isArray(t)?t:[t]).length)throw new o.gG("no protocols were provided to open a stream");return(await this.dial(e,r)).newStream(t,r)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(e,t={}){(0,M.R8)(e)&&(e=(0,s.XL)(e.getPeerId()??"")),await this.components.connectionManager.closeConnections(e,t)}async getPublicKey(e,t={}){if(this.log("getPublicKey %p",e),null!=e.publicKey)return e.publicKey;try{const r=await this.peerStore.get(e,t);if(null!=r.id.publicKey)return r.id.publicKey}catch(e){if("NotFoundError"!==e.name)throw e}const r=(0,Lt.x)([(0,at.s)("/pk/"),e.toMultihash().bytes]),s=await this.contentRouting.get(r,t),i=(0,n.EZ)(s);return await this.peerStore.patch(e,{publicKey:i},t),i}async handle(e,t,r){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async e=>{await this.components.registrar.handle(e,t,r)}))}async unhandle(e,t){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async e=>{await this.components.registrar.unhandle(e,t)}))}async register(e,t,r){return this.components.registrar.register(e,t,r)}unregister(e){this.components.registrar.unregister(e)}async isDialable(e,t={}){return this.components.connectionManager.isDialable(e,t)}#U(e){const{detail:t}=e;t.id.toString()!==this.peerId.toString()?this.components.peerStore.merge(t.id,{multiaddrs:t.multiaddrs}).catch(e=>{this.log.error(e)}):this.log.error("peer discovery mechanism discovered self")}}async function On(e={}){e.privateKey??=await(0,n.TZ)("Ed25519");const t=new Nn({...await $(e),peerId:(0,s.Ug)(e.privateKey)});return!1!==e.start&&await t.start(),t}},7884:(e,t,r)=>{"use strict";r.d(t,{w:()=>i});var n=r(4597);class s extends n.Vw{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,(0,n.sd)(e);const r=(0,n.ZJ)(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(r.length>s?e.create().update(r).digest():r);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),(0,n.uH)(i)}update(e){return(0,n.CC)(this),this.iHash.update(e),this}digestInto(e){(0,n.CC)(this),(0,n.DO)(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:n,destroyed:s,blockLen:i,outputLen:o}=this;return e.finished=n,e.destroyed=s,e.blockLen=i,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const i=(e,t,r)=>new s(e,t).update(r).digest();i.create=(e,t)=>new s(e,t)},7908:(e,t,r)=>{"use strict";r.d(t,{zI:()=>uo,Ve:()=>lo});var n={};r.r(n),r.d(n,{base10:()=>z});var s={};r.r(s),r.d(s,{base16:()=>K,base16upper:()=>$});var i={};r.r(i),r.d(i,{base2:()=>j});var o={};r.r(o),r.d(o,{base256emoji:()=>W});var a={};r.r(a),r.d(a,{base32:()=>Z,base32hex:()=>J,base32hexpad:()=>te,base32hexpadupper:()=>re,base32hexupper:()=>ee,base32pad:()=>Q,base32padupper:()=>X,base32upper:()=>Y,base32z:()=>ne});var c={};r.r(c),r.d(c,{base36:()=>se,base36upper:()=>ie});var l={};r.r(l),r.d(l,{base58btc:()=>oe,base58flickr:()=>ae});var u={};r.r(u),r.d(u,{base64:()=>ce,base64pad:()=>le,base64url:()=>ue,base64urlpad:()=>he});var h={};r.r(h),r.d(h,{base8:()=>de});var d={};r.r(d),r.d(d,{identity:()=>fe});var f={};r.r(f),r.d(f,{code:()=>ye,decode:()=>be,encode:()=>we,name:()=>me});var p={};r.r(p),r.d(p,{code:()=>Ee,decode:()=>Se,encode:()=>xe,name:()=>ve});var g={};r.r(g),r.d(g,{identity:()=>$e});var m={};r.r(m),r.d(m,{sha256:()=>Ge,sha512:()=>We}),Error,Error,Error;class y extends Error{static name="InvalidParametersError";constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}}class w extends Error{static name="InvalidPublicKeyError";constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}class b extends Error{static name="InvalidPrivateKeyError";constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}}Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error,Error;const v="1.2.840.10045.3.1.7",E="1.3.132.0.34",x="1.3.132.0.35";function S(e=0){return new Uint8Array(e)}function A(e=0){return new Uint8Array(e)}function I(e,t){null==t&&(t=e.reduce((e,t)=>e+t.length,0));const r=A(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}function C(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}const k=Symbol.for("@achingbrain/uint8arraylist");function P(e,t){if(null==t||t<0)throw new RangeError("index is out of bounds");let r=0;for(const n of e){const e=r+n.byteLength;if(t<e)return{buf:n,index:t-r};r=e}throw new RangeError("index is out of bounds")}function T(e){return Boolean(e?.[k])}class _{bufs;length;[k]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const r of e)if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.push(r);else{if(!T(r))throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");t+=r.byteLength,this.bufs.push(...r.bufs)}this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const r of e.reverse())if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.unshift(r);else{if(!T(r))throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");t+=r.byteLength,this.bufs.unshift(...r.bufs)}this.length+=t}get(e){const t=P(this.bufs,e);return t.buf[t.index]}set(e,t){const r=P(this.bufs,e);r.buf[r.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let r=0;r<e.length;r++)this.set(t+r,e[r]);else{if(!T(e))throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList");for(let r=0;r<e.length;r++)this.set(t+r,e.get(r))}}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength)return this.bufs=[],void(this.length=0);for(;this.bufs.length>0;){if(!(e>=this.bufs[0].byteLength)){this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift()}}}slice(e,t){const{bufs:r,length:n}=this._subList(e,t);return I(r,n)}subarray(e,t){const{bufs:r,length:n}=this._subList(e,t);return 1===r.length?r[0]:I(r,n)}sublist(e,t){const{bufs:r,length:n}=this._subList(e,t),s=new _;return s.length=n,s.bufs=[...r],s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(0===e&&t===this.length)return{bufs:this.bufs,length:this.length};const r=[];let n=0;for(let s=0;s<this.bufs.length;s++){const i=this.bufs[s],o=n,a=o+i.byteLength;if(n=a,e>=a)continue;const c=e>=o&&e<a,l=t>o&&t<=a;if(c&&l){if(e===o&&t===a){r.push(i);break}const n=e-o;r.push(i.subarray(n,n+(t-e)));break}if(c){if(0===e){r.push(i);continue}r.push(i.subarray(e-o))}else{if(l){if(t===a){r.push(i);break}r.push(i.subarray(0,t-o));break}r.push(i)}}return{bufs:r,length:t-e}}indexOf(e,t=0){if(!(T(e)||e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const r=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;const n=r.byteLength;if(0===n)throw new TypeError("search must be at least 1 byte long");const s=new Int32Array(256);for(let e=0;e<256;e++)s[e]=-1;for(let e=0;e<n;e++)s[r[e]]=e;const i=s,o=this.byteLength-r.byteLength,a=r.byteLength-1;let c;for(let e=t;e<=o;e+=c){c=0;for(let t=a;t>=0;t--){const n=this.get(e+t);if(r[t]!==n){c=Math.max(1,t-i[n]);break}}if(0===c)return e}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const r=A(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt8(0,t),this.write(r,e)}getInt16(e,t){const r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt16(0,t)}setInt16(e,t,r){const n=S(2);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt16(0,t,r),this.write(n,e)}getInt32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt32(0,t)}setInt32(e,t,r){const n=S(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt32(0,t,r),this.write(n,e)}getBigInt64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigInt64(0,t)}setBigInt64(e,t,r){const n=S(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setBigInt64(0,t,r),this.write(n,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const r=A(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint8(0,t),this.write(r,e)}getUint16(e,t){const r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,t)}setUint16(e,t,r){const n=S(2);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint16(0,t,r),this.write(n,e)}getUint32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint32(0,t)}setUint32(e,t,r){const n=S(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(0,t,r),this.write(n,e)}getBigUint64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigUint64(0,t)}setBigUint64(e,t,r){const n=S(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setBigUint64(0,t,r),this.write(n,e)}getFloat32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat32(0,t)}setFloat32(e,t,r){const n=S(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setFloat32(0,t,r),this.write(n,e)}getFloat64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat64(0,t)}setFloat64(e,t,r){const n=S(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setFloat64(0,t,r),this.write(n,e)}equals(e){if(null==e)return!1;if(!(e instanceof _))return!1;if(e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!C(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const r=new _;return r.bufs=e,null==t&&(t=e.reduce((e,t)=>e+t.byteLength,0)),r.length=t,r}}function D(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}new Uint8Array(0);const L=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(255!==r[o])throw new TypeError(i+" is ambiguous");r[o]=s}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,s=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*l+1>>>0,o=new Uint8Array(i);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=i-1;(0!==u||h<s)&&-1!==d;d--,h++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");s=h,t++}if(" "!==e[t]){for(var f=i-s;f!==i&&0===o[f];)f++;for(var p=new Uint8Array(n+(i-f)),g=n;f!==i;)p[g++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,s=0,i=t.length;s!==i&&0===t[s];)s++,r++;for(var o=(i-s)*u+1>>>0,l=new Uint8Array(o);s!==i;){for(var h=t[s],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,s++}for(var p=o-n;p!==o&&0===l[p];)p++;for(var g=c.repeat(r);p<o;++p)g+=e.charAt(l[p]);return g},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}};class R{name;prefix;baseEncode;constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class U{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,r){this.name=e,this.prefix=t;const n=t.codePointAt(0);if(void 0===n)throw new Error("Invalid prefix character");this.prefixCodePoint=n,this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return B(this,e)}}class M{decoders;constructor(e){this.decoders=e}or(e){return B(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(null!=r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function B(e,t){return new M({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}class N{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new R(e,t,r),this.decoder=new U(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function O({name:e,prefix:t,encode:r,decode:n}){return new N(e,t,r,n)}function F({name:e,prefix:t,alphabet:r}){const{encode:n,decode:s}=L(r,e);return O({prefix:t,name:e,encode:n,decode:e=>D(s(e))})}function q({name:e,prefix:t,bitsPerChar:r,alphabet:n}){return O({prefix:t,name:e,encode:e=>function(e,t,r){const n="="===t[t.length-1],s=(1<<r)-1;let i="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,i+=t[s&a>>o];if(0!==o&&(i+=t[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i}(e,n,r),decode:t=>function(e,t,r,n){const s={};for(let e=0;e<t.length;++e)s[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,l=0;for(let t=0;t<i;++t){const i=s[e[t]];if(void 0===i)throw new SyntaxError(`Non-${n} character`);c=c<<r|i,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}(t,n,r,e)})}const z=F({prefix:"9",name:"base10",alphabet:"0123456789"}),K=q({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),$=q({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),j=q({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),V=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),H=V.reduce((e,t,r)=>(e[r]=t,e),[]),G=V.reduce((e,t,r)=>{const n=t.codePointAt(0);if(null==n)throw new Error(`Invalid character: ${t}`);return e[n]=r,e},[]),W=O({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce((e,t)=>e+H[t],"")},decode:function(e){const t=[];for(const r of e){const e=r.codePointAt(0);if(null==e)throw new Error(`Invalid character: ${r}`);const n=G[e];if(null==n)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}}),Z=q({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Y=q({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Q=q({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),X=q({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),J=q({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ee=q({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),te=q({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),re=q({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ne=q({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),se=F({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ie=F({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),oe=F({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ae=F({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),ce=q({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),le=q({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ue=q({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),he=q({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),de=q({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),fe=O({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>function(e){return(new TextEncoder).encode(e)}(e)}),pe=new TextEncoder,ge=new TextDecoder,me="json",ye=512;function we(e){return pe.encode(JSON.stringify(e))}function be(e){return JSON.parse(ge.decode(e))}const ve="raw",Ee=85;function xe(e){return D(e)}function Se(e){return D(e)}var Ae=128,Ie=-128,Ce=Math.pow(2,31),ke=Math.pow(2,7),Pe=Math.pow(2,14),Te=Math.pow(2,21),_e=Math.pow(2,28),De=Math.pow(2,35),Le=Math.pow(2,42),Re=Math.pow(2,49),Ue=Math.pow(2,56),Me=Math.pow(2,63);const Be=function e(t,r,n){r=r||[];for(var s=n=n||0;t>=Ce;)r[n++]=255&t|Ae,t/=128;for(;t&Ie;)r[n++]=255&t|Ae,t>>>=7;return r[n]=0|t,e.bytes=n-s+1,r},Ne=function(e){return e<ke?1:e<Pe?2:e<Te?3:e<_e?4:e<De?5:e<Le?6:e<Re?7:e<Ue?8:e<Me?9:10};function Oe(e,t,r=0){return Be(e,t,r),t}function Fe(e){return Ne(e)}function qe(e,t){const r=t.byteLength,n=Fe(e),s=n+Fe(r),i=new Uint8Array(s+r);return Oe(e,i,0),Oe(r,i,n),i.set(t,s),new ze(e,r,t,i)}class ze{code;size;digest;bytes;constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Ke=D,$e={code:0,name:"identity",encode:Ke,digest:function(e){return qe(0,Ke(e))}};function je({name:e,code:t,encode:r}){return new Ve(e,t,r)}class Ve{name;code;encode;constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?qe(this.code,t):t.then(e=>qe(this.code,e))}throw Error("Unknown type, must be binary type")}}function He(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}const Ge=je({name:"sha2-256",code:18,encode:He("SHA-256")}),We=je({name:"sha2-512",code:19,encode:He("SHA-512")});new WeakMap,Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"),Symbol.for("@ipld/js-cid/CID");const Ze={...d,...i,...h,...n,...s,...a,...c,...l,...u,...o};function Ye(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Qe=Ye("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>(new TextEncoder).encode(e.substring(1))),Xe=Ye("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{const t=A((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),Je={utf8:Qe,"utf-8":Qe,hex:Ze.base16,latin1:Xe,ascii:Xe,binary:Xe,...Ze};function et(e,t="utf8"){const r=Je[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}function tt(e,t="utf8"){const r=Je[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}const rt=parseInt("11111",2),nt=parseInt("10000000",2),st=parseInt("01111111",2),it={0:ct,1:ct,2:function(e,t){const r=at(e,t),n=t.offset,s=t.offset+r,i=[];for(let t=n;t<s;t++)t===n&&0===e[t]||i.push(e[t]);return t.offset+=r,Uint8Array.from(i)},3:function(e,t){const r=at(e,t),n=e[t.offset];t.offset++;const s=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,0!==n)throw new Error("Unused bits in bit string is unimplemented");return s},4:function(e,t){const r=at(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n},5:function(e,t){return t.offset++,null},6:function(e,t){const r=at(e,t),n=t.offset+r,s=e[t.offset];t.offset++;let i=0,o=0;s<40?(i=0,o=s):s<80?(i=1,o=s-40):(i=2,o=s-80);let a=`${i}.${o}`,c=[];for(;t.offset<n;){const r=e[t.offset];if(t.offset++,c.push(127&r),r<128){c.reverse();let e=0;for(let t=0;t<c.length;t++)e+=c[t]<<7*t;a+=`.${e}`,c=[]}}return a},16:ct,22:ct,48:ct};function ot(e,t={offset:0}){const r=e[t.offset]&rt;if(t.offset++,null!=it[r])return it[r](e,t);throw new Error("No decoder for tag "+r)}function at(e,t){let r=0;if((e[t.offset]&nt)===nt){const n=e[t.offset]&st;let s="0x";t.offset++;for(let r=0;r<n;r++,t.offset++)s+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(s,16)}else r=e[t.offset],t.offset++;return r}function ct(e,t){at(e,t);const r=[];for(;!(t.offset>=e.byteLength);){const n=ot(e,t);if(null===n)break;r.push(n)}return r}function lt(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);const t=function(e){let t=e.toString(16);t.length%2==1&&(t="0"+t);const r=new _;for(let e=0;e<t.length;e+=2)r.append(Uint8Array.from([parseInt(`${t[e]}${t[e+1]}`,16)]));return r}(e.byteLength);return new _(Uint8Array.from([t.byteLength|nt]),t)}function ut(e){const t=new _;return!(128&~e.subarray()[0])&&t.append(Uint8Array.from([0])),t.append(e),new _(Uint8Array.from([2]),lt(t),t)}function ht(e){const t=Uint8Array.from([0]),r=new _(t,e);return new _(Uint8Array.from([3]),lt(r),r)}function dt(e,t=48){const r=new _;for(const t of e)r.append(t);return new _(Uint8Array.from([t]),lt(r),r)}function ft(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}new Uint8Array(0);const pt=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(255!==r[o])throw new TypeError(i+" is ambiguous");r[o]=s}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,s=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*l+1>>>0,o=new Uint8Array(i);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=i-1;(0!==u||h<s)&&-1!==d;d--,h++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");s=h,t++}if(" "!==e[t]){for(var f=i-s;f!==i&&0===o[f];)f++;for(var p=new Uint8Array(n+(i-f)),g=n;f!==i;)p[g++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,s=0,i=t.length;s!==i&&0===t[s];)s++,r++;for(var o=(i-s)*u+1>>>0,l=new Uint8Array(o);s!==i;){for(var h=t[s],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,s++}for(var p=o-n;p!==o&&0===l[p];)p++;for(var g=c.repeat(r);p<o;++p)g+=e.charAt(l[p]);return g},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}};class gt{name;prefix;baseEncode;constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class mt{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,r){this.name=e,this.prefix=t;const n=t.codePointAt(0);if(void 0===n)throw new Error("Invalid prefix character");this.prefixCodePoint=n,this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return wt(this,e)}}class yt{decoders;constructor(e){this.decoders=e}or(e){return wt(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(null!=r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function wt(e,t){return new yt({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}class bt{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new gt(e,t,r),this.decoder=new mt(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function vt({name:e,prefix:t,encode:r,decode:n}){return new bt(e,t,r,n)}function Et({name:e,prefix:t,alphabet:r}){const{encode:n,decode:s}=pt(r,e);return vt({prefix:t,name:e,encode:n,decode:e=>ft(s(e))})}function xt({name:e,prefix:t,bitsPerChar:r,alphabet:n}){const s=function(e){const t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}(n);return vt({prefix:t,name:e,encode:e=>function(e,t,r){const n="="===t[t.length-1],s=(1<<r)-1;let i="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,i+=t[s&a>>o];if(0!==o&&(i+=t[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i}(e,n,r),decode:t=>function(e,t,r,n){let s=e.length;for(;"="===e[s-1];)--s;const i=new Uint8Array(s*r/8|0);let o=0,a=0,c=0;for(let l=0;l<s;++l){const s=t[e[l]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);a=a<<r|s,o+=r,o>=8&&(o-=8,i[c++]=255&a>>o)}if(o>=r||255&a<<8-o)throw new SyntaxError("Unexpected end of data");return i}(t,s,r,e)})}const St=Et({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),At=(Et({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),xt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5})),It=(xt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),xt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),xt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),xt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),xt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),xt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),xt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),xt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Et({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}));Et({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ct=128,kt=-128,Pt=Math.pow(2,31),Tt=128,_t=127,Dt=Math.pow(2,7),Lt=Math.pow(2,14),Rt=Math.pow(2,21),Ut=Math.pow(2,28),Mt=Math.pow(2,35),Bt=Math.pow(2,42),Nt=Math.pow(2,49),Ot=Math.pow(2,56),Ft=Math.pow(2,63);const qt={encode:function e(t,r,n){r=r||[];for(var s=n=n||0;t>=Pt;)r[n++]=255&t|Ct,t/=128;for(;t&kt;)r[n++]=255&t|Ct,t>>>=7;return r[n]=0|t,e.bytes=n-s+1,r},decode:function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(n&_t)<<i:(n&_t)*Math.pow(2,i),i+=7}while(n>=Tt);return e.bytes=o-r,s},encodingLength:function(e){return e<Dt?1:e<Lt?2:e<Rt?3:e<Ut?4:e<Mt?5:e<Bt?6:e<Nt?7:e<Ot?8:e<Ft?9:10}};function zt(e,t=0){return[qt.decode(e,t),qt.decode.bytes]}function Kt(e,t,r=0){return qt.encode(e,t,r),t}function $t(e){return qt.encodingLength(e)}function jt(e,t){const r=t.byteLength,n=$t(e),s=n+$t(r),i=new Uint8Array(s+r);return Kt(e,i,0),Kt(r,i,n),i.set(t,s),new Vt(e,r,t,i)}class Vt{code;size;digest;bytes;constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}function Ht(e,t){const{bytes:r,version:n}=e;return 0===n?function(e,t,r){const{prefix:n}=r;if(n!==St.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const s=t.get(n);if(null==s){const s=r.encode(e).slice(1);return t.set(n,s),s}return s}(r,Wt(e),t??St.encoder):function(e,t,r){const{prefix:n}=r,s=t.get(n);if(null==s){const s=r.encode(e);return t.set(n,s),s}return s}(r,Wt(e),t??At.encoder)}const Gt=new WeakMap;function Wt(e){const t=Gt.get(e);if(null==t){const t=new Map;return Gt.set(e,t),t}return t}class Zt{code;version;multihash;bytes;"/";constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Yt)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Qt)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Zt.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=jt(e,t);return Zt.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Zt.equals(this,e)}static equals(e,t){const r=t;return null!=r&&e.code===r.code&&e.version===r.version&&function(e,t){if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}(e.bytes,r.bytes)}}(e.multihash,r.multihash)}toString(e){return Ht(this,e)}toJSON(){return{"/":Ht(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Zt)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:s}=t;return new Zt(e,r,n,s??Xt(e,r,n.bytes))}if(!0===t[Jt]){const{version:e,multihash:r,code:n}=t,s=function(e){const t=ft(e),[r,n]=zt(t),[s,i]=zt(t.subarray(n)),o=t.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new Vt(r,s,o,t)}(r);return Zt.create(e,n,s)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==Yt)throw new Error(`Version 0 CID must use dag-pb (code: ${Yt}) block encoding`);return new Zt(e,t,r,r.bytes);case 1:{const n=Xt(e,t,r.bytes);return new Zt(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Zt.create(0,Yt,e)}static createV1(e,t){return Zt.create(1,e,t)}static decode(e){const[t,r]=Zt.decodeFirst(e);if(0!==r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Zt.inspectBytes(e),r=t.size-t.multihashSize,n=ft(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=n.subarray(t.multihashSize-t.digestSize),i=new Vt(t.multihashCode,t.digestSize,s,n);return[0===t.version?Zt.createV0(i):Zt.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=zt(e.subarray(t));return t+=n,r};let n=r(),s=Yt;if(18===n?(n=0,t=0):s=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,o=r(),a=r(),c=t+a;return{version:n,codec:s,multihashCode:o,digestSize:a,multihashSize:c-i,size:c}}static parse(e,t){const[r,n]=function(e,t){switch(e[0]){case"Q":{const r=t??St;return[St.prefix,r.decode(`${St.prefix}${e}`)]}case St.prefix:{const r=t??St;return[St.prefix,r.decode(e)]}case At.prefix:{const r=t??At;return[At.prefix,r.decode(e)]}case It.prefix:{const r=t??It;return[It.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}(e,t),s=Zt.decode(n);if(0===s.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Wt(s).set(r,e),s}}const Yt=112,Qt=18;function Xt(e,t,r){const n=$t(e),s=n+$t(t),i=new Uint8Array(s+r.byteLength);return Kt(e,i,0),Kt(t,i,n),i.set(r,s),i}const Jt=Symbol.for("@ipld/js-cid/CID"),er=ft,tr=function(e){return jt(0,er(e))};class rr{type="ECDSA";jwk;_raw;constructor(e){this.jwk=e}get raw(){var e;return null==this._raw&&(this._raw=(e=this.jwk,dt([ut(Uint8Array.from([1])),dt([fr(e.crv)],160),dt([ht(new _(Uint8Array.from([4]),et(e.x??"","base64url"),et(e.y??"","base64url")))],161)]).subarray())),this._raw}toMultihash(){return tr(lo(this))}toCID(){return Zt.createV1(114,this.toMultihash())}toString(){return St.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&C(this.raw,e.raw)}async verify(e,t,r){return async function(e,t,r,n){const s=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();const i=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},s,t,r.subarray());return n?.signal?.throwIfAborted(),i}(this.jwk,t,e,r)}}class nr{type="ECDSA";jwk;publicKey;_raw;constructor(e){this.jwk=e,this.publicKey=new rr({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){var e,t;return null==this._raw&&(this._raw=(e=this.jwk,dt([ut(Uint8Array.from([1])),(t=et(e.d??"","base64url"),new _(Uint8Array.from([4]),lt(t),t)),dt([fr(e.crv)],160),dt([ht(new _(Uint8Array.from([4]),et(e.x??"","base64url"),et(e.y??"","base64url")))],161)]).subarray())),this._raw}equals(e){return null!=e&&e.raw instanceof Uint8Array&&C(this.raw,e.raw)}async sign(e,t){return async function(e,t,r){const n=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["sign"]);r?.signal?.throwIfAborted();const s=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(s,0,s.byteLength)}(this.jwk,e,t)}}const sr=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),ir=Uint8Array.from([6,5,43,129,4,0,34]),or=Uint8Array.from([6,5,43,129,4,0,35]),ar={ext:!0,kty:"EC",crv:"P-256"},cr={ext:!0,kty:"EC",crv:"P-384"},lr={ext:!0,kty:"EC",crv:"P-521"},ur=32,hr=48,dr=66;function fr(e){if("P-256"===e)return sr;if("P-384"===e)return ir;if("P-521"===e)return or;throw new y(`Invalid curve ${e}`)}const pr="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function gr(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function mr(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function yr(e,...t){if(!gr(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function wr(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function br(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function vr(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Er(e,t){return e<<32-t|e>>>t}const xr=(()=>"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex)(),Sr=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ar(e){if(yr(e),xr)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=Sr[e[r]];return t}function Ir(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}function Cr(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);if(xr)return Uint8Array.fromHex(e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let t=0,s=0;t<r;t++,s+=2){const r=Ir(e.charCodeAt(s)),i=Ir(e.charCodeAt(s+1));if(void 0===r||void 0===i){const t=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+s)}n[t]=16*r+i}return n}function kr(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}(e)),yr(e),e}function Pr(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];yr(n),t+=n.length}const r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const s=e[t];r.set(s,n),n+=s.length}return r}class Tr{}function _r(e){const t=t=>e().update(kr(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function Dr(e=32){if(pr&&"function"==typeof pr.getRandomValues)return pr.getRandomValues(new Uint8Array(e));if(pr&&"function"==typeof pr.randomBytes)return Uint8Array.from(pr.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function Lr(e,t,r){return e&t^~e&r}function Rr(e,t,r){return e&t^e&r^t&r}class Ur extends Tr{constructor(e,t,r,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.buffer=new Uint8Array(e),this.view=vr(this.buffer)}update(e){wr(this),yr(e=kr(e));const{view:t,buffer:r,blockLen:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);if(o===n){const t=vr(e);for(;n<=s-i;i+=n)this.process(t,i);continue}r.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){wr(this),function(e,t){yr(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:n,isLE:s}=this;let{pos:i}=this;t[i++]=128,br(this.buffer.subarray(i)),this.padOffset>n-i&&(this.process(r,0),i=0);for(let e=i;e<n;e++)t[e]=0;!function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,l=n?0:4;e.setUint32(t+c,o,n),e.setUint32(t+l,a,n)}(r,n-8,BigInt(8*this.length),s),this.process(r,0);const o=vr(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,l[e],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:n,finished:s,destroyed:i,pos:o}=this;return e.destroyed=i,e.finished=s,e.length=n,e.pos=o,n%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const Mr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Br=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Nr=BigInt(2**32-1),Or=BigInt(32);function Fr(e,t=!1){return t?{h:Number(e&Nr),l:Number(e>>Or&Nr)}:{h:0|Number(e>>Or&Nr),l:0|Number(e&Nr)}}const qr=(e,t,r)=>e>>>r,zr=(e,t,r)=>e<<32-r|t>>>r,Kr=(e,t,r)=>e>>>r|t<<32-r,$r=(e,t,r)=>e<<32-r|t>>>r,jr=(e,t,r)=>e<<64-r|t>>>r-32,Vr=(e,t,r)=>e>>>r-32|t<<64-r;function Hr(e,t,r,n){const s=(t>>>0)+(n>>>0);return{h:e+r+(s/2**32|0)|0,l:0|s}}const Gr=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),Wr=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,Zr=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),Yr=(e,t,r,n,s)=>t+r+n+s+(e/2**32|0)|0,Qr=(e,t,r,n,s)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(s>>>0),Xr=(e,t,r,n,s,i)=>t+r+n+s+i+(e/2**32|0)|0,Jr=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),en=new Uint32Array(64);class tn extends Ur{constructor(e=32){super(64,e,8,!1),this.A=0|Mr[0],this.B=0|Mr[1],this.C=0|Mr[2],this.D=0|Mr[3],this.E=0|Mr[4],this.F=0|Mr[5],this.G=0|Mr[6],this.H=0|Mr[7]}get(){const{A:e,B:t,C:r,D:n,E:s,F:i,G:o,H:a}=this;return[e,t,r,n,s,i,o,a]}set(e,t,r,n,s,i,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|s,this.F=0|i,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)en[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=en[e-15],r=en[e-2],n=Er(t,7)^Er(t,18)^t>>>3,s=Er(r,17)^Er(r,19)^r>>>10;en[e]=s+en[e-7]+n+en[e-16]|0}let{A:r,B:n,C:s,D:i,E:o,F:a,G:c,H:l}=this;for(let e=0;e<64;e++){const t=l+(Er(o,6)^Er(o,11)^Er(o,25))+Lr(o,a,c)+Jr[e]+en[e]|0,u=(Er(r,2)^Er(r,13)^Er(r,22))+Rr(r,n,s)|0;l=c,c=a,a=o,o=i+t|0,i=s,s=n,n=r,r=t+u|0}r=r+this.A|0,n=n+this.B|0,s=s+this.C|0,i=i+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(r,n,s,i,o,a,c,l)}roundClean(){br(en)}destroy(){this.set(0,0,0,0,0,0,0,0),br(this.buffer)}}const rn=(()=>function(e,t=!1){const r=e.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){const{h:r,l:o}=Fr(e[i],t);[n[i],s[i]]=[r,o]}return[n,s]}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))))(),nn=(()=>rn[0])(),sn=(()=>rn[1])(),on=new Uint32Array(80),an=new Uint32Array(80);class cn extends Ur{constructor(e=64){super(128,e,16,!1),this.Ah=0|Br[0],this.Al=0|Br[1],this.Bh=0|Br[2],this.Bl=0|Br[3],this.Ch=0|Br[4],this.Cl=0|Br[5],this.Dh=0|Br[6],this.Dl=0|Br[7],this.Eh=0|Br[8],this.El=0|Br[9],this.Fh=0|Br[10],this.Fl=0|Br[11],this.Gh=0|Br[12],this.Gl=0|Br[13],this.Hh=0|Br[14],this.Hl=0|Br[15]}get(){const{Ah:e,Al:t,Bh:r,Bl:n,Ch:s,Cl:i,Dh:o,Dl:a,Eh:c,El:l,Fh:u,Fl:h,Gh:d,Gl:f,Hh:p,Hl:g}=this;return[e,t,r,n,s,i,o,a,c,l,u,h,d,f,p,g]}set(e,t,r,n,s,i,o,a,c,l,u,h,d,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|s,this.Cl=0|i,this.Dh=0|o,this.Dl=0|a,this.Eh=0|c,this.El=0|l,this.Fh=0|u,this.Fl=0|h,this.Gh=0|d,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let r=0;r<16;r++,t+=4)on[r]=e.getUint32(t),an[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){const t=0|on[e-15],r=0|an[e-15],n=Kr(t,r,1)^Kr(t,r,8)^qr(t,0,7),s=$r(t,r,1)^$r(t,r,8)^zr(t,r,7),i=0|on[e-2],o=0|an[e-2],a=Kr(i,o,19)^jr(i,o,61)^qr(i,0,6),c=$r(i,o,19)^Vr(i,o,61)^zr(i,o,6),l=Zr(s,c,an[e-7],an[e-16]),u=Yr(l,n,a,on[e-7],on[e-16]);on[e]=0|u,an[e]=0|l}let{Ah:r,Al:n,Bh:s,Bl:i,Ch:o,Cl:a,Dh:c,Dl:l,Eh:u,El:h,Fh:d,Fl:f,Gh:p,Gl:g,Hh:m,Hl:y}=this;for(let e=0;e<80;e++){const t=Kr(u,h,14)^Kr(u,h,18)^jr(u,h,41),w=$r(u,h,14)^$r(u,h,18)^Vr(u,h,41),b=u&d^~u&p,v=Qr(y,w,h&f^~h&g,sn[e],an[e]),E=Xr(v,m,t,b,nn[e],on[e]),x=0|v,S=Kr(r,n,28)^jr(r,n,34)^jr(r,n,39),A=$r(r,n,28)^Vr(r,n,34)^Vr(r,n,39),I=r&s^r&o^s&o,C=n&i^n&a^i&a;m=0|p,y=0|g,p=0|d,g=0|f,d=0|u,f=0|h,({h:u,l:h}=Hr(0|c,0|l,0|E,0|x)),c=0|o,l=0|a,o=0|s,a=0|i,s=0|r,i=0|n;const k=Gr(x,A,C);r=Wr(k,E,S,I),n=0|k}({h:r,l:n}=Hr(0|this.Ah,0|this.Al,0|r,0|n)),({h:s,l:i}=Hr(0|this.Bh,0|this.Bl,0|s,0|i)),({h:o,l:a}=Hr(0|this.Ch,0|this.Cl,0|o,0|a)),({h:c,l}=Hr(0|this.Dh,0|this.Dl,0|c,0|l)),({h:u,l:h}=Hr(0|this.Eh,0|this.El,0|u,0|h)),({h:d,l:f}=Hr(0|this.Fh,0|this.Fl,0|d,0|f)),({h:p,l:g}=Hr(0|this.Gh,0|this.Gl,0|p,0|g)),({h:m,l:y}=Hr(0|this.Hh,0|this.Hl,0|m,0|y)),this.set(r,n,s,i,o,a,c,l,u,h,d,f,p,g,m,y)}roundClean(){br(on,an)}destroy(){br(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const ln=_r(()=>new tn),un=_r(()=>new cn),hn=BigInt(0),dn=BigInt(1);function fn(e,t){if("boolean"!=typeof t)throw new Error(e+" boolean expected, got "+t)}function pn(e){const t=e.toString(16);return 1&t.length?"0"+t:t}function gn(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?hn:BigInt("0x"+e)}function mn(e){return gn(Ar(e))}function yn(e){return yr(e),gn(Ar(Uint8Array.from(e).reverse()))}function wn(e,t){return Cr(e.toString(16).padStart(2*t,"0"))}function bn(e,t){return wn(e,t).reverse()}function vn(e,t,r){let n;if("string"==typeof t)try{n=Cr(t)}catch(t){throw new Error(e+" must be hex string or Uint8Array, cause: "+t)}else{if(!gr(t))throw new Error(e+" must be hex string or Uint8Array");n=Uint8Array.from(t)}const s=n.length;if("number"==typeof r&&s!==r)throw new Error(e+" of length "+r+" expected, got "+s);return n}const En=e=>"bigint"==typeof e&&hn<=e;function xn(e,t,r,n){if(!function(e,t,r){return En(e)&&En(t)&&En(r)&&t<=e&&e<r}(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}const Sn=e=>(dn<<BigInt(e))-dn;function An(e,t,r={}){if(!e||"object"!=typeof e)throw new Error("expected valid options object");function n(t,r,n){const s=e[t];if(n&&void 0===s)return;const i=typeof s;if(i!==r||null===s)throw new Error(`param "${t}" is invalid: expected ${r}, got ${i}`)}Object.entries(t).forEach(([e,t])=>n(e,t,!1)),Object.entries(r).forEach(([e,t])=>n(e,t,!0))}function In(e){const t=new WeakMap;return(r,...n)=>{const s=t.get(r);if(void 0!==s)return s;const i=e(r,...n);return t.set(r,i),i}}const Cn=BigInt(0),kn=BigInt(1),Pn=BigInt(2),Tn=BigInt(3),_n=BigInt(4),Dn=BigInt(5),Ln=BigInt(8);function Rn(e,t){const r=e%t;return r>=Cn?r:t+r}function Un(e,t,r){let n=e;for(;t-- >Cn;)n*=n,n%=r;return n}function Mn(e,t){if(e===Cn)throw new Error("invert: expected non-zero number");if(t<=Cn)throw new Error("invert: expected positive modulus, got "+t);let r=Rn(e,t),n=t,s=Cn,i=kn,o=kn,a=Cn;for(;r!==Cn;){const e=n/r,t=n%r,c=s-o*e,l=i-a*e;n=r,r=t,s=o,i=a,o=c,a=l}if(n!==kn)throw new Error("invert: does not exist");return Rn(s,t)}function Bn(e,t){const r=(e.ORDER+kn)/_n,n=e.pow(t,r);if(!e.eql(e.sqr(n),t))throw new Error("Cannot find square root");return n}function Nn(e,t){const r=(e.ORDER-Dn)/Ln,n=e.mul(t,Pn),s=e.pow(n,r),i=e.mul(t,s),o=e.mul(e.mul(i,Pn),s),a=e.mul(i,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),t))throw new Error("Cannot find square root");return a}const On=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Fn(e,t,r=!1){const n=new Array(t.length).fill(r?e.ZERO:void 0),s=t.reduce((t,r,s)=>e.is0(r)?t:(n[s]=t,e.mul(t,r)),e.ONE),i=e.inv(s);return t.reduceRight((t,r,s)=>e.is0(r)?t:(n[s]=e.mul(t,n[s]),e.mul(t,r)),i),n}function qn(e,t){const r=(e.ORDER-kn)/Pn,n=e.pow(t,r),s=e.eql(n,e.ONE),i=e.eql(n,e.ZERO),o=e.eql(n,e.neg(e.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function zn(e,t,r=!1,n={}){if(e<=Cn)throw new Error("invalid field: expected ORDER > 0, got "+e);let s,i;if("object"==typeof t&&null!=t){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const e=t;e.BITS&&(s=e.BITS),e.sqrt&&(i=e.sqrt),"boolean"==typeof e.isLE&&(r=e.isLE)}else"number"==typeof t&&(s=t),n.sqrt&&(i=n.sqrt);const{nBitLength:o,nByteLength:a}=function(e,t){void 0!==t&&mr(t);const r=void 0!==t?t:e.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}(e,s);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c;const l=Object.freeze({ORDER:e,isLE:r,BITS:o,BYTES:a,MASK:Sn(o),ZERO:Cn,ONE:kn,create:t=>Rn(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("invalid field element: expected bigint, got "+typeof t);return Cn<=t&&t<e},is0:e=>e===Cn,isValidNot0:e=>!l.is0(e)&&l.isValid(e),isOdd:e=>(e&kn)===kn,neg:t=>Rn(-t,e),eql:(e,t)=>e===t,sqr:t=>Rn(t*t,e),add:(t,r)=>Rn(t+r,e),sub:(t,r)=>Rn(t-r,e),mul:(t,r)=>Rn(t*r,e),pow:(e,t)=>function(e,t,r){if(r<Cn)throw new Error("invalid exponent, negatives unsupported");if(r===Cn)return e.ONE;if(r===kn)return t;let n=e.ONE,s=t;for(;r>Cn;)r&kn&&(n=e.mul(n,s)),s=e.sqr(s),r>>=kn;return n}(l,e,t),div:(t,r)=>Rn(t*Mn(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>Mn(t,e),sqrt:i||(t=>{return c||(c=(r=e)%_n===Tn?Bn:r%Ln===Dn?Nn:function(e){if(e<BigInt(3))throw new Error("sqrt is not defined for small field");let t=e-kn,r=0;for(;t%Pn===Cn;)t/=Pn,r++;let n=Pn;const s=zn(e);for(;1===qn(s,n);)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(1===r)return Bn;let i=s.pow(n,t);const o=(t+kn)/Pn;return function(e,n){if(e.is0(n))return n;if(1!==qn(e,n))throw new Error("Cannot find square root");let s=r,a=e.mul(e.ONE,i),c=e.pow(n,t),l=e.pow(n,o);for(;!e.eql(c,e.ONE);){if(e.is0(c))return e.ZERO;let t=1,r=e.sqr(c);for(;!e.eql(r,e.ONE);)if(t++,r=e.sqr(r),t===s)throw new Error("Cannot find square root");const n=kn<<BigInt(s-t-1),i=e.pow(a,n);s=t,a=e.sqr(i),c=e.mul(c,a),l=e.mul(l,i)}return l}}(r)),c(l,t);var r}),toBytes:e=>r?bn(e,a):wn(e,a),fromBytes:e=>{if(e.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+e.length);return r?yn(e):mn(e)},invertBatch:e=>Fn(l,e),cmov:(e,t,r)=>r?t:e});return Object.freeze(l)}function Kn(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function $n(e){const t=Kn(e);return t+Math.ceil(t/2)}const jn=BigInt(0),Vn=BigInt(1);function Hn(e,t){const r=t.negate();return e?r:t}function Gn(e,t,r){const n="pz"===t?e=>e.pz:e=>e.ez,s=Fn(e.Fp,r.map(n));return r.map((e,t)=>e.toAffine(s[t])).map(e.fromAffine)}function Wn(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Zn(e,t){Wn(e,t);const r=2**e;return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1),mask:Sn(e),maxNumber:r,shiftBy:BigInt(e)}}function Yn(e,t,r){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=r;let a=Number(e&s),c=e>>o;a>n&&(a-=i,c+=Vn);const l=t*n;return{nextN:c,offset:l+Math.abs(a)-1,isZero:0===a,isNeg:a<0,isNegF:t%2!=0,offsetF:l}}const Qn=new WeakMap,Xn=new WeakMap;function Jn(e){return Xn.get(e)||1}function es(e){if(e!==jn)throw new Error("invalid wNAF")}function ts(e,t){return{constTimeNegate:Hn,hasPrecomputes:e=>1!==Jn(e),unsafeLadder(t,r,n=e.ZERO){let s=t;for(;r>jn;)r&Vn&&(n=n.add(s)),s=s.double(),r>>=Vn;return n},precomputeWindow(e,r){const{windows:n,windowSize:s}=Zn(r,t),i=[];let o=e,a=o;for(let e=0;e<n;e++){a=o,i.push(a);for(let e=1;e<s;e++)a=a.add(o),i.push(a);o=a.double()}return i},wNAF(r,n,s){let i=e.ZERO,o=e.BASE;const a=Zn(r,t);for(let e=0;e<a.windows;e++){const{nextN:t,offset:r,isZero:c,isNeg:l,isNegF:u,offsetF:h}=Yn(s,e,a);s=t,c?o=o.add(Hn(u,n[h])):i=i.add(Hn(l,n[r]))}return es(s),{p:i,f:o}},wNAFUnsafe(r,n,s,i=e.ZERO){const o=Zn(r,t);for(let e=0;e<o.windows&&s!==jn;e++){const{nextN:t,offset:r,isZero:a,isNeg:c}=Yn(s,e,o);if(s=t,!a){const e=n[r];i=i.add(c?e.negate():e)}}return es(s),i},getPrecomputes(e,t,r){let n=Qn.get(t);return n||(n=this.precomputeWindow(t,e),1!==e&&("function"==typeof r&&(n=r(n)),Qn.set(t,n))),n},wNAFCached(e,t,r){const n=Jn(e);return this.wNAF(n,this.getPrecomputes(n,e,r),t)},wNAFCachedUnsafe(e,t,r,n){const s=Jn(e);return 1===s?this.unsafeLadder(e,t,n):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),t,n)},setWindowSize(e,r){Wn(r,t),Xn.set(e,r),Qn.delete(e)}}}function rs(e,t,r,n){(function(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((e,r)=>{if(!(e instanceof t))throw new Error("invalid point at index "+r)})})(r,e),function(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((e,r)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+r)})}(n,t);const s=r.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=e.ZERO,a=function(e){let t;for(t=0;e>hn;e>>=dn,t+=1);return t}(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=Sn(c),u=new Array(Number(l)+1).fill(o);let h=o;for(let e=Math.floor((t.BITS-1)/c)*c;e>=0;e-=c){u.fill(o);for(let t=0;t<i;t++){const s=n[t],i=Number(s>>BigInt(e)&l);u[i]=u[i].add(r[t])}let t=o;for(let e=u.length-1,r=o;e>0;e--)r=r.add(u[e]),t=t.add(r);if(h=h.add(t),0!==e)for(let e=0;e<c;e++)h=h.double()}return h}function ns(e,t){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return function(e){An(e,On.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"}))}(t),t}return zn(e)}function ss(e,t,r={}){if(!t||"object"!=typeof t)throw new Error(`expected valid ${e} CURVE object`);for(const e of["p","n","h"]){const r=t[e];if(!("bigint"==typeof r&&r>jn))throw new Error(`CURVE.${e} must be positive bigint`)}const n=ns(t.p,r.Fp),s=ns(t.n,r.Fn),i=["Gx","Gy","a","weierstrass"===e?"b":"d"];for(const e of i)if(!n.isValid(t[e]))throw new Error(`CURVE.${e} must be valid field element of CURVE.Fp`);return{Fp:n,Fn:s}}const is=BigInt(0),os=BigInt(1),as=BigInt(2),cs=BigInt(8),ls={zip215:!0};function us(e){const{CURVE:t,curveOpts:r,eddsaOpts:n}=function(e){const t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy};return{CURVE:t,curveOpts:{Fp:e.Fp,Fn:zn(t.n,e.nBitLength,!0),uvRatio:e.uvRatio},eddsaOpts:{hash:e.hash,randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve}}}(e),s=function(e,t={}){const{Fp:r,Fn:n}=ss("edwards",e,t),{h:s,n:i}=e;An(t,{},{uvRatio:"function"});const o=as<<BigInt(8*n.BYTES)-os,a=e=>r.create(e),c=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:r.sqrt(r.div(e,t))}}catch(e){return{isValid:!1,value:is}}});if(!function(e,t,r,n){const s=e.sqr(r),i=e.sqr(n),o=e.add(e.mul(t.a,s),i),a=e.add(e.ONE,e.mul(t.d,e.mul(s,i)));return e.eql(o,a)}(r,e,e.Gx,e.Gy))throw new Error("bad curve params: generator point");function l(e,t,r=!1){return xn("coordinate "+e,t,r?os:is,o),t}function u(e){if(!(e instanceof f))throw new Error("ExtendedPoint expected")}const h=In((e,t)=>{const{ex:n,ey:s,ez:i}=e,o=e.is0();null==t&&(t=o?cs:r.inv(i));const c=a(n*t),l=a(s*t),u=a(i*t);if(o)return{x:is,y:os};if(u!==os)throw new Error("invZ was invalid");return{x:c,y:l}}),d=In(t=>{const{a:r,d:n}=e;if(t.is0())throw new Error("bad point: ZERO");const{ex:s,ey:i,ez:o,et:c}=t,l=a(s*s),u=a(i*i),h=a(o*o),d=a(h*h),f=a(l*r);if(a(h*a(f+u))!==a(d+a(n*a(l*u))))throw new Error("bad point: equation left != right (1)");if(a(s*i)!==a(o*c))throw new Error("bad point: equation left != right (2)");return!0});class f{constructor(e,t,r,n){this.ex=l("x",e),this.ey=l("y",t),this.ez=l("z",r,!0),this.et=l("t",n),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof f)throw new Error("extended point not allowed");const{x:t,y:r}=e||{};return l("x",t),l("y",r),new f(t,r,os,a(t*r))}static normalizeZ(e){return Gn(f,"ez",e)}static msm(e,t){return rs(f,n,e,t)}_setWindowSize(e){this.precompute(e)}precompute(e=8,t=!0){return p.setWindowSize(this,e),t||this.multiply(as),this}assertValidity(){d(this)}equals(e){u(e);const{ex:t,ey:r,ez:n}=this,{ex:s,ey:i,ez:o}=e,c=a(t*o),l=a(s*n),h=a(r*o),d=a(i*n);return c===l&&h===d}is0(){return this.equals(f.ZERO)}negate(){return new f(a(-this.ex),this.ey,this.ez,a(-this.et))}double(){const{a:t}=e,{ex:r,ey:n,ez:s}=this,i=a(r*r),o=a(n*n),c=a(as*a(s*s)),l=a(t*i),u=r+n,h=a(a(u*u)-i-o),d=l+o,p=d-c,g=l-o,m=a(h*p),y=a(d*g),w=a(h*g),b=a(p*d);return new f(m,y,b,w)}add(t){u(t);const{a:r,d:n}=e,{ex:s,ey:i,ez:o,et:c}=this,{ex:l,ey:h,ez:d,et:p}=t,g=a(s*l),m=a(i*h),y=a(c*n*p),w=a(o*d),b=a((s+i)*(l+h)-g-m),v=w-y,E=w+y,x=a(m-r*g),S=a(b*v),A=a(E*x),I=a(b*x),C=a(v*E);return new f(S,A,C,I)}subtract(e){return this.add(e.negate())}multiply(e){const t=e;xn("scalar",t,os,i);const{p:r,f:n}=p.wNAFCached(this,t,f.normalizeZ);return f.normalizeZ([r,n])[0]}multiplyUnsafe(e,t=f.ZERO){const r=e;return xn("scalar",r,is,i),r===is?f.ZERO:this.is0()||r===os?this:p.wNAFCachedUnsafe(this,r,f.normalizeZ,t)}isSmallOrder(){return this.multiplyUnsafe(s).is0()}isTorsionFree(){return p.wNAFCachedUnsafe(this,i).is0()}toAffine(e){return h(this,e)}clearCofactor(){return s===os?this:this.multiplyUnsafe(s)}static fromBytes(e,t=!1){return yr(e),this.fromHex(e,t)}static fromHex(t,n=!1){const{d:s,a:i}=e,l=r.BYTES;t=vn("pointHex",t,l),fn("zip215",n);const u=t.slice(),h=t[l-1];u[l-1]=-129&h;const d=yn(u),p=n?o:r.ORDER;xn("pointHex.y",d,is,p);const g=a(d*d),m=a(g-os),y=a(s*g-i);let{isValid:w,value:b}=c(m,y);if(!w)throw new Error("Point.fromHex: invalid y coordinate");const v=(b&os)===os,E=!!(128&h);if(!n&&b===is&&E)throw new Error("Point.fromHex: x=0 and x_0=1");return E!==v&&(b=a(-b)),f.fromAffine({x:b,y:d})}static fromPrivateScalar(e){return f.BASE.multiply(e)}toBytes(){const{x:e,y:t}=this.toAffine(),n=bn(t,r.BYTES);return n[n.length-1]|=e&os?128:0,n}toRawBytes(){return this.toBytes()}toHex(){return Ar(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}f.BASE=new f(e.Gx,e.Gy,os,a(e.Gx*e.Gy)),f.ZERO=new f(is,os,os,is),f.Fp=r,f.Fn=n;const p=ts(f,8*n.BYTES);return f}(t,r);return function(e,t){return Object.assign({},t,{ExtendedPoint:t.Point,CURVE:e})}(e,function(e,t){An(t,{hash:"function"},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:r,hash:n}=t,{BASE:s,Fp:i,Fn:o}=e,a=o.ORDER,c=t.randomBytes||Dr,l=t.adjustScalarBytes||(e=>e),u=t.domain||((e,t,r)=>{if(fn("phflag",r),t.length||r)throw new Error("Contexts/pre-hash are not supported");return e});function h(e){return o.create(e)}function d(e){return h(yn(e))}function f(e){const{head:t,prefix:r,scalar:o}=function(e){const t=i.BYTES;e=vn("private key",e,t);const r=vn("hashed private key",n(e),2*t),s=l(r.slice(0,t));return{head:s,prefix:r.slice(t,2*t),scalar:d(s)}}(e),a=s.multiply(o),c=a.toBytes();return{head:t,prefix:r,scalar:o,point:a,pointBytes:c}}function p(e=Uint8Array.of(),...t){const s=Pr(...t);return d(n(u(s,vn("context",e),!!r)))}const g=ls;return s.precompute(8),{getPublicKey:function(e){return f(e).pointBytes},sign:function(e,t,n={}){e=vn("message",e),r&&(e=r(e));const{prefix:o,scalar:c,pointBytes:l}=f(t),u=p(n.context,o,e),d=s.multiply(u).toBytes(),g=h(u+p(n.context,d,l,e)*c);xn("signature.s",g,is,a);const m=i.BYTES;return vn("result",Pr(d,bn(g,m)),2*m)},verify:function(t,n,o,a=g){const{context:c,zip215:l}=a,u=i.BYTES;t=vn("signature",t,2*u),n=vn("message",n),o=vn("publicKey",o,u),void 0!==l&&fn("zip215",l),r&&(n=r(n));const h=yn(t.slice(u,2*u));let d,f,m;try{d=e.fromHex(o,l),f=e.fromHex(t.slice(0,u),l),m=s.multiplyUnsafe(h)}catch(e){return!1}if(!l&&d.isSmallOrder())return!1;const y=p(c,f.toBytes(),d.toBytes(),n);return f.add(d.multiplyUnsafe(y)).subtract(m).clearCofactor().is0()},utils:{getExtendedPublicKey:f,randomPrivateKey:()=>c(i.BYTES),precompute:(t=8,r=e.BASE)=>r.precompute(t,!1)},Point:e}}(s,n))}BigInt(0);const hs=BigInt(1),ds=BigInt(2),fs=(BigInt(3),BigInt(5)),ps=BigInt(8),gs={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:ps,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function ms(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}const ys=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function ws(e,t){const r=gs.p,n=Rn(t*t*t,r),s=Rn(n*n*t,r);let i=Rn(e*n*function(e){const t=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=gs.p,o=e*e%i*e%i,a=Un(o,ds,i)*o%i,c=Un(a,hs,i)*e%i,l=Un(c,fs,i)*c%i,u=Un(l,t,i)*l%i,h=Un(u,r,i)*u%i,d=Un(h,n,i)*h%i,f=Un(d,s,i)*d%i,p=Un(f,s,i)*d%i,g=Un(p,t,i)*l%i;return{pow_p_5_8:Un(g,ds,i)*e%i,b2:o}}(e*s).pow_p_5_8,r);const o=Rn(t*i*i,r),a=i,c=Rn(i*ys,r),l=o===e,u=o===Rn(-e,r),h=o===Rn(-e*ys,r);return l&&(i=a),(u||h)&&(i=c),(Rn(i,r)&kn)===kn&&(i=Rn(-i,r)),{isValid:l||u,value:i}}const bs=(()=>zn(gs.p,void 0,!0))(),vs=(()=>({...gs,Fp:bs,hash:un,adjustScalarBytes:ms,uvRatio:ws}))(),Es=(()=>us(vs))();class xs extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}}class Ss extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class As extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const Is={get(e=globalThis){const t=e.crypto;if(null==t?.subtle)throw new As("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}},Cs=32,ks=64;let Ps;const Ts=(async()=>{try{return await Is.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();function _s(e){return null!=e&&"function"==typeof e.then&&"function"==typeof e.catch&&"function"==typeof e.finally}class Ds{type="Ed25519";raw;constructor(e){this.raw=Rs(e,Cs)}toMultihash(){return tr(lo(this))}toCID(){return Zt.createV1(114,this.toMultihash())}toString(){return St.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&C(this.raw,e.raw)}verify(e,t,r){r?.signal?.throwIfAborted();const n=async function(e,t,r){return null==Ps&&(Ps=await Ts),Ps?async function(e,t,r){if(e.buffer instanceof ArrayBuffer){const n=await Is.get().subtle.importKey("raw",e.buffer,{name:"Ed25519"},!1,["verify"]);return await Is.get().subtle.verify({name:"Ed25519"},n,t,r instanceof Uint8Array?r:r.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}(e,t,r):function(e,t,r){return Es.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}(e,t,r)}(this.raw,t,e);return _s(n)?n.then(e=>(r?.signal?.throwIfAborted(),e)):n}}class Ls{type="Ed25519";raw;publicKey;constructor(e,t){this.raw=Rs(e,ks),this.publicKey=new Ds(t)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&C(this.raw,e.raw)}sign(e,t){t?.signal?.throwIfAborted();const r=async function(e,t){return null==Ps&&(Ps=await Ts),Ps?async function(e,t){let r;r=e.length===ks?e.subarray(0,32):e;const n={crv:"Ed25519",kty:"OKP",x:tt(e.subarray(32),"base64url"),d:tt(r,"base64url"),ext:!0,key_ops:["sign"]},s=await Is.get().subtle.importKey("jwk",n,{name:"Ed25519"},!0,["sign"]),i=await Is.get().subtle.sign({name:"Ed25519"},s,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(i,0,i.byteLength)}(e,t):function(e,t){const r=e.subarray(0,32);return Es.sign(t instanceof Uint8Array?t:t.subarray(),r)}(e,t)}(this.raw,e);return _s(r)?r.then(e=>(t?.signal?.throwIfAborted(),e)):(t?.signal?.throwIfAborted(),r)}}function Rs(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new y(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}const Us=Math.pow(2,7),Ms=Math.pow(2,14),Bs=Math.pow(2,21),Ns=Math.pow(2,28),Os=Math.pow(2,35),Fs=Math.pow(2,42),qs=Math.pow(2,49),zs=128,Ks=127;function $s(e){if(e<Us)return 1;if(e<Ms)return 2;if(e<Bs)return 3;if(e<Ns)return 4;if(e<Os)return 5;if(e<Fs)return 6;if(e<qs)return 7;if(null!=Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function js(e,t,r=0){switch($s(e)){case 8:t[r++]=255&e|zs,e/=128;case 7:t[r++]=255&e|zs,e/=128;case 6:t[r++]=255&e|zs,e/=128;case 5:t[r++]=255&e|zs,e/=128;case 4:t[r++]=255&e|zs,e>>>=7;case 3:t[r++]=255&e|zs,e>>>=7;case 2:t[r++]=255&e|zs,e>>>=7;case 1:t[r++]=255&e,e>>>=7;break;default:throw new Error("unreachable")}return t}const Vs=new Float32Array([-0]),Hs=new Uint8Array(Vs.buffer);function Gs(e,t,r){Vs[0]=e,t[r]=Hs[0],t[r+1]=Hs[1],t[r+2]=Hs[2],t[r+3]=Hs[3]}const Ws=new Float64Array([-0]),Zs=new Uint8Array(Ws.buffer);function Ys(e,t,r){Ws[0]=e,t[r]=Zs[0],t[r+1]=Zs[1],t[r+2]=Zs[2],t[r+3]=Zs[3],t[r+4]=Zs[4],t[r+5]=Zs[5],t[r+6]=Zs[6],t[r+7]=Zs[7]}const Qs=BigInt(Number.MAX_SAFE_INTEGER),Xs=BigInt(Number.MIN_SAFE_INTEGER);class Js{lo;hi;constructor(e,t){this.lo=0|e,this.hi=0|t}toNumber(e=!1){if(!e&&this.hi>>>31>0){const e=1+~this.lo>>>0;let t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(e+4294967296*t)}return this.lo+4294967296*this.hi}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!=0){const e=1+~this.lo>>>0;let t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(BigInt(e)+(BigInt(t)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}static fromBigInt(e){if(0n===e)return ei;if(e<Qs&&e>Xs)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let r=e>>32n,n=e-(r<<32n);return t&&(r=0n|~r,n=0n|~n,++n>ti&&(n=0n,++r>ti&&(r=0n))),new Js(Number(n),Number(r))}static fromNumber(e){if(0===e)return ei;const t=e<0;t&&(e=-e);let r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new Js(r,n)}static from(e){return"number"==typeof e?Js.fromNumber(e):"bigint"==typeof e?Js.fromBigInt(e):"string"==typeof e?Js.fromBigInt(BigInt(e)):null!=e.low||null!=e.high?new Js(e.low>>>0,e.high>>>0):ei}}const ei=new Js(0,0);ei.toBigInt=function(){return 0n},ei.zzEncode=ei.zzDecode=function(){return this},ei.length=function(){return 1};const ti=4294967296n;function ri(e,t,r){const n=r;let s,i;for(let n=0;n<e.length;++n)s=e.charCodeAt(n),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=63&s|128):55296==(64512&s)&&56320==(64512&(i=e.charCodeAt(n+1)))?(s=65536+((1023&s)<<10)+(1023&i),++n,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=63&s|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=63&s|128);return r-n}function ni(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function si(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}class ii{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,ni(this,10);return e}int32(){return 0|this.uint32()}sint32(){const e=this.uint32();return e>>>1^-(1&e)}bool(){return 0!==this.uint32()}fixed32(){if(this.pos+4>this.len)throw ni(this,4);return si(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw ni(this,4);return 0|si(this.buf,this.pos+=4)}float(){if(this.pos+4>this.len)throw ni(this,4);const e=(t=this.buf,r=this.pos,Hs[0]=t[r],Hs[1]=t[r+1],Hs[2]=t[r+2],Hs[3]=t[r+3],Vs[0]);var t,r;return this.pos+=4,e}double(){if(this.pos+8>this.len)throw ni(this,4);const e=(t=this.buf,r=this.pos,Zs[0]=t[r],Zs[1]=t[r+1],Zs[2]=t[r+2],Zs[3]=t[r+3],Zs[4]=t[r+4],Zs[5]=t[r+5],Zs[6]=t[r+6],Zs[7]=t[r+7],Ws[0]);var t,r;return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw ni(this,e);return this.pos+=e,t===r?new Uint8Array(0):this.buf.subarray(t,r)}string(){const e=this.bytes();return function(e,t,r){if(r-t<1)return"";let n;const s=[];let i,o=0;for(;t<r;)i=e[t++],i<128?s[o++]=i:i>191&&i<224?s[o++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(i>>10),s[o++]=56320+(1023&i)):s[o++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((n??(n=[])).push(String.fromCharCode.apply(String,s)),o=0);return null!=n?(o>0&&n.push(String.fromCharCode.apply(String,s.slice(0,o))),n.join("")):String.fromCharCode.apply(String,s.slice(0,o))}(e,0,e.length)}skip(e){if("number"==typeof e){if(this.pos+e>this.len)throw ni(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw ni(this)}while(128&this.buf[this.pos++]);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new Js(0,0);let t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw ni(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw ni(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw ni(this,8);const e=si(this.buf,this.pos+=4),t=si(this.buf,this.pos+=4);return new Js(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=function(e,t){let r=e[t],n=0;if(n+=r&Ks,r<zs)return n;if(r=e[t+1],n+=(r&Ks)<<7,r<zs)return n;if(r=e[t+2],n+=(r&Ks)<<14,r<zs)return n;if(r=e[t+3],n+=(r&Ks)<<21,r<zs)return n;if(r=e[t+4],n+=(r&Ks)*Ns,r<zs)return n;if(r=e[t+5],n+=(r&Ks)*Os,r<zs)return n;if(r=e[t+6],n+=(r&Ks)*Fs,r<zs)return n;if(r=e[t+7],n+=(r&Ks)*qs,r<zs)return n;throw new RangeError("Could not decode varint")}(this.buf,this.pos);return this.pos+=$s(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function oi(e,t,r){const n=function(e){return new ii(e instanceof Uint8Array?e:e.subarray())}(e);return t.decode(n,void 0,r)}class ai{fn;len;next;val;constructor(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}}function ci(){}class li{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const ui=function(){const e=8192;let t,r=e;return function(n){if(n<1||n>4096)return A(n);r+n>e&&(t=A(e),r=0);const s=t.subarray(r,r+=n);return 7&r&&(r=1+(7|r)),s}}();class hi{len;head;tail;states;constructor(){this.len=0,this.head=new ai(ci,0,0),this.tail=this.head,this.states=null}_push(e,t,r){return this.tail=this.tail.next=new ai(e,t,r),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new pi((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(gi,10,Js.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=Js.fromBigInt(e);return this._push(gi,t.length(),t)}uint64Number(e){return this._push(js,$s(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=Js.fromBigInt(e).zzEncode();return this._push(gi,t.length(),t)}sint64Number(e){const t=Js.fromNumber(e).zzEncode();return this._push(gi,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(di,1,e?1:0)}fixed32(e){return this._push(mi,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=Js.fromBigInt(e);return this._push(mi,4,t.lo)._push(mi,4,t.hi)}fixed64Number(e){const t=Js.fromNumber(e);return this._push(mi,4,t.lo)._push(mi,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(Gs,4,e)}double(e){return this._push(Ys,8,e)}bytes(e){const t=e.length>>>0;return 0===t?this._push(di,1,0):this.uint32(t)._push(yi,t,e)}string(e){const t=function(e){let t=0,r=0;for(let n=0;n<e.length;++n)r=e.charCodeAt(n),r<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t}(e);return 0!==t?this.uint32(t)._push(ri,t,e):this._push(di,1,0)}fork(){return this.states=new li(this),this.head=this.tail=new ai(ci,0,0),this.len=0,this}reset(){return null!=this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ai(ci,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),0!==r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this}finish(){let e=this.head.next;const t=(r=this.len,null!=globalThis.Buffer?A(r):ui(r));var r;let n=0;for(;null!=e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}}function di(e,t,r){t[r]=255&e}function fi(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}class pi extends ai{next;constructor(e,t){super(fi,e,t),this.next=void 0}}function gi(e,t,r){for(;0!==e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function mi(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function yi(e,t,r){t.set(e,r)}function wi(e,t,r){t.set(e,r)}function bi(e,t,r){e.length<40?ri(e,t,r):null!=t.utf8Write?t.utf8Write(e,r):t.set(et(e),r)}function vi(e,t){const r=new hi;return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var Ei,xi,Si,Ai,Ii;function Ci(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function ki(e,t){return Ci("message",Ei.LENGTH_DELIMITED,e,t)}null!=globalThis.Buffer&&(hi.prototype.bytes=function(e){const t=e.length>>>0;return this.uint32(t),t>0&&this._push(wi,t,e),this},hi.prototype.string=function(e){const t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(bi,t,e),this}),function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"}(Ei||(Ei={})),Error,function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"}(xi||(xi={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"}(Si||(Si={})),function(e){e.codec=()=>function(e){function t(t){if(null==e[t.toString()])throw new Error("Invalid enum value");return e[t]}return Ci("enum",Ei.VARINT,function(e,r){const n=t(e);r.int32(n)},function(e){return t(e.int32())})}(Si)}(xi||(xi={})),function(e){let t;e.codec=()=>(null==t&&(t=ki((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),xi.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.Type=xi.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>vi(t,e.codec()),e.decode=(t,r)=>oi(t,e.codec(),r)}(Ai||(Ai={})),function(e){let t;e.codec=()=>(null==t&&(t=ki((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),xi.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.Type=xi.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>vi(t,e.codec()),e.decode=(t,r)=>oi(t,e.codec(),r)}(Ii||(Ii={}));const Pi=ln;class Ti{type="RSA";jwk;_raw;_multihash;constructor(e,t){this.jwk=e,this._multihash=t}get raw(){return null==this._raw&&(this._raw=Ui(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return Zt.createV1(114,this._multihash)}toString(){return St.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&C(this.raw,e.raw)}verify(e,t,r){return async function(e,t,r,n){const s=await Is.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();const i=await Is.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},s,t,r instanceof Uint8Array?r:r.subarray());return n?.signal?.throwIfAborted(),i}(this.jwk,t,e,r)}}class _i{type="RSA";jwk;_raw;publicKey;constructor(e,t){this.jwk=e,this.publicKey=t}get raw(){return null==this._raw&&(this._raw=function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new y("JWK was missing components");return dt([ut(Uint8Array.from([0])),ut(et(e.n,"base64url")),ut(et(e.e,"base64url")),ut(et(e.d,"base64url")),ut(et(e.p,"base64url")),ut(et(e.q,"base64url")),ut(et(e.dp,"base64url")),ut(et(e.dq,"base64url")),ut(et(e.qi,"base64url"))]).subarray()}(this.jwk)),this._raw}equals(e){return null!=e&&e.raw instanceof Uint8Array&&C(this.raw,e.raw)}sign(e,t){return async function(e,t,r){const n=await Is.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);r?.signal?.throwIfAborted();const s=await Is.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(s,0,s.byteLength)}(this.jwk,e,t)}}const Di=8192,Li=18,Ri=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function Ui(e){if(null==e.n||null==e.e)throw new y("JWK was missing components");return dt([Ri,ht(dt([ut(et(e.n,"base64url")),ut(et(e.e,"base64url"))]))]).subarray()}function Mi(e){return function(e){if(function(e){if("RSA"!==e.kty)throw new y("invalid key type");if(null==e.n)throw new y("invalid key modulus");return 8*et(e.n,"base64url").length}(e)>Di)throw new y("Key size is too large");const t=function(e){if(null==e)throw new y("Missing key parameter");return{privateKey:e,publicKey:{kty:e.kty,n:e.n,e:e.e}}}(e),r=Pi(Ai.encode({Type:xi.RSA,Data:Ui(t.publicKey)})),n=jt(Li,r);return new _i(t.privateKey,new Ti(t.publicKey,n))}(function(e){return{n:tt(e[1],"base64url"),e:tt(e[2],"base64url"),d:tt(e[3],"base64url"),p:tt(e[4],"base64url"),q:tt(e[5],"base64url"),dp:tt(e[6],"base64url"),dq:tt(e[7],"base64url"),qi:tt(e[8],"base64url"),kty:"RSA"}}(e))}class Bi extends Tr{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.createHasher");mr(e.outputLen),mr(e.blockLen)}(e);const r=kr(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,s=new Uint8Array(n);s.set(r.length>n?e.create().update(r).digest():r);for(let e=0;e<s.length;e++)s[e]^=54;this.iHash.update(s),this.oHash=e.create();for(let e=0;e<s.length;e++)s[e]^=106;this.oHash.update(s),br(s)}update(e){return wr(this),this.iHash.update(e),this}digestInto(e){wr(this),yr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:n,destroyed:s,blockLen:i,outputLen:o}=this;return e.finished=n,e.destroyed=s,e.blockLen=i,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Ni=(e,t,r)=>new Bi(e,t).update(r).digest();function Oi(e){void 0!==e.lowS&&fn("lowS",e.lowS),void 0!==e.prehash&&fn("prehash",e.prehash)}Ni.create=(e,t)=>new Bi(e,t);class Fi extends Error{constructor(e=""){super(e)}}const qi={Err:Fi,_tlv:{encode:(e,t)=>{const{Err:r}=qi;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(1&t.length)throw new r("tlv.encode: unpadded data");const n=t.length/2,s=pn(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const i=n>127?pn(s.length/2|128):"";return pn(e)+i+s+t},decode(e,t){const{Err:r}=qi;let n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");const s=t[n++];let i=0;if(128&s){const e=127&s;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");const o=t.subarray(n,n+e);if(o.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===o[0])throw new r("tlv.decode(long): zero leftmost byte");for(const e of o)i=i<<8|e;if(n+=e,i<128)throw new r("tlv.decode(long): not minimal encoding")}else i=s;const o=t.subarray(n,n+i);if(o.length!==i)throw new r("tlv.decode: wrong value length");return{v:o,l:t.subarray(n+i)}}},_int:{encode(e){const{Err:t}=qi;if(e<zi)throw new t("integer: negative integers are not allowed");let r=pn(e);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){const{Err:t}=qi;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return mn(e)}},toSig(e){const{Err:t,_int:r,_tlv:n}=qi,s=vn("signature",e),{v:i,l:o}=n.decode(48,s);if(o.length)throw new t("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:l,l:u}=n.decode(2,c);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(e){const{_tlv:t,_int:r}=qi,n=t.encode(2,r.encode(e.r))+t.encode(2,r.encode(e.s));return t.encode(48,n)}},zi=BigInt(0),Ki=BigInt(1),$i=BigInt(2),ji=BigInt(3),Vi=BigInt(4);function Hi(e,t,r){const{BYTES:n}=e;return function(s){let i;if("bigint"==typeof s)i=s;else{let r=vn("private key",s);if(t){if(!t.includes(2*r.length))throw new Error("invalid private key");const e=new Uint8Array(n);e.set(r,e.length-r.length),r=e}try{i=e.fromBytes(r)}catch(e){throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof s}`)}}if(r&&(i=e.create(i)),!e.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}}function Gi(e){return Uint8Array.of(e?2:3)}function Wi(e,t,r={}){An(t,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=t.randomBytes||Dr,s=t.hmac||((e,...r)=>Ni(t.hash,e,Pr(...r))),{Fp:i,Fn:o}=e,{ORDER:a,BITS:c}=o;function l(e){return e>a>>Ki}function u(e,t){if(!o.isValidNot0(t))throw new Error(`invalid signature ${e}: out of range 1..CURVE.n`)}class h{constructor(e,t,r){u("r",e),u("s",t),this.r=e,this.s=t,null!=r&&(this.recovery=r),Object.freeze(this)}static fromCompact(e){const t=o.BYTES,r=vn("compactSignature",e,2*t);return new h(o.fromBytes(r.subarray(0,t)),o.fromBytes(r.subarray(t,2*t)))}static fromDER(e){const{r:t,s:r}=qi.toSig(vn("DER",e));return new h(t,r)}assertValidity(){}addRecoveryBit(e){return new h(this.r,this.s,e)}recoverPublicKey(t){const r=i.ORDER,{r:n,s,recovery:c}=this;if(null==c||![0,1,2,3].includes(c))throw new Error("recovery id invalid");if(a*$i<r&&c>1)throw new Error("recovery id is ambiguous for h>1 curve");const l=2===c||3===c?n+a:n;if(!i.isValid(l))throw new Error("recovery id 2 or 3 invalid");const u=i.toBytes(l),h=e.fromHex(Pr(Gi(!(1&c)),u)),d=o.inv(l),f=m(vn("msgHash",t)),p=o.create(-f*d),g=o.create(s*d),y=e.BASE.multiplyUnsafe(p).add(h.multiplyUnsafe(g));if(y.is0())throw new Error("point at infinify");return y.assertValidity(),y}hasHighS(){return l(this.s)}normalizeS(){return this.hasHighS()?new h(this.r,o.neg(this.s),this.recovery):this}toBytes(e){if("compact"===e)return Pr(o.toBytes(this.r),o.toBytes(this.s));if("der"===e)return Cr(qi.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Ar(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Ar(this.toBytes("compact"))}}const d=Hi(o,r.allowedPrivateKeyLengths,r.wrapPrivateKey),f={isValidPrivateKey(e){try{return d(e),!0}catch(e){return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{const e=a;return function(e,t,r=!1){const n=e.length,s=Kn(t),i=$n(t);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=Rn(r?yn(e):mn(e),t-kn)+kn;return r?bn(o,s):wn(o,s)}(n($n(e)),e)},precompute:(t=8,r=e.BASE)=>r.precompute(t,!1)};function p(t){if("bigint"==typeof t)return!1;if(t instanceof e)return!0;const n=vn("key",t).length,s=i.BYTES,a=s+1,c=2*s+1;return r.allowedPrivateKeyLengths||o.BYTES===a?void 0:n===a||n===c}const g=t.bits2int||function(e){if(e.length>8192)throw new Error("input is too large");const t=mn(e),r=8*e.length-c;return r>0?t>>BigInt(r):t},m=t.bits2int_modN||function(e){return o.create(g(e))},y=Sn(c);function w(e){return xn("num < 2^"+c,e,zi,y),o.toBytes(e)}const b={lowS:t.lowS,prehash:!1},v={lowS:t.lowS,prehash:!1};return e.BASE.precompute(8),Object.freeze({getPublicKey:function(t,r=!0){return e.fromPrivateKey(t).toBytes(r)},getSharedSecret:function(t,r,n=!0){if(!0===p(t))throw new Error("first arg must be private key");if(!1===p(r))throw new Error("second arg must be public key");return e.fromHex(r).multiply(d(t)).toBytes(n)},sign:function(r,a,c=b){const{seed:u,k2sig:f}=function(r,s,a=b){if(["recovered","canonical"].some(e=>e in a))throw new Error("sign() legacy options not supported");const{hash:c}=t;let{lowS:u,prehash:f,extraEntropy:p}=a;null==u&&(u=!0),r=vn("msgHash",r),Oi(a),f&&(r=vn("prehashed msgHash",c(r)));const y=m(r),v=d(s),E=[w(v),w(y)];if(null!=p&&!1!==p){const e=!0===p?n(i.BYTES):p;E.push(vn("extraEntropy",e))}const x=Pr(...E),S=y;return{seed:x,k2sig:function(t){const r=g(t);if(!o.isValidNot0(r))return;const n=o.inv(r),s=e.BASE.multiply(r).toAffine(),i=o.create(s.x);if(i===zi)return;const a=o.create(n*o.create(S+i*v));if(a===zi)return;let c=(s.x===i?0:2)|Number(s.y&Ki),d=a;return u&&l(a)&&(d=function(e){return l(e)?o.neg(e):e}(a),c^=1),new h(i,d,c)}}}(r,a,c);return function(e,t,r){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof r)throw new Error("hmacFn must be a function");const n=e=>new Uint8Array(e),s=e=>Uint8Array.of(e);let i=n(e),o=n(e),a=0;const c=()=>{i.fill(1),o.fill(0),a=0},l=(...e)=>r(o,i,...e),u=(e=n(0))=>{o=l(s(0),e),i=l(),0!==e.length&&(o=l(s(1),e),i=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const r=[];for(;e<t;){i=l();const t=i.slice();r.push(t),e+=i.length}return Pr(...r)};return(e,t)=>{let r;for(c(),u(e);!(r=t(h()));)u();return c(),r}}(t.hash.outputLen,o.BYTES,s)(u,f)},verify:function(r,n,s,i=v){const a=r;n=vn("msgHash",n),s=vn("publicKey",s),Oi(i);const{lowS:c,prehash:l,format:u}=i;if("strict"in i)throw new Error("options.strict was renamed to lowS");if(void 0!==u&&!["compact","der","js"].includes(u))throw new Error('format must be "compact", "der" or "js"');const d="string"==typeof a||gr(a),f=!d&&!u&&"object"==typeof a&&null!==a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!d&&!f)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let p,g;try{if(f){if(void 0!==u&&"js"!==u)throw new Error("invalid format");p=new h(a.r,a.s)}if(d){try{"compact"!==u&&(p=h.fromDER(a))}catch(e){if(!(e instanceof qi.Err))throw e}p||"der"===u||(p=h.fromCompact(a))}g=e.fromHex(s)}catch(e){return!1}if(!p)return!1;if(c&&p.hasHighS())return!1;l&&(n=t.hash(n));const{r:y,s:w}=p,b=m(n),E=o.inv(w),x=o.create(b*E),S=o.create(y*E),A=e.BASE.multiplyUnsafe(x).add(g.multiplyUnsafe(S));return!A.is0()&&o.create(A.x)===y},utils:f,Point:e,Signature:h})}function Zi(e){const{CURVE:t,curveOpts:r,ecdsaOpts:n}=function(e){const{CURVE:t,curveOpts:r}=function(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy};return{CURVE:t,curveOpts:{Fp:e.Fp,Fn:zn(t.n,e.nBitLength),allowedPrivateKeyLengths:e.allowedPrivateKeyLengths,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,wrapPrivateKey:e.wrapPrivateKey,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes}}}(e);return{CURVE:t,curveOpts:r,ecdsaOpts:{hash:e.hash,hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN}}}(e);return function(e,t){return Object.assign({},t,{ProjectivePoint:t.Point,CURVE:e})}(e,Wi(function(e,t={}){const{Fp:r,Fn:n}=ss("weierstrass",e,t),{h:s,n:i}=e;An(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:o}=t;if(o&&(!r.is0(e.a)||"bigint"!=typeof o.beta||"function"!=typeof o.splitScalar))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}const c=t.toBytes||function(e,t,n){const{x:s,y:i}=t.toAffine(),o=r.toBytes(s);return fn("isCompressed",n),n?(a(),Pr(Gi(!r.isOdd(i)),o)):Pr(Uint8Array.of(4),o,r.toBytes(i))},l=t.fromBytes||function(e){yr(e);const t=r.BYTES,n=t+1,s=2*t+1,i=e.length,o=e[0],c=e.subarray(1);if(i!==n||2!==o&&3!==o){if(i===s&&4===o){const e=r.fromBytes(c.subarray(0*t,1*t)),n=r.fromBytes(c.subarray(1*t,2*t));if(!h(e,n))throw new Error("bad point: is not on curve");return{x:e,y:n}}throw new Error(`bad point: got length ${i}, expected compressed=${n} or uncompressed=${s}`)}{const e=r.fromBytes(c);if(!r.isValid(e))throw new Error("bad point: is not on curve, wrong x");const t=u(e);let n;try{n=r.sqrt(t)}catch(e){const t=e instanceof Error?": "+e.message:"";throw new Error("bad point: is not on curve, sqrt error"+t)}return a(),!(1&~o)!==r.isOdd(n)&&(n=r.neg(n)),{x:e,y:n}}},u=function(e,t,r){return function(n){const s=e.sqr(n),i=e.mul(s,n);return e.add(e.add(i,e.mul(n,t)),r)}}(r,e.a,e.b);function h(e,t){const n=r.sqr(t),s=u(e);return r.eql(n,s)}if(!h(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const d=r.mul(r.pow(e.a,ji),Vi),f=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(d,f)))throw new Error("bad curve params: a or b");function p(e,t,n=!1){if(!r.isValid(t)||n&&r.is0(t))throw new Error(`bad point coordinate ${e}`);return t}function g(e){if(!(e instanceof b))throw new Error("ProjectivePoint expected")}const m=In((e,t)=>{const{px:n,py:s,pz:i}=e;if(r.eql(i,r.ONE))return{x:n,y:s};const o=e.is0();null==t&&(t=o?r.ONE:r.inv(i));const a=r.mul(n,t),c=r.mul(s,t),l=r.mul(i,t);if(o)return{x:r.ZERO,y:r.ZERO};if(!r.eql(l,r.ONE))throw new Error("invZ was invalid");return{x:a,y:c}}),y=In(e=>{if(e.is0()){if(t.allowInfinityPoint&&!r.is0(e.py))return;throw new Error("bad point: ZERO")}const{x:n,y:s}=e.toAffine();if(!r.isValid(n)||!r.isValid(s))throw new Error("bad point: x or y not field elements");if(!h(n,s))throw new Error("bad point: equation left != right");if(!e.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function w(e,t,n,s,i){return n=new b(r.mul(n.px,e),n.py,n.pz),t=Hn(s,t),n=Hn(i,n),t.add(n)}class b{constructor(e,t,r){this.px=p("x",e),this.py=p("y",t,!0),this.pz=p("z",r),Object.freeze(this)}static fromAffine(e){const{x:t,y:n}=e||{};if(!e||!r.isValid(t)||!r.isValid(n))throw new Error("invalid affine point");if(e instanceof b)throw new Error("projective point not allowed");return r.is0(t)&&r.is0(n)?b.ZERO:new b(t,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){return Gn(b,"pz",e)}static fromBytes(e){return yr(e),b.fromHex(e)}static fromHex(e){const t=b.fromAffine(l(vn("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){const r=Hi(n,t.allowedPrivateKeyLengths,t.wrapPrivateKey);return b.BASE.multiply(r(e))}static msm(e,t){return rs(b,n,e,t)}precompute(e=8,t=!0){return E.setWindowSize(this,e),t||this.multiply(ji),this}_setWindowSize(e){this.precompute(e)}assertValidity(){y(this)}hasEvenY(){const{y:e}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(e)}equals(e){g(e);const{px:t,py:n,pz:s}=this,{px:i,py:o,pz:a}=e,c=r.eql(r.mul(t,a),r.mul(i,s)),l=r.eql(r.mul(n,a),r.mul(o,s));return c&&l}negate(){return new b(this.px,r.neg(this.py),this.pz)}double(){const{a:t,b:n}=e,s=r.mul(n,ji),{px:i,py:o,pz:a}=this;let c=r.ZERO,l=r.ZERO,u=r.ZERO,h=r.mul(i,i),d=r.mul(o,o),f=r.mul(a,a),p=r.mul(i,o);return p=r.add(p,p),u=r.mul(i,a),u=r.add(u,u),c=r.mul(t,u),l=r.mul(s,f),l=r.add(c,l),c=r.sub(d,l),l=r.add(d,l),l=r.mul(c,l),c=r.mul(p,c),u=r.mul(s,u),f=r.mul(t,f),p=r.sub(h,f),p=r.mul(t,p),p=r.add(p,u),u=r.add(h,h),h=r.add(u,h),h=r.add(h,f),h=r.mul(h,p),l=r.add(l,h),f=r.mul(o,a),f=r.add(f,f),h=r.mul(f,p),c=r.sub(c,h),u=r.mul(f,d),u=r.add(u,u),u=r.add(u,u),new b(c,l,u)}add(t){g(t);const{px:n,py:s,pz:i}=this,{px:o,py:a,pz:c}=t;let l=r.ZERO,u=r.ZERO,h=r.ZERO;const d=e.a,f=r.mul(e.b,ji);let p=r.mul(n,o),m=r.mul(s,a),y=r.mul(i,c),w=r.add(n,s),v=r.add(o,a);w=r.mul(w,v),v=r.add(p,m),w=r.sub(w,v),v=r.add(n,i);let E=r.add(o,c);return v=r.mul(v,E),E=r.add(p,y),v=r.sub(v,E),E=r.add(s,i),l=r.add(a,c),E=r.mul(E,l),l=r.add(m,y),E=r.sub(E,l),h=r.mul(d,v),l=r.mul(f,y),h=r.add(l,h),l=r.sub(m,h),h=r.add(m,h),u=r.mul(l,h),m=r.add(p,p),m=r.add(m,p),y=r.mul(d,y),v=r.mul(f,v),m=r.add(m,y),y=r.sub(p,y),y=r.mul(d,y),v=r.add(v,y),p=r.mul(m,v),u=r.add(u,p),p=r.mul(E,v),l=r.mul(w,l),l=r.sub(l,p),p=r.mul(w,m),h=r.mul(E,h),h=r.add(h,p),new b(l,u,h)}subtract(e){return this.add(e.negate())}is0(){return this.equals(b.ZERO)}multiply(e){const{endo:r}=t;if(!n.isValidNot0(e))throw new Error("invalid scalar: out of range");let s,i;const o=e=>E.wNAFCached(this,e,b.normalizeZ);if(r){const{k1neg:t,k1:n,k2neg:a,k2:c}=r.splitScalar(e),{p:l,f:u}=o(n),{p:h,f:d}=o(c);i=u.add(d),s=w(r.beta,l,h,t,a)}else{const{p:t,f:r}=o(e);s=t,i=r}return b.normalizeZ([s,i])[0]}multiplyUnsafe(e){const{endo:r}=t,s=this;if(!n.isValid(e))throw new Error("invalid scalar: out of range");if(e===zi||s.is0())return b.ZERO;if(e===Ki)return s;if(E.hasPrecomputes(this))return this.multiply(e);if(r){const{k1neg:t,k1:n,k2neg:i,k2:o}=r.splitScalar(e),{p1:a,p2:c}=function(e,t,r,n){let s=t,i=e.ZERO,o=e.ZERO;for(;r>jn||n>jn;)r&Vn&&(i=i.add(s)),n&Vn&&(o=o.add(s)),s=s.double(),r>>=Vn,n>>=Vn;return{p1:i,p2:o}}(b,s,n,o);return w(r.beta,a,c,t,i)}return E.wNAFCachedUnsafe(s,e)}multiplyAndAddUnsafe(e,t,r){const n=this.multiplyUnsafe(t).add(e.multiplyUnsafe(r));return n.is0()?void 0:n}toAffine(e){return m(this,e)}isTorsionFree(){const{isTorsionFree:e}=t;return s===Ki||(e?e(b,this):E.wNAFCachedUnsafe(this,i).is0())}clearCofactor(){const{clearCofactor:e}=t;return s===Ki?this:e?e(b,this):this.multiplyUnsafe(s)}toBytes(e=!0){return fn("isCompressed",e),this.assertValidity(),c(b,this,e)}toRawBytes(e=!0){return this.toBytes(e)}toHex(e=!0){return Ar(this.toBytes(e))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}b.BASE=new b(e.Gx,e.Gy,r.ONE),b.ZERO=new b(r.ZERO,r.ONE,r.ZERO),b.Fp=r,b.Fn=n;const v=n.BITS,E=ts(b,t.endo?Math.ceil(v/2):v);return b}(t,r),n,r))}const Yi={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},Qi=(BigInt(0),BigInt(1)),Xi=BigInt(2),Ji=(e,t)=>(e+t/Xi)/t;const eo=zn(Yi.p,void 0,void 0,{sqrt:function(e){const t=Yi.p,r=BigInt(3),n=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=e*e*e%t,u=l*l*e%t,h=Un(u,r,t)*u%t,d=Un(h,r,t)*u%t,f=Un(d,Xi,t)*l%t,p=Un(f,s,t)*f%t,g=Un(p,i,t)*p%t,m=Un(g,a,t)*g%t,y=Un(m,c,t)*m%t,w=Un(y,a,t)*g%t,b=Un(w,r,t)*u%t,v=Un(b,o,t)*p%t,E=Un(v,n,t)*l%t,x=Un(E,Xi,t);if(!eo.eql(eo.sqr(x),e))throw new Error("Cannot find square root");return x}}),to=function(e,t){const r=t=>Zi({...e,hash:t});return{...r(t),create:r}}({...Yi,Fp:eo,lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Yi.n,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Qi*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=r,o=BigInt("0x100000000000000000000000000000000"),a=Ji(i*e,t),c=Ji(-n*e,t);let l=Rn(e-a*r-c*s,t),u=Rn(-a*n-c*i,t);const h=l>o,d=u>o;if(h&&(l=t-l),d&&(u=t-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:l,k2neg:d,k2:u}}}},ln);function ro({name:e,code:t,encode:r}){return new no(e,t,r)}class no{name;code;encode;constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?jt(this.code,t):t.then(e=>jt(this.code,e))}throw Error("Unknown type, must be binary type")}}function so(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}const io=ro({name:"sha2-256",code:18,encode:so("SHA-256")}),oo=(ro({name:"sha2-512",code:19,encode:so("SHA-512")}),32);class ao{type="secp256k1";raw;_key;constructor(e){this._key=function(e){try{return to.ProjectivePoint.fromHex(e),e}catch(e){throw new w(String(e))}}(e),this.raw=function(e){return to.ProjectivePoint.fromHex(e).toRawBytes(!0)}(this._key)}toMultihash(){return tr(lo(this))}toCID(){return Zt.createV1(114,this.toMultihash())}toString(){return St.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&C(this.raw,e.raw)}verify(e,t,r){return function(e,t,r,n){const s=io.digest(r instanceof Uint8Array?r:r.subarray());if(_s(s))return s.then(({digest:r})=>(n?.signal?.throwIfAborted(),to.verify(t,r,e))).catch(e=>{if("AbortError"===e.name)throw e;throw new Ss(String(e))});try{return n?.signal?.throwIfAborted(),to.verify(t,s.digest,e)}catch(e){throw new Ss(String(e))}}(this._key,t,e,r)}}class co{type="secp256k1";raw;publicKey;constructor(e,t){this.raw=function(e){try{return to.getPublicKey(e,!0),e}catch(e){throw new b(String(e))}}(e),this.publicKey=new ao(t??function(e){try{return to.getPublicKey(e,!0)}catch(e){throw new b(String(e))}}(e))}equals(e){return null!=e&&e.raw instanceof Uint8Array&&C(this.raw,e.raw)}sign(e,t){return function(e,t,r){const n=io.digest(t instanceof Uint8Array?t:t.subarray());if(_s(n))return n.then(({digest:t})=>(r?.signal?.throwIfAborted(),to.sign(t,e).toDERRawBytes())).catch(e=>{if("AbortError"===e.name)throw e;throw new xs(String(e))});try{return to.sign(n.digest,e).toDERRawBytes()}catch(e){throw new xs(String(e))}}(this.raw,e,t)}}function lo(e){return Ai.encode({Type:xi[e.type],Data:e.raw})}function uo(e){if(e.byteLength===ks)return function(e){if(e.length>ks){const t=(e=Rs(e,ks+Cs)).subarray(0,ks),r=e.subarray(ks,e.length);return new Ls(t,r)}const t=(e=Rs(e,ks)).subarray(0,ks),r=e.subarray(Cs);return new Ls(t,r)}(e);if(e.byteLength===oo)return new co(e);const t=ot(e),r=t[2]?.[0];if(r===v||r===E||r===x)return function(e){const t=e[1],r=tt(t,"base64url"),n=e[2][1][0];let s,i;if(t.byteLength===ur)return s=tt(n.subarray(1,1+ur),"base64url"),i=tt(n.subarray(1+ur),"base64url"),new nr({...ar,key_ops:["sign"],d:r,x:s,y:i});if(t.byteLength===hr)return s=tt(n.subarray(1,1+hr),"base64url"),i=tt(n.subarray(1+hr),"base64url"),new nr({...cr,key_ops:["sign"],d:r,x:s,y:i});if(t.byteLength===dr)return s=tt(n.subarray(1,1+dr),"base64url"),i=tt(n.subarray(1+dr),"base64url"),new nr({...lr,key_ops:["sign"],d:r,x:s,y:i});throw new y(`Private key length was wrong length, got ${t.byteLength}, expected 32, 48 or 66`)}(t);if(t.length>8)return Mi(t);throw new y("Could not extract private key from raw bytes")}},7944:()=>{"use strict";try{self["workbox:core:7.2.0"]&&_()}catch(e){}},7987:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var n=r(515);const s=globalThis.CustomEvent??Event;async function*i(e,t={}){let r=t.concurrency??1/0;r<1&&(r=1/0);const i=t.ordered??!1,o=new EventTarget,a=[];let c,l=(0,n.A)(),u=(0,n.A)(),h=!1,d=!1;function f(){return i?a[0]?.done:Boolean(a.find(e=>e.done))}function*p(){for(;a.length>0&&a[0].done;){const e=a[0];if(a.shift(),!e.ok)throw d=!0,l.resolve(),e.err;yield e.value,l.resolve()}}function*g(){for(;f();)for(let e=0;e<a.length;e++)if(a[e].done){const t=a[e];if(a.splice(e,1),e--,!t.ok)throw d=!0,l.resolve(),t.err;yield t.value,l.resolve()}}for(o.addEventListener("task-complete",()=>{u.resolve()}),Promise.resolve().then(async()=>{try{for await(const t of e){if(a.length===r&&(l=(0,n.A)(),await l.promise),d)break;const e={done:!1};a.push(e),t().then(t=>{e.done=!0,e.ok=!0,e.value=t,o.dispatchEvent(new s("task-complete"))},t=>{e.done=!0,e.err=t,o.dispatchEvent(new s("task-complete"))})}h=!0,o.dispatchEvent(new s("task-complete"))}catch(e){c=e,o.dispatchEvent(new s("task-complete"))}});;){if(f()||(u=(0,n.A)(),await u.promise),null!=c)throw c;if(i?yield*p():yield*g(),null!=c)throw c;if(h&&0===a.length)break}}},8192:(e,t,r)=>{"use strict";r.d(t,{G:()=>i});var n=r(6760);let s;r(5706);const i=()=>(s||(s=new n.I,s.addFetchListener(),s.addCacheListener()),s)},8289:(e,t,r)=>{"use strict";r.d(t,{DS:()=>b,OG:()=>y,Ph:()=>l,aK:()=>g,dJ:()=>m,e8:()=>o,fg:()=>w,lX:()=>u,lq:()=>h,qj:()=>f,x:()=>v,z:()=>d,zW:()=>a});var n=r(4597);const s=BigInt(0),i=BigInt(1);function o(e,t){if("boolean"!=typeof t)throw new Error(e+" boolean expected, got "+t)}function a(e){const t=e.toString(16);return 1&t.length?"0"+t:t}function c(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?s:BigInt("0x"+e)}function l(e){return c((0,n.My)(e))}function u(e){return(0,n.DO)(e),c((0,n.My)(Uint8Array.from(e).reverse()))}function h(e,t){return(0,n.aT)(e.toString(16).padStart(2*t,"0"))}function d(e,t){return h(e,t).reverse()}function f(e,t,r){let s;if("string"==typeof t)try{s=(0,n.aT)(t)}catch(t){throw new Error(e+" must be hex string or Uint8Array, cause: "+t)}else{if(!(0,n.aY)(t))throw new Error(e+" must be hex string or Uint8Array");s=Uint8Array.from(t)}const i=s.length;if("number"==typeof r&&i!==r)throw new Error(e+" of length "+r+" expected, got "+i);return s}const p=e=>"bigint"==typeof e&&s<=e;function g(e,t,r,n){if(!function(e,t,r){return p(e)&&p(t)&&p(r)&&t<=e&&e<r}(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function m(e){let t;for(t=0;e>s;e>>=i,t+=1);return t}const y=e=>(i<<BigInt(e))-i;function w(e,t,r){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof r)throw new Error("hmacFn must be a function");const s=e=>new Uint8Array(e),i=e=>Uint8Array.of(e);let o=s(e),a=s(e),c=0;const l=()=>{o.fill(1),a.fill(0),c=0},u=(...e)=>r(a,o,...e),h=(e=s(0))=>{a=u(i(0),e),o=u(),0!==e.length&&(a=u(i(1),e),o=u())},d=()=>{if(c++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const r=[];for(;e<t;){o=u();const t=o.slice();r.push(t),e+=o.length}return(0,n.Id)(...r)};return(e,t)=>{let r;for(l(),h(e);!(r=t(d()));)h();return l(),r}}function b(e,t,r={}){if(!e||"object"!=typeof e)throw new Error("expected valid options object");function n(t,r,n){const s=e[t];if(n&&void 0===s)return;const i=typeof s;if(i!==r||null===s)throw new Error(`param "${t}" is invalid: expected ${r}, got ${i}`)}Object.entries(t).forEach(([e,t])=>n(e,t,!1)),Object.entries(r).forEach(([e,t])=>n(e,t,!0))}function v(e){const t=new WeakMap;return(r,...n)=>{const s=t.get(r);if(void 0!==s)return s;const i=e(r,...n);return t.set(r,i),i}}},8304:(e,t,r)=>{"use strict";r.d(t,{O:()=>w});var n=r(7442),s=r(6345),i=r(5131);const o=64;class a{fp;h;seed;constructor(e,t,r,n=2){if(n>o)throw new TypeError("Invalid Fingerprint Size");const i=t.hashV(e,r),a=(0,s.c)(n);for(let e=0;e<a.length;e++)a[e]=i[e];0===a.length&&(a[0]=7),this.fp=a,this.h=t,this.seed=r}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return e?.fp instanceof Uint8Array&&(0,i.a)(this.fp,e.fp)}}function c(e,t){return Math.floor(Math.random()*(t-e))+e}class l{contents;constructor(e){this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof a))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof a))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(null==this.contents[t])return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof a))throw new TypeError("Invalid Fingerprint");const t=c(0,this.contents.length-1),r=this.contents[t];return this.contents[t]=e,r}remove(e){if(!(e instanceof a))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(t=>e.equals(t));return t>-1&&(this.contents[t]=null,!0)}}const u={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},h={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},d=new globalThis.TextEncoder;const f={hash:e=>Number(function(e,{size:t=32,utf8Buffer:r}={}){if(!u[t])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if("string"==typeof e){if(r)return function(e,t,r){if(0===r.length)throw new Error("The `utf8Buffer` option must have a length greater than zero");const n=u[t];let s=h[t],i=e;for(;i.length>0;){const e=d.encodeInto(i,r);i=i.slice(e.read);for(let i=0;i<e.written;i++)s^=BigInt(r[i]),s=BigInt.asUintN(t,s*n)}return s}(e,t,r);e=d.encode(e)}return function(e,t){const r=u[t];let n=h[t];for(let s=0;s<e.length;s++)n^=BigInt(e[s]),n=BigInt.asUintN(t,n*r);return n}(e,t)}(e,{size:32})),hashV:(e,t)=>function(e){let t=e.toString(16);return t.length%2==1&&(t=`0${t}`),(0,n.s)(t,"base16")}(f.hash(e,t))};class p{bucketSize;filterSize;fingerprintSize;buckets;count;hash;seed;constructor(e){this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??f,this.seed=e.seed??c(0,Math.pow(2,10))}add(e){"string"==typeof e&&(e=(0,n.s)(e));const t=new a(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,s=(r^t.hash())%this.filterSize;if(null==this.buckets[r]&&(this.buckets[r]=new l(this.bucketSize)),null==this.buckets[s]&&(this.buckets[s]=new l(this.bucketSize)),this.buckets[r].add(t)||this.buckets[s].add(t))return this.count++,!0;const i=[r,s];let o=i[c(0,i.length-1)];null==this.buckets[o]&&(this.buckets[o]=new l(this.bucketSize));for(let e=0;e<500;e++){const e=this.buckets[o].swap(t);if(null!=e&&(o=(o^e.hash())%this.filterSize,null==this.buckets[o]&&(this.buckets[o]=new l(this.bucketSize)),this.buckets[o].add(e)))return this.count++,!0}return!1}has(e){"string"==typeof e&&(e=(0,n.s)(e));const t=new a(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,s=this.buckets[r]?.has(t)??!1;if(s)return s;const i=(r^t.hash())%this.filterSize;return this.buckets[i]?.has(t)??!1}remove(e){"string"==typeof e&&(e=(0,n.s)(e));const t=new a(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,s=this.buckets[r]?.remove(t)??!1;if(s)return this.count--,s;const i=(r^t.hash())%this.filterSize,o=this.buckets[i]?.remove(t)??!1;return o&&this.count--,o}get reliable(){return Math.floor(this.count/this.filterSize*100)<=90}}const g={1:.5,2:.84,4:.95,8:.98};function m(e,t=.001){const r=function(e=.001){return e>.002?2:e>1e-5?4:8}(t),n=g[r];return{filterSize:Math.round(e/n),bucketSize:r,fingerprintSize:Math.min(Math.ceil(Math.log2(1/t)+Math.log2(2*r)),o)}}class y{filterSize;bucketSize;fingerprintSize;scale;filterSeries;hash;seed;constructor(e){this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??f,this.seed=e.seed??c(0,Math.pow(2,10)),this.filterSeries=[new p({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if("string"==typeof e&&(e=(0,n.s)(e)),this.has(e))return!0;let t=this.filterSeries.find(e=>e.reliable);if(null==t){const e=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new p({filterSize:e,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){"string"==typeof e&&(e=(0,n.s)(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){"string"==typeof e&&(e=(0,n.s)(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function w(e,t=.001,r){return new y({...m(e,t),...r??{}})}},8337:(e,t,r)=>{"use strict";function n(){}r.d(t,{k:()=>n})},8566:(e,t,r)=>{"use strict";r.d(t,{y:()=>X});var n=r(7191),s=r(2090),i=r(9583),o=r(6800),a=r(8304);class c{filter;constructor(e,t){this.filter=(0,a.O)(e,t)}has(e){return this.filter.has(e.toMultihash().bytes)}add(e){this.filter.add(e.toMultihash().bytes)}remove(e){this.filter.remove?.(e.toMultihash().bytes)}}function l(e,t=.001){return new c(e,t)}var u=r(5291),h=r(6267),d=r(9986);function f(e){const{stream:t,remoteAddr:r,logger:n,onDataRead:s,onDataWrite:i}=e,o=n.forComponent("libp2p:stream:converter");let a=!1,c=!1;const l=t.close.bind(t);t.close=async e=>{await l(e),g(!0)};const u=t.abort.bind(t);t.abort=e=>{u(e),g(!0)};const f=t.sink.bind(t);t.sink=async e=>{try{await f((0,d.F)(e,e=>(0,h.A)(e,e=>i?.(e))))}catch(e){"aborted"!==e.type&&o.error("%s error in sink",r,e)}finally{c=!0,g()}};const p={log:o,sink:t.sink,source:async function*(){try{for await(const e of t.source)s?.(e),yield e}finally{a=!0,g()}}(),remoteAddr:r,timeline:{open:Date.now(),close:void 0},close:t.close,abort:t.abort};function g(e){!0===e&&(a=!0,c=!0),a&&c&&null==p.timeline.close&&(p.timeline.close=Date.now())}return p}var p=r(4135),g=r(386),m=r(6209),y=r(8337),w=r(6915),b=r(4214);const v=`${r(3951).Q}-circuit-relay`,E=(BigInt(1<<17),"/libp2p/circuit/relay/0.2.0/hop"),x="/libp2p/circuit/relay/0.2.0/stop";var S,A,I,C,k,P,T,_,D,L=r(4113),R=r(6345);!function(e){let t,r,n;!function(e){e.RESERVE="RESERVE",e.CONNECT="CONNECT",e.STATUS="STATUS"}(t=e.Type||(e.Type={})),function(e){e[e.RESERVE=0]="RESERVE",e[e.CONNECT=1]="CONNECT",e[e.STATUS=2]="STATUS"}(r||(r={})),function(e){e.codec=()=>(0,L.eG)(r)}(t=e.Type||(e.Type={})),e.codec=()=>(null==n&&(n=(0,L.iU)((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.peer&&(r.uint32(18),I.codec().encode(t.peer,r)),null!=t.reservation&&(r.uint32(26),C.codec().encode(t.reservation,r)),null!=t.limit&&(r.uint32(34),k.codec().encode(t.limit,r)),null!=t.status&&(r.uint32(40),P.codec().encode(t.status,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{const s={},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:s.type=e.Type.codec().decode(t);break;case 2:s.peer=I.codec().decode(t,t.uint32(),{limits:n.limits?.peer});break;case 3:s.reservation=C.codec().decode(t,t.uint32(),{limits:n.limits?.reservation});break;case 4:s.limit=k.codec().decode(t,t.uint32(),{limits:n.limits?.limit});break;case 5:s.status=P.codec().decode(t);break;default:t.skipType(7&r)}}return s})),n),e.encode=t=>(0,L.mH)(t,e.codec()),e.decode=(t,r)=>(0,L.Y8)(t,e.codec(),r)}(S||(S={})),function(e){let t,r,n;!function(e){e.CONNECT="CONNECT",e.STATUS="STATUS"}(t=e.Type||(e.Type={})),function(e){e[e.CONNECT=0]="CONNECT",e[e.STATUS=1]="STATUS"}(r||(r={})),function(e){e.codec=()=>(0,L.eG)(r)}(t=e.Type||(e.Type={})),e.codec=()=>(null==n&&(n=(0,L.iU)((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.peer&&(r.uint32(18),I.codec().encode(t.peer,r)),null!=t.limit&&(r.uint32(26),k.codec().encode(t.limit,r)),null!=t.status&&(r.uint32(32),P.codec().encode(t.status,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{const s={},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:s.type=e.Type.codec().decode(t);break;case 2:s.peer=I.codec().decode(t,t.uint32(),{limits:n.limits?.peer});break;case 3:s.limit=k.codec().decode(t,t.uint32(),{limits:n.limits?.limit});break;case 4:s.status=P.codec().decode(t);break;default:t.skipType(7&r)}}return s})),n),e.encode=t=>(0,L.mH)(t,e.codec()),e.decode=(t,r)=>(0,L.Y8)(t,e.codec(),r)}(A||(A={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,L.iU)((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.id&&e.id.byteLength>0&&(t.uint32(10),t.bytes(e.id)),null!=e.addrs)for(const r of e.addrs)t.uint32(18),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={id:(0,R.c)(0),addrs:[]},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:if(null!=r.limits?.addrs&&n.addrs.length===r.limits.addrs)throw new L.zH('Decode error - map field "addrs" had too many elements');n.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,L.mH)(t,e.codec()),e.decode=(t,r)=>(0,L.Y8)(t,e.codec(),r)}(I||(I={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,L.iU)((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.expire&&0n!==e.expire&&(t.uint32(8),t.uint64(e.expire)),null!=e.addrs)for(const r of e.addrs)t.uint32(18),t.bytes(r);null!=e.voucher&&(t.uint32(26),D.codec().encode(e.voucher,t)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={expire:0n,addrs:[]},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.expire=e.uint64();break;case 2:if(null!=r.limits?.addrs&&n.addrs.length===r.limits.addrs)throw new L.zH('Decode error - map field "addrs" had too many elements');n.addrs.push(e.bytes());break;case 3:n.voucher=D.codec().decode(e,e.uint32(),{limits:r.limits?.voucher});break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,L.mH)(t,e.codec()),e.decode=(t,r)=>(0,L.Y8)(t,e.codec(),r)}(C||(C={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,L.iU)((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.duration&&(t.uint32(8),t.uint32(e.duration)),null!=e.data&&(t.uint32(16),t.uint64(e.data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.duration=e.uint32();break;case 2:n.data=e.uint64();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,L.mH)(t,e.codec()),e.decode=(t,r)=>(0,L.Y8)(t,e.codec(),r)}(k||(k={})),function(e){e.UNUSED="UNUSED",e.OK="OK",e.RESERVATION_REFUSED="RESERVATION_REFUSED",e.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONNECTION_FAILED="CONNECTION_FAILED",e.NO_RESERVATION="NO_RESERVATION",e.MALFORMED_MESSAGE="MALFORMED_MESSAGE",e.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"}(P||(P={})),function(e){e[e.UNUSED=0]="UNUSED",e[e.OK=100]="OK",e[e.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",e[e.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",e[e.PERMISSION_DENIED=202]="PERMISSION_DENIED",e[e.CONNECTION_FAILED=203]="CONNECTION_FAILED",e[e.NO_RESERVATION=204]="NO_RESERVATION",e[e.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",e[e.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"}(T||(T={})),function(e){e.codec=()=>(0,L.eG)(T)}(P||(P={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,L.iU)((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.relay&&e.relay.byteLength>0&&(t.uint32(10),t.bytes(e.relay)),null!=e.peer&&e.peer.byteLength>0&&(t.uint32(18),t.bytes(e.peer)),null!=e.expiration&&0n!==e.expiration&&(t.uint32(24),t.uint64(e.expiration)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={relay:(0,R.c)(0),peer:(0,R.c)(0),expiration:0n},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.relay=e.bytes();break;case 2:n.peer=e.bytes();break;case 3:n.expiration=e.uint64();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,L.mH)(t,e.codec()),e.decode=(t,r)=>(0,L.Y8)(t,e.codec(),r)}(_||(_={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,L.iU)((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.publicKey&&e.publicKey.byteLength>0&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.payloadType&&e.payloadType.byteLength>0&&(t.uint32(18),t.bytes(e.payloadType)),null!=e.payload&&(t.uint32(26),_.codec().encode(e.payload,t)),null!=e.signature&&e.signature.byteLength>0&&(t.uint32(42),t.bytes(e.signature)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{const n={publicKey:(0,R.c)(0),payloadType:(0,R.c)(0),signature:(0,R.c)(0)},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:n.publicKey=e.bytes();break;case 2:n.payloadType=e.bytes();break;case 3:n.payload=_.codec().decode(e,e.uint32(),{limits:r.limits?.payload});break;case 5:n.signature=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>(0,L.mH)(t,e.codec()),e.decode=(t,r)=>(0,L.Y8)(t,e.codec(),r)}(D||(D={}));var U=r(6115);function M(e){const t=e*BigInt(1e3),r=(new Date).getTime();return Number(t-BigInt(r))}r(5494),r(142);class B{expires;bytes;constructor(e){null!=e?.duration&&0!==e?.duration&&(this.expires=Date.now()+1e3*e.duration),this.bytes=e?.data,0n===this.bytes&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(e){null!=this.bytes&&(this.bytes-=BigInt(e.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(null==this.expires&&null==this.bytes)return;const e={};if(null!=this.bytes){const t=this;Object.defineProperty(e,"bytes",{get:()=>t.bytes})}if(null!=this.expires){const t=this;Object.defineProperty(e,"seconds",{get:()=>Math.round(((t.expires??0)-Date.now())/1e3)})}return e}}const N=(0,U.Sc)((0,U.Uo)(g.VO.matchers[0],(0,U.eu)("p2p-circuit"))),O=(0,U.Sc)((0,U.eu)("p2p-circuit"));var F=r(9163),q=r(704),z=r(2860),K=r(5129);class $ extends z.X{components;started;running;topologyId;log;discoveryController;filter;queue;constructor(e,t={}){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.components=e,this.started=!1,this.running=!1,this.filter=t.filter,this.discoveryController=new AbortController,(0,y.k)(1/0,this.discoveryController.signal),this.dialPeer=this.dialPeer.bind(this),this.onPeer=this.onPeer.bind(this)}isStarted(){return this.started}async start(){this.topologyId=await this.components.registrar.register(E,{filter:this.filter,onConnect:e=>{this.log.trace("discovered relay %p queue (length: %d, active %d)",e,this.queue?.size,this.queue?.running),this.safeDispatchEvent("relay:discover",{detail:e})}}),this.started=!0}stop(){null!=this.topologyId&&this.components.registrar.unregister(this.topologyId),this.running&&this.stopDiscovery(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,(0,y.k)(1/0,this.discoveryController.signal),this.components.events.addEventListener("peer:discovery",this.onPeer),Promise.resolve().then(async()=>{this.log("searching peer store for relays");const e=await this.components.peerStore.all({filters:[e=>e.protocols.includes(E)],orders:[()=>Math.random()<.5?1:-1,(e,t)=>{const r=j(e),n=j(t);return r>n?-1:n>r?1:0}]});for(const t of e)this.log.trace("found relay peer %p in peer store",t.id),this.safeDispatchEvent("relay:discover",{detail:t.id});this.log("found %d relay peers in peer store",e.length);const t=this.queue=new F.w({concurrency:5});this.log("start random walk");for await(const e of this.components.randomWalk.walk({signal:this.discoveryController.signal}))this.log.trace("found random peer %p",e.id),t.has(e.id)?this.log.trace("random peer %p was already in queue",e.id):this.components.connectionManager.getConnections(e.id)?.length>0?this.log.trace("random peer %p was already connected",e.id):await this.components.connectionManager.isDialable(e.multiaddrs)?(t.queued>10&&(this.log.trace("wait for space in queue for %p",e.id),await t.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",e.id,t.size,t.running),t.add(this.dialPeer,{peerId:e.id,signal:this.discoveryController.signal}).catch(t=>{this.log.error("error opening connection to random peer %p",e.id,t)})):this.log.trace("random peer %p was not dialable",e.id,e.multiaddrs.map(e=>e.toString()));this.log("stop random walk"),await t.onIdle()}).catch(e=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network",e)}))}stopDiscovery(){this.log("stop discovery"),this.running=!1,this.discoveryController?.abort(),this.queue?.clear(),this.components.events.removeEventListener("peer:discovery",this.onPeer)}onPeer(e){this.log.trace("maybe dialing discovered peer %p - %e",e.detail.id),this.maybeDialPeer(e).catch(t=>{this.log.trace("error dialing discovered peer %p - %e",e.detail.id,t)})}async maybeDialPeer(e){if(null==this.queue)return;const t=e.detail.id,r=e.detail.multiaddrs;this.queue.has(t)?this.log.trace("random peer %p was already in queue",t):this.components.connectionManager.getConnections(t)?.length>0?this.log.trace("random peer %p was already connected",t):await this.components.connectionManager.isDialable(r)?this.queue?.add(this.dialPeer,{peerId:e.detail.id,signal:this.discoveryController.signal}).catch(t=>{this.log.error("error opening connection to discovered peer %p",e.detail.id,t)}):this.log.trace("random peer %p was not dialable",t)}async dialPeer({peerId:e,signal:t}){const r=(0,q.J)([AbortSignal.timeout(5e3),t]);(0,y.k)(1/0,r);try{await this.components.connectionManager.openConnection(e,{signal:r})}finally{r.clear()}}}function j(e){const t=e.metadata.get("last-dial-success");return null==t?0:new Date((0,K.d)(t)).getTime()}class V extends z.X{connectionManager;addressManager;reservationStore;listeningAddrs;log;listenTimeout;reservationId;relay;constructor(e,t={}){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=e.connectionManager,this.addressManager=e.addressManager,this.reservationStore=e.reservationStore,this.listeningAddrs=[],this.listenTimeout=t.listenTimeout??2e3,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}_onRemoveRelayPeer=e=>{this.log("relay removed %p our relay %p",e.detail.relay,this.relay,this.relay?.equals(e.detail.relay)),!0===this.relay?.equals(e.detail.relay)&&(this.log("relay peer removed %p",e.detail.relay),this.listeningAddrs.forEach(e=>{this.addressManager.removeObservedAddr(e)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))};_onAddRelayPeer=e=>{const{details:t}=e.detail;"configured"!==t.type&&t.id===this.reservationId&&this.addedRelay(e.detail)};async listen(e){if(O.exactMatch(e))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else{if(!N.exactMatch(e))throw new o.U7(`Could not listen on p2p-circuit address "${e}"`);{this.log("listen on specific relay server %a",e);const t=AbortSignal.timeout(this.listenTimeout);(0,y.k)(1/0,t);const r=e.decapsulate("/p2p-circuit"),n=await this.connectionManager.openConnection(r,{signal:t});if(!this.reservationStore.hasReservation(n.remotePeer)){this.log("making reservation on peer %p",n.remotePeer);const e=await this.reservationStore.addRelay(n.remotePeer,"configured");this.addedRelay(e)}}}}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}async close(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})}addedRelay(e){this.log("relay peer added %p",e.relay),this.relay=e.relay,this.listeningAddrs=e.details.reservation.addrs.map(e=>(0,p.HZ)(e).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(e=>{this.addressManager.confirmObservedAddr(e,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}}var H=r(5086);Error,Error;class G extends Error{static name="HadEnoughRelaysError";name="HadEnoughRelaysError"}class W extends Error{static name="DoubleRelayError";name="DoubleRelayError"}class Z extends Error{static name="RelayQueueFullError";name="RelayQueueFullError"}class Y extends z.X{peerId;connectionManager;peerStore;events;reserveQueue;reservations;pendingReservations;maxReservationQueueLength;reservationCompletionTimeout;started;log;relayFilter;constructor(e,t){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.reservations=new H.j,this.pendingReservations=[],this.maxReservationQueueLength=t?.maxReservationQueueLength??100,this.reservationCompletionTimeout=t?.reservationCompletionTimeout??2e3,this.started=!1,this.relayFilter=(0,a.O)(100),this.reserveQueue=new F.w({concurrency:t?.reservationConcurrency??1,metricName:"libp2p_relay_reservation_queue",metrics:e.metrics}),this.events.addEventListener("connection:close",e=>{null!=[...this.reservations.values()].find(t=>t.connection===e.detail.id)&&this.#M(e.detail.remotePeer).catch(t=>{this.log("could not remove relay %p - %e",e.detail,t)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[e=>e.tags.has(v)]});this.log("removing tag from %d old relays",e.length),await Promise.all(e.map(async e=>{await this.peerStore.merge(e.id,{tags:{[v]:void 0}})})),this.log("redialing %d old relays",e.length),await Promise.all(e.map(async e=>this.addRelay(e.id,"discovered"))),this.#B()}).catch(e=>{this.log.error(e)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:e})=>{clearTimeout(e)}),this.reservations.clear(),this.started=!1}reserveRelay(){const e=((e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[e]];return t})();return this.pendingReservations.push(e),this.#B(),e}async addRelay(e,t){if(this.peerId.equals(e))throw this.log.trace("not trying to use self as relay"),new o.U7("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new Z("The reservation queue is full");const r=this.reserveQueue.find(e);if(null!=r)return this.log.trace("potential relay peer %p is already in the reservation queue",e),r.join();if(this.relayFilter.has(e.toMultihash().bytes))throw new o.U7("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",e),this.reserveQueue.add(async()=>{const r=Date.now();try{const r=this.reservations.get(e);if(null!=r){const t=this.connectionManager.getConnections(e);let n=!1;if(0===t.length&&this.log("already have relay reservation with %p but we are no longer connected",e),t.map(e=>e.id).includes(r.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",e),n=!0),n&&M(r.reservation.expire)>6e5)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",e),{relay:e,details:r};await this.#M(e)}if("discovered"===t&&0===this.pendingReservations.length)throw new G("Not making reservation on discovered relay because we do not need any more relays");const n=AbortSignal.timeout(this.reservationCompletionTimeout);(0,y.k)(1/0,n);const s=await this.connectionManager.openConnection(e,{signal:n});if(g.uu.matches(s.remoteAddr))throw new W("not creating reservation over relayed connection");const i=await this.#N(s,{signal:n}),o=M(i.expire);this.log("created reservation on relay peer %p, expiry date is %s",e,new Date(Date.now()+o).toString());const a=Math.min(Math.max(o-3e5,3e4),Math.pow(2,31)-1),c=setTimeout(()=>{this.log("refresh reservation to relay %p",e),this.addRelay(e,t).catch(async t=>{this.log.error("could not refresh reservation to relay %p - %e",e,t),await this.#M(e)}).catch(t=>{this.log.error("could not remove expired reservation to relay %p - %e",e,t)})},a);let l;if("discovered"===t){const e=this.pendingReservations.pop();if(null==e)throw new G("Made reservation on relay but did not need any more discovered relays");l={timeout:c,reservation:i,type:t,connection:s.id,id:e}}else l={timeout:c,reservation:i,type:t,connection:s.id};this.reservations.set(e,l),await this.peerStore.merge(e,{tags:{[v]:{value:1,ttl:o}}}),this.#B();const u={relay:e,details:l};return this.safeDispatchEvent("relay:created-reservation",{detail:u}),u}catch(n){throw"discovered"===t&&"HadEnoughRelaysError"===n.name||this.log.error("could not reserve slot on %p after %dms - %e",e,Date.now()-r,n),"DialError"!==n.name&&"UnsupportedProtocolError"!==n.name||this.relayFilter.add(e.toMultihash().bytes),this.#M(e).catch(t=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",e,t)}),n}},{peerId:e})}hasReservation(e){return this.reservations.has(e)}getReservation(e){return this.reservations.get(e)?.reservation}reservationCount(e){return null==e?this.reservations.size:[...this.reservations.values()].reduce((t,r)=>(r.type===e&&t++,t),0)}cancelReservations(){[...this.reservations.values()].forEach(e=>{clearTimeout(e.timeout)}),this.reservations.clear()}async#N(e,t){t.signal?.throwIfAborted(),this.log("requesting reservation from %p",e.remotePeer);const r=await e.newStream(E,t),n=(0,m.z)(r).pb(S);let s;this.log.trace("send RESERVE to %p",e.remotePeer),await n.write({type:S.Type.RESERVE},t);try{this.log.trace("reading response from %p",e.remotePeer),s=await n.read(t)}catch(e){throw r.abort(e),e}finally{"closed"!==r.status&&await r.close(t)}if(this.log.trace("read response %o",s),s.status===P.OK&&null!=s.reservation){const t=new Set;t.add(e.remoteAddr.toString());for(const r of s.reservation.addrs){let n=(0,p.HZ)(r);null==n.getPeerId()&&(n=n.encapsulate(`/p2p/${e.remotePeer}`)),n=(0,p.HZ)(n.toString().replace(`/p2p/${e.remotePeer}/p2p/${e.remotePeer}`,`/p2p/${e.remotePeer}`)),t.add(n.toString())}return s.reservation.addrs=[...t].map(e=>(0,p.HZ)(e).bytes),s.reservation}const i=`reservation failed with status ${s.status??"undefined"}`;throw this.log.error(i),new Error(i)}async#M(e){const t=this.reservations.get(e);null!=t&&(this.log("removing relay reservation with %p from local store",e),clearTimeout(t.timeout),this.reservations.delete(e),"discovered"===t.type&&this.pendingReservations.push(t.id),await this.peerStore.merge(e,{tags:{[v]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:e,details:t}}),this.#B())}#B(){if(0===this.pendingReservations.length)return this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),void this.safeDispatchEvent("relay:found-enough-relays");this.relayFilter=(0,a.O)(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")}}class Q{discovery;registrar;peerStore;connectionManager;transportManager;peerId;upgrader;addressManager;connectionGater;reservationStore;logger;maxInboundStopStreams;maxOutboundStopStreams;started;log;shutdownController;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=e.registrar,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.logger=e.logger,this.peerId=e.peerId,this.upgrader=e.upgrader,this.addressManager=e.addressManager,this.connectionGater=e.connectionGater,this.maxInboundStopStreams=t.maxInboundStopStreams??300,this.maxOutboundStopStreams=t.maxOutboundStopStreams??300,this.shutdownController=new AbortController,this.discovery=new $(e,{filter:t.discoveryFilter??l(4096,.001)}),this.discovery.addEventListener("relay:discover",e=>{this.reservationStore.addRelay(e.detail,"discovered").catch(t=>{"HadEnoughRelaysError"!==t.name&&"RelayQueueFullError"!==t.name&&this.log.error("could not add discovered relay %p",e.detail,t)})}),this.reservationStore=new Y(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{this.discovery?.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{this.discovery?.stopDiscovery()}),this.started=!1}[Symbol.toStringTag]="@libp2p/circuit-relay-v2-transport";[n.Ch]=["@libp2p/transport","@libp2p/circuit-relay-v2-transport"];get[n.VM](){return null!=this.discovery?["@libp2p/identify"]:[]}[s._J]=!0;isStarted(){return this.started}async start(){this.shutdownController=new AbortController,(0,y.k)(1/0,this.shutdownController.signal),await this.registrar.handle(x,e=>{const t=this.upgrader.createInboundAbortSignal(this.shutdownController.signal);this.onStop(e,t).catch(t=>{this.log.error("error while handling STOP protocol",t),e.stream.abort(t)}).finally(()=>{t.clear()})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),await(0,i.ni)(this.discovery,this.reservationStore),this.started=!0}async stop(){this.shutdownController.abort(),await(0,i.ds)(this.discovery,this.reservationStore),await this.registrar.unhandle(x),this.started=!1}async dial(e,t){if(1!==e.protoCodes().filter(e=>290===e).length){const t="Invalid circuit relay address";throw this.log.error(t,e),new o.zm(t)}const r=e.toString().split("/p2p-circuit"),n=(0,p.HZ)(r[0]),s=(0,p.HZ)(r[r.length-1]),i=n.getPeerId(),a=s.getPeerId();if(null==i||null==a){const t=`ircuit relay dial to ${e.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${t}`),new o.zm(`C${t}`)}const c=(0,u.XL)(i),l=(0,u.XL)(a);let h,d=this.connectionManager.getConnections(c)[0];null==d?(await this.peerStore.merge(c,{multiaddrs:[n]}),t.onProgress?.(new b.j("circuit-relay:open-connection")),d=await this.connectionManager.openConnection(c,t)):t.onProgress?.(new b.j("circuit-relay:reuse-connection"));try{t.onProgress?.(new b.j("circuit-relay:open-hop-stream")),h=await d.newStream(E,t);const r=(0,m.z)(h),i=r.pb(S);t.onProgress?.(new b.j("circuit-relay:write-connect-message")),await i.write({type:S.Type.CONNECT,peer:{id:l.toMultihash().bytes,addrs:[(0,p.HZ)(s).bytes]}},t),t.onProgress?.(new b.j("circuit-relay:read-connect-response"));const a=await i.read(t);if(a.status!==P.OK)throw new o.L(`failed to connect via relay with status ${a?.status?.toString()??"undefined"}`);const c=new B(a.limit),u=f({stream:r.unwrap(),remoteAddr:e,localAddr:n.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),logger:this.logger,onDataRead:c.onData,onDataWrite:c.onData});return this.log("new outbound relayed connection %a",u.remoteAddr),await this.upgrader.upgradeOutbound(u,{...t,limits:c.getLimits()})}catch(e){throw this.log.error("circuit relay dial to destination %p via relay %p failed",l,c,e),h?.abort(e),e}}createListener(e){return function(e){return new V(e)}({peerId:this.peerId,connectionManager:this.connectionManager,addressManager:this.addressManager,reservationStore:this.reservationStore,logger:this.logger})}listenFilter(e){return(e=Array.isArray(e)?e:[e]).filter(e=>N.exactMatch(e)||O.exactMatch(e))}dialFilter(e){return(e=Array.isArray(e)?e:[e]).filter(e=>g.uu.exactMatch(e))}async onStop({connection:e,stream:t},r){if(!this.reservationStore.hasReservation(e.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.transportManager.listen([e.remoteAddr.encapsulate("/p2p-circuit")])}catch(e){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",e)}const n=(0,m.z)(t).pb(A),s=await n.read({signal:r});if(this.log("new circuit relay v2 stop stream from %p with type %s",e.remotePeer,s.type),void 0===s?.type)return this.log.error("type was missing from circuit v2 stop protocol request from %s",e.remotePeer),await n.write({type:A.Type.STATUS,status:P.MALFORMED_MESSAGE},{signal:r}),void await t.close();if(s.type!==A.Type.CONNECT)return this.log.error("invalid stop connect request via peer %p",e.remotePeer),await n.write({type:A.Type.STATUS,status:P.UNEXPECTED_MESSAGE},{signal:r}),void await t.close();if(!(e=>{if(null==e.peer)return!1;try{e.peer.addrs.forEach(p.HZ)}catch{return!1}return!0})(s))return this.log.error("invalid stop connect request via peer %p",e.remotePeer),await n.write({type:A.Type.STATUS,status:P.MALFORMED_MESSAGE},{signal:r}),void await t.close({signal:r});const i=(0,u.jD)(w.decode(s.peer.id));if(!0===await(this.connectionGater.denyInboundRelayedConnection?.(e.remotePeer,i)))return this.log.error("connection gater denied inbound relayed connection from %p",e.remotePeer),await n.write({type:A.Type.STATUS,status:P.PERMISSION_DENIED},{signal:r}),void await t.close({signal:r});this.log.trace("sending success response to %p",e.remotePeer),await n.write({type:A.Type.STATUS,status:P.OK},{signal:r});const o=new B(s.limit),a=e.remoteAddr.encapsulate(`/p2p-circuit/p2p/${i.toString()}`),c=this.addressManager.getAddresses()[0],l=f({stream:n.unwrap().unwrap(),remoteAddr:a,localAddr:c,logger:this.logger,onDataRead:o.onData,onDataWrite:o.onData});this.log("new inbound relayed connection %a",l.remoteAddr),await this.upgrader.upgradeInbound(l,{limits:o.getLimits(),signal:r}),this.log("%s connection %a upgraded","inbound",l.remoteAddr)}}function X(e={}){return t=>new Q(t,e)}},8661:(e,t,r)=>{"use strict";r.d(t,{Q:()=>s,e:()=>n});const n=Symbol.for("@libp2p/peer-id");function s(e){return Boolean(e?.[n])}},8776:(e,t,r)=>{"use strict";r.d(t,{gh:()=>s,R6:()=>i.R}),r(9248),r(9566);var n=r(7136);r(5706);class s extends n.q{constructor(e,{allowlist:t=[/./],denylist:r=[]}={}){super(e=>this._match(e),e),this._allowlist=t,this._denylist=r}_match({url:e,request:t}){if(t&&"navigate"!==t.mode)return!1;const r=e.pathname+e.search;for(const e of this._denylist)if(e.test(r))return!1;return!!this._allowlist.some(e=>e.test(r))}}r(6419);var i=r(2095);r(6760),r(8192)},8803:(e,t,r)=>{"use strict";r.a(e,async(e,n)=>{try{r.r(t);var s=r(7638),i=r(853),o=r(38),a=r(3848),c=r(4135),l=r(2988),u=r(4523),h=r(8566),d=r(5291),f=r(7908),p=r(2158),g=r(6837),m=r(8776);let y,w;self.addEventListener("install",e=>{console.log("Service Worker: Installed"),self.skipWaiting()}),self.addEventListener("activate",e=>{console.log("Service Worker: Activated"),e.waitUntil(self.clients.claim())}),y=await(0,s.E)({addresses:{listen:["/p2p-circuit"]},transports:[(0,i.q)(),(0,h.y)()],connectionEncrypters:[(0,o.f)()],streamMuxers:[(0,a.N)()],connectionGater:{denyDialMultiaddr:()=>!1},services:{identify:(0,l.l)(),identifyPush:(0,l.d)(),ping:(0,u.h)()}});const b=async e=>{console.log("Initing SW LibP2P Node with: ",e),w=await(0,s.E)({privateKey:(0,f.zI)(e.privKey),addresses:{listen:["/p2p-circuit"]},transports:[(0,i.q)(),(0,h.y)()],connectionEncrypters:[(0,o.f)()],streamMuxers:[(0,a.N)()],connectionGater:{denyDialMultiaddr:()=>!1},services:{identify:(0,l.l)(),identifyPush:(0,l.d)(),ping:(0,u.h)()}}),console.log(y),await w.start();for(let e in w.getMultiaddrs())console.log("SW MultiAddr[s]",y.getMultiaddrs[e])};async function v(e,t){console.log("Bootstrapping SW with: ",t),e.addEventListener("connection:open",e=>{console.log("Connection Opened")}),e.addEventListener("connection:close",e=>{console.log("Connection closed")});let r=[];for(let e in t)r.push((0,c.HZ)(t[e]));for(let t in r)await e.dialProtocol(r[t],"/ipfs/id/1.0.0")}let E;self.addEventListener("message",async e=>{if(e.data&&"2.0"===e.data.jsonrpc)"init"===e.data.method?b(e.data.params):console.log("Unknown method");else if(e.data&&"ADD_WEBTRANSPORT_ADDRS"===e.data.type){console.log("Bootstrapped PeerData: ",e.data.data.peerData),await v(y,e.data.data.peerData);let t=[];for(let r in e.data.data.peerData)t.push((0,c.HZ)(e.data.data.peerData[r]));try{y.peerStore.save((0,d.XL)(e.data.data.peerId.toString()),t),await y.dial(e.data.data.peerData[0])}catch(e){console.log(e)}}}),self.addEventListener("message",e=>{if(e.data&&"GET_PEER_ID"===e.data.type){const t=y.peerId.toString();e.source.postMessage({type:"PEER_ID_RESPONSE",peerId:t})}}),self.addEventListener("fetch",e=>{e.request.url.match(/\.libp2p\/.*$/)&&e.respondWith((async()=>{const t=e.request.clone();for(const[e,r]of t.headers);"GET"!==t.method&&"HEAD"!==t.method&&await t.clone().text();let r=await y.peerStore.all(),n="";for(const[e,r]of t.headers)n+=`${e}: ${r}\r\n`;const s=new URL(t.url),i=s.pathname,o=s.search;let a=`Host: ${s.host}\r\n`,c="";"GET"!==t.method&&"HEAD"!==t.method&&(c=await t.text(),n+=`content-length: ${(new TextEncoder).encode(c).length}\r\n`);let l=`${t.method} ${i}${o} HTTP/1.1\r\n`+a+n+"\r\n"+c,u=await(0,p.q)(y,r[0].id,l);const[h,...d]=u.split("\r\n"),[f,g,m]=h.split(" ");let w=d.indexOf("");const b=d.slice(0,w),v=new Headers;let E,x=!1;if(b.forEach(e=>{const[t,r]=e.split(": ").map(e=>e.trim());t&&r&&(v.append(t,r),"transfer-encoding"===t.toLowerCase()&&"chunked"===r.toLowerCase()&&(x=!0))}),x){const e=d.slice(w+1);let t="",r=0;for(;r<e.length;){const n=e[r].trim();if(0===parseInt(n,16))break;r++,t+=e.slice(r,r+1).join("\r\n"),r+=1,""===e[r]&&r++}E=t}else E=d.slice(w+1).join("\r\n");return new Response(E,{status:parseInt(g),statusText:m,headers:v})})())}),self.addEventListener("message",e=>{e.data&&"SKIP_WAITING"===e.data.type&&self.skipWaiting()}),(0,g.ok)(self.__WB_MANIFEST),(0,g.Up)(),(void 0).DEV&&(E=[/^\/$/]),(0,m.R6)(new m.gh((0,g.N6)("index.html"),{allowlist:E})),n()}catch(x){n(x)}},1)},8935:(e,t,r)=>{"use strict";r.d(t,{do:()=>c,vm:()=>o,JI:()=>a});const n=45,s=15,i=new class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,r=e();return void 0===r&&(this.index=t),r}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,r){return this.readAtomically(()=>{if(!(t>0&&void 0===this.readGivenChar(e)))return r()})}readNumber(e,t,r,n){return this.readAtomically(()=>{let s=0,i=0;const o=this.peekChar();if(void 0===o)return;const a="0"===o,c=2**(8*n)-1;for(;;){const r=this.readAtomically(()=>{const t=this.readChar();if(void 0===t)return;const r=Number.parseInt(t,e);return Number.isNaN(r)?void 0:r});if(void 0===r)break;if(s*=e,s+=r,s>c)return;if(i+=1,void 0!==t&&i>t)return}return 0===i||!r&&a&&i>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const r=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(void 0===r)return;e[t]=r}return e})}readIPv6Addr(){const e=e=>{for(let t=0;t<e.length/2;t++){const r=2*t;if(t<e.length-3){const n=this.readSeparator(":",t,()=>this.readIPv4Addr());if(void 0!==n)return e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[3],[r+4,!0]}const n=this.readSeparator(":",t,()=>this.readNumber(16,4,!0,2));if(void 0===n)return[r,!1];e[r]=n>>8,e[r+1]=255&n}return[e.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[r,n]=e(t);if(16===r)return t;if(n)return;if(void 0===this.readGivenChar(":"))return;if(void 0===this.readGivenChar(":"))return;const s=new Uint8Array(14),i=16-(r+2),[o]=e(s.subarray(0,i));return t.set(s.subarray(0,o),16-o),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};function o(e){if(!(e.length>s))return i.new(e).parseWith(()=>i.readIPv4Addr())}function a(e){if(e.includes("%")&&(e=e.split("%")[0]),!(e.length>n))return i.new(e).parseWith(()=>i.readIPv6Addr())}function c(e,t=!1){if(e.includes("%")&&(e=e.split("%")[0]),e.length>n)return;const r=i.new(e).parseWith(()=>i.readIPAddr());return r?t&&4===r.length?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,r[0],r[1],r[2],r[3]]):r:void 0}},8980:()=>{"use strict";try{self["workbox:strategies:7.2.0"]&&_()}catch(e){}},9163:(e,t,r)=>{"use strict";r.d(t,{w:()=>s});var n=r(250);class s extends n.o{has(e){return null!=this.find(e)}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}},9248:(e,t,r)=>{"use strict";r(9538),r(7944)},9460:(e,t,r)=>{"use strict";r.d(t,{Ak:()=>c,UT:()=>v,Xf:()=>w,fH:()=>y,hT:()=>m,u0:()=>a});var n=r(8289),s=r(3801);const i=BigInt(0),o=BigInt(1);function a(e,t){const r=t.negate();return e?r:t}function c(e,t,r){const n="pz"===t?e=>e.pz:e=>e.ez,i=(0,s.pS)(e.Fp,r.map(n));return r.map((e,t)=>e.toAffine(i[t])).map(e.fromAffine)}function l(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function u(e,t){l(e,t);const r=2**e;return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1),mask:(0,n.OG)(e),maxNumber:r,shiftBy:BigInt(e)}}function h(e,t,r){const{windowSize:n,mask:s,maxNumber:i,shiftBy:a}=r;let c=Number(e&s),l=e>>a;c>n&&(c-=i,l+=o);const u=t*n;return{nextN:l,offset:u+Math.abs(c)-1,isZero:0===c,isNeg:c<0,isNegF:t%2!=0,offsetF:u}}const d=new WeakMap,f=new WeakMap;function p(e){return f.get(e)||1}function g(e){if(e!==i)throw new Error("invalid wNAF")}function m(e,t){return{constTimeNegate:a,hasPrecomputes:e=>1!==p(e),unsafeLadder(t,r,n=e.ZERO){let s=t;for(;r>i;)r&o&&(n=n.add(s)),s=s.double(),r>>=o;return n},precomputeWindow(e,r){const{windows:n,windowSize:s}=u(r,t),i=[];let o=e,a=o;for(let e=0;e<n;e++){a=o,i.push(a);for(let e=1;e<s;e++)a=a.add(o),i.push(a);o=a.double()}return i},wNAF(r,n,s){let i=e.ZERO,o=e.BASE;const c=u(r,t);for(let e=0;e<c.windows;e++){const{nextN:t,offset:r,isZero:l,isNeg:u,isNegF:d,offsetF:f}=h(s,e,c);s=t,l?o=o.add(a(d,n[f])):i=i.add(a(u,n[r]))}return g(s),{p:i,f:o}},wNAFUnsafe(r,n,s,o=e.ZERO){const a=u(r,t);for(let e=0;e<a.windows&&s!==i;e++){const{nextN:t,offset:r,isZero:i,isNeg:c}=h(s,e,a);if(s=t,!i){const e=n[r];o=o.add(c?e.negate():e)}}return g(s),o},getPrecomputes(e,t,r){let n=d.get(t);return n||(n=this.precomputeWindow(t,e),1!==e&&("function"==typeof r&&(n=r(n)),d.set(t,n))),n},wNAFCached(e,t,r){const n=p(e);return this.wNAF(n,this.getPrecomputes(n,e,r),t)},wNAFCachedUnsafe(e,t,r,n){const s=p(e);return 1===s?this.unsafeLadder(e,t,n):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),t,n)},setWindowSize(e,r){l(r,t),f.set(e,r),d.delete(e)}}}function y(e,t,r,n){let s=t,a=e.ZERO,c=e.ZERO;for(;r>i||n>i;)r&o&&(a=a.add(s)),n&o&&(c=c.add(s)),s=s.double(),r>>=o,n>>=o;return{p1:a,p2:c}}function w(e,t,r,s){(function(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((e,r)=>{if(!(e instanceof t))throw new Error("invalid point at index "+r)})})(r,e),function(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((e,r)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+r)})}(s,t);const i=r.length,o=s.length;if(i!==o)throw new Error("arrays of points and scalars must have equal length");const a=e.ZERO,c=(0,n.dJ)(BigInt(i));let l=1;c>12?l=c-3:c>4?l=c-2:c>0&&(l=2);const u=(0,n.OG)(l),h=new Array(Number(u)+1).fill(a);let d=a;for(let e=Math.floor((t.BITS-1)/l)*l;e>=0;e-=l){h.fill(a);for(let t=0;t<o;t++){const n=s[t],i=Number(n>>BigInt(e)&u);h[i]=h[i].add(r[t])}let t=a;for(let e=h.length-1,r=a;e>0;e--)r=r.add(h[e]),t=t.add(r);if(d=d.add(t),0!==e)for(let e=0;e<l;e++)d=d.double()}return d}function b(e,t){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return(0,s.jr)(t),t}return(0,s.D0)(e)}function v(e,t,r={}){if(!t||"object"!=typeof t)throw new Error(`expected valid ${e} CURVE object`);for(const e of["p","n","h"]){const r=t[e];if(!("bigint"==typeof r&&r>i))throw new Error(`CURVE.${e} must be positive bigint`)}const n=b(t.p,r.Fp),s=b(t.n,r.Fn),o=["Gx","Gy","a","weierstrass"===e?"b":"d"];for(const e of o)if(!n.isValid(t[e]))throw new Error(`CURVE.${e} must be valid field element of CURVE.Fp`);return{Fp:n,Fn:s}}},9488:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var n=r(1266);function s(e){return null!=e[Symbol.asyncIterator]}const i=function(...e){const t=[];for(const r of e)s(r)||t.push(r);return t.length===e.length?function*(e){for(const t of e)yield*t}(t):async function*(e){const t=new AbortController,r=(0,n.L)();(async function(e,t,r){try{await Promise.all(e.map(async e=>{for await(const n of e)await t.push(n,{signal:r}),r.throwIfAborted()})),await t.end(void 0,{signal:r})}catch(e){await t.end(e,{signal:r}).catch(()=>{})}})(e,r,t.signal).catch(()=>{});try{yield*r}finally{t.abort()}}(e)}},9538:(e,t,r)=>{"use strict";r.d(t,{R:()=>n}),r(7944);class n extends Error{constructor(e,t){super(((e,...t)=>{let r=e;return t.length>0&&(r+=` :: ${JSON.stringify(t)}`),r})(e,t)),this.name=e,this.details=t}}},9566:(e,t,r)=>{"use strict";r(7944)},9583:(e,t,r)=>{"use strict";function n(e){return null!=e&&"function"==typeof e.start&&"function"==typeof e.stop}async function s(...e){const t=[];for(const r of e)n(r)&&t.push(r);await Promise.all(t.map(async e=>{null!=e.beforeStart&&await e.beforeStart()})),await Promise.all(t.map(async e=>{await e.start()})),await Promise.all(t.map(async e=>{null!=e.afterStart&&await e.afterStart()}))}async function i(...e){const t=[];for(const r of e)n(r)&&t.push(r);await Promise.all(t.map(async e=>{null!=e.beforeStop&&await e.beforeStop()})),await Promise.all(t.map(async e=>{await e.stop()})),await Promise.all(t.map(async e=>{null!=e.afterStop&&await e.afterStop()}))}r.d(t,{ds:()=>i,ni:()=>s,nw:()=>n})},9621:(e,t,r)=>{"use strict";r.d(t,{Ci:()=>n,Xn:()=>o,gG:()=>i,yI:()=>s});class n extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"}class s extends Error{static name="ValidationError";name="ValidationError"}class i extends Error{static name="InvalidParametersError";name="InvalidParametersError"}class o extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"}},9809:(e,t,r)=>{"use strict";r.r(t),r.d(t,{identity:()=>o});var n=r(6129),s=r(6915);const i=n.au,o={code:0,name:"identity",encode:i,digest:function(e){return s.create(0,i(e))}}},9820:(e,t,r)=>{"use strict";r.d(t,{V:()=>l});var n=r(1252),s=r(5082),i=r(86);class o extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class a extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class c extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}function l(e,t={}){const r=(0,n.p)(e,t);null!=t.maxDataLength&&null==t.maxLengthLength&&(t.maxLengthLength=s.OY(t.maxDataLength));const l=t?.lengthDecoder??s.D4,u=t?.lengthEncoder??s.lF;return{read:async e=>{let n=-1;const s=new i.I;for(;;){s.append(await r.read({...e,bytes:1}));try{n=l(s)}catch(e){if(e instanceof RangeError)continue;throw e}if(n<0)throw new o("Invalid message length");if(null!=t?.maxLengthLength&&s.byteLength>t.maxLengthLength)throw new c("message length length too long");if(n>-1)break}if(null!=t?.maxDataLength&&n>t.maxDataLength)throw new a("message length too long");return r.read({...e,bytes:n})},write:async(e,t)=>{await r.write(new i.I(u(e.byteLength),e),t)},writeV:async(e,t)=>{const n=new i.I(...e.flatMap(e=>[u(e.byteLength),e]));await r.write(n,t)},unwrap:()=>r.unwrap()}}},9944:function(e,t){(function(){var e,r,n,s,i,o,a,c;c=function(e){return[(e&255<<24)>>>24,(e&255<<16)>>>16,(65280&e)>>>8,255&e].join(".")},a=function(e){var t,n,s,i,o,a;for(t=[],s=i=0;i<=3&&0!==e.length;s=++i){if(s>0){if("."!==e[0])throw new Error("Invalid IP");e=e.substring(1)}o=(a=r(e))[0],n=a[1],e=e.substring(n),t.push(o)}if(0!==e.length)throw new Error("Invalid IP");switch(t.length){case 1:if(t[0]>4294967295)throw new Error("Invalid IP");return t[0]>>>0;case 2:if(t[0]>255||t[1]>16777215)throw new Error("Invalid IP");return(t[0]<<24|t[1])>>>0;case 3:if(t[0]>255||t[1]>255||t[2]>65535)throw new Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2])>>>0;case 4:if(t[0]>255||t[1]>255||t[2]>255||t[3]>255)throw new Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2]<<8|t[3])>>>0;default:throw new Error("Invalid IP")}},s=(n=function(e){return e.charCodeAt(0)})("0"),o=n("a"),i=n("A"),r=function(e){var t,r,a,c,l;for(c=0,t=10,r="9",a=0,e.length>1&&"0"===e[a]&&("x"===e[a+1]||"X"===e[a+1]?(a+=2,t=16):"0"<=e[a+1]&&e[a+1]<="9"&&(a++,t=8,r="7")),l=a;a<e.length;){if("0"<=e[a]&&e[a]<=r)c=c*t+(n(e[a])-s)>>>0;else{if(16!==t)break;if("a"<=e[a]&&e[a]<="f")c=c*t+(10+n(e[a])-o)>>>0;else{if(!("A"<=e[a]&&e[a]<="F"))break;c=c*t+(10+n(e[a])-i)>>>0}}if(c>4294967295)throw new Error("too large");a++}if(a===l)throw new Error("empty octet");return[c,a]},e=function(){function e(e,t){var r,n,s;if("string"!=typeof e)throw new Error("Missing `net' parameter");if(t||(s=e.split("/",2),e=s[0],t=s[1]),t||(t=32),"string"==typeof t&&t.indexOf(".")>-1){try{this.maskLong=a(t)}catch(e){throw new Error("Invalid mask: "+t)}for(r=n=32;n>=0;r=--n)if(this.maskLong===4294967295<<32-r>>>0){this.bitmask=r;break}}else{if(!t&&0!==t)throw new Error("Invalid mask: empty");this.bitmask=parseInt(t,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0)}try{this.netLong=(a(e)&this.maskLong)>>>0}catch(t){throw new Error("Invalid net address: "+e)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+t);this.size=Math.pow(2,32-this.bitmask),this.base=c(this.netLong),this.mask=c(this.maskLong),this.hostmask=c(~this.maskLong),this.first=this.bitmask<=30?c(this.netLong+1):this.base,this.last=this.bitmask<=30?c(this.netLong+this.size-2):c(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?c(this.netLong+this.size-1):void 0}return e.prototype.contains=function(t){return"string"==typeof t&&(t.indexOf("/")>0||4!==t.split(".").length)&&(t=new e(t)),t instanceof e?this.contains(t.base)&&this.contains(t.broadcast||t.last):(a(t)&this.maskLong)>>>0==(this.netLong&this.maskLong)>>>0},e.prototype.next=function(t){return null==t&&(t=1),new e(c(this.netLong+this.size*t),this.mask)},e.prototype.forEach=function(e){var t,r,n;for(n=a(this.first),r=a(this.last),t=0;n<=r;)e(c(n),n,t),t++,n++},e.prototype.toString=function(){return this.base+"/"+this.bitmask},e}(),t.ip2long=a,t.long2ip=c,t.Netmask=e}).call(this)},9986:(e,t,r)=>{"use strict";r.d(t,{F:()=>i});var n=r(6513),s=r(9488);function i(e,...t){if(null==e)throw new Error("Empty pipeline");if(l(e)){const t=e;e=()=>t.source}else if(c(e)||a(e)){const t=e;e=()=>t}const r=[e,...t];if(r.length>1&&l(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let e=1;e<r.length-1;e++)l(r[e])&&(r[e]=u(r[e]));return o(...r)}const o=(...e)=>{let t;for(;e.length>0;)t=e.shift()(t);return t},a=e=>null!=e?.[Symbol.asyncIterator],c=e=>null!=e?.[Symbol.iterator],l=e=>null!=e&&null!=e.sink&&null!=e.source,u=e=>t=>{const r=e.sink(t);if(null!=r?.then){const t=(0,n.Ny)({objectMode:!0});let i;r.then(()=>{t.end()},e=>{t.end(e)});const o=e.source;if(a(o))i=async function*(){yield*o,t.end()};else{if(!c(o))throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");i=function*(){yield*o,t.end()}}return(0,s.A)(t,i())}return e.source}}},i={};function o(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return s[e].call(r.exports,r,r.exports,o),r.exports}return e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",n=e=>{e&&e.d<1&&(e.d=1,e.forEach(e=>e.r--),e.forEach(e=>e.r--?e.r++:e()))},o.a=(s,i,o)=>{var a;o&&((a=[]).d=-1);var c,l,u,h=new Set,d=s.exports,f=new Promise((e,t)=>{u=t,l=e});f[t]=d,f[e]=e=>(a&&e(a),h.forEach(e),f.catch(e=>{})),s.exports=f,i(s=>{var i;c=(s=>s.map(s=>{if(null!==s&&"object"==typeof s){if(s[e])return s;if(s.then){var i=[];i.d=0,s.then(e=>{o[t]=e,n(i)},e=>{o[r]=e,n(i)});var o={};return o[e]=e=>e(i),o}}var a={};return a[e]=e=>{},a[t]=s,a}))(s);var o=()=>c.map(e=>{if(e[r])throw e[r];return e[t]}),l=new Promise(t=>{(i=()=>t(o)).r=0;var r=e=>e!==a&&!h.has(e)&&(h.add(e),e&&!e.d&&(i.r++,e.push(i)));c.map(t=>t[e](r))});return i.r?l:o()},e=>(e?u(f[r]=e):l(d),n(a))),a&&a.d<0&&(a.d=0)},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o(8803)})());